/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","./func","./pathmaker","./findFormat","./Binder"],function(e,t,r,s,a,n){var i=/_{2,}/;function l(e){for(var t=arguments,r=1;r<t.length;r++)if(-1!==e.indexOf(t[r]))return!1;return!0}return function c(u,f,d,o){var b=f.split(i);if(-1!==b.indexOf("|")){if(!o){for(var h=[],g=[],p=0;p<b.length;p++){var v=b[p];"|"!==v?v&&h.push(v):(h.length&&g.push(c(u,h.join("__"),d)),h=[])}h.length&&g.push(c(u,h.join("__"),d,!0))}return g}var m=null,k=null,$=new n,x=[],O={},w=$.el=t(u);for(p=0;p<b.length;p++){var T=b[p].trim();if(T)if(p){var _;if("template"!==T&&"!template"!==T&&"strict"!==T?(-1===(k=T.indexOf(":"))&&(k=T.length,T+=":value"),K=T.substring(0,k).trim(),_=T.substring(k+1).trim()):K=T,"selector"===K){$[K]=_;continue}var y=K.indexOf(" ");if(!(V=l(-1===y?K:K.substring(0,y),"setter","strict","track","delay","import","class","template")&&"def"!==K.substring(0,3)?-1!==_.indexOf("=>")?r(r.rebinddecode(_)):r.isValue(_)?r("(value,path,el)=>"+r.rebinddecode(_),!0):"@"===_.substring(0,1)?$.com[_.substring(1)]:GET(_):1))return null;for(var E=K.split("+"),j=0;j<E.length;j++){var F="",G=!1,N=!1,q=!1;-1!==(k=(K=E[j].trim()).indexOf(" "))&&(F=K.substring(k+1),K=K.substring(0,k));var B=(K=K.replace(/^(~!|!~|!|~)/,function(e){return-1!==e.indexOf("!")&&(N=!0),-1!==e.indexOf("~")&&(G=!0),""})).substring(0,1);switch("class"===K&&(K="tclass"),"."===B&&(N&&(V.$nn=1),x.push({name:K.substring(1),fn:V}),K="class"),e.isFunction(V)&&(N&&(V.$nn=1),G&&(V.$nv=1)),K){case"track":$[K]=_.split(",").trim();continue;case"strict":$[K]=!0;continue;case"hidden":K="hide";break;case"exec":K="change";break;case"disable":K="disabled",q=!0;break;case"value":K="val",q=!0;break;case"default":K="def";break;case"delay":V=+_;break;case"href":case"src":case"val":case"title":case"html":case"text":case"disabled":case"enabled":case"checked":q=!0;break;case"setter":V=e.fn("(value,path,el)=>el.SETTER("+_+")"),N&&(V.$nn=1),G&&(V.$nv=1);break;case"import":B=_.substring(0,1),V=/^(https|http):\/\//.test(_)||"/"===B||"."===B?"."===B?_.substring(1):_:r(r.rebinddecode(_));break;case"tclass":V=_;break;case"template":var R=w.find("script");R.length||(R=w),V=Tangular.compile(R.html()),N&&(V.$nn=1),G&&(V.$nv=1)}if("def"===K&&(V=new Function("return "+_)()),q&&N&&($[K+"bk"]="src"==K||"href"==K||"title"==K?w.attr(K):"html"==K||"text"==K?w.html():"val"==K?w.val():"disabled"==K||"checked"==K?w.prop(K):""),F)if(O[F]||(O[F]={}),"class"!==K)O[F][K]=V;else{var S=x.pop();O[F].cls?O[F].cls.push(S):O[F].cls=[S]}else"class"!==K&&($[K]=V)}}else{var V;if("!"===(B=(m=T).substring(0,1))&&(m=m.substring(1),$.notnull=!0),1===b.length)return(V=GET(m))&&V.call($.el,$.el),V||null;if((h=a(m))&&(m=h.path,$.format=h.fn),"."===B){$.virtual=!0,m=m.substring(1);continue}if("."===m.substring(m.length-1)&&(m=m.substring(0,m.length-1)),"@"===m.substring(0,1)){var z=!1;"@"===(m=m.substring(1)).substring(0,1)&&(z=!0,m=m.substring(1)),m||(m="@");for(var A=u.parentNode;A;){if(z){if(A.$ctrl){$.com=A.$ctrl,"@"!==m||$.com.$dataw||($.com.$dataw=1,$.com.watch(function(e,t){$.com.data("@",t)}));break}}else if(A.$com){$.com=A.$com;break}A=A.parentNode}if(!$.com)return null}}}for(E=Object.keys(O),p=0;p<E.length;p++){var C=E[p];$.child||($.child=[]);var D=O[C];D.selector=C,$.child.push(D)}if(x.length&&($.classes=x),$.virtual)m=s(m);else{if(-1!==(m=$.com&&"@"===m.substring(0,1)?m:s(m)).indexOf("?")){var H=initscopes(d);if(!H)return;m=m.replace(/\?/g,H.path)}var I=m.split(".");if(S="",$.com)!$.com.$data[m]&&($.com.$data[m]={value:null,items:[]}),$.com.$data[m].items.push($);else{p=0;for(var J=I.length;p<J;p++){S+=(S?".":"")+I[p];var K=p===J-1?S:"!"+S;binders[K]?binders[K].push($):binders[K]=[$]}}}if($.path=m,$.track)for(p=0;p<$.track.length;p++)$.track[p]=m+"."+$.track[p];return $.init=0,$.virtual||bindersnew.push($),$}});
//# sourceMappingURL=../sourcemaps/binding/parsebinder.js.map
