/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","./func","./pathmaker","./findFormat","./Binder"],function(e,t,r,s,a,n){function i(e){for(var t=arguments,r=1;r<t.length;r++)if(-1!==e.indexOf(t[r]))return!1;return!0}return function l(c,u,f,d,o){var h=d.binders,b=d.bindersnew,g=u.split(/_{2,}/);if(-1!==g.indexOf("|")){if(!o){for(var p=[],m=[],v=0;v<g.length;v++){var k=g[v];"|"!==k?k&&p.push(k):(p.length&&m.push(l(c,p.join("__"),f,d)),p=[])}p.length&&m.push(l(c,p.join("__"),f,d,!0))}return m}var $=null,x=null,O=new n,w=[],T={},_=O.el=t(c);for(v=0;v<g.length;v++){var y=g[v].trim();if(y)if(v){var E;if("template"!==y&&"!template"!==y&&"strict"!==y?(-1===(x=y.indexOf(":"))&&(x=y.length,y+=":value"),M=y.substring(0,x).trim(),E=y.substring(x+1).trim()):M=y,"selector"===M){O[M]=E;continue}var j=M.indexOf(" ");if(!(A=i(-1===j?M:M.substring(0,j),"setter","strict","track","delay","import","class","template")&&"def"!==M.substring(0,3)?-1!==E.indexOf("=>")?r(r.rebinddecode(E)):r.isValue(E)?r("(value,path,el)=>"+r.rebinddecode(E),!0):"@"===E.substring(0,1)?O.com[E.substring(1)]:GET(E):1))return null;for(var F=M.split("+"),G=0;G<F.length;G++){var N="",q=!1,B=!1,R=!1;-1!==(x=(M=F[G].trim()).indexOf(" "))&&(N=M.substring(x+1),M=M.substring(0,x));var S=(M=M.replace(/^(~!|!~|!|~)/,function(e){return-1!==e.indexOf("!")&&(B=!0),-1!==e.indexOf("~")&&(q=!0),""})).substring(0,1);switch("class"===M&&(M="tclass"),"."===S&&(B&&(A.$nn=1),w.push({name:M.substring(1),fn:A}),M="class"),e.isFunction(A)&&(B&&(A.$nn=1),q&&(A.$nv=1)),M){case"track":O[M]=E.split(",").trim();continue;case"strict":O[M]=!0;continue;case"hidden":M="hide";break;case"exec":M="change";break;case"disable":M="disabled",R=!0;break;case"value":M="val",R=!0;break;case"default":M="def";break;case"delay":A=+E;break;case"href":case"src":case"val":case"title":case"html":case"text":case"disabled":case"enabled":case"checked":R=!0;break;case"setter":A=e.fn("(value,path,el)=>el.SETTER("+E+")"),B&&(A.$nn=1),q&&(A.$nv=1);break;case"import":S=E.substring(0,1),A=/^(https|http):\/\//.test(E)||"/"===S||"."===S?"."===S?E.substring(1):E:r(r.rebinddecode(E));break;case"tclass":A=E;break;case"template":var V=_.find("script");V.length||(V=_),A=Tangular.compile(V.html()),B&&(A.$nn=1),q&&(A.$nv=1)}if("def"===M&&(A=new Function("return "+E)()),R&&B&&(O[M+"bk"]="src"==M||"href"==M||"title"==M?_.attr(M):"html"==M||"text"==M?_.html():"val"==M?_.val():"disabled"==M||"checked"==M?_.prop(M):""),N)if(T[N]||(T[N]={}),"class"!==M)T[N][M]=A;else{var z=w.pop();T[N].cls?T[N].cls.push(z):T[N].cls=[z]}else"class"!==M&&(O[M]=A)}}else{var A;if("!"===(S=($=y).substring(0,1))&&($=$.substring(1),O.notnull=!0),1===g.length)return(A=GET($))&&A.call(O.el,O.el),A||null;if((p=a($))&&($=p.path,O.format=p.fn),"."===S){O.virtual=!0,$=$.substring(1);continue}if("."===$.substring($.length-1)&&($=$.substring(0,$.length-1)),"@"===$.substring(0,1)){var C=!1;"@"===($=$.substring(1)).substring(0,1)&&(C=!0,$=$.substring(1)),$||($="@");for(var D=c.parentNode;D;){if(C){if(D.$ctrl){O.com=D.$ctrl,"@"!==$||O.com.$dataw||(O.com.$dataw=1,O.com.watch(function(e,t){O.com.data("@",t)}));break}}else if(D.$com){O.com=D.$com;break}D=D.parentNode}if(!O.com)return null}}}for(F=Object.keys(T),v=0;v<F.length;v++){var H=F[v];O.child||(O.child=[]);var I=T[H];I.selector=H,O.child.push(I)}if(w.length&&(O.classes=w),O.virtual)$=s($);else{if(-1!==($=O.com&&"@"===$.substring(0,1)?$:s($)).indexOf("?")){var J=initscopes(f);if(!J)return;$=$.replace(/\?/g,J.path)}var K=$.split(".");if(z="",O.com)!O.com.$data[$]&&(O.com.$data[$]={value:null,items:[]}),O.com.$data[$].items.push(O);else{v=0;for(var L=K.length;v<L;v++){var M;z+=(z?".":"")+K[v],h[M=v===L-1?z:"!"+z]?h[M].push(O):h[M]=[O]}}}if(O.path=$,O.track)for(v=0;v<O.track.length;v++)O.track[v]=$+"."+O.track[v];return O.init=0,O.virtual||b.push(O),O}});
//# sourceMappingURL=../sourcemaps/binding/parse.js.map
