/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../jc","../langx","./cache"],function(e,t,r,n){var s={},a={};function i(e){var t={};return e.split("\n").forEach(function(e){var r=e.indexOf(":");-1!==r&&(t[e.substring(0,r).toLowerCase()]=e.substring(r+1).trim())}),t}function o(e,r,s,a,i){s&&!s.version&&M.$version&&(s.version=M.$version),s&&!s.language&&M.$language&&(s.language=M.$language),s=t.stringify(s);var o=t.hashCode(e+"#"+r.replace(/\//g,"")+s).toString();return n.set(o,a,i)}function u(e,t){if(a.makeurl&&(e=a.makeurl(e)),t)return e;var r=[],n=encodeURIComponent;return M.$version&&r.push("version="+n(M.$version)),M.$language&&r.push("language="+n(M.$language)),r.length?(e+=-1==e.indexOf("?")?"?":"&")+r.join("&"):e}function c(e,n,s,a,i,o){var c,f=(e=e.$env().replace(/<.*?>/,function(e){return c=e.substring(1,e.length-1).trim(),""}).trim()).substring(0,1),d="once "===e.substring(0,5).toLowerCase();if(t.isFunction(s)?(t.isFunction(a)?(o=a,i=!0):typeof i===TYPE_FN&&(o=i,i=!0),a=s,s="body"):t.isFunction(i)&&(o=i,i=!0),c){var g="()"===c.substring(c.length-2);g&&(c=c.substring(0,c.length-2));var v=GET(c);if(g&&t.isFunction(v)){if(v())return void(a&&a(0))}else if(v)return void(a&&a(0))}"//"===e.substring(0,2)&&(e=location.protocol+e);var h=e.lastIndexOf(" ."),m="";if(-1!==h&&(m=e.substring(h).trim().toLowerCase(),e=e.substring(0,h).trim()),"!"===f||d){if(e=d?e.substring(5):e.substring(1),statics[e])return a&&(2===statics[e]?a(0):t.wait(function(){return 2===statics[e]},function(){a(0)})),W;statics[e]=1}if(s&&s.setPath&&(s=s.element),s||(s="body"),!m)if(-1!==(h=e.lastIndexOf("?"))){var y=e.lastIndexOf(".",h);-1!==y&&(m=e.substring(y,h).toLowerCase())}else-1!==(h=e.lastIndexOf("."))&&(m=e.substring(h).toLowerCase());var b=document;if(".js"===m){var x=b.createElement("script");return x.type="text/javascript",x.async=!1,x.onload=function(){statics[e]=2,a&&a(1),setTimeout(compile,300)},x.src=u(e,!0),b.getElementsByTagName("head")[0].appendChild(x),r.emit("import",e,$(x)),this}if(".css"===m){var T=b.createElement("link");return T.type="text/css",T.rel="stylesheet",T.href=u(e,!0),b.getElementsByTagName("head")[0].appendChild(T),statics[e]=2,a&&setTimeout(a,200,1),r.emit("import",e,$(T)),this}return t.wait(function(){return!!W.jQuery},function(){statics[e]=2;var u="import"+HASH(e),c=function(n,c,l){if(n){e="$import"+e,o&&(n=o(n,l));var p=REGCOM.test(n);n=importscripts(importstyles(n,u)).trim(),s=$(s),n&&(!1===i?s.html(n):s.append(n)),setTimeout(function(){p&&compile(),a&&t.wait(function(){return 0==C.is},function(){a(1)}),r.emit("import",e,s)},10)}else a&&a(0)};n?p("GET "+e,null,c,n):l("GET "+e,c)}),W}function l(e,r,n,o){typeof e===TYPE_FN&&(o=n,n=r,r=e,e=location.pathname);var c,l=typeof r,p=EMPTYARRAY;n||l!==TYPE_FN&&l!==TYPE_S||(o=n,n=r,r=void 0);var f=e.indexOf(" ");if(-1===f)return W;var d=!1;e=e.replace(/\srepeat/i,function(){return d=!0,""}),d&&(p=[e,r,n,o]);var g=e.substring(0,f).toUpperCase(),v="!"===g.substring(0,1);v&&(g=g.substring(1));var h={};return(c=e.match(/\{.*?\}/g))&&(e=e.replace(c,"").replace(/\s{2,}/g," "),typeof(c=new Function("return "+c)())===TYPE_O&&(h=c)),e=e.substring(f).trim().$env(),setTimeout(function(){if("GET"===g&&r){var o=typeof r===TYPE_S?r:jQuery.param(r,!0);o&&(e+="?"+o)}var c={};c.method=g,c.converters=a.jsonconverter,"GET"!==g&&(typeof r===TYPE_S?c.data=r:(c.contentType="application/json; charset=utf-8",c.data=STRINGIFY(r))),c.headers=$.extend(h,a.headers),e.match(/http:\/\/|https:\/\//i)?(c.crossDomain=!0,delete c.headers["X-Requested-With"],v&&(c.xhrFields={withCredentials:!0})):e=e.ROOT();var l=e.match(/\([a-z0-9\-.,]+\)/i);if(l){e=e.replace(l,"").replace(/\s+/g,""),c.url=e,l=l.toString().replace(/\(|\)/g,"").split(",");for(var f=0;f<l.length;f++){var m=s[l[f].trim()];m&&m(c)}}if(c.url||(c.url=e),!c.cancel){c.type=c.method,delete c.method;var y={};y.url=c.url,y.process=!0,y.error=!1,y.upload=!1,y.method=g,y.data=r,delete c.url,c.success=function(e,t,r){y.response=e,y.status=r.status||999,y.text=t,y.headers=i(r.getAllResponseHeaders()),y.process&&!y.cancel&&n&&n.call(y,y.response,void 0,y)},c.error=function(e,r){var s=e.status;if(!d||s&&408!==s&&502!==s&&503!==s&&504!==s&&509!==s){y.response=e.responseText,y.status=s||999,y.text=r,y.error=!0,y.headers=i(e.getAllResponseHeaders());var o=y.headers["content-type"];if(o&&-1!==o.indexOf("/json"))try{y.response=PARSE(y.response,a.jsondate)}catch(e){}!y.cancel&&y.process&&(a.ajaxerrors?n&&n.call(y,y.response,y.status,y):t.isFunction(n)&&n.call(y,y.response,y.status,y))}else setTimeout(function(){p[0]+=" REPEAT",W.AJAX.apply(M,p)},a.delayrepeat)},$.ajax(u(y.url),c)}},o||0),this}function p(e,r,n,s,a,i,u){(t.isFunction(r)||t.isString(r)&&t.isString(n)&&!t.isString(s))&&(i=a,a=s,s=n,n=r,r=null),t.isBoolean(a)&&(i=!0===a,a=0);var c=e.indexOf(" ");if(-1===c)return W;var p=e.substring(0,c).toUpperCase(),f=e.substring(c).trim().$env();return setTimeout(function(){var t=i?void 0:o(p,f,r,void 0,s);if(void 0===t)l(e,r,function(e,t){t&&(e=t),o(p,f,r,e,s),n(e,!1)});else{var a=u?STRINGIFY(t):null;if(n(t,!0),!u)return;l(e,r,function(e,t){t&&(e=t),a!==STRINGIFY(e)&&(o(p,f,r,e,s),n(e,!1,!0))})}},a||1),this}return a.ajaxerrors=!1,a.pingdata={},a.baseurl="",a.makeurl=null,a.delayrepeat=2e3,a.jsondate=!0,a.jsonconverter={"text json":function(e){return PARSE(e)}},a.headers={"X-Requested-With":"XMLHttpRequest"},e.http={defaults:a,ajax:l,ajaxCache:p,ajaxCacheReview:function(e,t,r,n,s,a){return p(e,t,r,n,s,a,!0)},configure:function(e,t){return s[e]=t,this},import2:function(e,r,n,s,a){return e instanceof Array?(t.isFunction(r)&&(a=s,s=n,n=r,r=null),e.wait(function(e,t){c(e,null,r,t,s,a)},function(){n&&n()})):c(e,null,r,n,s,a),this},importCache:c,makeParams:function(e,t,r){var n,s=location;typeof e===TYPE_O&&(r=t,t=e,e=s.pathname+s.search);var a=e.indexOf("?");-1!==a?(n=M.parseQuery(e.substring(a+1)),e=e.substring(0,a)):n={};for(var i=Object.keys(t),o=0,u=i.length;o<u;o++){var c=i[o];n[c]=t[c]}var l=$.param(n,null==r||!0===r);return e+(l?"?"+l:"")},ping:function(e,t,r){if(null==navigator.onLine||navigator.onLine){"boolean"==typeof t&&(r=t,t=0);var n=(e=e.$env()).indexOf(" "),s="GET";-1!==n&&(s=e.substring(0,n).toUpperCase(),e=e.substring(n).trim());var i={},o=$.param(a.pingdata);return o&&(n=e.lastIndexOf("?"),e+=-1===n?"?"+o:"&"+o),i.type=s,i.headers={"x-ping":location.pathname,"x-cookies":navigator.cookieEnabled?"1":"0","x-referrer":document.referrer},i.success=function(e){if(e)try{new Function(e)()}catch(e){}},r&&$.ajax(u(e),i),setInterval(function(){$.ajax(u(e),i)},t||3e4)}},parseQuery:function(e){if(e||(e=location.search),!e)return{};var t=e.indexOf("?");-1!==t&&(e=e.substring(t+1));for(var r=e.split("&"),n={},s=0,a=r.length;s<a;s++){var i=r[s].split("="),o=i[0],u=decodeURIComponent((i[1]||"").replace(/\+/g,"%20"));n[o]?(n[o]instanceof Array||(n[o]=[n[o]]),n[o].push(u)):n[o]=u}return n},upload:function(e,n,s,o,c){t.isNumber(o)||null!=c||(c=o,o=null),e||(e=location.pathname);var l="POST",p=e.indexOf(" "),f=null;-1!==p&&(l=e.substring(0,p).toUpperCase());var d="!"===l.substring(0,1);d&&(l=l.substring(1));var g={};(f=e.match(/\{.*?\}/g))&&(e=e.replace(f,"").replace(/\s{2,}/g," "),typeof(f=new Function("return "+f)())===TYPE_O&&(g=f)),e=e.substring(p).trim().$env(),typeof s===TYPE_N&&(o=s,s=void 0);var v={};if(v.url=e,v.process=!0,v.error=!1,v.upload=!0,v.method=l,v.data=n,r.emit("request",v),!v.cancel)return setTimeout(function(){var e=new XMLHttpRequest;d&&(e.withCredentials=!0),e.addEventListener("load",function(){var e=this.responseText;try{e=PARSE(e,a.jsondate)}catch(e){}c&&c(100),v.response=e,v.status=this.status,v.text=this.statusText,v.error=this.status>399,v.headers=i(this.getAllResponseHeaders()),r.emit("response",v),v.process&&!v.cancel&&(!e&&v.error&&(e=v.response=this.status+": "+this.statusText),!v.error||a.ajaxerrors?typeof s===TYPE_S?remap(s.env(),e):s&&s(e,null,v):(r.emit("error",v),v.process&&typeof s===TYPE_FN&&s({},e,v)))},!1),e.upload.onprogress=function(e){if(c){var t=0;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total)),c(t,e.transferSpeed,e.timeRemaining)}},e.open(l,u(v.url));for(var t=Object.keys(a.headers),o=0;o<t.length;o++)e.setRequestHeader(t[o].env(),a.headers[t[o]].env());if(g)for(t=Object.keys(g),o=0;o<t.length;o++)e.setRequestHeader(t[o],g[t[o]]);e.send(n)},o||0),W},uptodate:uptodate}});
//# sourceMappingURL=../sourcemaps/utils/http.js.map
