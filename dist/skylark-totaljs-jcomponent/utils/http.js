/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../jc","../langx","./cache"],function(e,t,r,n){var s=t.statics,a={},i={};function o(e){var t={};return e.split("\n").forEach(function(e){var r=e.indexOf(":");-1!==r&&(t[e.substring(0,r).toLowerCase()]=e.substring(r+1).trim())}),t}function u(e,r,s,a,i){s&&!s.version&&M.$version&&(s.version=M.$version),s&&!s.language&&M.$language&&(s.language=M.$language),s=t.stringify(s);var o=t.hashCode(e+"#"+r.replace(/\//g,"")+s).toString();return n.set(o,a,i)}function l(e,n,a,i,o,u){var l,f=(e=e.$env().replace(/<.*?>/,function(e){return l=e.substring(1,e.length-1).trim(),""}).trim()).substring(0,1),d="once "===e.substring(0,5).toLowerCase();if(t.isFunction(a)?(t.isFunction(i)?(u=i,o=!0):typeof o===TYPE_FN&&(u=o,o=!0),i=a,a="body"):t.isFunction(o)&&(u=o,o=!0),l){var h="()"===l.substring(l.length-2);h&&(l=l.substring(0,l.length-2));var v=GET(l);if(h&&t.isFunction(v)){if(v())return void(i&&i(0))}else if(v)return void(i&&i(0))}"//"===e.substring(0,2)&&(e=location.protocol+e);var g=e.lastIndexOf(" ."),m="";if(-1!==g&&(m=e.substring(g).trim().toLowerCase(),e=e.substring(0,g).trim()),"!"===f||d){if(e=d?e.substring(5):e.substring(1),s[e])return i&&(2===s[e]?i(0):t.wait(function(){return 2===s[e]},function(){i(0)})),W;s[e]=1}if(a&&a.setPath&&(a=a.element),a||(a="body"),!m)if(-1!==(g=e.lastIndexOf("?"))){var y=e.lastIndexOf(".",g);-1!==y&&(m=e.substring(y,g).toLowerCase())}else-1!==(g=e.lastIndexOf("."))&&(m=e.substring(g).toLowerCase());var b=document;if(".js"===m){var T=b.createElement("script");return T.type="text/javascript",T.async=!1,T.onload=function(){s[e]=2,i&&i(1),setTimeout(compile,300)},T.src=makeurl(e,!0),b.getElementsByTagName("head")[0].appendChild(T),r.emit("import",e,$(T)),this}if(".css"===m){var x=b.createElement("link");return x.type="text/css",x.rel="stylesheet",x.href=makeurl(e,!0),b.getElementsByTagName("head")[0].appendChild(x),s[e]=2,i&&setTimeout(i,200,1),r.emit("import",e,$(x)),this}return t.wait(function(){return!!W.jQuery},function(){s[e]=2;var l="import"+t.hashCode(e),f=function(n,s,c){if(n){e="$import"+e,u&&(n=u(n,c));var p=REGCOM.test(n);n=importscripts(importstyles(n,l)).trim(),a=$(a),n&&(!1===o?a.html(n):a.append(n)),setTimeout(function(){p&&compile(),i&&t.wait(function(){return 0==C.is},function(){i(1)}),r.emit("import",e,a)},10)}else i&&i(0)};n?p("GET "+e,null,f,n):c("GET "+e,f)}),W}function c(e,r,n,s){typeof e===TYPE_FN&&(s=n,n=r,r=e,e=location.pathname);var u,l=typeof r,c=EMPTYARRAY;n||l!==TYPE_FN&&l!==TYPE_S||(s=n,n=r,r=void 0);var p=e.indexOf(" ");if(-1===p)return W;var f=!1;e=e.replace(/\srepeat/i,function(){return f=!0,""}),f&&(c=[e,r,n,s]);var d=e.substring(0,p).toUpperCase(),h="!"===d.substring(0,1);h&&(d=d.substring(1));var v={};return(u=e.match(/\{.*?\}/g))&&(e=e.replace(u,"").replace(/\s{2,}/g," "),typeof(u=new Function("return "+u)())===TYPE_O&&(v=u)),e=e.substring(p).trim().$env(),setTimeout(function(){if("GET"===d&&r){var s=typeof r===TYPE_S?r:jQuery.param(r,!0);s&&(e+="?"+s)}var u={};u.method=d,u.converters=i.jsonconverter,"GET"!==d&&(typeof r===TYPE_S?u.data=r:(u.contentType="application/json; charset=utf-8",u.data=STRINGIFY(r))),u.headers=$.extend(v,i.headers),e.match(/http:\/\/|https:\/\//i)?(u.crossDomain=!0,delete u.headers["X-Requested-With"],h&&(u.xhrFields={withCredentials:!0})):e=e.ROOT();var l=e.match(/\([a-z0-9\-.,]+\)/i);if(l){e=e.replace(l,"").replace(/\s+/g,""),u.url=e,l=l.toString().replace(/\(|\)/g,"").split(",");for(var p=0;p<l.length;p++){var g=a[l[p].trim()];g&&g(u)}}if(u.url||(u.url=e),!u.cancel){u.type=u.method,delete u.method;var m={};m.url=u.url,m.process=!0,m.error=!1,m.upload=!1,m.method=d,m.data=r,delete u.url,u.success=function(e,t,r){m.response=e,m.status=r.status||999,m.text=t,m.headers=o(r.getAllResponseHeaders()),m.process&&!m.cancel&&n&&n.call(m,m.response,void 0,m)},u.error=function(e,r){var s=e.status;if(!f||s&&408!==s&&502!==s&&503!==s&&504!==s&&509!==s){m.response=e.responseText,m.status=s||999,m.text=r,m.error=!0,m.headers=o(e.getAllResponseHeaders());var a=m.headers["content-type"];if(a&&-1!==a.indexOf("/json"))try{m.response=PARSE(m.response,i.jsondate)}catch(e){}!m.cancel&&m.process&&(i.ajaxerrors?n&&n.call(m,m.response,m.status,m):t.isFunction(n)&&n.call(m,m.response,m.status,m))}else setTimeout(function(){c[0]+=" REPEAT",W.AJAX.apply(M,c)},i.delayrepeat)},$.ajax(makeurl(m.url),u)}},s||0),this}function p(e,r,n,s,a,i,o){(t.isFunction(r)||t.isString(r)&&t.isString(n)&&!t.isString(s))&&(i=a,a=s,s=n,n=r,r=null),t.isBoolean(a)&&(i=!0===a,a=0);var l=e.indexOf(" ");if(-1===l)return W;var p=e.substring(0,l).toUpperCase(),f=e.substring(l).trim().$env();return setTimeout(function(){var t=i?void 0:u(p,f,r,void 0,s);if(void 0===t)c(e,r,function(e,t){t&&(e=t),u(p,f,r,e,s),n(e,!1)});else{var a=o?STRINGIFY(t):null;if(n(t,!0),!o)return;c(e,r,function(e,t){t&&(e=t),a!==STRINGIFY(e)&&(u(p,f,r,e,s),n(e,!1,!0))})}},a||1),this}return i.ajaxerrors=!1,i.pingdata={},i.baseurl="",i.makeurl=null,i.delayrepeat=2e3,i.jsondate=!0,i.jsonconverter={"text json":function(e){return PARSE(e)}},i.headers={"X-Requested-With":"XMLHttpRequest"},e.http={defaults:i,ajax:c,ajaxCache:p,ajaxCacheReview:function(e,t,r,n,s,a){return p(e,t,r,n,s,a,!0)},configure:function(e,t){return a[e]=t,this},import2:function(e,r,n,s,a){return e instanceof Array?(t.isFunction(r)&&(a=s,s=n,n=r,r=null),e.wait(function(e,t){l(e,null,r,t,s,a)},function(){n&&n()})):l(e,null,r,n,s,a),this},importCache:l,makeParams:function(e,t,r){var n,s=location;typeof e===TYPE_O&&(r=t,t=e,e=s.pathname+s.search);var a=e.indexOf("?");-1!==a?(n=M.parseQuery(e.substring(a+1)),e=e.substring(0,a)):n={};for(var i=Object.keys(t),o=0,u=i.length;o<u;o++){var l=i[o];n[l]=t[l]}var c=$.param(n,null==r||!0===r);return e+(c?"?"+c:"")},ping:function(e,t,r){if(null==navigator.onLine||navigator.onLine){"boolean"==typeof t&&(r=t,t=0);var n=(e=e.$env()).indexOf(" "),s="GET";-1!==n&&(s=e.substring(0,n).toUpperCase(),e=e.substring(n).trim());var a={},o=$.param(i.pingdata);return o&&(n=e.lastIndexOf("?"),e+=-1===n?"?"+o:"&"+o),a.type=s,a.headers={"x-ping":location.pathname,"x-cookies":navigator.cookieEnabled?"1":"0","x-referrer":document.referrer},a.success=function(e){if(e)try{new Function(e)()}catch(e){}},r&&$.ajax(makeurl(e),a),setInterval(function(){$.ajax(makeurl(e),a)},t||3e4)}},parseQuery:function(e){if(e||(e=location.search),!e)return{};var t=e.indexOf("?");-1!==t&&(e=e.substring(t+1));for(var r=e.split("&"),n={},s=0,a=r.length;s<a;s++){var i=r[s].split("="),o=i[0],u=decodeURIComponent((i[1]||"").replace(/\+/g,"%20"));n[o]?(n[o]instanceof Array||(n[o]=[n[o]]),n[o].push(u)):n[o]=u}return n},upload:function(e,n,s,a,u){t.isNumber(a)||null!=u||(u=a,a=null),e||(e=location.pathname);var l="POST",c=e.indexOf(" "),p=null;-1!==c&&(l=e.substring(0,c).toUpperCase());var f="!"===l.substring(0,1);f&&(l=l.substring(1));var d={};(p=e.match(/\{.*?\}/g))&&(e=e.replace(p,"").replace(/\s{2,}/g," "),typeof(p=new Function("return "+p)())===TYPE_O&&(d=p)),e=e.substring(c).trim().$env(),typeof s===TYPE_N&&(a=s,s=void 0);var h={};if(h.url=e,h.process=!0,h.error=!1,h.upload=!0,h.method=l,h.data=n,r.emit("request",h),!h.cancel)return setTimeout(function(){var e=new XMLHttpRequest;f&&(e.withCredentials=!0),e.addEventListener("load",function(){var e=this.responseText;try{e=PARSE(e,i.jsondate)}catch(e){}u&&u(100),h.response=e,h.status=this.status,h.text=this.statusText,h.error=this.status>399,h.headers=o(this.getAllResponseHeaders()),r.emit("response",h),h.process&&!h.cancel&&(!e&&h.error&&(e=h.response=this.status+": "+this.statusText),!h.error||i.ajaxerrors?typeof s===TYPE_S?remap(s.env(),e):s&&s(e,null,h):(r.emit("error",h),h.process&&typeof s===TYPE_FN&&s({},e,h)))},!1),e.upload.onprogress=function(e){if(u){var t=0;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total)),u(t,e.transferSpeed,e.timeRemaining)}},e.open(l,makeurl(h.url));for(var t=Object.keys(i.headers),a=0;a<t.length;a++)e.setRequestHeader(t[a].env(),i.headers[t[a]].env());if(d)for(t=Object.keys(d),a=0;a<t.length;a++)e.setRequestHeader(t[a],d[t[a]]);e.send(n)},a||0),W},uptodate:uptodate}});
//# sourceMappingURL=../sourcemaps/utils/http.js.map
