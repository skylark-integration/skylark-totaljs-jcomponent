/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../jc","../langx","./cache"],function(e,t,r,n){var s=t.statics,i={},a={};function o(e,r){r.url=e;var n=t.Xhr.request(r.url,r);return(n=n.then(function(){r.success&&r.success.apply(this,arguments)},function(){r.error&&r.error.apply(this,arguments)})).success=n.done,n.error=n.fail,n.complete=n.always,n}function u(e){var t={};return e.split("\n").forEach(function(e){var r=e.indexOf(":");-1!==r&&(t[e.substring(0,r).toLowerCase()]=e.substring(r+1).trim())}),t}function c(e,r,s,i,a){s&&!s.version&&M.$version&&(s.version=M.$version),s&&!s.language&&M.$language&&(s.language=M.$language),s=t.stringify(s);var o=t.hashCode(e+"#"+r.replace(/\//g,"")+s).toString();return n.set(o,i,a)}function l(e,t){var r=[];encodeURIComponent;return r.length?(e+=-1==e.indexOf("?")?"?":"&")+r.join("&"):e}function p(e,n,i,a,o,u){var c,p=(e=e.$env().replace(/<.*?>/,function(e){return c=e.substring(1,e.length-1).trim(),""}).trim()).substring(0,1),h="once "===e.substring(0,5).toLowerCase();if(t.isFunction(i)?(t.isFunction(a)?(u=a,o=!0):t.isFunction(o)&&(u=o,o=!0),a=i,i="body"):t.isFunction(o)&&(u=o,o=!0),c){var g="()"===c.substring(c.length-2);g&&(c=c.substring(0,c.length-2));var v=GET(c);if(g&&t.isFunction(v)){if(v())return void(a&&a(0))}else if(v)return void(a&&a(0))}"//"===e.substring(0,2)&&(e=location.protocol+e);var m=e.lastIndexOf(" ."),b="";if(-1!==m&&(b=e.substring(m).trim().toLowerCase(),e=e.substring(0,m).trim()),"!"===p||h){if(e=h?e.substring(5):e.substring(1),s[e])return a&&(2===s[e]?a(0):t.wait(function(){return 2===s[e]},function(){a(0)})),W;s[e]=1}if(i&&i.setPath&&(i=i.element),i||(i="body"),!b)if(-1!==(m=e.lastIndexOf("?"))){var x=e.lastIndexOf(".",m);-1!==x&&(b=e.substring(x,m).toLowerCase())}else-1!==(m=e.lastIndexOf("."))&&(b=e.substring(m).toLowerCase());var y=document;if(".js"===b){var T=y.createElement("script");return T.type="text/javascript",T.async=!1,T.onload=function(){s[e]=2,a&&a(1),setTimeout(compile,300)},T.src=l(e),y.getElementsByTagName("head")[0].appendChild(T),r.emit("import",e,$(T)),this}if(".css"===b){var j=y.createElement("link");return j.type="text/css",j.rel="stylesheet",j.href=l(e),y.getElementsByTagName("head")[0].appendChild(j),s[e]=2,a&&setTimeout(a,200,1),r.emit("import",e,$(j)),this}return t.wait(function(){return!!W.jQuery},function(){s[e]=2;var c="import"+t.hashCode(e),l=function(n,s,l){if(n){e="$import"+e,u&&(n=u(n,l));var p=REGCOM.test(n);n=importscripts(importstyles(n,c)).trim(),i=$(i),n&&(!1===o?i.html(n):i.append(n)),setTimeout(function(){p&&compile(),a&&t.wait(function(){return 0==C.is},function(){a(1)}),r.emit("import",e,i)},10)}else a&&a(0)};n?d("GET "+e,null,l,n):f("GET "+e,l)}),W}function f(e,r,n,s){t.isFunction(e)&&(s=n,n=r,r=e,e=location.pathname);var c,p=typeof r,f=EMPTYARRAY;n||"function"!==p&&"string"!==p||(s=n,n=r,r=void 0);var d=e.indexOf(" ");if(-1===d)return W;var h=!1;e=e.replace(/\srepeat/i,function(){return h=!0,""}),h&&(f=[e,r,n,s]);var g=e.substring(0,d).toUpperCase(),v="!"===g.substring(0,1);v&&(g=g.substring(1));var m={};return(c=e.match(/\{.*?\}/g))&&(e=e.replace(c,"").replace(/\s{2,}/g," "),c=new Function("return "+c)(),t.isObject(c)&&(m=c)),e=e.substring(d).trim().$env(),setTimeout(function(){if("GET"===g&&r){var s=t.isString(r)?r:jQuery.param(r,!0);s&&(e+="?"+s)}var c={};c.method=g,c.converters=a.jsonconverter,"GET"!==g&&(t.isString(r)?c.data=r:(c.contentType="application/json; charset=utf-8",c.data=STRINGIFY(r))),c.headers=t.extend(m,a.headers),e.match(/http:\/\/|https:\/\//i)?(c.crossDomain=!0,delete c.headers["X-Requested-With"],v&&(c.xhrFields={withCredentials:!0})):e=e.ROOT();var p=e.match(/\([a-z0-9\-.,]+\)/i);if(p){e=e.replace(p,"").replace(/\s+/g,""),c.url=e,p=p.toString().replace(/\(|\)/g,"").split(",");for(var d=0;d<p.length;d++){var b=i[p[d].trim()];b&&b(c)}}if(c.url||(c.url=e),!c.cancel){c.type=c.method,delete c.method;var x={};x.url=c.url,x.process=!0,x.error=!1,x.upload=!1,x.method=g,x.data=r,delete c.url,c.success=function(e,t,r){x.response=e,x.status=r.status||999,x.text=t,x.headers=u(r.getAllResponseHeaders()),x.process&&!x.cancel&&n&&n.call(x,x.response,void 0,x)},c.error=function(e,r){var s=e.status;if(!h||s&&408!==s&&502!==s&&503!==s&&504!==s&&509!==s){x.response=e.responseText,x.status=s||999,x.text=r,x.error=!0,x.headers=u(e.getAllResponseHeaders());var i=x.headers["content-type"];if(i&&-1!==i.indexOf("/json"))try{x.response=PARSE(x.response,a.jsondate)}catch(e){}!x.cancel&&x.process&&(a.ajaxerrors?n&&n.call(x,x.response,x.status,x):t.isFunction(n)&&n.call(x,x.response,x.status,x))}else setTimeout(function(){f[0]+=" REPEAT",W.AJAX.apply(M,f)},a.delayrepeat)},o(l(x.url),c)}},s||0),this}function d(e,r,n,s,i,a,o){(t.isFunction(r)||t.isString(r)&&t.isString(n)&&!t.isString(s))&&(a=i,i=s,s=n,n=r,r=null),t.isBoolean(i)&&(a=!0===i,i=0);var u=e.indexOf(" ");if(-1===u)return W;var l=e.substring(0,u).toUpperCase(),p=e.substring(u).trim().$env();return setTimeout(function(){var t=a?void 0:c(l,p,r,void 0,s);if(void 0===t)f(e,r,function(e,t){t&&(e=t),c(l,p,r,e,s),n(e,!1)});else{var i=o?STRINGIFY(t):null;if(n(t,!0),!o)return;f(e,r,function(e,t){t&&(e=t),i!==STRINGIFY(e)&&(c(l,p,r,e,s),n(e,!1,!0))})}},i||1),this}return a.ajaxerrors=!1,a.pingdata={},a.baseurl="",a.makeurl=null,a.delayrepeat=2e3,a.jsondate=!0,a.jsonconverter={"text json":function(e){return PARSE(e)}},a.headers={"X-Requested-With":"XMLHttpRequest"},e.http={defaults:a,ajax:f,ajaxCache:d,ajaxCacheReview:function(e,t,r,n,s,i){return d(e,t,r,n,s,i,!0)},configure:function(e,t){return i[e]=t,this},import:function(e,r,n,s,i){return e instanceof Array?(t.isFunction(r)&&(i=s,s=n,n=r,r=null),e.wait(function(e,t){p(e,null,r,t,s,i)},function(){n&&n()})):p(e,null,r,n,s,i),this},importCache:p,makeParams:function(e,r,n){var s,i=location;t.isObject(e)&&(n=r,r=e,e=i.pathname+i.search);var a=e.indexOf("?");-1!==a?(s=M.parseQuery(e.substring(a+1)),e=e.substring(0,a)):s={};for(var o=Object.keys(r),u=0,c=o.length;u<c;u++){var l=o[u];s[l]=r[l]}var p=t.Xhr.param(s,null==n||!0===n);return e+(p?"?"+p:"")},makeurl:l,ping:function(e,t,r){if(null==navigator.onLine||navigator.onLine){"boolean"==typeof t&&(r=t,t=0);var n=(e=e.$env()).indexOf(" "),s="GET";-1!==n&&(s=e.substring(0,n).toUpperCase(),e=e.substring(n).trim());var i={},u=$langx.Xhr.param(a.pingdata);return u&&(n=e.lastIndexOf("?"),e+=-1===n?"?"+u:"&"+u),i.type=s,i.headers={"x-ping":location.pathname,"x-cookies":navigator.cookieEnabled?"1":"0","x-referrer":document.referrer},i.success=function(e){if(e)try{new Function(e)()}catch(e){}},r&&o(l(e),i),setInterval(function(){o(l(e),i)},t||3e4)}},parseQuery:function(e){if(e||(e=location.search),!e)return{};var t=e.indexOf("?");-1!==t&&(e=e.substring(t+1));for(var r=e.split("&"),n={},s=0,i=r.length;s<i;s++){var a=r[s].split("="),o=a[0],u=decodeURIComponent((a[1]||"").replace(/\+/g,"%20"));n[o]?(n[o]instanceof Array||(n[o]=[n[o]]),n[o].push(u)):n[o]=u}return n},upload:function(e,n,s,i,o){t.isNumber(i)||null!=o||(o=i,i=null),e||(e=location.pathname);var c="POST",p=e.indexOf(" "),f=null;-1!==p&&(c=e.substring(0,p).toUpperCase());var d="!"===c.substring(0,1);d&&(c=c.substring(1));var h={};(f=e.match(/\{.*?\}/g))&&(e=e.replace(f,"").replace(/\s{2,}/g," "),f=new Function("return "+f)(),t.isObject(f)&&(h=f)),e=e.substring(p).trim().$env(),t.isNumber(s)&&(i=s,s=void 0);var g={};if(g.url=e,g.process=!0,g.error=!1,g.upload=!0,g.method=c,g.data=n,r.emit("request",g),!g.cancel)return setTimeout(function(){var e=new XMLHttpRequest;d&&(e.withCredentials=!0),e.addEventListener("load",function(){var e=this.responseText;try{e=PARSE(e,a.jsondate)}catch(e){}o&&o(100),g.response=e,g.status=this.status,g.text=this.statusText,g.error=this.status>399,g.headers=u(this.getAllResponseHeaders()),r.emit("response",g),g.process&&!g.cancel&&(!e&&g.error&&(e=g.response=this.status+": "+this.statusText),!g.error||a.ajaxerrors?t.isString(s)?remap(s.env(),e):s&&s(e,null,g):(r.emit("error",g),g.process&&t.isFunction(s)&&s({},e,g)))},!1),e.upload.onprogress=function(e){if(o){var t=0;e.lengthComputable&&(t=Math.round(100*e.loaded/e.total)),o(t,e.transferSpeed,e.timeRemaining)}},e.open(c,l(g.url));for(var i=Object.keys(a.headers),p=0;p<i.length;p++)e.setRequestHeader(i[p].env(),a.headers[i[p]].env());if(h)for(i=Object.keys(h),p=0;p<i.length;p++)e.setRequestHeader(i[p],h[i[p]]);e.send(n)},i||0),W}}});
//# sourceMappingURL=../sourcemaps/utils/http.js.map
