{"version":3,"sources":["views/download.js"],"names":["define","langx","$","http"],"mappings":";;;;;;;AAAAA,QACC,WACA,iBACA,iBACC,SAASC,EAAOC,EAAGC","file":"../../views/download.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"../utils/query\",\r\n\t\"../utils/http\"\r\n],function(langx, $, http){\r\n\tfunction download(view) {\r\n\r\n\t\tvar arr = [];\r\n\t\tvar count = 0;\r\n\r\n\t\t$(ATTRURL).each(function() {\r\n\r\n\t\t\tvar t = this;\r\n\t\t\tvar el = $(t);\r\n\r\n\t\t\tif (t.$downloaded) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tt.$downloaded = 1;\r\n\t\t\tvar url = view.attrcom(el, 'url');\r\n\r\n\t\t\t// Unique\r\n\t\t\tvar once = url.substring(0, 5).toLowerCase() === 'once ';\r\n\t\t\tif (url.substring(0, 1) === '!' || once) {\r\n\t\t\t\tif (once) {\r\n\t\t\t\t\turl = url.substring(5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = url.substring(1);\r\n\t\t\t\t}\r\n\t\t\t\tif (statics[url]) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tstatics[url] = 2;\r\n\t\t\t}\r\n\r\n\t\t\tvar item = {};\r\n\t\t\titem.url = url;\r\n\t\t\titem.element = el;\r\n\t\t\titem.callback = attrcom(el, 'init');\r\n\t\t\titem.path = attrcom(el, 'path');\r\n\t\t\titem.toggle = (attrcom(el, 'class') || '').split(' ');\r\n\t\t\titem.expire = attrcom(el, 'cache') || MD.importcache;\r\n\t\t\tarr.push(item);\r\n\t\t});\r\n\r\n\t\tif (!arr.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar canCompile = false;\r\n\t\tview.importing++;\r\n\r\n\t\tlangx.async(arr, function(item, next) {\r\n\r\n\t\t\tvar key = makeurl(item.url);\r\n\t\t\tvar can = false;\r\n\r\n\t\t\thttp.ajaxCache('GET ' + item.url, null, function(response) {\r\n\r\n\t\t\t\tkey = '$import' + key;\r\n\r\n\t\t\t\tcaches.current.element = item.element[0];\r\n\r\n\t\t\t\tif (statics[key]) {\r\n\t\t\t\t\tresponse = removescripts(response);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresponse = importscripts(importstyles(response));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcan = response && REGCOM.test(response);\r\n\r\n\t\t\t\tif (can) {\r\n\t\t\t\t\tcanCompile = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.element.html(response);\r\n\t\t\t\tstatics[key] = true;\r\n\t\t\t\titem.toggle.length && item.toggle[0] && toggles.push(item);\r\n\r\n\t\t\t\tif (item.callback && !attrcom(item.element)) {\r\n\t\t\t\t\tvar callback = get(item.callback);\r\n\t\t\t\t\ttypeof(callback) === TYPE_FN && callback(item.element);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcaches.current.element = null;\r\n\t\t\t\tcount++;\r\n\t\t\t\tnext();\r\n\r\n\t\t\t}, item.expire);\r\n\r\n\t\t}, function() {\r\n\t\t\tview.importing--;\r\n\t\t\tclear('valid', 'dirty', 'find');\r\n\t\t\tif (count && canCompile){\r\n\t\t\t\tview.compile();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t\r\n});"]}