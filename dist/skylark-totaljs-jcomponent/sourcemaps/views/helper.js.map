{"version":3,"sources":["views/helper.js"],"names":["define","langx","Component","view","ATTRCOM","ATTRDATA","ATTRDEL","findControl","container","onElement","level","arr","childNodes","sub","domx","inputable","i","length","el","tagName","getAttribute","push","findComponent","selector","callback","index","components","s","split","path","name","id","version","substring","indexOf","trim","lastIndexOf","undefined","stop","find","option","each","com","this","$com","$loaded","$removed","$name","$version","$pp","pathscope","findControl2","input","$inputcontrol","element","attrcom","attrd","attrbind","attrscope","kill","$el","$","removeData","attr","makeurl","url","make","builder","encodeURIComponent","join","scope","results","closest","reesults","nocompile","value","comp","released"],"mappings":"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","file":"../../views/helper.js","sourcesContent":["define([\r\n\t\"../langx\",\t\r\n\t\"../components/Component\"\r\n],function(langx, Component){\r\n\r\n\r\n\tfunction helper(view) {\r\n\t\tvar ATTRCOM = '[data-jc]',\r\n\t\t\tATTRURL = '[data-jc-url]',\r\n\t\t\tATTRDATA = 'jc',\r\n\t\t\tATTRDEL = 'data-jc-removed',\r\n\t\t\tATTRREL = 'data-jc-released',\r\n\t\t\tATTRSCOPE = 'data-jc-scope';\r\n\r\n\r\n\t\tvar REGCOM = /(data-jc|data-jc-url|data-jc-import|data-bind|bind):|COMPONENT\\(/;\r\n\r\n\t\tfunction findControl2(com, input) {\r\n\r\n\t\t\tif (com.$inputcontrol) {\r\n\t\t\t\tif (com.$inputcontrol % 2 !== 0) {\r\n\t\t\t\t\tcom.$inputcontrol++;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar target = input ? input : com.element;\r\n\t\t\tfindControl(target[0], function(el) {\r\n\t\t\t\tif (!el.$com || el.$com !== com) {\r\n\t\t\t\t\tel.$com = com;\r\n\t\t\t\t\tcom.$inputcontrol = 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction findControl(container, onElement, level) {\r\n\r\n\t\t\tvar arr = container.childNodes;\r\n\t\t\tvar sub = [];\r\n\r\n\t\t\tdomx.inputable(container) && onElement(container);\r\n\r\n\t\t\tif (level == null) {\r\n\t\t\t\tlevel = 0;\r\n\t\t\t} else {\r\n\t\t\t\tlevel++;\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\t\t\t\tvar el = arr[i];\r\n\t\t\t\tif (el && el.tagName) {\r\n\t\t\t\t\tel.childNodes.length && el.tagName !== 'SCRIPT' && el.getAttribute('data-jc') == null && sub.push(el);\r\n\t\t\t\t\tif (domx.inputable(el) && el.getAttribute('data-jc-bind') != null && onElement(el) === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, length = sub.length; i < length; i++) {\r\n\t\t\t\tel = sub[i];\r\n\t\t\t\tif (el && findControl(el, onElement, level) === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// find all nested component\r\n\t\tfunction nested(el) {\r\n\t\t\tvar $el = $(el),\r\n\t\t\t\tarr = [];\r\n\t\t\t$el.find(ATTRCOM).each(function() {\r\n\t\t\t\tvar el = $(this);\r\n\t\t\t\tvar com = el[0].$com;\r\n\t\t\t\tif (com && !el.attr(ATTRDEL)) {\r\n\t\t\t\t\tif (com instanceof Array) {\r\n\t\t\t\t\t\tarr.push.apply(arr, com);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn arr;\r\n\t\t}\r\n\r\n\t\t// destory all nested component\r\n\t\tfunction kill(el) {\r\n\t\t\tvar $el = $(el);\r\n\t\t\t$el.removeData(ATTRDATA);\r\n\t\t\t$el.attr(ATTRDEL, 'true').find(ATTRCOM).attr(ATTRDEL, 'true');\r\n\t\t}\r\n\r\n\t\tfunction findComponent(container, selector, callback) {\r\n\t\t\tvar components = view.components;\r\n\r\n\t\t\tvar s = (selector ? selector.split(' ') : []);\r\n\t\t\tvar path = '';\r\n\t\t\tvar name = '';\r\n\t\t\tvar id = '';\r\n\t\t\tvar version = '';\r\n\t\t\tvar index;\r\n\r\n\t\t\tfor (var i = 0, length = s.length; i < length; i++) {\r\n\t\t\t\tswitch (s[i].substring(0, 1)) {\r\n\t\t\t\t\tcase '*':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase '.':\r\n\t\t\t\t\t\t// path\r\n\t\t\t\t\t\tpath = s[i].substring(1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase '#':\r\n\t\t\t\t\t\t// id;\r\n\t\t\t\t\t\tid = s[i].substring(1);\r\n\t\t\t\t\t\tindex = id.indexOf('[');\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tpath = id.substring(index + 1, id.length - 1).trim();\r\n\t\t\t\t\t\t\tid = id.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// name\r\n\t\t\t\t\t\tname = s[i];\r\n\t\t\t\t\t\tindex = name.indexOf('[');\r\n\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tpath = name.substring(index + 1, name.length - 1).trim();\r\n\t\t\t\t\t\t\tname = name.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tindex = name.lastIndexOf('@');\r\n\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tversion = name.substring(index + 1);\r\n\t\t\t\t\t\t\tname = name.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar arr = callback ? undefined : [];\r\n\t\t\tif (container) {\r\n\t\t\t\tvar stop = false;\r\n\t\t\t\tcontainer.find('['+view.option(\"elmAttrNames.com.base\")+']').each(function() { // [data-jc]\r\n\t\t\t\t\tvar com = this.$com;\r\n\r\n\t\t\t\t\tif (stop || !com || !com.$loaded || com.$removed || (id && com.id !== id) || (name && com.$name !== name) || (version && com.$version !== version) || (path && (com.$pp || (com.path !== path && (!com.pathscope || ((com.pathscope + '.' + path) !== com.path))))))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tif (callback(com) === false) {\r\n\t\t\t\t\t\t\tstop = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfor (var i = 0, length = components.length; i < length; i++) { // M.components.length\r\n\t\t\t\t\tvar com = components[i]; // M.components[i]\r\n\t\t\t\t\tif (!com || !com.$loaded || com.$removed || (id && com.id !== id) || (name && com.$name !== name) || (version && com.$version !== version) || ((path && (com.$pp || (com.path !== path && (!com.pathscope || ((com.pathscope + '.' + path) !== com.path)))))))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tif (callback(com) === false) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t}\r\n\r\n\t\tfunction attrcom(el, name) {\r\n\t\t\tname = name ? '-' + name : '';\r\n\t\t\treturn el.getAttribute ? el.getAttribute('data-jc' + name) : el.attrd('jc' + name);\r\n\t\t}\r\n\r\n\t\tfunction attrbind(el) {\r\n\t\t\treturn el.getAttribute('data-bind') || el.getAttribute('bind');\r\n\t\t}\r\n\r\n\t\tfunction scope(el) {\r\n\t\t\tvar results = $(el).closest('[' + this.option(\"elmAttrNames.scope\") + ']');\r\n\t\t\tif (results && results.length) {\r\n\t\t\t\treturn reesults[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction nocompile(el,value) {\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvar value = $(el).attr(view.option(\"elmAttrNames.compile\")) ;\r\n\t\t\t\tif (value === '0' || comp === 'false') {\r\n\t\t\t\t\t// no compile\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$(el).attr(view.option(\"elmAttrNames.compile\"),value);\r\n\t\t\t\treturn this; \r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction released(el,value) {\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvar value = $(el).attr(view.option(\"elmAttrNames.released\")) ;\r\n\t\t\t\tif (value === '0' || comp === 'false') {\r\n\t\t\t\t\t// no compile\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$(el).attr(view.option(\"elmAttrNames.released\"),value);\r\n\t\t\t\treturn this; \r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tfunction canCompile(el) {\r\n\t\t\tvar html = el.innerHTML ? el.innerHTML : el;\r\n\t\t\treturn REGCOM.test(html);\r\n\t\t}\r\n\r\n\t\tfunction findUrl(container,callback) {\r\n\t\t\treturn $(ATTRURL);\r\n\t\t}\r\n\r\n\t\tfunction makeurl(url, make) {\r\n\r\n\t\t\t// TODO\r\n\t\t\t//defaults.makeurl && (url = defaults.makeurl(url));\r\n\t\t\t//\r\n\t\t\t//if (make)\r\n\t\t\t//\treturn url;\r\n\r\n\t\t\tvar builder = [];\r\n\t\t\tvar en = encodeURIComponent;\r\n\r\n\t\t\t//M.$version && builder.push('version=' + en(M.$version));\r\n\t\t\t//M.$language && builder.push('language=' + en(M.$language));\r\n\r\n\t\t\tif (!builder.length)\r\n\t\t\t\treturn url;\r\n\r\n\t\t\tvar index = url.indexOf('?');\r\n\t\t\tif (index == -1)\r\n\t\t\t\turl += '?';\r\n\t\t\telse\r\n\t\t\t\turl += '&';\r\n\r\n\t\t\treturn url + builder.join('&');\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"Component\"     : Component,\r\n\t\t\t\"findComponent\" : findComponent,\r\n\t\t\t\"findControl\" \t: findControl,\r\n\t\t\t\"findControl2\" \t: findControl2,\r\n\t\t\t\"attrcom\" \t\t: attrcom,\r\n\t\t\t\"attrbind\"      : attrbind,\r\n\t\t\t\"attrscope\"     : attrscope,\r\n\t\t\t\"kill\"          : kill,\r\n\t\t\t\"makeurl\"\t\t: makeurl,\r\n\t\t\t\"scope\" \t\t: scope,\r\n\t\t\t\"nocompile\" \t: nocompile,\r\n\t\t\t\"released\" \t\t: released\r\n\t\t};\r\n\r\n\t}\r\n\r\n\treturn helper;\r\n});"]}