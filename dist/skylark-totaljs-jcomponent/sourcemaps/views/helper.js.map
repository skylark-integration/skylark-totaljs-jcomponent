{"version":3,"sources":["views/helper.js"],"names":["define","langx","$","Component","view","ATTRCOM","ATTRURL","ATTRDATA","ATTRDEL","ATTRREL","ATTRSCOPE","ATTRCOMPILE","REGCOM","findControl","container","onElement","level","arr","childNodes","sub","domx","inputable","i","length","el","tagName","getAttribute","push","attrcom","name","attrd","attrbind","attrscope","canCompile","html","innerHTML","test","findComponent","selector","callback","index","components","s","split","path","id","version","substring","indexOf","trim","lastIndexOf","undefined","stop","find","option","each","com","this","$com","$loaded","$removed","$name","$version","$pp","pathscope","findControl2","input","$inputcontrol","element","findUrl","kill","$el","removeData","attr","makeurl","url","make","builder","encodeURIComponent","join","nested","Array","apply","nocompile","value","released","scope","results","closest","reesults"],"mappings":"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","file":"../../views/helper.js","sourcesContent":["define([\r\n\t\"../langx\",\t\r\n\t\"../utils/query\",\t\r\n\t\"../components/Component\"\r\n],function(langx, $,Component){\r\n\r\n\r\n\tfunction helper(view) {\r\n\t\tvar ATTRCOM = '[data-jc]',\r\n\t\t\tATTRURL = '[data-jc-url]',\r\n\t\t\tATTRDATA = 'jc',\r\n\t\t\tATTRDEL = 'data-jc-removed',\r\n\t\t\tATTRREL = 'data-jc-released',\r\n\t\t\tATTRSCOPE = 'data-jc-scope',\r\n\t\t\tATTRCOMPILE = 'data-jc-comile';\r\n\r\n\r\n\t\tvar REGCOM = /(data-jc|data-jc-url|data-jc-import|data-bind|bind)=|COMPONENT\\(/;\r\n\r\n\t\tfunction findControl2(com, input) {\r\n\r\n\t\t\tif (com.$inputcontrol) {\r\n\t\t\t\tif (com.$inputcontrol % 2 !== 0) {\r\n\t\t\t\t\tcom.$inputcontrol++;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar target = input ? input : com.element;\r\n\t\t\tfindControl(target[0], function(el) {\r\n\t\t\t\tif (!el.$com || el.$com !== com) {\r\n\t\t\t\t\tel.$com = com;\r\n\t\t\t\t\tcom.$inputcontrol = 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction findControl(container, onElement, level) {\r\n\r\n\t\t\tvar arr = container.childNodes;\r\n\t\t\tvar sub = [];\r\n\r\n\t\t\tdomx.inputable(container) && onElement(container);\r\n\r\n\t\t\tif (level == null) {\r\n\t\t\t\tlevel = 0;\r\n\t\t\t} else {\r\n\t\t\t\tlevel++;\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\t\t\t\tvar el = arr[i];\r\n\t\t\t\tif (el && el.tagName) {\r\n\t\t\t\t\tel.childNodes.length && el.tagName !== 'SCRIPT' && el.getAttribute('data-jc') == null && sub.push(el);\r\n\t\t\t\t\tif (domx.inputable(el) && el.getAttribute('data-jc-bind') != null && onElement(el) === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, length = sub.length; i < length; i++) {\r\n\t\t\t\tel = sub[i];\r\n\t\t\t\tif (el && findControl(el, onElement, level) === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// find all nested component\r\n\t\tfunction nested(el) {\r\n\t\t\tvar $el = $(el),\r\n\t\t\t\tarr = [];\r\n\t\t\t$el.find(ATTRCOM).each(function() {\r\n\t\t\t\tvar el = $(this);\r\n\t\t\t\tvar com = el[0].$com;\r\n\t\t\t\tif (com && !el.attr(ATTRDEL)) {\r\n\t\t\t\t\tif (com instanceof Array) {\r\n\t\t\t\t\t\tarr.push.apply(arr, com);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn arr;\r\n\t\t}\r\n\r\n\t\t// destory all nested component\r\n\t\tfunction kill(el) {\r\n\t\t\tvar $el = $(el);\r\n\t\t\t$el.removeData(ATTRDATA);\r\n\t\t\t$el.attr(ATTRDEL, 'true').find(ATTRCOM).attr(ATTRDEL, 'true');\r\n\t\t}\r\n\r\n\t\tfunction findComponent(container, selector, callback) {\r\n\t\t\tvar components = view.components;\r\n\r\n\t\t\tvar s = (selector ? selector.split(' ') : []);\r\n\t\t\tvar path = '';\r\n\t\t\tvar name = '';\r\n\t\t\tvar id = '';\r\n\t\t\tvar version = '';\r\n\t\t\tvar index;\r\n\r\n\t\t\tfor (var i = 0, length = s.length; i < length; i++) {\r\n\t\t\t\tswitch (s[i].substring(0, 1)) {\r\n\t\t\t\t\tcase '*':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase '.':\r\n\t\t\t\t\t\t// path\r\n\t\t\t\t\t\tpath = s[i].substring(1);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase '#':\r\n\t\t\t\t\t\t// id;\r\n\t\t\t\t\t\tid = s[i].substring(1);\r\n\t\t\t\t\t\tindex = id.indexOf('[');\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tpath = id.substring(index + 1, id.length - 1).trim();\r\n\t\t\t\t\t\t\tid = id.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// name\r\n\t\t\t\t\t\tname = s[i];\r\n\t\t\t\t\t\tindex = name.indexOf('[');\r\n\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tpath = name.substring(index + 1, name.length - 1).trim();\r\n\t\t\t\t\t\t\tname = name.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tindex = name.lastIndexOf('@');\r\n\r\n\t\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\t\tversion = name.substring(index + 1);\r\n\t\t\t\t\t\t\tname = name.substring(0, index);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar arr = callback ? undefined : [];\r\n\t\t\tif (container) {\r\n\t\t\t\tvar stop = false;\r\n\t\t\t\tcontainer.find('['+view.option(\"elmAttrNames.com.base\")+']').each(function() { // [data-jc]\r\n\t\t\t\t\tvar com = this.$com;\r\n\r\n\t\t\t\t\tif (stop || !com || !com.$loaded || com.$removed || (id && com.id !== id) || (name && com.$name !== name) || (version && com.$version !== version) || (path && (com.$pp || (com.path !== path && (!com.pathscope || ((com.pathscope + '.' + path) !== com.path))))))\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tif (callback(com) === false) {\r\n\t\t\t\t\t\t\tstop = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tfor (var i = 0, length = components.length; i < length; i++) { // M.components.length\r\n\t\t\t\t\tvar com = components[i]; // M.components[i]\r\n\t\t\t\t\tif (!com || !com.$loaded || com.$removed || (id && com.id !== id) || (name && com.$name !== name) || (version && com.$version !== version) || ((path && (com.$pp || (com.path !== path && (!com.pathscope || ((com.pathscope + '.' + path) !== com.path)))))))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tif (callback(com) === false) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tarr.push(com);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn arr;\r\n\t\t}\r\n\r\n\t\tfunction attrcom(el, name) {\r\n\t\t\tname = name ? '-' + name : '';\r\n\t\t\treturn el.getAttribute ? el.getAttribute('data-jc' + name) : el.attrd('jc' + name);\r\n\t\t}\r\n\r\n\t\tfunction attrbind(el) {\r\n\t\t\treturn el.getAttribute('data-bind') || el.getAttribute('bind');\r\n\t\t}\r\n\r\n\t\tfunction attrscope(el) {\r\n\t\t\treturn el.getAttribute(ATTRSCOPE);\r\n\t\t}\r\n\r\n\t\tfunction scope(el) {\r\n\t\t\tvar results = $(el).closest('[' + ATTRCOMPILE + ']');\r\n\t\t\tif (results && results.length) {\r\n\t\t\t\treturn reesults[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction nocompile(el,value) {\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvar value = $(el).attr(ATTRCOMPILE) ;\r\n\t\t\t\tif (value === '0' || value === 'false') {\r\n\t\t\t\t\t// no compile\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$(el).attr(ATTRCOMPILE,value);\r\n\t\t\t\treturn this; \r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction released(el,value) {\r\n\t\t\tif (value === undefined) {\r\n\t\t\t\tvar value = $(el).attr(ATTRREL) ;\r\n\t\t\t\tif (value === '0' || value === 'false') {\r\n\t\t\t\t\t// no compile\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t$(el).attr(ATTRREL,value);\r\n\t\t\t\treturn this; \r\n\t\t\t}\r\n\t\t}\t\t\r\n\r\n\t\tfunction canCompile(el) {\r\n\t\t\tvar html = el.innerHTML ? el.innerHTML : el;\r\n\t\t\treturn REGCOM.test(html);\r\n\t\t}\r\n\r\n\t\tfunction findUrl(container) {\r\n\t\t\treturn $(ATTRURL,container);\r\n\t\t}\r\n\r\n\t\tfunction makeurl(url, make) {\r\n\r\n\t\t\t// TODO\r\n\t\t\t//defaults.makeurl && (url = defaults.makeurl(url));\r\n\t\t\t//\r\n\t\t\t//if (make)\r\n\t\t\t//\treturn url;\r\n\r\n\t\t\tvar builder = [];\r\n\t\t\tvar en = encodeURIComponent;\r\n\r\n\t\t\t//M.$version && builder.push('version=' + en(M.$version));\r\n\t\t\t//M.$language && builder.push('language=' + en(M.$language));\r\n\r\n\t\t\tif (!builder.length)\r\n\t\t\t\treturn url;\r\n\r\n\t\t\tvar index = url.indexOf('?');\r\n\t\t\tif (index == -1)\r\n\t\t\t\turl += '?';\r\n\t\t\telse\r\n\t\t\t\turl += '&';\r\n\r\n\t\t\treturn url + builder.join('&');\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"attrcom\" \t\t: attrcom,\r\n\t\t\t\"attrbind\"      : attrbind,\r\n\t\t\t\"attrscope\"     : attrscope,\r\n\t\t\t\"canCompile\"    : canCompile,\r\n\t\t\t\"Component\"     : Component,\r\n\t\t\t\"findComponent\" : findComponent,\r\n\t\t\t\"findControl\" \t: findControl,\r\n\t\t\t\"findControl2\" \t: findControl2,\r\n\t\t\t\"findUrl\"       : findUrl,\r\n\t\t\t\"kill\"          : kill,\r\n\t\t\t\"makeurl\"\t\t: makeurl,\r\n\t\t\t\"nested\"        : nested,\r\n\t\t\t\"nocompile\" \t: nocompile,\r\n\t\t\t\"released\" \t\t: released,\r\n\t\t\t\"scope\" \t\t: scope\r\n\t\t};\r\n\r\n\t}\r\n\r\n\treturn helper;\r\n});"]}