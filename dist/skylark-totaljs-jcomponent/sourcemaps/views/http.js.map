{"version":3,"sources":["views/http.js"],"names":["define","Xhr","jc","langx","domx","storage","REGCOM","statics","view","ajaxconfig","defaults","request","url","options","p","then","success","apply","this","arguments","error","done","fail","complete","always","parseHeaders","val","h","split","forEach","line","index","indexOf","substring","toLowerCase","trim","cacherest","method","params","value","expire","version","M","$version","language","$language","stringify","key","hashCode","replace","toString","set","makeurl","make","builder","encodeURIComponent","length","join","importCache","target","callback","insert","preparator","w","first","$env","text","once","isFunction","wf","wo","GET","location","protocol","lastIndexOf","ext","storing","wait","W","setPath","element","index2","d","document","scr","createElement","type","async","onload","setTimeout","compiler","compile","src","getElementsByTagName","appendChild","eventer","emit","$","stl","rel","href","jQuery","id","cb","response","code","output","is","test","importscripts","importstyles","addClass","html","removeClass","ajaxCache","ajax","data","timeout","pathname","tmp","td","arg","EMPTYARRAY","undefined","repeat","toUpperCase","isCredentials","headers","match","Function","isObject","qs","isString","param","converters","jsonconverter","contentType","STRINGIFY","extend","crossDomain","xhrFields","withCredentials","ROOT","custom","i","opt","cancel","process","upload","r","s","req","status","getAllResponseHeaders","call","responseText","ct","PARSE","jsondate","e","ajaxerrors","AJAX","delayrepeat","clear","review","isBoolean","uri","err","diff","pingdata","baseurl","text json","X-Requested-With","ajaxCacheReview","configure","name","fn","import","Array","next","makeParams","values","query","l","search","parseQuery","keys","Object","ping","execute","navigator","onLine","$langx","x-ping","x-cookies","cookieEnabled","x-referrer","referrer","setInterval","arr","obj","sub","decodeURIComponent","push","progress","isNumber","xhr","XMLHttpRequest","addEventListener","statusText","remap","env","onprogress","evt","percentage","lengthComputable","Math","round","loaded","total","transferSpeed","timeRemaining","open","setRequestHeader","send"],"mappings":"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","file":"../../views/http.js","sourcesContent":["define([\r\n\t\"skylark-net-http/Xhr\",\r\n\t\"../jc\",\r\n\t\"../langx\",\r\n    \"../utils/domx\",\r\n\t\"../utils/storage\"\r\n],function(Xhr,jc,langx,domx,storage){\r\n\tvar REGCOM = /(data-jc|data-jc-url|data-jc-import|data-bind|bind)=|COMPONENT\\(/; //TODO\r\n\r\n\tvar statics = langx.statics;\r\n\r\n\tfunction http(view) {\r\n\t\tvar ajaxconfig = {};\r\n\t\tvar defaults = {\r\n\r\n\t\t};\r\n\t\tdefaults.ajaxerrors = false;\r\n\t\tdefaults.pingdata = {};\r\n\t\tdefaults.baseurl = ''; // String or Function\r\n\t\tdefaults.makeurl = null; // Function\r\n\t\tdefaults.delayrepeat = 2000;\r\n\t\tdefaults.jsondate = true;\r\n\t\tdefaults.jsonconverter = {\r\n\t\t\t'text json': function(text) {\r\n\t\t\t\treturn PARSE(text);\r\n\t\t\t}\r\n\t\t};\r\n\t\tdefaults.headers = { 'X-Requested-With': 'XMLHttpRequest' };\r\n\r\n\t\tfunction request(url,options) {\r\n\t\t\toptions.url = url;\r\n\t        function ajaxSuccess() {\r\n\t            if (options.success) {\r\n\t                options.success.apply(this,arguments);\r\n\t            }\r\n\t        }\r\n\r\n\t        function ajaxError() {\r\n\t            if (options.error) {\r\n\t                options.error.apply(this,arguments);\r\n\t            }\r\n\t        }\r\n\r\n\t        var p = Xhr.request(options.url,options);\r\n\t        p = p.then(ajaxSuccess,ajaxError);\r\n\t        p.success = p.done;\r\n\t        p.error = p.fail;\r\n\t        p.complete = p.always;\r\n\t        \r\n\t        return p;\t\t\r\n\t\t}\r\n\r\n\t\tfunction parseHeaders(val) {\r\n\t\t\tvar h = {};\r\n\t\t\tval.split('\\n').forEach(function(line) {\r\n\t\t\t\tvar index = line.indexOf(':');\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\th[line.substring(0, index).toLowerCase()] = line.substring(index + 1).trim();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn h;\r\n\t\t}\r\n\r\n\t\tfunction cacherest(method, url, params, value, expire) {\r\n\r\n\t\t\tif (params && !params.version && M.$version)\r\n\t\t\t\tparams.version = M.$version;\r\n\r\n\t\t\tif (params && !params.language && M.$language)\r\n\t\t\t\tparams.language = M.$language;\r\n\r\n\t\t\tparams = langx.stringify(params);\r\n\t\t\tvar key = langx.hashCode(method + '#' + url.replace(/\\//g, '') + params).toString();\r\n\t\t\treturn storage.set(key, value, expire);\r\n\t\t}\r\n\t\t\r\n\r\n\r\n\t\tfunction makeParams(url, values, type) { //W.MAKEPARAMS = \r\n\r\n\t\t\tvar l = location;\r\n\r\n\t\t\tif (langx.isObject(url)) {\r\n\t\t\t\ttype = values;\r\n\t\t\t\tvalues = url;\r\n\t\t\t\turl = l.pathname + l.search;\r\n\t\t\t}\r\n\r\n\t\t\tvar query;\r\n\t\t\tvar index = url.indexOf('?');\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tquery = M.parseQuery(url.substring(index + 1));\r\n\t\t\t\turl = url.substring(0, index);\r\n\t\t\t} else\r\n\t\t\t\tquery = {};\r\n\r\n\t\t\tvar keys = Object.keys(values);\r\n\r\n\t\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\t\tvar key = keys[i];\r\n\t\t\t\tquery[key] = values[key];\r\n\t\t\t}\r\n\r\n\t\t\tvar val = Xhr.param(query, type == null || type === true);\r\n\t\t\treturn url + (val ? '?' + val : '');\r\n\t\t}\r\n\r\n\t\tfunction makeurl(url, make) {\r\n\r\n\t\t\t// TODO\r\n\t\t\t//defaults.makeurl && (url = defaults.makeurl(url));\r\n\t\t\t//\r\n\t\t\t//if (make)\r\n\t\t\t//\treturn url;\r\n\r\n\t\t\tvar builder = [];\r\n\t\t\tvar en = encodeURIComponent;\r\n\r\n\t\t\t//M.$version && builder.push('version=' + en(M.$version));\r\n\t\t\t//M.$language && builder.push('language=' + en(M.$language));\r\n\r\n\t\t\tif (!builder.length)\r\n\t\t\t\treturn url;\r\n\r\n\t\t\tvar index = url.indexOf('?');\r\n\t\t\tif (index == -1)\r\n\t\t\t\turl += '?';\r\n\t\t\telse\r\n\t\t\t\turl += '&';\r\n\r\n\t\t\treturn url + builder.join('&');\r\n\t\t}\r\n\r\n\t\tfunction upload(url, data, callback, timeout, progress) { //W.UPLOAD = \r\n\r\n\t\t\tif (!langx.isNumber(timeout) && progress == null) {\r\n\t\t\t\tprogress = timeout;\r\n\t\t\t\ttimeout = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (!url)\r\n\t\t\t\turl = location.pathname;\r\n\r\n\t\t\tvar method = 'POST';\r\n\t\t\tvar index = url.indexOf(' ');\r\n\t\t\tvar tmp = null;\r\n\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tmethod = url.substring(0, index).toUpperCase();\r\n\t\t\t}\r\n\r\n\t\t\tvar isCredentials = method.substring(0, 1) === '!';\r\n\t\t\tif (isCredentials) {\r\n\t\t\t\tmethod = method.substring(1);\r\n\t\t\t}\r\n\r\n\t\t\tvar headers = {};\r\n\t\t\ttmp = url.match(/\\{.*?\\}/g);\r\n\r\n\t\t\tif (tmp) {\r\n\t\t\t\turl = url.replace(tmp, '').replace(/\\s{2,}/g, ' ');\r\n\t\t\t\ttmp = (new Function('return ' + tmp))();\r\n\t\t\t\tif (langx.isObject(tmp))\r\n\t\t\t\t\theaders = tmp;\r\n\t\t\t}\r\n\r\n\t\t\turl = url.substring(index).trim().$env();\r\n\r\n\t\t\tif (langx.isNumber(callback)) {\r\n\t\t\t\ttimeout = callback;\r\n\t\t\t\tcallback = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tvar output = {};\r\n\t\t\toutput.url = url;\r\n\t\t\toutput.process = true;\r\n\t\t\toutput.error = false;\r\n\t\t\toutput.upload = true;\r\n\t\t\toutput.method = method;\r\n\t\t\toutput.data = data;\r\n\r\n\t\t\tview.eventer.emit('request', output);\r\n\r\n\t\t\tif (output.cancel)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tsetTimeout(function() {\r\n\r\n\t\t\t\tvar xhr = new XMLHttpRequest();\r\n\r\n\t\t\t\tif (isCredentials) {\r\n\t\t\t\t\txhr.withCredentials = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.addEventListener('load', function() {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar r = self.responseText;\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tr = PARSE(r, defaults.jsondate);\r\n\t\t\t\t\t} catch (e) {}\r\n\r\n\t\t\t\t\tif (progress) {\r\n\t\t\t\t\t\t/* TODO\r\n\t\t\t\t\t\tif (typeof(progress) === TYPE_S) {\r\n\t\t\t\t\t\t\tremap(progress, 100);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tprogress(100);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\tprogress(100);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutput.response = r;\r\n\t\t\t\t\toutput.status = self.status;\r\n\t\t\t\t\toutput.text = self.statusText;\r\n\t\t\t\t\toutput.error = self.status > 399;\r\n\t\t\t\t\toutput.headers = parseHeaders(self.getAllResponseHeaders());\r\n\r\n\t\t\t\t\tview.eventer.emit('response', output);\r\n\r\n\t\t\t\t\tif (!output.process || output.cancel)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (!r && output.error)\r\n\t\t\t\t\t\tr = output.response = self.status + ': ' + self.statusText;\r\n\r\n\t\t\t\t\tif (!output.error || defaults.ajaxerrors) {\r\n\t\t\t\t\t\tlangx.isString(callback)  ? remap(callback.env(), r) : (callback && callback(r, null, output));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tview.eventer.emit('error', output);\r\n\t\t\t\t\t\toutput.process && langx.isFunction(callback)  && callback({}, r, output);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\txhr.upload.onprogress = function(evt) {\r\n\t\t\t\t\tif (!progress) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar percentage = 0;\r\n\t\t\t\t\tif (evt.lengthComputable) {\r\n\t\t\t\t\t\tpercentage = Math.round(evt.loaded * 100 / evt.total);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t/* TODO\r\n\t\t\t\t\tif (langx.isString(progress)) {\r\n\t\t\t\t\t\tremap(progress.env(), percentage);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprogress(percentage, evt.transferSpeed, evt.timeRemaining);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tprogress(percentage, evt.transferSpeed, evt.timeRemaining);\r\n\t\t\t\t};\r\n\r\n\t\t\t\txhr.open(method, makeurl(output.url));\r\n\r\n\t\t\t\tvar keys = Object.keys(defaults.headers);\r\n\t\t\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\t\t\txhr.setRequestHeader(keys[i].env(), defaults.headers[keys[i]].env());\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (headers) {\r\n\t\t\t\t\tvar keys = Object.keys(headers);\r\n\t\t\t\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\t\t\t\txhr.setRequestHeader(keys[i], headers[keys[i]]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.send(data);\r\n\r\n\t\t\t}, timeout || 0);\r\n\r\n\t\t\treturn W;\r\n\t\t}\r\n\r\n\r\n\t\tfunction importCache(url, expire, target, callback, insert, preparator) { // W.IMPORTCACHE = \r\n\r\n\t\t\tvar w;\r\n\r\n\t\t\turl = url.$env().replace(/<.*?>/, function(text) {\r\n\t\t\t\tw = text.substring(1, text.length - 1).trim();\r\n\t\t\t\treturn '';\r\n\t\t\t}).trim();\r\n\r\n\t\t\t// unique\r\n\t\t\tvar first = url.substring(0, 1);\r\n\t\t\tvar once = url.substring(0, 5).toLowerCase() === 'once ';\r\n\r\n\t\t\tif (langx.isFunction(target)) {\r\n\r\n\t\t\t\tif (langx.isFunction(callback)) {\r\n\t\t\t\t\tpreparator = callback;\r\n\t\t\t\t\tinsert = true;\r\n\t\t\t\t} else if (langx.isFunction(insert) ) {\r\n\t\t\t\t\tpreparator = insert;\r\n\t\t\t\t\tinsert = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcallback = target;\r\n\t\t\t\ttarget = 'body';\r\n\t\t\t} else if (langx.isFunction(insert)) {\r\n\t\t\t\tpreparator = insert;\r\n\t\t\t\tinsert = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (w) {\r\n\r\n\t\t\t\tvar wf = w.substring(w.length - 2) === '()';\r\n\t\t\t\tif (wf) {\r\n\t\t\t\t\tw = w.substring(0, w.length - 2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar wo = GET(w);\r\n\t\t\t\tif (wf && langx.isFunction(wo)) {\r\n\t\t\t\t\tif (wo()) {\r\n\t\t\t\t\t\tcallback && callback(0);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (wo) {\r\n\t\t\t\t\tcallback && callback(0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (url.substring(0, 2) === '//') {\r\n\t\t\t\turl = location.protocol + url;\r\n\t\t\t}\r\n\r\n\t\t\tvar index = url.lastIndexOf(' .');\r\n\t\t\tvar ext = '';\r\n\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\text = url.substring(index).trim().toLowerCase();\r\n\t\t\t\turl = url.substring(0, index).trim();\r\n\t\t\t}\r\n\r\n\t\t\tif (first === '!' || once) {\r\n\r\n\t\t\t\tif (once) {\r\n\t\t\t\t\turl = url.substring(5);\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl = url.substring(1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (statics[url]) {\r\n\t\t\t\t\tif (callback) {\r\n\t\t\t\t\t\tif (statics[url] === 2)\r\n\t\t\t\t\t\t\tcallback(0);\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tview.storing.wait(function() {\r\n\t\t\t\t\t\t\t\treturn statics[url] === 2;\r\n\t\t\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t\t\tcallback(0);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn W;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstatics[url] = 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (target && target.setPath)\r\n\t\t\t\ttarget = target.element;\r\n\r\n\t\t\tif (!target) {\r\n\t\t\t\ttarget = 'body';\r\n\t\t\t}\r\n\r\n\t\t\tif (!ext) {\r\n\t\t\t\tindex = url.lastIndexOf('?');\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tvar index2 = url.lastIndexOf('.', index);\r\n\t\t\t\t\tif (index2 !== -1) {\r\n\t\t\t\t\t\text = url.substring(index2, index).toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tindex = url.lastIndexOf('.');\r\n\t\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\t\text = url.substring(index).toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar d = document;\r\n\t\t\tif (ext === '.js') {\r\n\t\t\t\tvar scr = d.createElement('script');\r\n\t\t\t\tscr.type = 'text/javascript';\r\n\t\t\t\tscr.async = false;\r\n\t\t\t\tscr.onload = function() {\r\n\t\t\t\t\tstatics[url] = 2;\r\n\t\t\t\t\tcallback && callback(1);\r\n\t\t\t\t\tsetTimeout(view.compiler.compile, 300);//W.jQuery && \r\n\t\t\t\t};\r\n\t\t\t\tscr.src = makeurl(url, true);\r\n\t\t\t\td.getElementsByTagName('head')[0].appendChild(scr);\r\n\t\t\t\tview.eventer.emit('import', url, $(scr));\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif (ext === '.css') {\r\n\t\t\t\tvar stl = d.createElement('link');\r\n\t\t\t\tstl.type = 'text/css';\r\n\t\t\t\tstl.rel = 'stylesheet';\r\n\t\t\t\tstl.href = makeurl(url, true);\r\n\t\t\t\td.getElementsByTagName('head')[0].appendChild(stl);\r\n\t\t\t\tstatics[url] = 2;\r\n\t\t\t\tcallback && setTimeout(callback, 200, 1);\r\n\t\t\t\tview.eventer.emit('import', url, $(stl));\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tview.storing.wait(function() {\r\n\t\t\t\treturn !!W.jQuery;\r\n\t\t\t}, function() {\r\n\r\n\t\t\t\tstatics[url] = 2;\r\n\t\t\t\tvar id = 'import' + langx.hashCode(url); // HASH\r\n\r\n\t\t\t\tvar cb = function(response, code, output) {\r\n\r\n\t\t\t\t\tif (!response) {\r\n\t\t\t\t\t\tcallback && callback(0);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\turl = '$import' + url;\r\n\r\n\t\t\t\t\tif (preparator)\r\n\t\t\t\t\t\tresponse = preparator(response, output);\r\n\r\n\t\t\t\t\tvar is = REGCOM.test(response);\r\n\t\t\t\t\tresponse = domx.importscripts(domx.importstyles(response, id)).trim();\r\n\t\t\t\t\ttarget = $(target);\r\n\r\n\t\t\t\t\tif (response) {\r\n\t\t\t\t\t\t//caches.current.element = target[0];\r\n            \t\t\ttarget.addClass(\"importing\");\r\n\t\t\t\t\t\t//if (insert === false) { // TODO\r\n\t\t\t\t\t\t\ttarget.html(response); \r\n\t\t\t\t\t\t//} else {\r\n\t\t\t\t\t\t//\ttarget.append(response);\r\n\t\t\t\t\t\t//}\r\n\t\t\t\t\t\t//caches.current.element = null;\r\n            \t\t\ttarget.removeClass(\"importing\");\r\n        \t\t\t}\r\n\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t// is && compile(response ? target : null);\r\n\t\t\t\t\t\t// because of paths\r\n\t\t\t\t\t\tis && view.compiler.compile();\r\n\t\t\t\t\t\tcallback && view.storing.wait(function() {\r\n\t\t\t\t\t\t\treturn view.compiler.is == false;\r\n\t\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t\tcallback(1);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tview.eventer.emit('import', url, target);\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (expire) {\r\n\t\t\t\t\tajaxCache('GET ' + url, null, cb, expire);\r\n\t\t\t\t}else {\r\n\t\t\t\t\tajax('GET ' + url, cb);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn W;\r\n\t\t}\r\n\r\n\t\tfunction import2(url, target, callback, insert, preparator) { //W.IMPORT = M.import = \r\n\t\t\tif (url instanceof Array) {\r\n\r\n\t\t\t\tif (langx.isFunction(target)) {\r\n\t\t\t\t\tpreparator = insert;\r\n\t\t\t\t\tinsert = callback;\r\n\t\t\t\t\tcallback = target;\r\n\t\t\t\t\ttarget = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\turl.wait(function(url, next) {\r\n\t\t\t\t\timportCache(url, null, target, next, insert, preparator);\r\n\t\t\t\t}, function() {\r\n\t\t\t\t\tcallback && callback();\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\timportCache(url, null, target, callback, insert, preparator);\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/* \r\n\t\tfunction uptodate(period, url, callback, condition) { // W.UPTODATE = \r\n\r\n\t\t\tif (langx.isFunction(url)) {\r\n\t\t\t\tcondition = callback;\r\n\t\t\t\tcallback = url;\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\r\n\t\t\tvar dt = new Date().add(period);\r\n\t\t\tview.eventer.on('knockknock', function() {\r\n\t\t\t\tif (dt > langx.now()) //W.NOW)\r\n\t\t\t\t\treturn;\r\n\t\t\t\tif (!condition || !condition())\r\n\t\t\t\t\treturn;\r\n\t\t\t\tvar id = setTimeout(function() {\r\n\t\t\t\t\tvar l = window.location;\r\n\t\t\t\t\tif (url)\r\n\t\t\t\t\t\tl.href = url.$env();\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tl.reload(true);\r\n\t\t\t\t}, 5000);\r\n\t\t\t\tcallback && callback(id);\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\tfunction ping(url, timeout, execute) { // W.PING = \r\n\r\n\t\t\tif (navigator.onLine != null && !navigator.onLine)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (typeof(timeout) === 'boolean') {\r\n\t\t\t\texecute = timeout;\r\n\t\t\t\ttimeout = 0;\r\n\t\t\t}\r\n\r\n\t\t\turl = url.$env();\r\n\r\n\t\t\tvar index = url.indexOf(' ');\r\n\t\t\tvar method = 'GET';\r\n\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tmethod = url.substring(0, index).toUpperCase();\r\n\t\t\t\turl = url.substring(index).trim();\r\n\t\t\t}\r\n\r\n\t\t\tvar options = {};\r\n\t\t\tvar data = $langx.Xhr.param(defaults.pingdata);\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tindex = url.lastIndexOf('?');\r\n\t\t\t\tif (index === -1)\r\n\t\t\t\t\turl += '?' + data;\r\n\t\t\t\telse\r\n\t\t\t\t\turl += '&' + data;\r\n\t\t\t}\r\n\r\n\t\t\toptions.type = method;\r\n\t\t\toptions.headers = { 'x-ping': location.pathname, 'x-cookies': navigator.cookieEnabled ? '1' : '0', 'x-referrer': document.referrer };\r\n\r\n\t\t\toptions.success = function(r) {\r\n\t\t\t\tif (r) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t(new Function(r))();\r\n\t\t\t\t\t} catch (e) {}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\texecute && request(makeurl(url), options);\r\n\r\n\t\t\treturn setInterval(function() {\r\n\t\t\t\trequest(makeurl(url), options);\r\n\t\t\t}, timeout || 30000);\r\n\t\t}\r\n\r\n\t\tfunction parseQuery(value) { //M.parseQuery = W.READPARAMS = \r\n\r\n\t\t\tif (!value)\r\n\t\t\t\tvalue = location.search;\r\n\r\n\t\t\tif (!value)\r\n\t\t\t\treturn {};\r\n\r\n\t\t\tvar index = value.indexOf('?');\r\n\t\t\tif (index !== -1)\r\n\t\t\t\tvalue = value.substring(index + 1);\r\n\r\n\t\t\tvar arr = value.split('&');\r\n\t\t\tvar obj = {};\r\n\t\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\t\t\t\tvar sub = arr[i].split('=');\r\n\t\t\t\tvar key = sub[0];\r\n\t\t\t\tvar val = decodeURIComponent((sub[1] || '').replace(/\\+/g, '%20'));\r\n\r\n\t\t\t\tif (!obj[key]) {\r\n\t\t\t\t\tobj[key] = val;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!(obj[key] instanceof Array))\r\n\t\t\t\t\tobj[key] = [obj[key]];\r\n\t\t\t\tobj[key].push(val);\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t}\r\n\r\n\t\tfunction configure(name, fn) {  // W.AJAXCONFIG = \r\n\t\t\tajaxconfig[name] = fn;  \r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tfunction ajax(url, data, callback, timeout) { // W.AJAX = \r\n\r\n\t\t\tif (langx.isFunction(url) ) {\r\n\t\t\t\ttimeout = callback;\r\n\t\t\t\tcallback = data;\r\n\t\t\t\tdata = url;\r\n\t\t\t\turl = location.pathname;\r\n\t\t\t}\r\n\r\n\t\t\tvar td = typeof(data);\r\n\t\t\tvar arg = EMPTYARRAY;\r\n\t\t\tvar tmp;\r\n\r\n\t\t\tif (!callback && (td === 'function' || td === 'string')) {\r\n\t\t\t\ttimeout = callback;\r\n\t\t\t\tcallback = data;\r\n\t\t\t\tdata = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tvar index = url.indexOf(' ');\r\n\t\t\tif (index === -1)\r\n\t\t\t\treturn W;\r\n\r\n\t\t\tvar repeat = false;\r\n\r\n\t\t\turl = url.replace(/\\srepeat/i, function() {\r\n\t\t\t\trepeat = true;\r\n\t\t\t\treturn '';\r\n\t\t\t});\r\n\r\n\t\t\tif (repeat)\r\n\t\t\t\targ = [url, data, callback, timeout];\r\n\r\n\t\t\tvar method = url.substring(0, index).toUpperCase();\r\n\t\t\tvar isCredentials = method.substring(0, 1) === '!';\r\n\t\t\tif (isCredentials)\r\n\t\t\t\tmethod = method.substring(1);\r\n\r\n\t\t\tvar headers = {};\r\n\t\t\ttmp = url.match(/\\{.*?\\}/g);\r\n\r\n\t\t\tif (tmp) {\r\n\t\t\t\turl = url.replace(tmp, '').replace(/\\s{2,}/g, ' ');\r\n\t\t\t\ttmp = (new Function('return ' + tmp))();\r\n\t\t\t\tif (langx.isObject(tmp) )\r\n\t\t\t\t\theaders = tmp;\r\n\t\t\t}\r\n\r\n\t\t\turl = url.substring(index).trim().$env();\r\n\r\n\t\t\tsetTimeout(function() {\r\n\r\n\t\t\t\tif (method === 'GET' && data) {\r\n\t\t\t\t\tvar qs = (langx.isString(data)  ? data : jQuery.param(data, true));\r\n\t\t\t\t\tif (qs)\r\n\t\t\t\t\t\turl += '?' + qs;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar options = {};\r\n\t\t\t\toptions.method = method;\r\n\t\t\t\toptions.converters = defaults.jsonconverter;\r\n\r\n\t\t\t\tif (method !== 'GET') {\r\n\t\t\t\t\tif (langx.isString(data) ) {\r\n\t\t\t\t\t\toptions.data = data;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\toptions.contentType = 'application/json; charset=utf-8';\r\n\t\t\t\t\t\toptions.data = STRINGIFY(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.headers = langx.extend(headers, defaults.headers);\r\n\r\n\t\t\t\tif (url.match(/http:\\/\\/|https:\\/\\//i)) {\r\n\t\t\t\t\toptions.crossDomain = true;\r\n\t\t\t\t\tdelete options.headers['X-Requested-With'];\r\n\t\t\t\t\tif (isCredentials)\r\n\t\t\t\t\t\toptions.xhrFields = { withCredentials: true };\r\n\t\t\t\t} else\r\n\t\t\t\t\turl = url.ROOT();\r\n\r\n\t\t\t\tvar custom = url.match(/\\([a-z0-9\\-.,]+\\)/i);\r\n\t\t\t\tif (custom) {\r\n\t\t\t\t\turl = url.replace(custom, '').replace(/\\s+/g, '');\r\n\t\t\t\t\toptions.url = url;\r\n\t\t\t\t\tcustom = custom.toString().replace(/\\(|\\)/g, '').split(',');\r\n\t\t\t\t\tfor (var i = 0; i < custom.length; i++) {\r\n\t\t\t\t\t\tvar opt = ajaxconfig[custom[i].trim()];\r\n\t\t\t\t\t\topt && opt(options);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!options.url)\r\n\t\t\t\t\toptions.url = url;\r\n\r\n\t\t\t\tview.eventer.emit('request', options); \r\n\r\n\t\t\t\tif (options.cancel)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\toptions.type = options.method;\r\n\t\t\t\tdelete options.method;\r\n\r\n\t\t\t\tvar output = {};\r\n\t\t\t\toutput.url = options.url;\r\n\t\t\t\toutput.process = true;\r\n\t\t\t\toutput.error = false;\r\n\t\t\t\toutput.upload = false;\r\n\t\t\t\toutput.method = method;\r\n\t\t\t\toutput.data = data;\r\n\r\n\t\t\t\tdelete options.url;\r\n\r\n\t\t\t\toptions.success = function(r, s, req) {\r\n\t\t\t\t\toutput.response = r;\r\n\t\t\t\t\toutput.status = req.status || 999;\r\n\t\t\t\t\toutput.text = s;\r\n\t\t\t\t\toutput.headers = parseHeaders(req.getAllResponseHeaders());\r\n\t\t\t\t\tview.eventer.emit('response', output);\r\n\t\t\t\t\tif (output.process && !output.cancel) {\r\n\t\t\t\t\t\t/* TODO\r\n\t\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\t\tremap(callback, output.response);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tcallback && callback.call(output, output.response, undefined, output);\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\tcallback && callback.call(output, output.response, undefined, output);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\toptions.error = function(req, s) {\r\n\r\n\t\t\t\t\tvar code = req.status;\r\n\r\n\t\t\t\t\tif (repeat && (!code || code === 408 || code === 502 || code === 503 || code === 504 || code === 509)) {\r\n\t\t\t\t\t\t// internal error\r\n\t\t\t\t\t\t// internet doesn't work\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\targ[0] += ' REPEAT';\r\n\t\t\t\t\t\t\tW.AJAX.apply(M, arg);\r\n\t\t\t\t\t\t}, defaults.delayrepeat);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutput.response = req.responseText;\r\n\t\t\t\t\toutput.status = code || 999;\r\n\t\t\t\t\toutput.text = s;\r\n\t\t\t\t\toutput.error = true;\r\n\t\t\t\t\toutput.headers = parseHeaders(req.getAllResponseHeaders());\r\n\t\t\t\t\tvar ct = output.headers['content-type'];\r\n\r\n\t\t\t\t\tif (ct && ct.indexOf('/json') !== -1) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\toutput.response = PARSE(output.response, defaults.jsondate);\r\n\t\t\t\t\t\t} catch (e) {}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tview.eventer.emit('response', output);\r\n\r\n\t\t\t\t\tif (output.cancel || !output.process)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (defaults.ajaxerrors) {\r\n\t\t\t\t\t\t/* TODO\r\n\t\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\t\tremap(callback, output.response);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tcallback && callback.call(output, output.response, output.status, output);\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\tcallback && callback.call(output, output.response, output.status, output);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tview.eventer.emit('error', output);\r\n\t\t\t\t\t\tif (langx.isFunction(callback)) \r\n\t\t\t\t\t\tcallback.call(output, output.response, output.status, output);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\trequest(makeurl(output.url), options);\r\n\r\n\t\t\t}, timeout || 0);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tfunction ajaxCacheReview(url, data, callback, expire, timeout, clear) { //W.AJAXCACHEREVIEW = \r\n\t\t\treturn ajaxCache(url, data, callback, expire, timeout, clear, true);\r\n\t\t}\r\n\r\n\t\tfunction ajaxCache(url, data, callback, expire, timeout, clear, review) { //W.AJAXCACHE = \r\n\r\n\r\n\t\t\tif (langx.isFunction(data) || (langx.isString(data) && langx.isString(callback)  && !langx.isString(expire))) {\r\n\t\t\t\tclear = timeout;\r\n\t\t\t\ttimeout = expire;\r\n\t\t\t\texpire = callback;\r\n\t\t\t\tcallback = data;\r\n\t\t\t\tdata = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (langx.isBoolean(timeout)) {\r\n\t\t\t\tclear = timeout === true;\r\n\t\t\t\ttimeout = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar index = url.indexOf(' ');\r\n\t\t\tif (index === -1)\r\n\t\t\t\treturn W;\r\n\r\n\t\t\tvar method = url.substring(0, index).toUpperCase();\r\n\t\t\tvar uri = url.substring(index).trim().$env();\r\n\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\tvar value = clear ? undefined : cacherest(method, uri, data, undefined, expire);\r\n\t\t\t\tif (value !== undefined) {\r\n\r\n\t\t\t\t\tvar diff = review ? STRINGIFY(value) : null;\r\n\r\n\t\t\t\t\t/* TODO\r\n\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\tremap(callback, value);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcallback(value, true);\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tcallback(value, true);\r\n\r\n\t\t\t\t\tif (!review)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tajax(url, data, function(r, err) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\tr = err;\r\n\t\t\t\t\t\t// Is same?\r\n\t\t\t\t\t\tif (diff !== STRINGIFY(r)) {\r\n\t\t\t\t\t\t\tcacherest(method, uri, data, r, expire);\r\n\t\t\t\t\t\t\t/* TODO\r\n\t\t\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\t\t\tremap(callback, r);\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\tcallback(r, false, true);\r\n\t\t\t\t\t\t\t*/\r\n\t\t\t\t\t\t\tcallback(r, false, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tajax(url, data, function(r, err) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\tr = err;\r\n\t\t\t\t\tcacherest(method, uri, data, r, expire);\r\n\t\t\t\t\t/* TODO\r\n\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\tremap(callback, r);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcallback(r, false);\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tcallback(r, false);\r\n\t\t\t\t});\r\n\t\t\t}, timeout || 1);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\treturn  {\r\n\t\t\tdefaults,\r\n\t\t\tajax,\r\n\t\t\tajaxCache,\r\n\t\t\tajaxCacheReview,\r\n\t\t\tconfigure,\r\n\t\t\t\"import\" : import2,\r\n\t\t\timportCache,\r\n\t\t\tmakeParams,\r\n\t\t\tmakeurl,\r\n\t\t\tping,\r\n\t\t\tparseQuery,\r\n\t\t\tupload\r\n\t\t};\r\n\r\n\t}\r\n\t\r\n\treturn http;\r\n});"]}