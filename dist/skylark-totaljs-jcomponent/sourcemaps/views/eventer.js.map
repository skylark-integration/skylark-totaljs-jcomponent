{"version":3,"sources":["views/eventer.js"],"names":["define","langx","findFormat","MULTIPLE","view","events","on","name","path","fn","init","context","indexOf","arr","split","trim","i","length","this","push","substring","owner","index","isFunction","replace","obj","tmp","format","charCodeAt","env","p","s","j","b","lastIndexOf","c","join","$path","watches","unshift","call","M","storing","get","off","lang","undefined","type","cleararr","key","remove","item","Object","keys","forEach","clean","topic","each","element","inDOM","$removed","splice","is","emit","e","args","arguments","apply","window","watch","pathmaker","unwatch","emitwatch","value","self","val","jl"],"mappings":"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","file":"../../views/eventer.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"../binding/findFormat\"\r\n],function(langx,findFormat){\r\n\tvar MULTIPLE = ' + ';\r\n\r\n\tfunction eventer(view) {\r\n\t\tvar events = {};\r\n\r\n\t\tfunction emitwatch(path, value, type) {\r\n\t\t\tfor (var i = 0, length = watches.length; i < length; i++) {\r\n\t\t\t\tvar self = watches[i];\r\n\t\t\t\tif (self.path === '*') {\r\n\t\t\t\t\tself.fn.call(self.context, path, self.format ? self.format(value, path, type) : value, type);\r\n\t\t\t\t} else if (path.length > self.path.length) {\r\n\t\t\t\t\tvar index = path.lastIndexOf('.', self.path.length);\r\n\t\t\t\t\tif (index === -1 ? false : self.path === path.substring(0, index)) {\r\n\t\t\t\t\t\tvar val = view.storing.get(self.path); // GET\r\n\t\t\t\t\t\tself.fn.call(self.context, path, self.format ? self.format(val, path, type) : val, type);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (var j = 0, jl = self.$path.length; j < jl; j++) {\r\n\t\t\t\t\t\tif (self.$path[j] === path) {\r\n\t\t\t\t\t\t\tvar val = view.storing.get(self.path); // get2\r\n\t\t\t\t\t\t\tself.fn.call(self.context, path, self.format ? self.format(val, path, type) : val, type);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// ===============================================================\r\n\t\t// Eventer\r\n\t\t// ===============================================================\r\n\r\n\r\n\t\tfunction on(name, path, fn, init, context) {\r\n\r\n\t\t\tif (name.indexOf(MULTIPLE) !== -1) {\r\n\t\t\t\t//ex: ON('name1 + name2 + name3', function() {});\r\n\t\t\t\tvar arr = name.split(MULTIPLE).trim();\r\n\t\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\t\ton(arr[i], path, fn, init, context);\r\n\t\t\t\t}\r\n\t\t\t\treturn this; //W;\r\n\t\t\t}\r\n\r\n\t\t\tvar push = true;\r\n\r\n\t\t\tif (name.substring(0, 1) === '^') {\r\n\t\t\t\tpush = false;\r\n\t\t\t\tname = name.substring(1);\r\n\t\t\t}\r\n\r\n\t\t\tvar owner = null;\r\n\t\t\tvar index = name.indexOf('#');\r\n\r\n\t\t\tif (index) {\r\n\t\t\t\towner = name.substring(0, index).trim();\r\n\t\t\t\tname = name.substring(index + 1).trim();\r\n\t\t\t}\r\n\r\n\t\t\tif (langx.isFunction(path)) {\r\n\t\t\t\tfn = path;\r\n\t\t\t\tpath = name === 'watch' ? '*' : '';\r\n\t\t\t} else {\r\n\t\t\t\tpath = path.replace('.*', '');\r\n\t\t\t}\r\n\r\n\t\t\tvar obj = { \r\n\t\t\t\tname: name, \r\n\t\t\t\tfn: fn, \r\n\t\t\t\towner: owner , \r\n\t\t\t\tcontext: context \r\n//\t\t\t\towner: owner || current_owner, \r\n//\t\t\t\tcontext: context || (current_com == null ? undefined : current_com) \r\n\t\t\t};\r\n\r\n\t\t\tif (name === 'watch') {\r\n\t\t\t\tvar arr = [];\r\n\r\n\t\t\t\tvar tmp = findFormat(path);\r\n\t\t\t\tif (tmp) {\r\n\t\t\t\t\tpath = tmp.path;\r\n\t\t\t\t\tobj.format = tmp.fn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (path.substring(path.length - 1) === '.') {\r\n\t\t\t\t\tpath = path.substring(0, path.length - 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Temporary\r\n\t\t\t\tif (path.charCodeAt(0) === 37) { // %\r\n\t\t\t\t\tpath = 'jctmp.' + path.substring(1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpath = path.env();\r\n\r\n\t\t\t\t// !path = fixed path\r\n\t\t\t\tif (path.charCodeAt(0) === 33) { // !\r\n\t\t\t\t\tpath = path.substring(1);\r\n\t\t\t\t\tarr.push(path);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar p = path.split('.');\r\n\t\t\t\t\tvar s = [];\r\n\t\t\t\t\tfor (var j = 0; j < p.length; j++) {\r\n\t\t\t\t\t\tvar b = p[j].lastIndexOf('[');\r\n\t\t\t\t\t\tif (b !== -1) {\r\n\t\t\t\t\t\t\tvar c = s.join('.');\r\n\t\t\t\t\t\t\tarr.push(c + (c ? '.' : '') + p[j].substring(0, b));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ts.push(p[j]);\r\n\t\t\t\t\t\tarr.push(s.join('.'));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tobj.path = path;\r\n\t\t\t\tobj.$path = arr;\r\n\r\n\t\t\t\tif (push) {\r\n\t\t\t\t\twatches.push(obj);\r\n\t\t\t\t} else {\r\n\t\t\t\t\twatches.unshift(obj);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinit && fn.call(context || M, path, obj.format ? obj.format(view.storing.get(path), path, 0) : view.storing.get(path), 0);\r\n\t\t\t} else {\r\n\t\t\t\tif (events[name]) {\r\n\t\t\t\t\tif (push) {\r\n\t\t\t\t\t\tevents[name].push(obj);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tevents[name].unshift(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tevents[name] = [obj];\r\n\t\t\t\t}\r\n\t\t\t\t//(!C.ready && (name === 'ready' || name === 'init')) && fn(); // TODO: lwf\r\n\t\t\t}\r\n\t\t\treturn this; //W;\r\n\t\t}\r\n\r\n\t\tfunction off(name, path, fn) {\r\n\r\n\t\t\tif (name.indexOf('+') !== -1) {\r\n\t\t\t\tvar arr = name.split('+').trim();\r\n\t\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\t\toff(arr[i], path, fn); //W.OFF\r\n\t\t\t\t}\r\n\t\t\t\treturn this; //W;\r\n\t\t\t}\r\n\r\n\t\t\tif (lang.isFunction(path)) {\r\n\t\t\t\tfn = path;\r\n\t\t\t\tpath = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (path === undefined) {\r\n\t\t\t\tpath = '';\r\n\t\t\t}\r\n\r\n\t\t\tvar owner = null;\r\n\t\t\tvar index = name.indexOf('#');\r\n\t\t\tif (index) {\r\n\t\t\t\towner = name.substring(0, index).trim();\r\n\t\t\t\tname = name.substring(index + 1).trim();\r\n\t\t\t}\r\n\r\n\t\t\tif (path) {\r\n\t\t\t\tpath = path.replace('.*', '').trim();\r\n\t\t\t\tvar tmp = findFormat(path);\r\n\t\t\t\tif (tmp) {\r\n\t\t\t\t\tpath = tmp.path;\r\n\t\t\t\t}\r\n\t\t\t\tif (path.substring(path.length - 1) === '.') {\r\n\t\t\t\t\tpath = path.substring(0, path.length - 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar type = 0;\r\n\r\n\t\t\tif (owner && !path && !fn && !name)\r\n\t\t\t\ttype = 1;\r\n\t\t\telse if (owner && name && !fn && !path)\r\n\t\t\t\ttype = 2;\r\n\t\t\telse if (owner && name && path)\r\n\t\t\t\ttype = 3;\r\n\t\t\telse if (owner && name && path && fn)\r\n\t\t\t\ttype = 4;\r\n\t\t\telse if (name && path && fn)\r\n\t\t\t\ttype = 5;\r\n\t\t\telse if (name && path)\r\n\t\t\t\ttype = 7;\r\n\t\t\telse if (fn)\r\n\t\t\t\ttype = 6;\r\n\r\n\t\t\tvar cleararr = function(arr, key) {\r\n\t\t\t\treturn arr.remove(function(item) {\r\n\t\t\t\t\tif (type > 2 && type < 5) {\r\n\t\t\t\t\t\tif (item.path !== path)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar v = false;\r\n\t\t\t\t\tif (type === 1)\r\n\t\t\t\t\t\tv = item.owner === owner;\r\n\t\t\t\t\telse if (type === 2)\r\n\t\t\t\t\t\tv = key === name && item.owner === owner;\r\n\t\t\t\t\telse if (type === 3)\r\n\t\t\t\t\t\tv = key === name && item.owner === owner;\r\n\t\t\t\t\telse if (type === 4)\r\n\t\t\t\t\t\tv = key === name && item.owner === owner && item.fn === fn;\r\n\t\t\t\t\telse if (type === 5 || type === 6)\r\n\t\t\t\t\t\tv = key === name && item.fn === fn;\r\n\t\t\t\t\telse if (type === 6)\r\n\t\t\t\t\t\tv = item.fn === fn;\r\n\t\t\t\t\telse if (type === 7)\r\n\t\t\t\t\t\tv = key === name && item.path === path;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tv = key === name;\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tObject.keys(events).forEach(function(p) {\r\n\t\t\t\tevents[p] = cleararr(events[p], p);\r\n\t\t\t\tif (!events[p].length) {\r\n\t\t\t\t\tdelete events[p];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\twatches = cleararr(watches, 'watch');\r\n\t\t\treturn this; //W;\r\n\t\t}\r\n\r\n\t\tfunction emit(name) {\r\n\r\n\t\t\tvar e = events[name];\r\n\t\t\tif (!e) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar args = [];\r\n\r\n\t\t\tfor (var i = 1, length = arguments.length; i < length; i++) {\r\n\t\t\t\targs.push(arguments[i]);\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, length = e.length; i < length; i++) {\r\n\t\t\t\tvar context = e[i].context;\r\n\t\t\t\tif (context !== undefined && (context === null || context.$removed)) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\te[i].fn.apply(context || window, args);\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfunction each(fn) {\r\n\r\n\t\t\tvar keys = Object.keys(events);\r\n\t\t\tvar length = keys.length;\r\n\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tvar key = keys[i];\r\n\t\t\t\tarr = events[key];\r\n\t\t\t\tfn(key,arr);\r\n\r\n\t\t\t\tif (!arr.length) {\r\n\t\t\t\t\tdelete events[key];\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvar watches = [];\r\n\r\n\t\tfunction unwatch(path, fn) { //W.UNWATCH \r\n\r\n\t\t\tif (path.indexOf(MULTIPLE) !== -1) {\r\n\t\t\t\tvar arr = path.split(MULTIPLE).trim();\r\n\t\t\t\tfor (var i = 0; i < arr.length; i++)\r\n\t\t\t\t\tunwatch(arr[i], fn);\r\n\t\t\t\treturn this; //W;\r\n\t\t\t}\r\n\r\n\t\t\treturn off('watch', path, fn); //OFF\r\n\t\t};\r\n\r\n\t\tfunction watch(path, fn, init) { // W.WATCH\r\n\r\n\t\t\tif (path.indexOf(MULTIPLE) !== -1) {\r\n\t\t\t\tvar arr = path.split(MULTIPLE).trim();\r\n\t\t\t\tfor (var i = 0; i < arr.length; i++)\r\n\t\t\t\t\twatch(arr[i], fn, init);\r\n\t\t\t\treturn this; //W;\r\n\t\t\t}\r\n\r\n\t\t\tif (langx.isFunction(path)) { //if (typeof(path) === TYPE_FN) {\r\n\t\t\t\tinit = fn;\r\n\t\t\t\tfn = path;\r\n\t\t\t\tpath = '*';\r\n\t\t\t}\r\n\r\n\t\t\tvar push = '';\r\n\r\n\t\t\tif (path.substring(0, 1) === '^') {\r\n\t\t\t\tpath = path.substring(1);\r\n\t\t\t\tpush = '^';\r\n\t\t\t}\r\n\r\n\t\t\tpath = pathmaker(path, true);\r\n\t\t\ton(push + 'watch', path, fn, init);  // ON\r\n\t\t\treturn this; //W;\r\n\t\t}\r\n\r\n\t\tfunction clean() {\r\n\t\t\ttopic.each(function(key,arr){\r\n\t\t\t\tindex = 0;\r\n\t\t\t\twhile (true) {\r\n\r\n\t\t\t\t\tvar item = arr[index++];\r\n\t\t\t\t\tif (item === undefined) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (item.context == null || (item.context.element && inDOM(item.context.element[0]))) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (item.context && item.context.element) {\r\n\t\t\t\t\t\titem.context.element.remove();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\titem.context.$removed = true;\r\n\t\t\t\t\titem.context = null;\r\n\t\t\t\t\tarr.splice(index - 1, 1);\r\n\r\n\t\t\t\t\tif (!arr.length) {\r\n\t\t\t\t\t\tdelete events[key];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tindex -= 2;\r\n\t\t\t\t\tis = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\tindex = 0;\r\n\t\t\twhile (true) {\r\n\t\t\t\tvar item = watches[index++];\r\n\t\t\t\tif (item === undefined)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tif (item.context == null || (item.context.element && inDOM(item.context.element[0])))\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\titem.context && item.context.element && item.context.element.remove();\r\n\t\t\t\titem.context.$removed = true;\r\n\t\t\t\titem.context = null;\r\n\t\t\t\twatches.splice(index - 1, 1);\r\n\t\t\t\tindex -= 2;\r\n\t\t\t\tis = true;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"clean\" : clean,\r\n\t\t\t\"on\" : on,\r\n\t\t\t\"off\" : off,\r\n\t\t\t\"emit\" : emit,\r\n\t\t\t\"watch\" : watch,\r\n\t\t\t\"unwatch\" : unwatch,\r\n\t\t\t\"emitwatch\" : emitwatch\r\n\t\t};\r\n\r\n\t}\r\n\r\n\treturn eventer;\r\n});"]}