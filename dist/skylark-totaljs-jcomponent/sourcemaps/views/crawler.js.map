{"version":3,"sources":["views/crawler.js"],"names":["define","$","helper","parsebinder","attrcom","crawler","container","onComponent","level","paths","document","body","comp","scope","closest","ATTRSCOPE","length","push","b","released","binders","$jcbind","getAttribute","el","name","$com","arr","childNodes","sub","undefined","i","tagName","setAttribute","ATTRREL","REGCOM","test","innerHTML","indexOf","a"],"mappings":";;;;;;;AAAAA,QACC,iBACA,uBACA,0BACC,SAASC,EAAGC,EAAQC,GACrB,IAAIC,EAAUF,EAAOE,QA0HrB,OAxHA,SAASC,EAAQC,EAAWC,EAAaC,EAAOC,GAQ/C,GALCH,EADGA,EACSL,EAAEK,GAAW,GAEbI,SAASC,KAGtB,CAIA,IAAIC,EAAOR,EAAQE,EAAW,WAC9B,GAAa,MAATM,GAAyB,UAATA,EAApB,CAKA,IAAa,MAATJ,GAA2B,IAAVA,KACpBC,KACIH,IAAcI,SAASC,MAAM,CAChC,IAAIE,EAAQZ,EAAEK,GAAWQ,QAAQ,IAAMC,UAAY,KAC/CF,GAASA,EAAMG,QAClBP,EAAMQ,KAAKJ,EAAM,IAKpB,IAAIK,EAAI,KACJC,IAAWb,GAA+C,SAAnCF,EAAQE,EAAW,YAE1Cc,EAAU,KADJhB,EAAQE,EAAW,UAI5BG,EAAMQ,KAAKX,GAGPA,EAAUe,UACdH,EAAIZ,EAAUgB,aAAa,cAAgBhB,EAAUgB,aAAa,WAE5DF,IACJA,MAEDA,EAAQH,MACPM,GAAIjB,EACJY,EAAGA,KAKN,IAAIM,EAAOpB,EAAQE,GACdA,EAAUmB,MAAgB,MAARD,GACtBjB,EAAYiB,EAAMlB,EAAW,EAAGG,GAGjC,IAAIiB,EAAMpB,EAAUqB,WAChBC,UAEUC,IAAVrB,EACHA,EAAQ,EAERA,IAGD,IAAK,IAAIsB,EAAI,EAAGd,EAASU,EAAIV,OAAQc,EAAId,EAAQc,IAAK,CACrD,IAAIP,EAAKG,EAAII,GACb,GAAIP,EAAI,CAEP,IAAKA,EAAGQ,QACP,SAID,GAAa,OADbnB,EAAOW,EAAGD,aAAa,qBACM,UAATV,EACnB,cAGeiB,IAAZN,EAAGE,MAEM,OADZD,EAAOpB,EAAQmB,MAEVJ,GACHI,EAAGS,aAAaC,QAAS,QAE1B1B,EAAYiB,GAAQ,GAAID,EAAIf,EAAOC,IAIhCc,EAAGF,UACPH,EAAIK,EAAGD,aAAa,cAAgBC,EAAGD,aAAa,WAEnDC,EAAGF,QAAU,GACZD,IAAYA,MACbA,EAAQH,MAAOM,GAAIA,EAAIL,EAAGA,KAKf,OADbN,EAAOW,EAAGD,aAAa,qBACM,UAATV,GACfW,EAAGI,WAAWX,QAAyB,WAAfO,EAAGQ,SAAwBG,OAAOC,KAAKZ,EAAGa,aAAmC,IAArBR,EAAIS,QAAQd,IAC9FK,EAAIX,KAAKM,IAMd,IAASO,EAAI,EAAGd,EAASY,EAAIZ,OAAQc,EAAId,EAAQc,KAChDP,EAAKK,EAAIE,KAERzB,EAAQkB,EAAIhB,EAAaC,EAAOC,GAASA,EAAMO,OAASP,MAI1D,GAAIW,EACH,IAASU,EAAI,EAAGA,EAAIV,EAAQJ,OAAQc,IAAK,CACxC,IAAIQ,EAAIlB,EAAQU,GAChBQ,EAAEf,GAAGF,QAAUlB,EAAYmC,EAAEf,GAAIe,EAAEpB,EAAGT","file":"../../views/crawler.js","sourcesContent":["define([\r\n\t\"../utils/query\",\r\n\t\"../components/helper\",\r\n\t\"../binding/parsebinder\"\r\n],function($, helper, parsebinder){\r\n\tvar attrcom = helper.attrcom;\r\n\r\n\tfunction crawler(container, onComponent, level, paths) {\r\n\r\n\t\tif (container) {\r\n\t\t\tcontainer = $(container)[0];\r\n\t\t} else {\r\n\t\t\tcontainer = document.body;\r\n\t\t}\r\n\r\n\t\tif (!container) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar comp = attrcom(container, 'compile') ;\r\n\t\tif (comp === '0' || comp === 'false') {\r\n\t\t\t// no compile\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (level == null || level === 0) {\r\n\t\t\tpaths = [];\r\n\t\t\tif (container !== document.body) {\r\n\t\t\t\tvar scope = $(container).closest('[' + ATTRSCOPE + ']');\r\n\t\t\t\tif (scope && scope.length) {\r\n\t\t\t\t\tpaths.push(scope[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar b = null;\r\n\t\tvar released = container ? attrcom(container, 'released') === 'true' : false;\r\n\t\tvar tmp = attrcom(container, 'scope');\r\n\t\tvar binders = null;\r\n\r\n\t\tif (tmp) {\r\n\t\t\tpaths.push(container);\r\n\t\t}\r\n\r\n\t\tif (!container.$jcbind) {\r\n\t\t\tb = container.getAttribute('data-bind') || container.getAttribute('bind');\r\n\t\t\tif (b) {\r\n\t\t\t\tif (!binders) {\r\n\t\t\t\t\tbinders = [];\r\n\t\t\t\t}\r\n\t\t\t\tbinders.push({ \r\n\t\t\t\t\tel: container, \r\n\t\t\t\t\tb: b \r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar name = attrcom(container);\r\n\t\tif (!container.$com && name != null) {\r\n\t\t\tonComponent(name, container, 0, paths);\r\n\t\t}\r\n\r\n\t\tvar arr = container.childNodes;\r\n\t\tvar sub = [];\r\n\r\n\t\tif (level === undefined) {\r\n\t\t\tlevel = 0;\r\n\t\t} else {\r\n\t\t\tlevel++;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\t\t\tvar el = arr[i];\r\n\t\t\tif (el) {\r\n\r\n\t\t\t\tif (!el.tagName) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcomp = el.getAttribute('data-jc-compile');\r\n\t\t\t\tif (comp === '0' || comp === 'false') {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (el.$com === undefined) {\r\n\t\t\t\t\tname = attrcom(el);\r\n\t\t\t\t\tif (name != null) {\r\n\t\t\t\t\t\tif (released) {\r\n\t\t\t\t\t\t\tel.setAttribute(ATTRREL, 'true');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tonComponent(name || '', el, level, paths);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!el.$jcbind) {\r\n\t\t\t\t\tb = el.getAttribute('data-bind') || el.getAttribute('bind');\r\n\t\t\t\t\tif (b) {\r\n\t\t\t\t\t\tel.$jcbind = 1;\r\n\t\t\t\t\t\t!binders && (binders = []);\r\n\t\t\t\t\t\tbinders.push({ el: el, b: b });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcomp = el.getAttribute('data-jc-compile');\r\n\t\t\t\tif (comp !== '0' && comp !== 'false') {\r\n\t\t\t\t\tif (el.childNodes.length && el.tagName !== 'SCRIPT' && REGCOM.test(el.innerHTML) && sub.indexOf(el) === -1)  {\r\n\t\t\t\t\t  sub.push(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (var i = 0, length = sub.length; i < length; i++) {\r\n\t\t\tel = sub[i];\r\n\t\t\tif (el) {\r\n\t\t\t\tcrawler(el, onComponent, level, paths && paths.length ? paths : []);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (binders) {\r\n\t\t\tfor (var i = 0; i < binders.length; i++) {\r\n\t\t\t\tvar a = binders[i];\r\n\t\t\t\ta.el.$jcbind = parsebinder(a.el, a.b, paths);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn crawler;\r\n});\r\n"]}