{"version":3,"sources":["views/scoper.js"],"names":["define","Scope","view","helper"],"mappings":";;;;;;;AAAAA,QACC,uBACC,SAASC,GA8GV,OA7GA,SAAgBC,GACFA,EAAKC","file":"../../views/scoper.js","sourcesContent":["define([\r\n\t\"../components/Scope\"\r\n],function(Scope){\r\n\tfunction scoper(view) {\r\n\t\tvar helper = view.helper;\r\n\r\n\t\tfunction initscopes(scopes) {\r\n\r\n\t\t\tvar scope = scopes[scopes.length - 1];\r\n\t\t\tif (scope.$scopedata) {\r\n\t\t\t\treturn scope.$scopedata;\r\n\t\t\t}\r\n\r\n\t\t\tvar path = helper.attrscope(scope); //attrcom(scope, 'scope');\r\n\t\t\tvar independent = path.substring(0, 1) === '!';\r\n\r\n\t\t\tif (independent) {\r\n\t\t\t\tpath = path.substring(1);\r\n\t\t\t}\r\n\r\n\t\t\tvar arr = [scope];\r\n\t\t\tif (!independent) {\r\n\t\t\t\tfor (var i = scopes.length - 1; i > -1; i--) {\r\n\t\t\t\t\tarr.push(scopes[i]);\r\n\t\t\t\t\tif (helpers.attrscope(scopes[i]).substring(0, 1) === '!') { // scopes[i].getAttribute(ATTRSCOPE).\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar absolute = '';\r\n\r\n\t\t\tarr.length && arr.reverse();\r\n\r\n\t\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\r\n\t\t\t\tvar sc = arr[i];\r\n\t\t\t\tvar p = sc.$scope || helper.attrscope(sc); //attrcom(sc, 'scope');\r\n\r\n\t\t\t\tsc.$initialized = true;\r\n\r\n\t\t\t\tif (sc.$processed) {\r\n\t\t\t\t\tabsolute = p;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsc.$processed = true;\r\n\t\t\t\tsc.$isolated = p.substring(0, 1) === '!';\r\n\r\n\t\t\t\tif (sc.$isolated) {\r\n\t\t\t\t\tp = p.substring(1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!p || p === '?')\r\n\t\t\t\t\tp = langx.guid(25).replace(/\\d/g, ''); //GUID\r\n\r\n\t\t\t\tif (sc.$isolated) {\r\n\t\t\t\t\tabsolute = p;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tabsolute += (absolute ? '.' : '') + p;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsc.$scope = absolute;\r\n\t\t\t\tvar d = new Scope();\r\n\t\t\t\td._id = d.ID = d.id = langx.guid(10); //GUID\r\n\t\t\t\td.path = absolute;\r\n\t\t\t\td.elements = arr.slice(0, i + 1);\r\n\t\t\t\td.isolated = sc.$isolated;\r\n\t\t\t\td.element = $(arr[0]);\r\n\t\t\t\tsc.$scopedata = d;\r\n\r\n\t\t\t\tvar tmp = helper.attrcom(sc, 'value');\r\n\t\t\t\tif (tmp) {\r\n\t\t\t\t\tvar fn = new Function('return ' + tmp);\r\n\t\t\t\t\tdefaults['#' + HASH(p)] = fn; // paths by path (DEFAULT() --> can reset scope object)\r\n\t\t\t\t\ttmp = fn();\r\n\t\t\t\t\tset(p, tmp);\r\n\t\t\t\t\temitwatch(p, tmp, 1);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Applies classes\r\n\t\t\t\tvar cls = helper.attrcom(sc, 'class');\r\n\t\t\t\tif (cls) {\r\n\t\t\t\t\t(function(cls) {\r\n\t\t\t\t\t\tcls = cls.split(' ');\r\n\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\tvar el = $(sc);\r\n\t\t\t\t\t\t\tfor (var i = 0, length = cls.length; i < length; i++) {\r\n\t\t\t\t\t\t\t\tel.tclass(cls[i]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 5);\r\n\t\t\t\t\t})(cls);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttmp = helper.attrcom(sc, 'init');\r\n\t\t\t\tif (tmp) {\r\n\t\t\t\t\ttmp = scopes.get(tmp);\r\n\t\t\t\t\tif (tmp) {\r\n\t\t\t\t\t\tvar a = current_owner;\r\n\t\t\t\t\t\tcurrent_owner = 'scope' + d._id;\r\n\t\t\t\t\t\ttmp.call(d, p, $(sc));\r\n\t\t\t\t\t\tcurrent_owner = a;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn scope.$scopedata;\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\treturn scoper;\r\n});"]}