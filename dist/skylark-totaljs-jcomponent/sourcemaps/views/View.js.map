{"version":3,"sources":["views/View.js"],"names":["define","langx","compose","crawler","download","pend","$rebinder","keypressdelay","self","com","$com","$jctimeout","dirty","getter","value","View","Evented","inherit","options","elmComAttrNames","base","url","removed","released","scope","_construct","elm","this","is","recompile","importing","pending","init","imports","ready","storer","storing","attrcom","el","compile","container","immediate","arr","W","READY","Array","push","apply","jComponent","components","length","fn","shift","clearTimeout","setTimeout","bindersnew","splice","i","item","exec","data","path","getx","undefined","toggles","async","next","toggle","element","tclass","refresh","setTimeout2","all","sort","a","b","$removed","al","bl","LCOMPARER","start","$el","$","document","$ready","load","on","$jckeypress","$jcevent","tmp","config","$realtime","$binding","MD","keypress","$jcdelay","$delay","delay","$jconly","$keypress","e","type","$jcskip","$skip","setter","get","tagName","sel","selectedIndex","checked","setterX","$domready","end","forEach","name","prototype","arguments"],"mappings":"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","file":"../../views/View.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"./compose\",\r\n\t\"./crawler\",\r\n\t\"./download\",\r\n\t\"./pend\"\r\n],function(langx, compose, crawler, download, pend){\r\n\r\n\tvar $rebinder;\r\n\r\n\tfunction rebindbinder() {\r\n\t\t$rebinder && clearTimeout($rebinder);\r\n\t\t$rebinder = setTimeout(function() {\r\n\t\t\tvar arr = bindersnew.splice(0);\r\n\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\tvar item = arr[i];\r\n\t\t\t\tif (!item.init) {\r\n\t\t\t\t\tif (item.com) {\r\n\t\t\t\t\t\titem.exec(item.com.data(item.path), item.path);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.exec(getx(item.path), item.path);  // GET\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 50);\r\n\t}\r\n\r\n\tfunction keypressdelay(self) {\r\n\t\tvar com = self.$com;\r\n\t\t// Reset timeout\r\n\t\tself.$jctimeout = 0;\r\n\t\t// It's not dirty\r\n\t\tcom.dirty(false, true);\r\n\t\t// Binds a value\r\n\t\tcom.getter(self.value, true);\r\n\t}\r\n\r\n\r\n\tvar View = langx.Evented.inherit({\r\n\t    options : {\r\n\t      elmComAttrNames: {\r\n\t        base : \"data-jc\",\r\n\t        url : \"data-jc-url\",\r\n\t        removed : \"data-jc-removed\",\r\n\t        released : \"data-jc-released\",\r\n\t        scope : \"data-jc-scope\"\r\n\t      }\r\n\t    },\r\n\r\n\t\t_construct : function(elm,options) {\r\n\r\n\t\t\tthis.is = false;\r\n\t\t\tthis.recompile = false;\r\n\t\t\tthis.importing = 0;\r\n\t\t\tthis.pending = [];\r\n\t\t\tthis.init = [];\r\n\t\t\tthis.imports = {};\r\n\t\t\tthis.ready = [];\r\n\r\n\t\t\tthis.storer = storing(this);\r\n\t\t},\r\n\r\n\t\tattrcom : function(el) {\r\n\t\t\treturn attrcom(el);\r\n\t\t},\r\n\r\n\t\tcompile : function (container,immediate) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.is) {\r\n\t\t\t\tself.recompile = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar arr = [];\r\n\r\n\t\t\tif (W.READY instanceof Array)  {\r\n\t\t\t\tarr.push.apply(arr, W.READY);\r\n\t\t\t}\r\n\t\t\tif (W.jComponent instanceof Array) {\r\n\t\t\t\tarr.push.apply(arr, W.jComponent);\r\n\t\t\t}\r\n\t\t\tif (W.components instanceof Array) {\r\n\t\t\t\tarr.push.apply(arr, W.components);\r\n\t\t\t}\r\n\r\n\t\t\tif (arr.length) {\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\tvar fn = arr.shift();\r\n\t\t\t\t\tif (!fn){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfn();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.is = true;\r\n\t\t\tdownload(self);\r\n\r\n\t\t\tif (self.pending.length) {\r\n\t\t\t\t(function(container) {\r\n\t\t\t\t\tself.pending.push(function() {\r\n\t\t\t\t\t\tcompile(self,container);\r\n\t\t\t\t\t});\r\n\t\t\t\t})(container);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar has = false;\r\n\r\n\t\t\tcrawler(self,container, compose);\r\n\r\n\t\t\t// perform binder\r\n\t\t\trebindbinder();\r\n\r\n\t\t\tif (!has || !self.pending.length) {\r\n\t\t\t\tself.is = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (container !== undefined || !toggles.length) {\r\n\t\t\t\treturn pend();\r\n\t\t\t}\r\n\r\n\t\t\tlangx.async(toggles, function(item, next) {\r\n\t\t\t\tfor (var i = 0, length = item.toggle.length; i < length; i++)\r\n\t\t\t\t\titem.element.tclass(item.toggle[i]);\r\n\t\t\t\tnext();\r\n\t\t\t}, pend);\r\n\t\t},\r\n\r\n\t\trefresh : function () {\r\n\t\t\tsetTimeout2('$refresh', function() {\r\n\t\t\t\tall.sort(function(a, b) {  // M.components.sort\r\n\t\t\t\t\tif (a.$removed || !a.path)\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\tif (b.$removed || !b.path)\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\tvar al = a.path.length;\r\n\t\t\t\t\tvar bl = b.path.length;\r\n\t\t\t\t\treturn al > bl ? - 1 : al === bl ? LCOMPARER(a.path, b.path) : 1;\r\n\t\t\t\t});\r\n\t\t\t}, 200);\r\n\t\t},\r\n\r\n\t\tstart : function() {\r\n\t\t\tvar $el = $(this.elm);\r\n\t\t\t$(document).ready(function() {\r\n\r\n\t\t\t\tif ($ready) {\r\n\t\t\t\t\tclearTimeout($ready);\r\n\t\t\t\t\tload();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$el.on('input', 'input[data-jc-bind],textarea[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\t// realtime binding\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter || self.$jckeypress === false) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.$jcevent = 2;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === undefined) {\r\n\t\t\t\t\t\tvar tmp = attrcom(self, 'keypress');\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tself.$jckeypress = tmp === 'true';\r\n\t\t\t\t\t\telse if (com.config.$realtime != null)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$realtime === true;\r\n\t\t\t\t\t\telse if (com.config.$binding)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$binding === 1;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tself.$jckeypress = MD.keypress;\r\n\t\t\t\t\t\tif (self.$jckeypress === false)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jcdelay === undefined) {\r\n\t\t\t\t\t\tself.$jcdelay = +(attrcom(self, 'keypress-delay') || com.config.$delay || MD.delay);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jconly === undefined) {\r\n\t\t\t\t\t\tself.$jconly = attrcom(self, 'keypress-only') === 'true' || com.config.$keypress === true || com.config.$binding === 2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\t\r\n\t\t\t\t\t} \r\n\t\t\t\t\tself.$jctimeout = setTimeout(keypressdelay, self.$jcdelay, self);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('focus blur', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function(e) {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (e.type === 'focusin')\r\n\t\t\t\t\t\tself.$jcevent = 1;\r\n\t\t\t\t\telse if (self.$jcevent === 1) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, 3);\r\n\t\t\t\t\t} else if (self.$jcskip) {\r\n\t\t\t\t\t\tself.$jcskip = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// formatter\r\n\t\t\t\t\t\tvar tmp = com.$skip;\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tcom.$skip = false;\r\n\t\t\t\t\t\tcom.setter(com.get(), com.path, 2);\r\n\t\t\t\t\t\tif (tmp) {\r\n\t\t\t\t\t\t\tcom.$skip = tmp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('change', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (self.$jconly || !com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === false) {\r\n\t\t\t\t\t\t// bind + validate\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.getter(self.value, false);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tswitch (self.tagName) {\r\n\t\t\t\t\t\tcase 'SELECT':\r\n\t\t\t\t\t\t\tvar sel = self[self.selectedIndex];\r\n\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\tcom.getter(sel.value, false);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\t\tif (self.type === 'checkbox' || self.type === 'radio') {\r\n\t\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\t\tcom.getter(self.checked, false);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, true);\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\r\n\t\t\t\t\t\tself.$jctimeout = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.setter && com.setterX(com.get(), self.path, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsetTimeout(compile, 2);\r\n\t\t\t\t$domready = true;\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tend : function() {\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t[\r\n\t\t\"cache\",\r\n\t\t\"can\",\r\n\t\t\"change\",\r\n\t\t\"changed\",\r\n\t\t\"create\",\r\n\t\t\"default\",\r\n\t\t\"disabled\",\r\n\t\t\"errors\",\r\n\t\t\"evaluate\",\r\n\t\t\"exec\",\r\n\t\t\"exec2\",\r\n\t\t\"extend\",\r\n\t\t\"format\",\r\n\t\t\"get\",\r\n\t\t\"inc\",\r\n\t\t\"invalid\",\r\n\t\t\"make\",\r\n\t\t\"modify\",\r\n\t\t\"modified\",\r\n\t\t\"parser\",\r\n\t\t\"push\",\r\n\t\t\"reset\",\r\n\t\t\"rewrite\",\r\n\t\t\"set\",\r\n\t\t\"set2\",\r\n \t\t\"setx\",\r\n \t\t\"skip\",\r\n \t\t\"update\",\r\n \t\t\"used\",\r\n \t\t\"validate\"\r\n \t].forEach(function(name){\r\n \t\tView.prototype[name] = function(){\r\n \t\t\treturn this.storer[name].apply(this,arguments);\r\n \t\t}\r\n \t});\r\n\r\n\r\n\treturn View;\r\n});"]}