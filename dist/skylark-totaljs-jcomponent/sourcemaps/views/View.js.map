{"version":3,"sources":["views/View.js"],"names":["define","langx","compose","crawler","download","pend","$rebinder","keypressdelay","self","com","$com","$jctimeout","dirty","getter","value","Evented","inherit","options","elmComAttrNames","base","url","removed","released","scope","_construct","elm","this","is","recompile","importing","pending","init","imports","ready","storing","attrcom","el","compile","container","immediate","arr","W","READY","Array","push","apply","jComponent","components","length","fn","shift","clearTimeout","setTimeout","bindersnew","splice","i","item","exec","data","path","getx","undefined","toggles","async","next","toggle","element","tclass","refresh","setTimeout2","all","sort","a","b","$removed","al","bl","LCOMPARER","start","$el","$","document","$ready","load","on","$jckeypress","$jcevent","tmp","config","$realtime","$binding","MD","keypress","$jcdelay","$delay","delay","$jconly","$keypress","e","type","$jcskip","$skip","setter","get","tagName","sel","selectedIndex","checked","setterX","$domready","end"],"mappings":"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","file":"../../views/View.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"./compose\",\r\n\t\"./crawler\",\r\n\t\"./download\",\r\n\t\"./pend\"\r\n],function(langx, compose, crawler, download, pend){\r\n\r\n\tvar $rebinder;\r\n\r\n\tfunction rebindbinder() {\r\n\t\t$rebinder && clearTimeout($rebinder);\r\n\t\t$rebinder = setTimeout(function() {\r\n\t\t\tvar arr = bindersnew.splice(0);\r\n\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\tvar item = arr[i];\r\n\t\t\t\tif (!item.init) {\r\n\t\t\t\t\tif (item.com) {\r\n\t\t\t\t\t\titem.exec(item.com.data(item.path), item.path);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.exec(getx(item.path), item.path);  // GET\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 50);\r\n\t}\r\n\r\n\tfunction keypressdelay(self) {\r\n\t\tvar com = self.$com;\r\n\t\t// Reset timeout\r\n\t\tself.$jctimeout = 0;\r\n\t\t// It's not dirty\r\n\t\tcom.dirty(false, true);\r\n\t\t// Binds a value\r\n\t\tcom.getter(self.value, true);\r\n\t}\r\n\r\n\r\n\tvar View = langx.Evented.inherit({\r\n\t    options : {\r\n\t      elmComAttrNames: {\r\n\t        base : \"data-jc\",\r\n\t        url : \"data-jc-url\",\r\n\t        removed : \"data-jc-removed\",\r\n\t        released : \"data-jc-released\",\r\n\t        scope : \"data-jc-scope\"\r\n\t      }\r\n\t    },\r\n\r\n\t\t_construct : function(elm,options) {\r\n\r\n\t\t\tthis.is = false;\r\n\t\t\tthis.recompile = false;\r\n\t\t\tthis.importing = 0;\r\n\t\t\tthis.pending = [];\r\n\t\t\tthis.init = [];\r\n\t\t\tthis.imports = {};\r\n\t\t\tthis.ready = [];\r\n\r\n\t\t\tthis.storing = storing(this);\r\n\t\t},\r\n\r\n\t\tattrcom : function(el) {\r\n\t\t\treturn attrcom(el);\r\n\t\t},\r\n\r\n\t\tcompile : function (container,immediate) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tif (self.is) {\r\n\t\t\t\tself.recompile = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar arr = [];\r\n\r\n\t\t\tif (W.READY instanceof Array)  {\r\n\t\t\t\tarr.push.apply(arr, W.READY);\r\n\t\t\t}\r\n\t\t\tif (W.jComponent instanceof Array) {\r\n\t\t\t\tarr.push.apply(arr, W.jComponent);\r\n\t\t\t}\r\n\t\t\tif (W.components instanceof Array) {\r\n\t\t\t\tarr.push.apply(arr, W.components);\r\n\t\t\t}\r\n\r\n\t\t\tif (arr.length) {\r\n\t\t\t\twhile (true) {\r\n\t\t\t\t\tvar fn = arr.shift();\r\n\t\t\t\t\tif (!fn){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfn();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tself.is = true;\r\n\t\t\tdownload(self);\r\n\r\n\t\t\tif (self.pending.length) {\r\n\t\t\t\t(function(container) {\r\n\t\t\t\t\tself.pending.push(function() {\r\n\t\t\t\t\t\tcompile(self,container);\r\n\t\t\t\t\t});\r\n\t\t\t\t})(container);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar has = false;\r\n\r\n\t\t\tcrawler(self,container, compose);\r\n\r\n\t\t\t// perform binder\r\n\t\t\trebindbinder();\r\n\r\n\t\t\tif (!has || !self.pending.length) {\r\n\t\t\t\tself.is = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (container !== undefined || !toggles.length) {\r\n\t\t\t\treturn pend();\r\n\t\t\t}\r\n\r\n\t\t\tlangx.async(toggles, function(item, next) {\r\n\t\t\t\tfor (var i = 0, length = item.toggle.length; i < length; i++)\r\n\t\t\t\t\titem.element.tclass(item.toggle[i]);\r\n\t\t\t\tnext();\r\n\t\t\t}, pend);\r\n\t\t},\r\n\r\n\t\trefresh : function () {\r\n\t\t\tsetTimeout2('$refresh', function() {\r\n\t\t\t\tall.sort(function(a, b) {  // M.components.sort\r\n\t\t\t\t\tif (a.$removed || !a.path)\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\tif (b.$removed || !b.path)\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\tvar al = a.path.length;\r\n\t\t\t\t\tvar bl = b.path.length;\r\n\t\t\t\t\treturn al > bl ? - 1 : al === bl ? LCOMPARER(a.path, b.path) : 1;\r\n\t\t\t\t});\r\n\t\t\t}, 200);\r\n\t\t},\r\n\r\n\t\tstart : function() {\r\n\t\t\tvar $el = $(this.elm);\r\n\t\t\t$(document).ready(function() {\r\n\r\n\t\t\t\tif ($ready) {\r\n\t\t\t\t\tclearTimeout($ready);\r\n\t\t\t\t\tload();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$el.on('input', 'input[data-jc-bind],textarea[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\t// realtime binding\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter || self.$jckeypress === false) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.$jcevent = 2;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === undefined) {\r\n\t\t\t\t\t\tvar tmp = attrcom(self, 'keypress');\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tself.$jckeypress = tmp === 'true';\r\n\t\t\t\t\t\telse if (com.config.$realtime != null)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$realtime === true;\r\n\t\t\t\t\t\telse if (com.config.$binding)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$binding === 1;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tself.$jckeypress = MD.keypress;\r\n\t\t\t\t\t\tif (self.$jckeypress === false)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jcdelay === undefined) {\r\n\t\t\t\t\t\tself.$jcdelay = +(attrcom(self, 'keypress-delay') || com.config.$delay || MD.delay);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jconly === undefined) {\r\n\t\t\t\t\t\tself.$jconly = attrcom(self, 'keypress-only') === 'true' || com.config.$keypress === true || com.config.$binding === 2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\t\r\n\t\t\t\t\t} \r\n\t\t\t\t\tself.$jctimeout = setTimeout(keypressdelay, self.$jcdelay, self);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('focus blur', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function(e) {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (e.type === 'focusin')\r\n\t\t\t\t\t\tself.$jcevent = 1;\r\n\t\t\t\t\telse if (self.$jcevent === 1) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, 3);\r\n\t\t\t\t\t} else if (self.$jcskip) {\r\n\t\t\t\t\t\tself.$jcskip = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// formatter\r\n\t\t\t\t\t\tvar tmp = com.$skip;\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tcom.$skip = false;\r\n\t\t\t\t\t\tcom.setter(com.get(), com.path, 2);\r\n\t\t\t\t\t\tif (tmp) {\r\n\t\t\t\t\t\t\tcom.$skip = tmp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('change', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (self.$jconly || !com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === false) {\r\n\t\t\t\t\t\t// bind + validate\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.getter(self.value, false);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tswitch (self.tagName) {\r\n\t\t\t\t\t\tcase 'SELECT':\r\n\t\t\t\t\t\t\tvar sel = self[self.selectedIndex];\r\n\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\tcom.getter(sel.value, false);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\t\tif (self.type === 'checkbox' || self.type === 'radio') {\r\n\t\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\t\tcom.getter(self.checked, false);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, true);\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\r\n\t\t\t\t\t\tself.$jctimeout = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.setter && com.setterX(com.get(), self.path, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsetTimeout(compile, 2);\r\n\t\t\t\t$domready = true;\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tend : function() {\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\treturn View;\r\n});"]}