{"version":3,"sources":["views/View.js"],"names":["define","langx","domx","binding","componenter","eventer","compiler","helper","scoper","storing","keypressdelay","self","com","$com","$jctimeout","dirty","getter","value","Plugin","inherit","options","elmAttrNames","scope","bind","store","base","url","removed","released","compile","_construct","elm","this","add","element","COM","Scope","Array","i","length","ADD","$","document","body","append","format","setTimeout2","COMPILE","container","immediate","refresh","components","sort","a","b","$removed","path","al","bl","LCOMPARER","start","$el","ready","$ready","clearTimeout","load","on","$jckeypress","$jcevent","undefined","tmp","attrcom","config","$realtime","$binding","MD","keypress","$jcdelay","$delay","delay","$jconly","$keypress","setTimeout","e","type","$jcskip","$skip","setter","get","tagName","sel","selectedIndex","checked","setterX","$domready","end"],"mappings":"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","file":"../../views/View.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"../utils/domx\",\r\n\t\"./binding\",\r\n\t\"./componenter\",\r\n\t\"./eventer\",\r\n\t\"./compiler\",\r\n\t\"./helper\",\r\n\t\"./scoper\",\r\n\t\"./storing\",\r\n],function(langx, domx, binding, componenter, eventer,compiler, helper,scoper,storing){\r\n\r\n\tvar $rebinder;\r\n\r\n\tfunction rebindbinder() {\r\n\t\t$rebinder && clearTimeout($rebinder);\r\n\t\t$rebinder = setTimeout(function() {\r\n\t\t\tvar arr = bindersnew.splice(0);\r\n\t\t\tfor (var i = 0; i < arr.length; i++) {\r\n\t\t\t\tvar item = arr[i];\r\n\t\t\t\tif (!item.init) {\r\n\t\t\t\t\tif (item.com) {\r\n\t\t\t\t\t\titem.exec(item.com.data(item.path), item.path);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.exec(getx(item.path), item.path);  // GET\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 50);\r\n\t}\r\n\r\n\tfunction keypressdelay(self) {\r\n\t\tvar com = self.$com;\r\n\t\t// Reset timeout\r\n\t\tself.$jctimeout = 0;\r\n\t\t// It's not dirty\r\n\t\tcom.dirty(false, true);\r\n\t\t// Binds a value\r\n\t\tcom.getter(self.value, true);\r\n\t}\r\n\r\n\r\n\t// data-scope    \r\n\t// data-compile \r\n\t// data-released \r\n\t// data-vendor\r\n\t// data-store\r\n\t// data-com\r\n\t// data-bind\r\n\tvar View = domx.Plugin.inherit({\r\n\t    options : {\r\n\t      elmAttrNames: {\r\n\t        scope   : \"data-scope\",             // data-jc-scope\r\n\t        bind    : \"data-bind\",              // data-bind\r\n\t        store   : \"data-store\",\r\n\t      \tcom  : {\r\n\t\t        base     : \"data-com\",          // data-jc\r\n\t\t        url      : \"data-comp-url\",     // data-jc-url\r\n\t\t        removed  : \"data-com-removed\",  //data-jc-removed\r\n\t\t        released : \"data-com-released\", //data-jc-released\r\n\t      \t},\r\n\t        compile : \"data-compile\"            // data-jc-comile\r\n\t      }\r\n\t    },\r\n\r\n\t\t_construct : function(elm,options) {\r\n\r\n\t\t\tthis.eventer = eventer(this);\r\n\t\t\tthis.scoper = scoper(this);\r\n\t\t\tthis.storing = storing(this);\r\n\t\t\tthis.helper = helper(this);\r\n\t\t\tthis.componenter = componenter(this);\r\n\t\t\tthis.binding = binding(this);\r\n\t\t\tthis.compiler = compiler(this);\r\n\t\t},\r\n\r\n\t   /**\r\n\t   * Create new components dynamically.\r\n\t   * @param  {String|Array<String>} declaration \r\n\t   * @param  {jQuery Element/Component/Scope/Plugin} element optional,a parent element (default: \"document.body\")\r\n\t   */\r\n\t\tadd : function (value, element) { // W.ADD =\r\n\t\t\tif (element instanceof COM || element instanceof Scope || element instanceof Plugin) {\r\n\t\t\t\telement = element.element;\r\n\t\t\t}\r\n\t\t\tif (value instanceof Array) {\r\n\t\t\t\tfor (var i = 0; i < value.length; i++)\r\n\t\t\t\t\tADD(value[i], element);\r\n\t\t\t} else {\r\n\t\t\t\t$(element || document.body).append('<div data-jc=\"{0}\"></div>'.format(value));\r\n\t\t\t\tsetTimeout2('ADD', COMPILE, 10);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcompile : function (container,immediate) {\r\n\r\n\t\t},\r\n\r\n\t\trefresh : function () {\r\n\t\t\tsetTimeout2('$refresh', function() {\r\n\t\t\t\tcomponenter.components.sort(function(a, b) {  // M.components.sort\r\n\t\t\t\t\tif (a.$removed || !a.path)\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\tif (b.$removed || !b.path)\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\tvar al = a.path.length;\r\n\t\t\t\t\tvar bl = b.path.length;\r\n\t\t\t\t\treturn al > bl ? - 1 : al === bl ? LCOMPARER(a.path, b.path) : 1;\r\n\t\t\t\t});\r\n\t\t\t}, 200);\r\n\t\t},\r\n\r\n\t\tstart : function() {\r\n\t\t\tvar $el = $(this.elm);\r\n\t\t\t$(document).ready(function() {\r\n\r\n\t\t\t\tif ($ready) {\r\n\t\t\t\t\tclearTimeout($ready);\r\n\t\t\t\t\tload();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$el.on('input', 'input[data-jc-bind],textarea[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\t// realtime binding\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter || self.$jckeypress === false) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.$jcevent = 2;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === undefined) {\r\n\t\t\t\t\t\tvar tmp = attrcom(self, 'keypress');\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tself.$jckeypress = tmp === 'true';\r\n\t\t\t\t\t\telse if (com.config.$realtime != null)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$realtime === true;\r\n\t\t\t\t\t\telse if (com.config.$binding)\r\n\t\t\t\t\t\t\tself.$jckeypress = com.config.$binding === 1;\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tself.$jckeypress = MD.keypress;\r\n\t\t\t\t\t\tif (self.$jckeypress === false)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jcdelay === undefined) {\r\n\t\t\t\t\t\tself.$jcdelay = +(attrcom(self, 'keypress-delay') || com.config.$delay || MD.delay);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jconly === undefined) {\r\n\t\t\t\t\t\tself.$jconly = attrcom(self, 'keypress-only') === 'true' || com.config.$keypress === true || com.config.$binding === 2;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\t\r\n\t\t\t\t\t} \r\n\t\t\t\t\tself.$jctimeout = setTimeout(keypressdelay, self.$jcdelay, self);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('focus blur', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function(e) {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (!com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (e.type === 'focusin')\r\n\t\t\t\t\t\tself.$jcevent = 1;\r\n\t\t\t\t\telse if (self.$jcevent === 1) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, 3);\r\n\t\t\t\t\t} else if (self.$jcskip) {\r\n\t\t\t\t\t\tself.$jcskip = false;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// formatter\r\n\t\t\t\t\t\tvar tmp = com.$skip;\r\n\t\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\t\tcom.$skip = false;\r\n\t\t\t\t\t\tcom.setter(com.get(), com.path, 2);\r\n\t\t\t\t\t\tif (tmp) {\r\n\t\t\t\t\t\t\tcom.$skip = tmp;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$el.on('change', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function() {\r\n\r\n\t\t\t\t\tvar self = this;\r\n\t\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\t\tif (self.$jconly || !com || com.$removed || !com.getter)\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\tif (self.$jckeypress === false) {\r\n\t\t\t\t\t\t// bind + validate\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.getter(self.value, false);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tswitch (self.tagName) {\r\n\t\t\t\t\t\tcase 'SELECT':\r\n\t\t\t\t\t\t\tvar sel = self[self.selectedIndex];\r\n\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\tcom.getter(sel.value, false);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\t\tif (self.type === 'checkbox' || self.type === 'radio') {\r\n\t\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\t\tcom.getter(self.checked, false);\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(self.value, true);\r\n\t\t\t\t\t\tclearTimeout(self.$jctimeout);\r\n\t\t\t\t\t\tself.$jctimeout = 0;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\t\tcom.setter && com.setterX(com.get(), self.path, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsetTimeout(compile, 2);\r\n\t\t\t\t$domready = true;\r\n\t\t\t});\r\n\r\n\t\t},\r\n\r\n\t\tend : function() {\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\treturn View;\r\n});"]}