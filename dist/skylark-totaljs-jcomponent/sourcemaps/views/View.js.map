{"version":3,"sources":["views/View.js"],"names":["define","langx","domx","binding","componenter","eventer","compiler","helper","scoper","storing","keypressdelay","self","com","$com","$jctimeout","dirty","getter","value","Plugin","inherit","options","elmAttrNames","scope","bind","store","base","url","removed","released","compile","_construct","elm","prototype","apply","this","arguments","add","element","COM","Scope","Array","i","length","ADD","$","document","body","append","format","setTimeout2","COMPILE","container","immediate","refresh","components","sort","a","b","$removed","path","al","bl","localCompare","start","$el","_elm","on","$jckeypress","$jcevent","undefined","tmp","attrcom","config","$realtime","$binding","MD","keypress","$jcdelay","$delay","delay","$jconly","$keypress","clearTimeout","setTimeout","e","type","$jcskip","$skip","setter","get","tagName","sel","selectedIndex","checked","setterX","end"],"mappings":"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","file":"../../views/View.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"../utils/domx\",\r\n\t\"./binding\",\r\n\t\"./componenter\",\r\n\t\"./eventer\",\r\n\t\"./compiler\",\r\n\t\"./helper\",\r\n\t\"./scoper\",\r\n\t\"./storing\",\r\n],function(langx, domx, binding, componenter, eventer,compiler, helper,scoper,storing){\r\n\r\n\tfunction keypressdelay(self) {\r\n\t\tvar com = self.$com;\r\n\t\t// Reset timeout\r\n\t\tself.$jctimeout = 0;\r\n\t\t// It's not dirty\r\n\t\tcom.dirty(false, true);\r\n\t\t// Binds a value\r\n\t\tcom.getter(self.value, true);\r\n\t}\r\n\r\n\r\n\t// data-scope    \r\n\t// data-compile \r\n\t// data-released \r\n\t// data-vendor\r\n\t// data-store\r\n\t// data-com\r\n\t// data-bind\r\n\tvar View = domx.Plugin.inherit({\r\n\t    options : {\r\n\t      elmAttrNames: {\r\n\t        scope   : \"data-scope\",             // data-jc-scope\r\n\t        bind    : \"data-bind\",              // data-bind\r\n\t        store   : \"data-store\",\r\n\t      \tcom  : {\r\n\t\t        base     : \"data-com\",          // data-jc\r\n\t\t        url      : \"data-comp-url\",     // data-jc-url\r\n\t\t        removed  : \"data-com-removed\",  //data-jc-removed\r\n\t\t        released : \"data-com-released\", //data-jc-released\r\n\t      \t},\r\n\t        compile : \"data-compile\"            // data-jc-comile\r\n\t      }\r\n\t    },\r\n\r\n\t\t_construct : function(elm,options) {\r\n\t\t\tdomx.Plugin.prototype._construct.apply(this,arguments);\r\n\r\n\t\t\tthis.eventer = eventer(this);\r\n\t\t\tthis.scoper = scoper(this);\r\n\t\t\tthis.storing = storing(this);\r\n\t\t\tthis.helper = helper(this);\r\n\t\t\tthis.componenter = componenter(this);\r\n\t\t\tthis.binding = binding(this);\r\n\t\t\tthis.compiler = compiler(this);\r\n\t\t},\r\n\r\n\t   /**\r\n\t   * Create new components dynamically.\r\n\t   * @param  {String|Array<String>} declaration \r\n\t   * @param  {jQuery Element/Component/Scope/Plugin} element optional,a parent element (default: \"document.body\")\r\n\t   */\r\n\t\tadd : function (value, element) { // W.ADD =\r\n\t\t\tif (element instanceof COM || element instanceof Scope || element instanceof Plugin) {\r\n\t\t\t\telement = element.element;\r\n\t\t\t}\r\n\t\t\tif (value instanceof Array) {\r\n\t\t\t\tfor (var i = 0; i < value.length; i++)\r\n\t\t\t\t\tADD(value[i], element);\r\n\t\t\t} else {\r\n\t\t\t\t$(element || document.body).append('<div data-jc=\"{0}\"></div>'.format(value));\r\n\t\t\t\tsetTimeout2('ADD', COMPILE, 10);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcompile : function (container,immediate) {\r\n\r\n\t\t},\r\n\r\n\t\trefresh : function () {\r\n\t\t\tsetTimeout2('$refresh', function() {\r\n\t\t\t\tcomponenter.components.sort(function(a, b) {  // M.components.sort\r\n\t\t\t\t\tif (a.$removed || !a.path)\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\tif (b.$removed || !b.path)\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\tvar al = a.path.length;\r\n\t\t\t\t\tvar bl = b.path.length;\r\n\t\t\t\t\treturn al > bl ? - 1 : al === bl ? langx.localCompare(a.path, b.path) : 1;\r\n\t\t\t\t});\r\n\t\t\t}, 200);\r\n\t\t},\r\n\r\n\t\tstart : function() {\r\n\t\t\tvar $el = $(this._elm);\r\n\r\n\t\t\t//if ($ready) {\r\n\t\t\t//\tclearTimeout($ready);\r\n\t\t\t//\tload();\r\n\t\t\t//}\r\n\r\n\t\t\t$el.on('input', 'input[data-jc-bind],textarea[data-jc-bind]', function() {\r\n\r\n\t\t\t\t// realtime binding\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\tif (!com || com.$removed || !com.getter || self.$jckeypress === false) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.$jcevent = 2;\r\n\r\n\t\t\t\tif (self.$jckeypress === undefined) {\r\n\t\t\t\t\tvar tmp = attrcom(self, 'keypress');\r\n\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\tself.$jckeypress = tmp === 'true';\r\n\t\t\t\t\telse if (com.config.$realtime != null)\r\n\t\t\t\t\t\tself.$jckeypress = com.config.$realtime === true;\r\n\t\t\t\t\telse if (com.config.$binding)\r\n\t\t\t\t\t\tself.$jckeypress = com.config.$binding === 1;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tself.$jckeypress = MD.keypress;\r\n\t\t\t\t\tif (self.$jckeypress === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.$jcdelay === undefined) {\r\n\t\t\t\t\tself.$jcdelay = +(attrcom(self, 'keypress-delay') || com.config.$delay || MD.delay);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.$jconly === undefined) {\r\n\t\t\t\t\tself.$jconly = attrcom(self, 'keypress-only') === 'true' || com.config.$keypress === true || com.config.$binding === 2;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\tclearTimeout(self.$jctimeout);\t\r\n\t\t\t\t} \r\n\t\t\t\tself.$jctimeout = setTimeout(keypressdelay, self.$jcdelay, self);\r\n\t\t\t});\r\n\r\n\t\t\t$el.on('focus blur', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function(e) {\r\n\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\tif (!com || com.$removed || !com.getter)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (e.type === 'focusin')\r\n\t\t\t\t\tself.$jcevent = 1;\r\n\t\t\t\telse if (self.$jcevent === 1) {\r\n\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\tcom.getter(self.value, 3);\r\n\t\t\t\t} else if (self.$jcskip) {\r\n\t\t\t\t\tself.$jcskip = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// formatter\r\n\t\t\t\t\tvar tmp = com.$skip;\r\n\t\t\t\t\tif (tmp)\r\n\t\t\t\t\t\tcom.$skip = false;\r\n\t\t\t\t\tcom.setter(com.get(), com.path, 2);\r\n\t\t\t\t\tif (tmp) {\r\n\t\t\t\t\t\tcom.$skip = tmp;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$el.on('change', 'input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]', function() {\r\n\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar com = self.$com;\r\n\r\n\t\t\t\tif (self.$jconly || !com || com.$removed || !com.getter)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (self.$jckeypress === false) {\r\n\t\t\t\t\t// bind + validate\r\n\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\tcom.getter(self.value, false);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (self.tagName) {\r\n\t\t\t\t\tcase 'SELECT':\r\n\t\t\t\t\t\tvar sel = self[self.selectedIndex];\r\n\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\tcom.getter(sel.value, false);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tcase 'INPUT':\r\n\t\t\t\t\t\tif (self.type === 'checkbox' || self.type === 'radio') {\r\n\t\t\t\t\t\t\tself.$jcevent = 2;\r\n\t\t\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\t\t\tcom.getter(self.checked, false);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (self.$jctimeout) {\r\n\t\t\t\t\tcom.dirty(false, true);\r\n\t\t\t\t\tcom.getter(self.value, true);\r\n\t\t\t\t\tclearTimeout(self.$jctimeout);\r\n\t\t\t\t\tself.$jctimeout = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tself.$jcskip = true;\r\n\t\t\t\t\tcom.setter && com.setterX(com.get(), self.path, 2);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t//setTimeout(compile, 2);\r\n\r\n\t\t},\r\n\r\n\t\tend : function() {\r\n\r\n\t\t}\r\n\r\n\t});\r\n\r\n\treturn View;\r\n});"]}