{"version":3,"sources":["storages.js"],"names":["define","jc","defaults","langx","caches","M","MD","storage","$localstorage","cachestorage","key","value","expire","now","Date","undefined","set","isString","parseExpire","save","item","get","isPRIVATEMODE","localstorage","localStorage","setItem","JSON","stringify","storages","put","remove","isSearching","m","indexOf","this","clearCache","rem","removeItem","k"],"mappings":";;;;;;;AAAAA,QACC,OACA,aACA,UACA,YACC,SAASC,EAAGC,EAASC,EAAMC,GAC5B,IAAIC,EAAIJ,EACPK,EAAKJ,EAEFK,KAEAC,EAAgB,KAGpB,SAASC,EAAaC,EAAKC,EAAOC,GAEjC,IAAIC,EAAMC,KAAKD,MAEf,QAAcE,IAAVJ,EAEH,MAAe,YAAXC,GACHR,EAAOY,IAAI,WAAaN,EAAKC,GACtBA,IAGJR,EAAMc,SAASL,KAClBA,EAASA,EAAOM,eAGjBX,EAAQG,IAASE,OAAQC,EAAMD,EAAQD,MAAOA,GAC9CQ,IACOR,GAGR,IAAIS,EAAOhB,EAAOiB,IAAI,WAAaX,GACnC,OAAIU,KAIJA,EAAOb,EAAQG,KACHU,EAAKR,OAASC,EAClBO,EAAKT,WADb,GA2BD,SAASQ,KACJd,EAAEiB,eAAiBhB,EAAGiB,cACzBC,aAAaC,QAAQjB,EAAgB,SAAUkB,KAAKC,UAAUpB,IA2ChE,OAAON,EAAG2B,UACTP,IApED,SAAaX,GACZ,OAAOD,EAAaC,IAoEpBmB,IAjED,SAAanB,EAAKC,EAAOC,GACxB,OAAOH,EAAaC,EAAKC,EAAOC,IAiEhCkB,OA7DD,SAAgBpB,EAAKqB,GACpB,GAAIA,EACH,IAAK,IAAIC,KAAKzB,GACW,IAApByB,EAAEC,QAAQvB,WACNH,EAAQG,eAGVH,EAAQG,GAGhB,OADAS,IACOe,MAoDPC,WA3CD,WACC,IAAK9B,EAAEiB,cAAe,CACrB,IAAIc,EAAMZ,aAAaa,WACnBC,EAAI9B,EACR4B,EAAIE,GACJF,EAAIE,EAAI,UACRF,EAAIE,EAAI,YAET,OAAOJ,MAoCPf,KAAAA","file":"../storages.js","sourcesContent":["define([\r\n\t\"./jc\",\r\n\t\"./defaults\",\r\n\t\"./langx\",\r\n\t\"./caches\"\r\n],function(jc,defaults,langx,caches){\r\n\tvar M = jc,\r\n\t\tMD = defaults;\r\n\r\n\tvar storage = {};\r\n\r\n\tvar $localstorage = 'jc'; //M.$localstorage\r\n\r\n\r\n\tfunction cachestorage(key, value, expire) {\r\n\r\n\t\tvar now = Date.now();\r\n\r\n\t\tif (value !== undefined) {\r\n\r\n\t\t\tif (expire === 'session') {\r\n\t\t\t\tcaches.set('$session' + key, value);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tif (langx.isString(expire)) {\r\n\t\t\t\texpire = expire.parseExpire();\r\n\t\t\t}\r\n\r\n\t\t\tstorage[key] = { expire: now + expire, value: value };\r\n\t\t\tsave();\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tvar item = caches.get('$session' + key);\r\n\t\tif (item) {\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\titem = storage[key];\r\n\t\tif (item && item.expire > now) {\r\n\t\t\treturn item.value;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction get(key) {\r\n\t\treturn cachestorage(key);\r\n\t}\r\n\r\n\tfunction put(key, value, expire) { //W.CACHE = \r\n\t\treturn cachestorage(key, value, expire);\r\n\t}\r\n\r\n\r\n\tfunction remove(key, isSearching) { // W.REMOVECACHE = \r\n\t\tif (isSearching) {\r\n\t\t\tfor (var m in storage) {\r\n\t\t\t\tif (m.indexOf(key) !== -1)\r\n\t\t\t\t\tdelete storage[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete storage[key];\r\n\t\t}\r\n\t\tsave();\r\n\t\treturn this;\r\n\t};\r\n\r\n\tfunction save() {\r\n\t\tif(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\t\tlocalStorage.setItem($localstorage + '.cache', JSON.stringify(storage)); // M.$localstorage\r\n\t\t}\r\n\t}\r\n\r\n\tfunction clearCache() { // W.CLEARCACHE = \r\n\t\tif (!M.isPRIVATEMODE) { // !W.isPRIVATEMODE\r\n\t\t\tvar rem = localStorage.removeItem;\r\n\t\t\tvar k = $localstorage; //M.$localstorage;\r\n\t\t\trem(k); \r\n\t\t\trem(k + '.cache');\r\n\t\t\trem(k + '.blocked');\r\n\t\t}\r\n\t\treturn this;\r\n\t};\r\n\r\n\tfunction load() {\r\n\t\tclearTimeout($ready);\r\n\t\tif (MD.localstorage) {\r\n\t\t\tvar cache;\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.cache');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tstorage = langx.parse(cache); // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.blocked');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tblocked = langx.parse(cache);  // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\r\n\t\tif (storage) {\r\n\t\t\tvar obj = storage['$jcpath'];\r\n\t\t\tobj && Object.keys(obj.value).forEach(function(key) {\r\n\t\t\t\timmSetx(key, obj.value[key], true);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tM.loaded = true;\r\n\t}\r\n\r\n\treturn jc.storages = {\r\n\t\tget,\r\n\t\tput,\r\n\t\tremove,\r\n\t\tclearCache,\r\n\t\tsave\r\n\t};\r\n});"]}