{"version":3,"sources":["plugins.js"],"names":["define","$","jc","caches","topic","schedulers","registry","Plugin","name","fn","test","warn","$remove","t","this","element","current","document","body","id","a","owner","call","emit","prototype","self","destroy","Object","keys","events","forEach","e","evt","remove","length","watches","off","clearAll","plugins","find","register"],"mappings":";;;;;;;AAAAA,QACC,0BACA,OACA,WACA,UACA,gBACC,SAASC,EAAGC,EAAIC,EAAQC,EAAOC,GAChC,IAAIC,KAEJ,SAASC,EAAOC,EAAMC,GACjB,KAAOC,KAAKF,IACfG,KAAK,4CAEFL,EAASE,IACZF,EAASE,GAAMI,SAAQ,GAExB,IAAIC,EAAIC,KACRD,EAAEE,QAAUd,EAAEE,EAAOa,QAAQD,SAAWE,SAASC,MACjDL,EAAEM,GAAK,OAASX,EAChBK,EAAEL,KAAOA,EACTF,EAASE,GAAQK,EACjB,IAAIO,EAAIjB,EAAOa,QAAQK,MACvBlB,EAAOa,QAAQK,MAAQR,EAAEM,GACzBV,EAAGa,KAAKT,EAAGA,GACXV,EAAOa,QAAQK,MAAQD,EACvBhB,EAAMmB,KAAK,SAAUV,GAgDtB,OA7CAN,EAAOiB,UAAUZ,QAAU,WAE1B,IAAIa,EAAOX,KACX,OAAKW,EAAKV,UAIVX,EAAMmB,KAAK,iBAAkBE,GACzBA,EAAKC,SACRD,EAAKC,UAINC,OAAOC,KAAKC,QAAQC,QAAQ,SAASC,GACpC,IAAIC,EAAMH,OAAOE,IACjBC,EAAMA,EAAIC,OAAO,QAASR,EAAKN,KACtBe,eACDL,OAAOE,KAIhBI,QAAUA,QAAQF,OAAO,QAASR,EAAKN,IAGvCf,EAAMgC,IAAIX,EAAKN,GAAK,UAIpBd,EAAWgC,SAASZ,EAAKN,IAGzBM,EAAKV,QAAU,YAERT,EAASmB,EAAKjB,OACd,IAWDN,EAAGoC,SACT/B,OAAAA,EACAgC,KAND,SAAc/B,GACb,OAAOF,EAASE,IAMhBF,SAAAA,EACAkC,SAZD,SAAkBhC,EAAMC,GACvB,OAAOA,EAAK,IAAIF,EAAOC,EAAMC,GAAMH,EAASE","file":"../plugins.js","sourcesContent":["define([\r\n\t\"skylark-utils-dom/query\",\r\n\t\"./jc\",\r\n\t\"./caches\",\r\n\t\"./topic\",\r\n\t\"./schedulers\"\r\n],function($, jc, caches, topic, schedulers){\r\n\tvar registry = {}; // W.PLUGINS\r\n\r\n\tfunction Plugin(name, fn) {\r\n\t\tif ((/\\W/).test(name)) {\r\n\t\t\twarn('Plugin name must contain A-Z chars only.');\r\n\t\t}\r\n\t\tif (registry[name]) {\r\n\t\t\tregistry[name].$remove(true);\r\n\t\t}\r\n\t\tvar t = this;\r\n\t\tt.element = $(caches.current.element || document.body);\r\n\t\tt.id = 'plug' + name;\r\n\t\tt.name = name;\r\n\t\tregistry[name] = t;\r\n\t\tvar a = caches.current.owner;\r\n\t\tcaches.current.owner = t.id;\r\n\t\tfn.call(t, t);\r\n\t\tcaches.current.owner = a;\r\n\t\ttopic.emit('plugin', t); // EMIT\r\n\t}\r\n\r\n\tPlugin.prototype.$remove = function() {\r\n\r\n\t\tvar self = this;\r\n\t\tif (!self.element) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\ttopic.emit('plugin.destroy', self); // EMIT\r\n\t\tif (self.destroy) {\r\n\t\t\tself.destroy();\r\n\t\t}\r\n\r\n\t\t// Remove all global events\r\n\t\tObject.keys(events).forEach(function(e) {\r\n\t\t\tvar evt = events[e];\r\n\t\t\tevt = evt.remove('owner', self.id);\r\n\t\t\tif (!evt.length) {\r\n\t\t\t\tdelete events[e];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twatches = watches.remove('owner', self.id);\r\n\r\n\t\t// Remove events\r\n\t\ttopic.off(self.id + '#watch'); // OFF\r\n\r\n\t\t// Remove schedulers\r\n\t\t//schedulers = schedulers.remove('owner', self.id);\r\n\t\tschedulers.clearAll(self.id);\r\n\r\n\t\t// self.element.remove();\r\n\t\tself.element = null;\r\n\r\n\t\tdelete registry[self.name];\r\n\t\treturn true;\r\n\t};\r\n\r\n\tfunction register(name, fn) { //W.PLUGIN = \r\n\t\treturn fn ? new Plugin(name, fn) : registry[name]; // W.PLUGINS\r\n\t};\r\n\r\n\tfunction find(name) {\r\n\t\treturn registry[name];\r\n\t}\r\n\t\r\n\treturn jc.plugins = {\r\n\t\tPlugin,\r\n\t\tfind,\r\n\t\tregistry,\r\n\t\tregister\r\n\t};\r\n});"]}