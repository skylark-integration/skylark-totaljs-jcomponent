{"version":3,"sources":["plugins/Plugin.js"],"names":["define","$","jc","caches","topic","schedulers","Plugin","name","fn","test","warn","registry","$remove","t","this","element","current","document","body","id","a","owner","call","emit","prototype","self","destroy","Object","keys","events","forEach","e","evt","remove","length","watches","off","clearAll"],"mappings":";;;;;;;AAAAA,QACC,0BACA,QACA,iBACA,WACA,gBACC,SAASC,EAAGC,EAAIC,EAAQC,EAAOC,GAChC,SAASC,EAAOC,EAAMC,GACjB,KAAOC,KAAKF,IACfG,KAAK,4CAEFC,SAASJ,IACZI,SAASJ,GAAMK,SAAQ,GAExB,IAAIC,EAAIC,KACRD,EAAEE,QAAUd,EAAEE,EAAOa,QAAQD,SAAWE,SAASC,MACjDL,EAAEM,GAAK,OAASZ,EAChBM,EAAEN,KAAOA,EACTI,SAASJ,GAAQM,EACjB,IAAIO,EAAIjB,EAAOa,QAAQK,MACvBlB,EAAOa,QAAQK,MAAQR,EAAEM,GACzBX,EAAGc,KAAKT,EAAGA,GACXV,EAAOa,QAAQK,MAAQD,EACvBhB,EAAMmB,KAAK,SAAUV,GAyCtB,OAtCAP,EAAOkB,UAAUZ,QAAU,WAE1B,IAAIa,EAAOX,KACX,OAAKW,EAAKV,UAIVX,EAAMmB,KAAK,iBAAkBE,GACzBA,EAAKC,SACRD,EAAKC,UAINC,OAAOC,KAAKC,QAAQC,QAAQ,SAASC,GACpC,IAAIC,EAAMH,OAAOE,IACjBC,EAAMA,EAAIC,OAAO,QAASR,EAAKN,KACtBe,eACDL,OAAOE,KAIhBI,QAAUA,QAAQF,OAAO,QAASR,EAAKN,IAGvCf,EAAMgC,IAAIX,EAAKN,GAAK,UAIpBd,EAAWgC,SAASZ,EAAKN,IAGzBM,EAAKV,QAAU,YAERJ,SAASc,EAAKlB,OACd,IAIDD","file":"../../plugins/Plugin.js","sourcesContent":["define([\r\n\t\"skylark-utils-dom/query\",\r\n\t\"../jc\",\r\n\t\"../utils/cache\",\r\n\t\"../topic\",\r\n\t\"./schedulers\"\r\n],function($, jc, caches, topic, schedulers){\r\n\tfunction Plugin(name, fn) {\r\n\t\tif ((/\\W/).test(name)) {\r\n\t\t\twarn('Plugin name must contain A-Z chars only.');\r\n\t\t}\r\n\t\tif (registry[name]) {\r\n\t\t\tregistry[name].$remove(true);\r\n\t\t}\r\n\t\tvar t = this;\r\n\t\tt.element = $(caches.current.element || document.body);\r\n\t\tt.id = 'plug' + name;\r\n\t\tt.name = name;\r\n\t\tregistry[name] = t;\r\n\t\tvar a = caches.current.owner;\r\n\t\tcaches.current.owner = t.id;\r\n\t\tfn.call(t, t);\r\n\t\tcaches.current.owner = a;\r\n\t\ttopic.emit('plugin', t); // EMIT\r\n\t}\r\n\r\n\tPlugin.prototype.$remove = function() {\r\n\r\n\t\tvar self = this;\r\n\t\tif (!self.element) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\ttopic.emit('plugin.destroy', self); // EMIT\r\n\t\tif (self.destroy) {\r\n\t\t\tself.destroy();\r\n\t\t}\r\n\r\n\t\t// Remove all global events\r\n\t\tObject.keys(events).forEach(function(e) {\r\n\t\t\tvar evt = events[e];\r\n\t\t\tevt = evt.remove('owner', self.id);\r\n\t\t\tif (!evt.length) {\r\n\t\t\t\tdelete events[e];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twatches = watches.remove('owner', self.id);\r\n\r\n\t\t// Remove events\r\n\t\ttopic.off(self.id + '#watch'); // OFF\r\n\r\n\t\t// Remove schedulers\r\n\t\t//schedulers = schedulers.remove('owner', self.id);\r\n\t\tschedulers.clearAll(self.id);\r\n\r\n\t\t// self.element.remove();\r\n\t\tself.element = null;\r\n\r\n\t\tdelete registry[self.name];\r\n\t\treturn true;\r\n\t};\r\n\r\n\r\n\treturn Plugin;\r\n});"]}