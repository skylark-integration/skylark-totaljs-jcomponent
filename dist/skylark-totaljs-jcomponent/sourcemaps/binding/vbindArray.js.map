{"version":3,"sources":["binding/vbindArray.js"],"names":["define","langx","domx","$","vbind","html","el","obj","items","element","$vbindarray","remove","i","length","checksum","serialize","val","Date","getTime","JSON","stringify","item","sum","binder","j","binders","b","p","path","track","$get","substring","hashCode","set","index","value","Array","$bchecksum","rem","splice","push","attrd","$vbind","append"],"mappings":";;;;;;;AAAAA,QACC,WACA,gBACA,iBACA,WACC,SAASC,EAAMC,EAAKC,EAAEC,GAmGvB,OAlGA,SAAoBC,EAAMC,GACzB,IAAIC,KACJA,EAAIF,KAAOA,EACXE,EAAIC,SAEJD,EAAIE,QAAUH,EAAGG,QAAUH,EAAGG,QAAUN,EAAEG,GAC1CC,EAAIE,QAAQ,GAAGC,YAAcH,EAC7BA,EAAII,OAAS,WACZ,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAAIC,MAAMK,OAAQD,IACrCL,EAAIC,MAAMI,GAAGD,SAEdJ,EAAIO,SAAW,KACfP,EAAIC,MAAQ,KACZD,EAAIF,KAAO,KACXE,EAAIE,QAAU,MAGf,IAAIM,EAAY,SAASC,GACxB,cAAc,GACb,IAAK,SACJ,OAAOA,EAAM,GACd,IAAK,UACJ,OAAOA,EAAM,IAAM,IACpB,IAAK,SACJ,OAAOA,EACR,QACC,OAAc,MAAPA,EAAc,GAAKA,aAAeC,KAAOD,EAAIE,UAAYC,KAAKC,UAAUJ,KAI9EF,EAAW,SAASO,GACvB,IAAIC,EAAM,EACNC,EAAShB,EAAIC,MAAM,GACvB,GAAIe,EACH,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAOE,QAAQZ,OAAQW,IAAK,CAC/C,IAAIE,EAAIH,EAAOE,QAAQD,GACnBG,EAAID,EAAEE,KACV,GAAIF,EAAEG,MACL,IAAK,IAAIjB,EAAI,EAAGA,EAAIc,EAAEG,MAAMhB,OAAQD,IACnCU,GAAOP,EAAUe,MAAMH,EAAKA,EAAI,IAAO,IAAMD,EAAEG,MAAMjB,GAAGmB,UAAU,GAAIV,SAEvEC,GAAOP,EAAUY,EAAIG,KAAKH,EAAGN,GAAQA,GAGxC,OAAOpB,EAAM+B,SAASV,IAmDvB,OAhDAf,EAAI0B,IAAM,SAASC,EAAOC,GAEzB,IAAIb,EAAM,KAEV,KAAMY,aAAiBE,OAUtB,OATIf,EAAOd,EAAIC,MAAM0B,MAEpBZ,EAAMR,EAASqB,IACX7B,EAAKe,EAAKZ,QAAQ,IACf4B,aAAef,IACrBhB,EAAG+B,WAAaf,EAChBD,EAAKY,IAAIE,KAGJ5B,EAKR,GAFA4B,EAAQD,EAEJ3B,EAAIC,MAAMK,OAASsB,EAAMtB,OAE5B,IADA,IAAIyB,EAAM/B,EAAIC,MAAM+B,OAAOJ,EAAMtB,QACxBD,EAAI,EAAGA,EAAI0B,EAAIzB,OAAQD,IAC/B0B,EAAI1B,GAAGD,SAGT,IAASC,EAAI,EAAGA,EAAIuB,EAAMtB,OAAQD,IAAK,CACtC,IACIS,EADAL,EAAMmB,EAAMvB,IACZS,EAAOd,EAAIC,MAAMI,MAGpBS,EAAOjB,EAAMG,EAAIF,MACjBE,EAAIC,MAAMgC,KAAKnB,GACfA,EAAKZ,QAAQgC,MAAM,QAAS7B,GAC5BS,EAAKZ,QAAQ,GAAGiC,OAASrB,EACzBA,EAAKa,MAAQtB,EACbL,EAAIE,QAAQkC,OAAOtB,EAAKZ,UAGzB,IAAIH,EAAKe,EAAKZ,QAAQ,GACtBa,EAAMR,EAASE,GAEXV,EAAG+B,aAAef,IACrBhB,EAAG+B,WAAaf,EAChBD,EAAKY,IAAIjB,MAKLT","file":"../../binding/vbindArray.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"../utils/domx\",\r\n\t\"../utils/query\",\r\n\t\"./vbind\"\r\n],function(langx,domx,$,vbind){\r\n\tfunction vbindArray(html, el) { //W.VBINDARRAY = \r\n\t\tvar obj = {};\r\n\t\tobj.html = html;\r\n\t\tobj.items = [];\r\n\t\t//obj.element = el instanceof Component ? el.element : $(el);\r\n\t\tobj.element = el.element ? el.element : $(el);\r\n\t\tobj.element[0].$vbindarray = obj;\r\n\t\tobj.remove = function() {\r\n\t\t\tfor (var i = 0; i < obj.items.length; i++) {\r\n\t\t\t\tobj.items[i].remove();\r\n\t\t\t}\r\n\t\t\tobj.checksum = null;\r\n\t\t\tobj.items = null;\r\n\t\t\tobj.html = null;\r\n\t\t\tobj.element = null;\r\n\t\t};\r\n\r\n\t\tvar serialize = function(val) {\r\n\t\t\tswitch (typeof(val)) {\r\n\t\t\t\tcase 'number':\r\n\t\t\t\t\treturn val + '';\r\n\t\t\t\tcase 'boolean':\r\n\t\t\t\t\treturn val ? '1' : '0';\r\n\t\t\t\tcase 'string':\r\n\t\t\t\t\treturn val;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn val == null ? '' : val instanceof Date ? val.getTime() : JSON.stringify(val);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar checksum = function(item) {\r\n\t\t\tvar sum = 0;\r\n\t\t\tvar binder = obj.items[0];\r\n\t\t\tif (binder) {\r\n\t\t\t\tfor (var j = 0; j < binder.binders.length; j++) {\r\n\t\t\t\t\tvar b = binder.binders[j];\r\n\t\t\t\t\tvar p = b.path;\r\n\t\t\t\t\tif (b.track) {\r\n\t\t\t\t\t\tfor (var i = 0; i < b.track.length; i++)\r\n\t\t\t\t\t\t\tsum += serialize($get((p ? (p + '.') : '') + b.track[i].substring(1), item));\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tsum += serialize(p ? $get(p, item) : item);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn langx.hashCode(sum); // HASH\r\n\t\t};\r\n\r\n\t\tobj.set = function(index, value) {\r\n\r\n\t\t\tvar sum = null;\r\n\r\n\t\t\tif (!(index instanceof Array)) {\r\n\t\t\t\tvar item = obj.items[index];\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tsum = checksum(value);\r\n\t\t\t\t\tvar el = item.element[0];\r\n\t\t\t\t\tif (el.$bchecksum !== sum) {\r\n\t\t\t\t\t\tel.$bchecksum = sum;\r\n\t\t\t\t\t\titem.set(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t}\r\n\r\n\t\t\tvalue = index;\r\n\r\n\t\t\tif (obj.items.length > value.length) {\r\n\t\t\t\tvar rem = obj.items.splice(value.length);\r\n\t\t\t\tfor (var i = 0; i < rem.length; i++)\r\n\t\t\t\t\trem[i].remove();\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0; i < value.length; i++) {\r\n\t\t\t\tvar val = value[i];\r\n\t\t\t\tvar item = obj.items[i];\r\n\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\titem = vbind(obj.html); //VBIND\r\n\t\t\t\t\tobj.items.push(item);\r\n\t\t\t\t\titem.element.attrd('index', i);\r\n\t\t\t\t\titem.element[0].$vbind = item;\r\n\t\t\t\t\titem.index = i;\r\n\t\t\t\t\tobj.element.append(item.element);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar el = item.element[0];\r\n\t\t\t\tsum = checksum(val);\r\n\r\n\t\t\t\tif (el.$bchecksum !== sum) {\r\n\t\t\t\t\tel.$bchecksum = sum;\r\n\t\t\t\t\titem.set(val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\treturn obj;\r\n\t};\r\n\r\n\treturn vbindArray;\r\n});\r\n"]}