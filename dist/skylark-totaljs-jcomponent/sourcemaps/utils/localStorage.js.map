{"version":3,"sources":["utils/localStorage.js"],"names":["define","jc","defaults","langx","caches","$localstorage","get","key","value","localStorage","getItem","isString","parse","set","setItem","JSON","stringify","this"],"mappings":";;;;;;;AAAAA,QACC,OACA,aACA,UACA,kBACC,SAASC,EAAGC,EAASC,EAAMC,GAC5B,IAKIC,EAAgB,MAmHpB,OACCC,IAdD,SAAaC,GACZ,IAAIC,EAAQC,aAAaC,QAAQL,EAAgBE,GAIjD,OAHIC,GAASL,EAAMQ,SAASH,KAC3BA,EAAQL,EAAMS,MAAMJ,IAEdA,GAUPK,IAPD,SAAaN,EAAIC,GAEhB,OADAC,aAAaK,QAAQT,EAAgBE,EAAKQ,KAAKC,UAAUR,IAClDS","file":"../../utils/localStorage.js","sourcesContent":["define([\r\n\t\"./jc\",\r\n\t\"./defaults\",\r\n\t\"./langx\",\r\n\t\"./utils/caches\"\r\n],function(jc,defaults,langx,caches){\r\n\tvar M = jc,\r\n\t\tMD = defaults;\r\n\r\n\tvar storage = {};\r\n\r\n\tvar $localstorage = 'jc.'; //M.$localstorage\r\n\r\n\r\n\tfunction cachestorage(key, value, expire) {\r\n\r\n\t\tvar now = Date.now();\r\n\r\n\t\tif (value !== undefined) {\r\n\r\n\t\t\tif (expire === 'session') {\r\n\t\t\t\tcaches.set('$session' + key, value);\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tif (langx.isString(expire)) {\r\n\t\t\t\texpire = expire.parseExpire();\r\n\t\t\t}\r\n\r\n\t\t\tstorage[key] = { expire: now + expire, value: value };\r\n\t\t\tsave();\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\tvar item = caches.get('$session' + key);\r\n\t\tif (item) {\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\titem = storage[key];\r\n\t\tif (item && item.expire > now) {\r\n\t\t\treturn item.value;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction get(key) {\r\n\t\treturn cachestorage(key);\r\n\t}\r\n\r\n\tfunction put(key, value, expire) { //W.CACHE = \r\n\t\treturn cachestorage(key, value, expire);\r\n\t}\r\n\r\n\r\n\tfunction remove(key, isSearching) { // W.REMOVECACHE = \r\n\t\tif (isSearching) {\r\n\t\t\tfor (var m in storage) {\r\n\t\t\t\tif (m.indexOf(key) !== -1)\r\n\t\t\t\t\tdelete storage[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete storage[key];\r\n\t\t}\r\n\t\tsave();\r\n\t\treturn this;\r\n\t};\r\n\r\n\tfunction save() {\r\n\t\tif(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\t\tlocalStorage.setItem($localstorage + '.cache', JSON.stringify(storage)); // M.$localstorage\r\n\t\t}\r\n\t}\r\n\r\n\tfunction clearCache() { // W.CLEARCACHE = \r\n\t\tif (!M.isPRIVATEMODE) { // !W.isPRIVATEMODE\r\n\t\t\tvar rem = localStorage.removeItem;\r\n\t\t\tvar k = $localstorage; //M.$localstorage;\r\n\t\t\trem(k); \r\n\t\t\trem(k + '.cache');\r\n\t\t\trem(k + '.blocked');\r\n\t\t}\r\n\t\treturn this;\r\n\t};\r\n\r\n\tfunction load() {\r\n\t\tclearTimeout($ready);\r\n\t\tif (MD.localstorage) {\r\n\t\t\tvar cache;\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.cache');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tstorage = langx.parse(cache); // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.blocked');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tblocked = langx.parse(cache);  // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\r\n\t\tif (storage) {\r\n\t\t\tvar obj = storage['$jcpath'];\r\n\t\t\tobj && Object.keys(obj.value).forEach(function(key) {\r\n\t\t\t\timmSetx(key, obj.value[key], true);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tM.loaded = true;\r\n\t}\r\n\r\n\r\n\tfunction get(key) {\r\n\t\tvar value = localStorage.getItem($localstorage + key);\r\n\t\tif (value && langx.isString(value)) {\r\n\t\t\tvalue = langx.parse(value); // PARSE\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tfunction set(key,value) {\r\n\t\tlocalStorage.setItem($localstorage + key, JSON.stringify(value)); // M.$localstorage\r\n\t\treturn this;\r\n\t}\r\n\r\n\treturn  {\r\n\t\t\"get\" : get,\r\n\t\t\"set\" : set\r\n\t};\r\n});"]}