{"version":3,"sources":["utils/storage.js"],"names":["define","langx","localStorage","localData","save","setItem","storage","key","value","expire","undefined","set","get","checkStorage","session","item","now","this","isString","parseExpire","Date","remove","isSearching","m","indexOf","clean","clear","rem","removeItem","k","$localstorage","getSessionData","setSessionData","clearSessionData","arguments","length","keys","page","i","a","j","substring","getStorageData","setStorageData","clearStorageData","load","cache","clearTimeout","$ready","MD","localstorage","getItem","M","parse","e","obj","Object","forEach","immSetx","loaded"],"mappings":"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","file":"../../utils/storage.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"./localStorage\"\r\n],function(langx, localStorage){\r\n\t//var M = jc,\r\n\t//\tMD = defaults;\r\n\r\n\tvar\tsessionData = {} ,\r\n\t\tlocalData= {};\r\n\r\n\tfunction save() {\r\n\t\t//if(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\tlocalStorage.setItem('cache', localData); // M.$localstorage\r\n\t\t//}\r\n\t}\r\n\r\n\r\n\tfunction storage(key, value, expire) { //cachestorage //W.CACHE =  \r\n\r\n\t\tif (value !== undefined) {\r\n\t\t\treturn storage.set(key,value,expire)\r\n\t\t} else {\r\n\t\t\treturn storage.get(key);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction save() {\r\n\t\t//if(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\t//\tlocalStorage.setItem($localstorage + '.cache', JSON.stringify(storage)); // M.$localstorage\r\n\t\t//}\r\n\t\tlocalStorage.set('cache', localData);\r\n\t}\r\n\r\n\tstorage.get = function (key,expire) {\r\n\t\tvar checkSession = !expire || expire == \"session\",\r\n\t\t\tcheckStorage = !expire  || expire != \"session\",\r\n\t\t\tvalue;\r\n\r\n\t\tif (checkSession) {\r\n\t\t\tvalue = session[key];\r\n\t\t}\r\n\r\n\t\tif (value === undefined && checkStorage) {\r\n\t\t\tvar item = localData[key];\r\n\t\t\tif (item && item.expire > langx.now()) {\r\n\t\t\t\tvalue = item.value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t};\r\n\r\n\tstorage.set = function (key, value, expire) { \r\n\t\tif (!expire || expire === 'session') {\r\n\t\t\tsession[key] = value;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (langx.isString(expire)) {\r\n\t\t\texpire = expire.parseExpire();\r\n\t\t}\r\n\r\n\t\tvar now = Date.now();\r\n\r\n\t\tlocalData[key] = { \r\n\t\t\texpire: now + expire, \r\n\t\t\tvalue: value \r\n\t\t};\r\n\r\n\t\tsave();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tstorage.remove = function (key, isSearching) { // W.REMOVECACHE = \r\n\t\tif (isSearching) {\r\n\t\t\tfor (var m in localData) {\r\n\t\t\t\tif (m.indexOf(key) !== -1)\r\n\t\t\t\t\tdelete localData[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete localData[key];\r\n\t\t}\r\n\t\tsave();\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tstorage.clean = function () { \r\n\t\tfor (var key in localData) {\r\n\t\t\tvar item = localData[key];\r\n\t\t\tif (!item.expire || item.expire <= now) {\r\n\t\t\t\tdelete localData[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsave();\t\t\r\n\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tstorage.clear = function () { // W.CLEARCACHE = \r\n\t\t//if (!M.isPRIVATEMODE) { // !W.isPRIVATEMODE\r\n\t\t\tvar rem = localStorage.removeItem;\r\n\t\t\tvar k = $localstorage; //M.$localstorage;\r\n\t\t\trem(k); \r\n\t\t\trem(k + '.cache');\r\n\t\t\trem(k + '.blocked');\r\n\t\t//}\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tstorage.getSessionData = function(key) {\r\n\t\treturn session[key];\r\n\t};\r\n\r\n\tstorage.setSessionData = function(key,value) {\r\n\t\tsession[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tstorage.clearSessionData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tsession = {};\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar keys = langx.keys(page);\r\n\r\n\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tvar remove = false;\r\n\t\t\tvar a = arguments;\r\n\r\n\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tremove = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (remove) {\r\n\t\t\t\tdelete session[key];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tstorage.getStorageData = function(key) {\r\n\t\treturn session[key];\r\n\t};\r\n\r\n\tstorage.setStorageData = function(key,value) {\r\n\t\tsession[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tstorage.clearStorageData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tsession = {};\r\n\t\t} else {\r\n\t\t\tvar keys = langx.keys(page);\r\n\r\n\t\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\t\tvar key = keys[i];\r\n\t\t\t\tvar remove = false;\r\n\t\t\t\tvar a = arguments;\r\n\r\n\t\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tremove = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (remove) {\r\n\t\t\t\t\tdelete session[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsave();\r\n\r\n\t};\r\n\r\n\tstorage.load = function () {\r\n\t\tclearTimeout($ready);\r\n\t\tif (MD.localstorage) {\r\n\t\t\tvar cache;\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.cache');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tlocalData = langx.parse(cache); // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\r\n\t\t}\r\n\r\n\t\tif (localData) {\r\n\t\t\tvar obj = localData['$jcpath'];\r\n\t\t\tobj && Object.keys(obj.value).forEach(function(key) {\r\n\t\t\t\timmSetx(key, obj.value[key], true);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tM.loaded = true;\r\n\t}\r\n\r\n\r\n\tfunction clean() {\r\n\r\n\t}\r\n\r\n\treturn storage;\r\n});"]}