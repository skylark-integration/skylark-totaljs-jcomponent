{"version":3,"sources":["utils/http.js"],"names":["define","jc","langx","topic","cache","remap","path","value","index","replace","indexOf","substring","trim","immSetx","ajaxconfig","defaults","parseHeaders","val","h","split","forEach","line","toLowerCase","cacherest","method","url","params","expire","version","M","$version","language","$language","stringify","key","hashCode","toString","set","makeurl","make","builder","en","encodeURIComponent","push","length","join","importCache","target","callback","insert","preparator","w","first","$env","text","once","isFunction","TYPE_FN","wf","wo","GET","location","protocol","lastIndexOf","ext","statics","wait","W","setPath","element","index2","d","document","scr","createElement","type","async","onload","setTimeout","compile","src","getElementsByTagName","appendChild","emit","$","this","stl","rel","href","jQuery","id","HASH","cb","response","code","output","is","REGCOM","test","importscripts","importstyles","html","append","C","ajaxCache","ajax","data","timeout","pathname","tmp","td","arg","EMPTYARRAY","TYPE_S","undefined","repeat","toUpperCase","isCredentials","headers","match","Function","TYPE_O","qs","param","options","converters","jsonconverter","contentType","STRINGIFY","extend","crossDomain","xhrFields","withCredentials","ROOT","custom","i","opt","cancel","process","error","upload","success","r","s","req","status","getAllResponseHeaders","call","responseText","ct","PARSE","jsondate","e","ajaxerrors","AJAX","apply","delayrepeat","clear","review","tdata","uri","err","diff","pingdata","baseurl","text json","X-Requested-With","http","ajaxCacheReview","configure","name","fn","import2","Array","next","makeParams","values","query","l","search","parseQuery","keys","Object","ping","execute","navigator","onLine","x-ping","x-cookies","cookieEnabled","x-referrer","referrer","setInterval","arr","obj","sub","decodeURIComponent","progress","isNumber","TYPE_N","xhr","XMLHttpRequest","addEventListener","statusText","env","onprogress","evt","percentage","lengthComputable","Math","round","loaded","total","isString","transferSpeed","timeRemaining","open","setRequestHeader","send","uptodate","period","condition","dt","Date","add","on","now","window","reload"],"mappings":"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","file":"../../utils/http.js","sourcesContent":["define([\r\n\t\"../jc\",\r\n\t\"../langx\",\r\n\t\"../topic\",\r\n\t\"./cache\"\r\n],function(jc,langx,topic,cache){\r\n\tfunction remap(path, value) {\r\n\r\n\t\tvar index = path.replace('-->', '->').indexOf('->');\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\tvalue = value[path.substring(0, index).trim()];\r\n\t\t\tpath = path.substring(index + 3).trim();\r\n\t\t}\r\n\r\n\t\timmSetx(path, value);\r\n\t}\r\n\r\n\tvar ajaxconfig = {};\r\n\tvar defaults = {\r\n\r\n\t};\r\n\tdefaults.ajaxerrors = false;\r\n\tdefaults.pingdata = {};\r\n\tdefaults.baseurl = ''; // String or Function\r\n\tdefaults.makeurl = null; // Function\r\n\tdefaults.delayrepeat = 2000;\r\n\tdefaults.jsondate = true;\r\n\tdefaults.jsonconverter = {\r\n\t\t'text json': function(text) {\r\n\t\t\treturn PARSE(text);\r\n\t\t}\r\n\t};\r\n\tdefaults.headers = { 'X-Requested-With': 'XMLHttpRequest' };\r\n\r\n\tfunction parseHeaders(val) {\r\n\t\tvar h = {};\r\n\t\tval.split('\\n').forEach(function(line) {\r\n\t\t\tvar index = line.indexOf(':');\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\th[line.substring(0, index).toLowerCase()] = line.substring(index + 1).trim();\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn h;\r\n\t}\r\n\r\n\tfunction cacherest(method, url, params, value, expire) {\r\n\r\n\t\tif (params && !params.version && M.$version)\r\n\t\t\tparams.version = M.$version;\r\n\r\n\t\tif (params && !params.language && M.$language)\r\n\t\t\tparams.language = M.$language;\r\n\r\n\t\tparams = langx.stringify(params);\r\n\t\tvar key = langx.hashCode(method + '#' + url.replace(/\\//g, '') + params).toString();\r\n\t\treturn cache.set(key, value, expire);\r\n\t}\r\n\t\r\n\tfunction makeurl(url, make) {\r\n\r\n\t\tdefaults.makeurl && (url = defaults.makeurl(url));\r\n\r\n\t\tif (make)\r\n\t\t\treturn url;\r\n\r\n\t\tvar builder = [];\r\n\t\tvar en = encodeURIComponent;\r\n\r\n\t\tM.$version && builder.push('version=' + en(M.$version));\r\n\t\tM.$language && builder.push('language=' + en(M.$language));\r\n\r\n\t\tif (!builder.length)\r\n\t\t\treturn url;\r\n\r\n\t\tvar index = url.indexOf('?');\r\n\t\tif (index == -1)\r\n\t\t\turl += '?';\r\n\t\telse\r\n\t\t\turl += '&';\r\n\r\n\t\treturn url + builder.join('&');\r\n\t}\r\n\r\n\tfunction makeParams(url, values, type) { //W.MAKEPARAMS = \r\n\r\n\t\tvar l = location;\r\n\r\n\t\tif (typeof(url) === TYPE_O) {\r\n\t\t\ttype = values;\r\n\t\t\tvalues = url;\r\n\t\t\turl = l.pathname + l.search;\r\n\t\t}\r\n\r\n\t\tvar query;\r\n\t\tvar index = url.indexOf('?');\r\n\t\tif (index !== -1) {\r\n\t\t\tquery = M.parseQuery(url.substring(index + 1));\r\n\t\t\turl = url.substring(0, index);\r\n\t\t} else\r\n\t\t\tquery = {};\r\n\r\n\t\tvar keys = Object.keys(values);\r\n\r\n\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tquery[key] = values[key];\r\n\t\t}\r\n\r\n\t\tvar val = $.param(query, type == null || type === true);\r\n\t\treturn url + (val ? '?' + val : '');\r\n\t}\r\n\r\n\tfunction upload(url, data, callback, timeout, progress) { //W.UPLOAD = \r\n\r\n\t\tif (!langx.isNumber(timeout) && progress == null) {\r\n\t\t\tprogress = timeout;\r\n\t\t\ttimeout = null;\r\n\t\t}\r\n\r\n\t\tif (!url)\r\n\t\t\turl = location.pathname;\r\n\r\n\t\tvar method = 'POST';\r\n\t\tvar index = url.indexOf(' ');\r\n\t\tvar tmp = null;\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\tmethod = url.substring(0, index).toUpperCase();\r\n\t\t}\r\n\r\n\t\tvar isCredentials = method.substring(0, 1) === '!';\r\n\t\tif (isCredentials) {\r\n\t\t\tmethod = method.substring(1);\r\n\t\t}\r\n\r\n\t\tvar headers = {};\r\n\t\ttmp = url.match(/\\{.*?\\}/g);\r\n\r\n\t\tif (tmp) {\r\n\t\t\turl = url.replace(tmp, '').replace(/\\s{2,}/g, ' ');\r\n\t\t\ttmp = (new Function('return ' + tmp))();\r\n\t\t\tif (typeof(tmp) === TYPE_O)\r\n\t\t\t\theaders = tmp;\r\n\t\t}\r\n\r\n\t\turl = url.substring(index).trim().$env();\r\n\r\n\t\tif (typeof(callback) === TYPE_N) {\r\n\t\t\ttimeout = callback;\r\n\t\t\tcallback = undefined;\r\n\t\t}\r\n\r\n\t\tvar output = {};\r\n\t\toutput.url = url;\r\n\t\toutput.process = true;\r\n\t\toutput.error = false;\r\n\t\toutput.upload = true;\r\n\t\toutput.method = method;\r\n\t\toutput.data = data;\r\n\r\n\t\ttopic.emit('request', output);\r\n\r\n\t\tif (output.cancel)\r\n\t\t\treturn;\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\tvar xhr = new XMLHttpRequest();\r\n\r\n\t\t\tif (isCredentials) {\r\n\t\t\t\txhr.withCredentials = true;\r\n\t\t\t}\r\n\r\n\t\t\txhr.addEventListener('load', function() {\r\n\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tvar r = self.responseText;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tr = PARSE(r, defaults.jsondate);\r\n\t\t\t\t} catch (e) {}\r\n\r\n\t\t\t\tif (progress) {\r\n\t\t\t\t\tif (typeof(progress) === TYPE_S) {\r\n\t\t\t\t\t\tremap(progress, 100);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tprogress(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutput.response = r;\r\n\t\t\t\toutput.status = self.status;\r\n\t\t\t\toutput.text = self.statusText;\r\n\t\t\t\toutput.error = self.status > 399;\r\n\t\t\t\toutput.headers = parseHeaders(self.getAllResponseHeaders());\r\n\r\n\t\t\t\ttopic.emit('response', output);\r\n\r\n\t\t\t\tif (!output.process || output.cancel)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (!r && output.error)\r\n\t\t\t\t\tr = output.response = self.status + ': ' + self.statusText;\r\n\r\n\t\t\t\tif (!output.error || defaults.ajaxerrors) {\r\n\t\t\t\t\ttypeof(callback) === TYPE_S ? remap(callback.env(), r) : (callback && callback(r, null, output));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttopic.emit('error', output);\r\n\t\t\t\t\toutput.process && typeof(callback) === TYPE_FN && callback({}, r, output);\r\n\t\t\t\t}\r\n\r\n\t\t\t}, false);\r\n\r\n\t\t\txhr.upload.onprogress = function(evt) {\r\n\t\t\t\tif (!progress) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar percentage = 0;\r\n\t\t\t\tif (evt.lengthComputable) {\r\n\t\t\t\t\tpercentage = Math.round(evt.loaded * 100 / evt.total);\r\n\t\t\t\t}\r\n\t\t\t\tif (langx.isString(progress)) {\r\n\t\t\t\t\tremap(progress.env(), percentage);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprogress(percentage, evt.transferSpeed, evt.timeRemaining);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.open(method, makeurl(output.url));\r\n\r\n\t\t\tvar keys = Object.keys(defaults.headers);\r\n\t\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\t\txhr.setRequestHeader(keys[i].env(), defaults.headers[keys[i]].env());\r\n\t\t\t}\r\n\r\n\t\t\tif (headers) {\r\n\t\t\t\tvar keys = Object.keys(headers);\r\n\t\t\t\tfor (var i = 0; i < keys.length; i++) {\r\n\t\t\t\t\txhr.setRequestHeader(keys[i], headers[keys[i]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\txhr.send(data);\r\n\r\n\t\t}, timeout || 0);\r\n\r\n\t\treturn W;\r\n\t}\r\n\r\n\r\n\tfunction importCache(url, expire, target, callback, insert, preparator) { // W.IMPORTCACHE = \r\n\r\n\t\tvar w;\r\n\r\n\t\turl = url.$env().replace(/<.*?>/, function(text) {\r\n\t\t\tw = text.substring(1, text.length - 1).trim();\r\n\t\t\treturn '';\r\n\t\t}).trim();\r\n\r\n\t\t// unique\r\n\t\tvar first = url.substring(0, 1);\r\n\t\tvar once = url.substring(0, 5).toLowerCase() === 'once ';\r\n\r\n\t\tif (langx.isFunction(target)) {\r\n\r\n\t\t\tif (langx.isFunction(callback)) {\r\n\t\t\t\tpreparator = callback;\r\n\t\t\t\tinsert = true;\r\n\t\t\t} else if (typeof(insert) === TYPE_FN) {\r\n\t\t\t\tpreparator = insert;\r\n\t\t\t\tinsert = true;\r\n\t\t\t}\r\n\r\n\t\t\tcallback = target;\r\n\t\t\ttarget = 'body';\r\n\t\t} else if (langx.isFunction(insert)) {\r\n\t\t\tpreparator = insert;\r\n\t\t\tinsert = true;\r\n\t\t}\r\n\r\n\t\tif (w) {\r\n\r\n\t\t\tvar wf = w.substring(w.length - 2) === '()';\r\n\t\t\tif (wf) {\r\n\t\t\t\tw = w.substring(0, w.length - 2);\r\n\t\t\t}\r\n\r\n\t\t\tvar wo = GET(w);\r\n\t\t\tif (wf && langx.isFunction(wo)) {\r\n\t\t\t\tif (wo()) {\r\n\t\t\t\t\tcallback && callback(0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t} else if (wo) {\r\n\t\t\t\tcallback && callback(0);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (url.substring(0, 2) === '//') {\r\n\t\t\turl = location.protocol + url;\r\n\t\t}\r\n\r\n\t\tvar index = url.lastIndexOf(' .');\r\n\t\tvar ext = '';\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\text = url.substring(index).trim().toLowerCase();\r\n\t\t\turl = url.substring(0, index).trim();\r\n\t\t}\r\n\r\n\t\tif (first === '!' || once) {\r\n\r\n\t\t\tif (once) {\r\n\t\t\t\turl = url.substring(5);\r\n\t\t\t} else {\r\n\t\t\t\turl = url.substring(1);\r\n\t\t\t}\r\n\r\n\t\t\tif (statics[url]) {\r\n\t\t\t\tif (callback) {\r\n\t\t\t\t\tif (statics[url] === 2)\r\n\t\t\t\t\t\tcallback(0);\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlangx.wait(function() {\r\n\t\t\t\t\t\t\treturn statics[url] === 2;\r\n\t\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\t\tcallback(0);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn W;\r\n\t\t\t}\r\n\r\n\t\t\tstatics[url] = 1;\r\n\t\t}\r\n\r\n\t\tif (target && target.setPath)\r\n\t\t\ttarget = target.element;\r\n\r\n\t\tif (!target) {\r\n\t\t\ttarget = 'body';\r\n\t\t}\r\n\r\n\t\tif (!ext) {\r\n\t\t\tindex = url.lastIndexOf('?');\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tvar index2 = url.lastIndexOf('.', index);\r\n\t\t\t\tif (index2 !== -1) {\r\n\t\t\t\t\text = url.substring(index2, index).toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tindex = url.lastIndexOf('.');\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\text = url.substring(index).toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar d = document;\r\n\t\tif (ext === '.js') {\r\n\t\t\tvar scr = d.createElement('script');\r\n\t\t\tscr.type = 'text/javascript';\r\n\t\t\tscr.async = false;\r\n\t\t\tscr.onload = function() {\r\n\t\t\t\tstatics[url] = 2;\r\n\t\t\t\tcallback && callback(1);\r\n\t\t\t\tsetTimeout(compile, 300);//W.jQuery && \r\n\t\t\t};\r\n\t\t\tscr.src = makeurl(url, true);\r\n\t\t\td.getElementsByTagName('head')[0].appendChild(scr);\r\n\t\t\ttopic.emit('import', url, $(scr));\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (ext === '.css') {\r\n\t\t\tvar stl = d.createElement('link');\r\n\t\t\tstl.type = 'text/css';\r\n\t\t\tstl.rel = 'stylesheet';\r\n\t\t\tstl.href = makeurl(url, true);\r\n\t\t\td.getElementsByTagName('head')[0].appendChild(stl);\r\n\t\t\tstatics[url] = 2;\r\n\t\t\tcallback && setTimeout(callback, 200, 1);\r\n\t\t\ttopic.emit('import', url, $(stl));\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tlangx.wait(function() {\r\n\t\t\treturn !!W.jQuery;\r\n\t\t}, function() {\r\n\r\n\t\t\tstatics[url] = 2;\r\n\t\t\tvar id = 'import' + HASH(url);\r\n\r\n\t\t\tvar cb = function(response, code, output) {\r\n\r\n\t\t\t\tif (!response) {\r\n\t\t\t\t\tcallback && callback(0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\turl = '$import' + url;\r\n\r\n\t\t\t\tif (preparator)\r\n\t\t\t\t\tresponse = preparator(response, output);\r\n\r\n\t\t\t\tvar is = REGCOM.test(response);\r\n\t\t\t\tresponse = importscripts(importstyles(response, id)).trim();\r\n\t\t\t\ttarget = $(target);\r\n\r\n\t\t\t\tif (response) {\r\n\t\t\t\t\t//caches.current.element = target[0];\r\n\t\t\t\t\tif (insert === false) {\r\n\t\t\t\t\t\ttarget.html(response);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttarget.append(response);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//caches.current.element = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t// is && compile(response ? target : null);\r\n\t\t\t\t\t// because of paths\r\n\t\t\t\t\tis && compile();\r\n\t\t\t\t\tcallback && langx.wait(function() {\r\n\t\t\t\t\t\treturn C.is == false;\r\n\t\t\t\t\t}, function() {\r\n\t\t\t\t\t\tcallback(1);\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttopic.emit('import', url, target);\r\n\t\t\t\t}, 10);\r\n\t\t\t};\r\n\r\n\t\t\tif (expire) {\r\n\t\t\t\tajaxCache('GET ' + url, null, cb, expire);\r\n\t\t\t}else {\r\n\t\t\t\tajax('GET ' + url, cb);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn W;\r\n\t}\r\n\r\n\tfunction import2(url, target, callback, insert, preparator) { //W.IMPORT = M.import = \r\n\t\tif (url instanceof Array) {\r\n\r\n\t\t\tif (langx.isFunction(target)) {\r\n\t\t\t\tpreparator = insert;\r\n\t\t\t\tinsert = callback;\r\n\t\t\t\tcallback = target;\r\n\t\t\t\ttarget = null;\r\n\t\t\t}\r\n\r\n\t\t\turl.wait(function(url, next) {\r\n\t\t\t\timportCache(url, null, target, next, insert, preparator);\r\n\t\t\t}, function() {\r\n\t\t\t\tcallback && callback();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\timportCache(url, null, target, callback, insert, preparator);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tfunction uptodate(period, url, callback, condition) { // W.UPTODATE = \r\n\r\n\t\tif (langx.isFunction(url)) {\r\n\t\t\tcondition = callback;\r\n\t\t\tcallback = url;\r\n\t\t\turl = '';\r\n\t\t}\r\n\r\n\t\tvar dt = new Date().add(period);\r\n\t\ttopic.on('knockknock', function() {\r\n\t\t\tif (dt > langx.now()) //W.NOW)\r\n\t\t\t\treturn;\r\n\t\t\tif (!condition || !condition())\r\n\t\t\t\treturn;\r\n\t\t\tvar id = setTimeout(function() {\r\n\t\t\t\tvar l = window.location;\r\n\t\t\t\tif (url)\r\n\t\t\t\t\tl.href = url.$env();\r\n\t\t\t\telse\r\n\t\t\t\t\tl.reload(true);\r\n\t\t\t}, 5000);\r\n\t\t\tcallback && callback(id);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction ping(url, timeout, execute) { // W.PING = \r\n\r\n\t\tif (navigator.onLine != null && !navigator.onLine)\r\n\t\t\treturn;\r\n\r\n\t\tif (typeof(timeout) === 'boolean') {\r\n\t\t\texecute = timeout;\r\n\t\t\ttimeout = 0;\r\n\t\t}\r\n\r\n\t\turl = url.$env();\r\n\r\n\t\tvar index = url.indexOf(' ');\r\n\t\tvar method = 'GET';\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\tmethod = url.substring(0, index).toUpperCase();\r\n\t\t\turl = url.substring(index).trim();\r\n\t\t}\r\n\r\n\t\tvar options = {};\r\n\t\tvar data = $.param(defaults.pingdata);\r\n\r\n\t\tif (data) {\r\n\t\t\tindex = url.lastIndexOf('?');\r\n\t\t\tif (index === -1)\r\n\t\t\t\turl += '?' + data;\r\n\t\t\telse\r\n\t\t\t\turl += '&' + data;\r\n\t\t}\r\n\r\n\t\toptions.type = method;\r\n\t\toptions.headers = { 'x-ping': location.pathname, 'x-cookies': navigator.cookieEnabled ? '1' : '0', 'x-referrer': document.referrer };\r\n\r\n\t\toptions.success = function(r) {\r\n\t\t\tif (r) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t(new Function(r))();\r\n\t\t\t\t} catch (e) {}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\texecute && $.ajax(makeurl(url), options);\r\n\r\n\t\treturn setInterval(function() {\r\n\t\t\t$.ajax(makeurl(url), options);\r\n\t\t}, timeout || 30000);\r\n\t}\r\n\r\n\tfunction parseQuery(value) { //M.parseQuery = W.READPARAMS = \r\n\r\n\t\tif (!value)\r\n\t\t\tvalue = location.search;\r\n\r\n\t\tif (!value)\r\n\t\t\treturn {};\r\n\r\n\t\tvar index = value.indexOf('?');\r\n\t\tif (index !== -1)\r\n\t\t\tvalue = value.substring(index + 1);\r\n\r\n\t\tvar arr = value.split('&');\r\n\t\tvar obj = {};\r\n\t\tfor (var i = 0, length = arr.length; i < length; i++) {\r\n\t\t\tvar sub = arr[i].split('=');\r\n\t\t\tvar key = sub[0];\r\n\t\t\tvar val = decodeURIComponent((sub[1] || '').replace(/\\+/g, '%20'));\r\n\r\n\t\t\tif (!obj[key]) {\r\n\t\t\t\tobj[key] = val;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!(obj[key] instanceof Array))\r\n\t\t\t\tobj[key] = [obj[key]];\r\n\t\t\tobj[key].push(val);\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tfunction configure(name, fn) {  // W.AJAXCONFIG = \r\n\t\tajaxconfig[name] = fn;  \r\n\t\treturn this;\r\n\t}\r\n\r\n\tfunction ajax(url, data, callback, timeout) { // W.AJAX = \r\n\r\n\t\tif (typeof(url) === TYPE_FN) {\r\n\t\t\ttimeout = callback;\r\n\t\t\tcallback = data;\r\n\t\t\tdata = url;\r\n\t\t\turl = location.pathname;\r\n\t\t}\r\n\r\n\t\tvar td = typeof(data);\r\n\t\tvar arg = EMPTYARRAY;\r\n\t\tvar tmp;\r\n\r\n\t\tif (!callback && (td === TYPE_FN || td === TYPE_S)) {\r\n\t\t\ttimeout = callback;\r\n\t\t\tcallback = data;\r\n\t\t\tdata = undefined;\r\n\t\t}\r\n\r\n\t\tvar index = url.indexOf(' ');\r\n\t\tif (index === -1)\r\n\t\t\treturn W;\r\n\r\n\t\tvar repeat = false;\r\n\r\n\t\turl = url.replace(/\\srepeat/i, function() {\r\n\t\t\trepeat = true;\r\n\t\t\treturn '';\r\n\t\t});\r\n\r\n\t\tif (repeat)\r\n\t\t\targ = [url, data, callback, timeout];\r\n\r\n\t\tvar method = url.substring(0, index).toUpperCase();\r\n\t\tvar isCredentials = method.substring(0, 1) === '!';\r\n\t\tif (isCredentials)\r\n\t\t\tmethod = method.substring(1);\r\n\r\n\t\tvar headers = {};\r\n\t\ttmp = url.match(/\\{.*?\\}/g);\r\n\r\n\t\tif (tmp) {\r\n\t\t\turl = url.replace(tmp, '').replace(/\\s{2,}/g, ' ');\r\n\t\t\ttmp = (new Function('return ' + tmp))();\r\n\t\t\tif (typeof(tmp) === TYPE_O)\r\n\t\t\t\theaders = tmp;\r\n\t\t}\r\n\r\n\t\turl = url.substring(index).trim().$env();\r\n\r\n\t\tsetTimeout(function() {\r\n\r\n\t\t\tif (method === 'GET' && data) {\r\n\t\t\t\tvar qs = (typeof(data) === TYPE_S ? data : jQuery.param(data, true));\r\n\t\t\t\tif (qs)\r\n\t\t\t\t\turl += '?' + qs;\r\n\t\t\t}\r\n\r\n\t\t\tvar options = {};\r\n\t\t\toptions.method = method;\r\n\t\t\toptions.converters = defaults.jsonconverter;\r\n\r\n\t\t\tif (method !== 'GET') {\r\n\t\t\t\tif (typeof(data) === TYPE_S) {\r\n\t\t\t\t\toptions.data = data;\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions.contentType = 'application/json; charset=utf-8';\r\n\t\t\t\t\toptions.data = STRINGIFY(data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\toptions.headers = $.extend(headers, defaults.headers);\r\n\r\n\t\t\tif (url.match(/http:\\/\\/|https:\\/\\//i)) {\r\n\t\t\t\toptions.crossDomain = true;\r\n\t\t\t\tdelete options.headers['X-Requested-With'];\r\n\t\t\t\tif (isCredentials)\r\n\t\t\t\t\toptions.xhrFields = { withCredentials: true };\r\n\t\t\t} else\r\n\t\t\t\turl = url.ROOT();\r\n\r\n\t\t\tvar custom = url.match(/\\([a-z0-9\\-.,]+\\)/i);\r\n\t\t\tif (custom) {\r\n\t\t\t\turl = url.replace(custom, '').replace(/\\s+/g, '');\r\n\t\t\t\toptions.url = url;\r\n\t\t\t\tcustom = custom.toString().replace(/\\(|\\)/g, '').split(',');\r\n\t\t\t\tfor (var i = 0; i < custom.length; i++) {\r\n\t\t\t\t\tvar opt = ajaxconfig[custom[i].trim()];\r\n\t\t\t\t\topt && opt(options);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.url)\r\n\t\t\t\toptions.url = url;\r\n\r\n\t\t\ttopic.emit('request', options);\r\n\r\n\t\t\tif (options.cancel)\r\n\t\t\t\treturn;\r\n\r\n\t\t\toptions.type = options.method;\r\n\t\t\tdelete options.method;\r\n\r\n\t\t\tvar output = {};\r\n\t\t\toutput.url = options.url;\r\n\t\t\toutput.process = true;\r\n\t\t\toutput.error = false;\r\n\t\t\toutput.upload = false;\r\n\t\t\toutput.method = method;\r\n\t\t\toutput.data = data;\r\n\r\n\t\t\tdelete options.url;\r\n\r\n\t\t\toptions.success = function(r, s, req) {\r\n\t\t\t\toutput.response = r;\r\n\t\t\t\toutput.status = req.status || 999;\r\n\t\t\t\toutput.text = s;\r\n\t\t\t\toutput.headers = parseHeaders(req.getAllResponseHeaders());\r\n\t\t\t\ttopic.emit('response', output);\r\n\t\t\t\tif (output.process && !output.cancel) {\r\n\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\tremap(callback, output.response);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcallback && callback.call(output, output.response, undefined, output);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\toptions.error = function(req, s) {\r\n\r\n\t\t\t\tvar code = req.status;\r\n\r\n\t\t\t\tif (repeat && (!code || code === 408 || code === 502 || code === 503 || code === 504 || code === 509)) {\r\n\t\t\t\t\t// internal error\r\n\t\t\t\t\t// internet doesn't work\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\targ[0] += ' REPEAT';\r\n\t\t\t\t\t\tW.AJAX.apply(M, arg);\r\n\t\t\t\t\t}, defaults.delayrepeat);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\toutput.response = req.responseText;\r\n\t\t\t\toutput.status = code || 999;\r\n\t\t\t\toutput.text = s;\r\n\t\t\t\toutput.error = true;\r\n\t\t\t\toutput.headers = parseHeaders(req.getAllResponseHeaders());\r\n\t\t\t\tvar ct = output.headers['content-type'];\r\n\r\n\t\t\t\tif (ct && ct.indexOf('/json') !== -1) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\toutput.response = PARSE(output.response, defaults.jsondate);\r\n\t\t\t\t\t} catch (e) {}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttopic.emit('response', output);\r\n\r\n\t\t\t\tif (output.cancel || !output.process)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tif (defaults.ajaxerrors) {\r\n\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\tremap(callback, output.response);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcallback && callback.call(output, output.response, output.status, output);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttopic.emit('error', output);\r\n\t\t\t\t\ttypeof(callback) === TYPE_FN && callback.call(output, output.response, output.status, output);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t$.ajax(makeurl(output.url), options);\r\n\r\n\t\t}, timeout || 0);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tfunction ajaxCacheReview(url, data, callback, expire, timeout, clear) { //W.AJAXCACHEREVIEW = \r\n\t\treturn ajaxCache(url, data, callback, expire, timeout, clear, true);\r\n\t}\r\n\r\n\tfunction ajaxCache(url, data, callback, expire, timeout, clear, review) { //W.AJAXCACHE = \r\n\r\n\t\tvar tdata = typeof(data);\r\n\r\n\t\tif (tdata === TYPE_FN || (tdata === TYPE_S && typeof(callback) === TYPE_S && typeof(expire) !== TYPE_S)) {\r\n\t\t\tclear = timeout;\r\n\t\t\ttimeout = expire;\r\n\t\t\texpire = callback;\r\n\t\t\tcallback = data;\r\n\t\t\tdata = null;\r\n\t\t}\r\n\r\n\t\tif (typeof(timeout) === 'boolean') {\r\n\t\t\tclear = timeout === true;\r\n\t\t\ttimeout = 0;\r\n\t\t}\r\n\r\n\t\tvar index = url.indexOf(' ');\r\n\t\tif (index === -1)\r\n\t\t\treturn W;\r\n\r\n\t\tvar method = url.substring(0, index).toUpperCase();\r\n\t\tvar uri = url.substring(index).trim().$env();\r\n\r\n\t\tsetTimeout(function() {\r\n\t\t\tvar value = clear ? undefined : cacherest(method, uri, data, undefined, expire);\r\n\t\t\tif (value !== undefined) {\r\n\r\n\t\t\t\tvar diff = review ? STRINGIFY(value) : null;\r\n\r\n\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\tremap(callback, value);\r\n\t\t\t\telse\r\n\t\t\t\t\tcallback(value, true);\r\n\r\n\t\t\t\tif (!review)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\tajax(url, data, function(r, err) {\r\n\t\t\t\t\tif (err)\r\n\t\t\t\t\t\tr = err;\r\n\t\t\t\t\t// Is same?\r\n\t\t\t\t\tif (diff !== STRINGIFY(r)) {\r\n\t\t\t\t\t\tcacherest(method, uri, data, r, expire);\r\n\t\t\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\t\t\tremap(callback, r);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tcallback(r, false, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tajax(url, data, function(r, err) {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\tr = err;\r\n\t\t\t\tcacherest(method, uri, data, r, expire);\r\n\t\t\t\tif (typeof(callback) === TYPE_S)\r\n\t\t\t\t\tremap(callback, r);\r\n\t\t\t\telse\r\n\t\t\t\t\tcallback(r, false);\r\n\t\t\t});\r\n\t\t}, timeout || 1);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\treturn jc.http = {\r\n\t\tdefaults,\r\n\t\tajax,\r\n\t\tajaxCache,\r\n\t\tajaxCacheReview,\r\n\t\tconfigure,\r\n\t\timport2,\r\n\t\timportCache,\r\n\t\tmakeParams,\r\n\t\tping,\r\n\t\tparseQuery,\r\n\t\tupload,\r\n\t\tuptodate\r\n\t};\r\n\r\n});"]}