{"version":3,"sources":["utils/cache.js"],"names":["define","langx","localStorage","page","session","storage","save","setItem","cache","key","value","expire","undefined","set","get","checkStorage","item","now","this","isString","parseExpire","Date","remove","isSearching","m","indexOf","clean","clear","M","isPRIVATEMODE","rem","removeItem","k","$localstorage","getPageData","setPageData","clearPageData","arguments","length","keys","i","a","j","substring","getSessionData","setSessionData","clearSessionData","getStorageData","setStorageData","clearStorageData","load","clearTimeout","$ready","MD","localstorage","getItem","parse","e","obj","Object","forEach","immSetx","loaded"],"mappings":"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","file":"../../utils/cache.js","sourcesContent":["define([\r\n\t\"../langx\",\r\n\t\"./localStorage\"\r\n],function(langx, localStorage){\r\n\t//var M = jc,\r\n\t//\tMD = defaults;\r\n\r\n\tvar page = {},\r\n\t\tsession = {} ,\r\n\t\tstorage = {};\r\n\r\n\tfunction save() {\r\n\t\t//if(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\tlocalStorage.setItem('cache', storage); // M.$localstorage\r\n\t\t//}\r\n\t}\r\n\r\n\r\n\tfunction cache(key, value, expire) {  //W.CACHE = \r\n\r\n\t\tif (value !== undefined) {\r\n\t\t\treturn cache.set(key,value,expire)\r\n\t\t} else {\r\n\t\t\treturn cache.get(key);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction save() {\r\n\t\t//if(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\t//\tlocalStorage.setItem($localstorage + '.cache', JSON.stringify(storage)); // M.$localstorage\r\n\t\t//}\r\n\t\tlocalStorage.set('cache', storage);\r\n\t}\r\n\r\n\tcache.get = function (key,expire) {\r\n\t\tvar checkSession = !expire || expire == \"session\",\r\n\t\t\tcheckStorage = !expire  || expire != \"session\",\r\n\t\t\tvalue;\r\n\r\n\t\tif (checkSession) {\r\n\t\t\tvalue = session[key];\r\n\t\t}\r\n\r\n\t\tif (value === undefined && checkStorage) {\r\n\t\t\tvar item = storage[key];\r\n\t\t\tif (item && item.expire > langx.now()) {\r\n\t\t\t\tvalue = item.value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t};\r\n\r\n\tcache.set = function (key, value, expire) { \r\n\t\tif (!expire || expire === 'session') {\r\n\t\t\tsession[key] = value;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (langx.isString(expire)) {\r\n\t\t\texpire = expire.parseExpire();\r\n\t\t}\r\n\r\n\t\tvar now = Date.now();\r\n\r\n\t\tstorage[key] = { \r\n\t\t\texpire: now + expire, \r\n\t\t\tvalue: value \r\n\t\t};\r\n\r\n\t\tsave();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tcache.remove = function (key, isSearching) { // W.REMOVECACHE = \r\n\t\tif (isSearching) {\r\n\t\t\tfor (var m in storage) {\r\n\t\t\t\tif (m.indexOf(key) !== -1)\r\n\t\t\t\t\tdelete storage[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete storage[key];\r\n\t\t}\r\n\t\tsave();\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tcache.clean = function () { \r\n\t\tfor (var key in storage) {\r\n\t\t\tvar item = storage[key];\r\n\t\t\tif (!item.expire || item.expire <= now) {\r\n\t\t\t\tdelete storage[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsave();\t\t\r\n\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tcache.clear = function () { // W.CLEARCACHE = \r\n\t\tif (!M.isPRIVATEMODE) { // !W.isPRIVATEMODE\r\n\t\t\tvar rem = localStorage.removeItem;\r\n\t\t\tvar k = $localstorage; //M.$localstorage;\r\n\t\t\trem(k); \r\n\t\t\trem(k + '.cache');\r\n\t\t\trem(k + '.blocked');\r\n\t\t}\r\n\t\treturn this;\r\n\t};\r\n\r\n\tcache.getPageData = function(key) {\r\n\t\treturn page[key];\r\n\t};\r\n\r\n\tcache.setPageData = function(key,value) {\r\n\t\tpage[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tcache.clearPageData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tpage = {};\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar keys = langx.keys(page);\r\n\r\n\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tvar remove = false;\r\n\t\t\tvar a = arguments;\r\n\r\n\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tremove = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (remove) {\r\n\t\t\t\tdelete page[key];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tcache.getSessionData = function(key) {\r\n\t\treturn session[key];\r\n\t};\r\n\r\n\tcache.setSessionData = function(key,value) {\r\n\t\tsession[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tcache.clearSessionData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tsession = {};\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar keys = langx.keys(page);\r\n\r\n\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tvar remove = false;\r\n\t\t\tvar a = arguments;\r\n\r\n\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tremove = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (remove) {\r\n\t\t\t\tdelete session[key];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tcache.getStorageData = function(key) {\r\n\t\treturn session[key];\r\n\t};\r\n\r\n\tcache.setStorageData = function(key,value) {\r\n\t\tsession[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tcache.clearStorageData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tsession = {};\r\n\t\t} else {\r\n\t\t\tvar keys = langx.keys(page);\r\n\r\n\t\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\t\tvar key = keys[i];\r\n\t\t\t\tvar remove = false;\r\n\t\t\t\tvar a = arguments;\r\n\r\n\t\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tremove = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (remove) {\r\n\t\t\t\t\tdelete session[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsave();\r\n\r\n\t};\r\n\r\n\tcache.load = function () {\r\n\t\tclearTimeout($ready);\r\n\t\tif (MD.localstorage) {\r\n\t\t\tvar cache;\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.cache');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tstorage = langx.parse(cache); // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\r\n\t\t}\r\n\r\n\t\tif (storage) {\r\n\t\t\tvar obj = storage['$jcpath'];\r\n\t\t\tobj && Object.keys(obj.value).forEach(function(key) {\r\n\t\t\t\timmSetx(key, obj.value[key], true);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tM.loaded = true;\r\n\t}\r\n\r\n\r\n\tfunction clean() {\r\n\r\n\t}\r\n\r\n\treturn cache;\r\n});"]}