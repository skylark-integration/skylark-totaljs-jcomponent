{"version":3,"sources":["utils/cache.js"],"names":["define","defaults","langx","page","session","storage","cache","key","value","expire","save","localStorage","set","get","checkStorage","undefined","item","now","this","isString","parseExpire","Date","remove","isSearching","m","indexOf","clear","M","isPRIVATEMODE","rem","removeItem","k","$localstorage","getPageData","setPageData","clearPageData","arguments","length","keys","i","a","j","substring"],"mappings":";;;;;;;AAAAA,QACC,cACA,YACC,SAASC,EAASC,GAInB,IAAIC,KACHC,KACAC,KAGD,SAASC,EAAMC,EAAKC,EAAOC,IAQ3B,SAASC,IAIRC,aAAaC,IAAI,QAASP,GAoI3B,OAhIAC,EAAMO,IAAM,SAAUN,EAAIE,GACzB,IAECD,EADAM,GAAgBL,GAAqB,WAAVA,EAO5B,KARoBA,GAAoB,WAAVA,KAK7BD,EAAQJ,EAAQG,SAGHQ,IAAVP,GAAuBM,EAAc,CACxC,IAAIE,EAAOX,EAAQE,GACfS,GAAQA,EAAKP,OAASQ,MACzBT,EAAQQ,EAAKR,OAIf,OAAOA,GAGRF,EAAMM,IAAM,SAAUL,EAAKC,EAAOC,GACjC,IAAKA,GAAqB,YAAXA,EAEd,OADAL,EAAQG,GAAOC,EACRU,KAGJhB,EAAMiB,SAASV,KAClBA,EAASA,EAAOW,eAGjB,IAAIH,EAAMI,KAAKJ,MAQf,OANAZ,EAAQE,IACPE,OAAQQ,EAAMR,EACdD,MAAOA,GAGRE,IACOQ,MAIRZ,EAAMgB,OAAS,SAAUf,EAAKgB,GAC7B,GAAIA,EACH,IAAK,IAAIC,KAAKnB,GACW,IAApBmB,EAAEC,QAAQlB,WACNF,EAAQE,eAGVF,EAAQE,GAGhB,OADAG,IACOQ,MAIRZ,EAAMoB,MAAQ,WACb,IAAKC,EAAEC,cAAe,CACrB,IAAIC,EAAMlB,aAAamB,WACnBC,EAAIC,cACRH,EAAIE,GACJF,EAAIE,EAAI,UACRF,EAAIE,EAAI,YAET,OAAOb,MAIRZ,EAAM2B,YAAc,SAAS1B,GAC5B,OAAOJ,EAAKI,IAGbD,EAAM4B,YAAc,SAAS3B,EAAIC,GAEhC,OADAL,EAAKI,GAAOC,EACLU,MAGRZ,EAAM6B,cAAgB,WAErB,GAAKC,UAAUC,OAOf,IAFA,IAAIC,EAAOpC,EAAMoC,KAAKnC,GAEboC,EAAI,EAAGF,EAASC,EAAKD,OAAQE,EAAIF,EAAQE,IAAK,CAKtD,IAJA,IAAIhC,EAAM+B,EAAKC,GACXjB,GAAS,EACTkB,EAAIJ,UAECK,EAAI,EAAGA,EAAID,EAAEH,OAAQI,IAC7B,GAAIlC,EAAImC,UAAU,EAAGF,EAAEC,GAAGJ,UAAYG,EAAEC,GAAxC,CAGAnB,GAAS,EACT,MAGGA,UACInB,EAAKI,QApBbJ,MAiDKG","file":"../../utils/cache.js","sourcesContent":["define([\r\n\t\"../defaults\",\r\n\t\"../langx\"\r\n],function(defaults,langx){\r\n\t//var M = jc,\r\n\t//\tMD = defaults;\r\n\r\n\tvar page = {},\r\n\t\tsession = {} ,\r\n\t\tstorage = {};\r\n\r\n\r\n\tfunction cache(key, value, expire) {  //W.CACHE = \r\n\r\n\t\tif (value !== undefined) {\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction save() {\r\n\t\t//if(!M.isPRIVATEMODE && MD.localstorage){ // !W.isPRIVATEMODE && MD.localstorage\r\n\t\t//\tlocalStorage.setItem($localstorage + '.cache', JSON.stringify(storage)); // M.$localstorage\r\n\t\t//}\r\n\t\tlocalStorage.set('cache', storage);\r\n\t}\r\n\r\n\r\n\tcache.get = function (key,expire) {\r\n\t\tvar checkSession = !expire || expire == \"session\",\r\n\t\t\tcheckStorage = !expire  || expire != \"session\",\r\n\t\t\tvalue;\r\n\r\n\t\tif (checkSession) {\r\n\t\t\tvalue = session[key];\r\n\t\t}\r\n\r\n\t\tif (value === undefined && checkStorage) {\r\n\t\t\tvar item = storage[key];\r\n\t\t\tif (item && item.expire > now) {\r\n\t\t\t\tvalue = item.value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t};\r\n\r\n\tcache.set = function (key, value, expire) { \r\n\t\tif (!expire || expire === 'session') {\r\n\t\t\tsession[key] = value;\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tif (langx.isString(expire)) {\r\n\t\t\texpire = expire.parseExpire();\r\n\t\t}\r\n\r\n\t\tvar now = Date.now();\r\n\r\n\t\tstorage[key] = { \r\n\t\t\texpire: now + expire, \r\n\t\t\tvalue: value \r\n\t\t};\r\n\r\n\t\tsave();\r\n\t\treturn this;\r\n\r\n\t};\r\n\r\n\tcache.remove = function (key, isSearching) { // W.REMOVECACHE = \r\n\t\tif (isSearching) {\r\n\t\t\tfor (var m in storage) {\r\n\t\t\t\tif (m.indexOf(key) !== -1)\r\n\t\t\t\t\tdelete storage[key];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdelete storage[key];\r\n\t\t}\r\n\t\tsave();\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tcache.clear = function () { // W.CLEARCACHE = \r\n\t\tif (!M.isPRIVATEMODE) { // !W.isPRIVATEMODE\r\n\t\t\tvar rem = localStorage.removeItem;\r\n\t\t\tvar k = $localstorage; //M.$localstorage;\r\n\t\t\trem(k); \r\n\t\t\trem(k + '.cache');\r\n\t\t\trem(k + '.blocked');\r\n\t\t}\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\tcache.getPageData = function(key) {\r\n\t\treturn page[key];\r\n\t};\r\n\r\n\tcache.setPageData = function(key,value) {\r\n\t\tpage[key] = value;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tcache.clearPageData = function() {\r\n\r\n\t\tif (!arguments.length) {\r\n\t\t\tpage = {};\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar keys = langx.keys(page);\r\n\r\n\t\tfor (var i = 0, length = keys.length; i < length; i++) {\r\n\t\t\tvar key = keys[i];\r\n\t\t\tvar remove = false;\r\n\t\t\tvar a = arguments;\r\n\r\n\t\t\tfor (var j = 0; j < a.length; j++) {\r\n\t\t\t\tif (key.substring(0, a[j].length) !== a[j]) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tremove = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (remove) {\r\n\t\t\t\tdelete page[key];\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\r\n\tfunction load() {\r\n\t\tclearTimeout($ready);\r\n\t\tif (MD.localstorage) {\r\n\t\t\tvar cache;\r\n\t\t\ttry {\r\n\t\t\t\tcache = localStorage.getItem(M.$localstorage + '.cache');\r\n\t\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\t\tstorage = langx.parse(cache); // PARSE\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {}\r\n\r\n\t\t}\r\n\r\n\t\tif (storage) {\r\n\t\t\tvar obj = storage['$jcpath'];\r\n\t\t\tobj && Object.keys(obj.value).forEach(function(key) {\r\n\t\t\t\timmSetx(key, obj.value[key], true);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tM.loaded = true;\r\n\t}\r\n\r\n\treturn cache;\r\n});"]}