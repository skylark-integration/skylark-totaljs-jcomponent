{"version":3,"sources":["utils/blocks.js"],"names":["define","localStorage","blocked","blocking","name","timeout","callback","key","item","now","Date","langx","isString","env","parseExpire","local","MD","localstorage","M","isPRIVATEMODE","set","block","load","cache","getItem","$localstorage","parse","e"],"mappings":";;;;;;;AAAAA,QACC,kBACC,SAASC,GACV,IAAIC,KACHC,GASDD,QAAmB,SAAUE,EAAMC,EAASC,GAC3C,IAAIC,EAAMH,EACNI,EAAON,EAAQK,GACfE,EAAMC,KAAKD,MAEf,GAAID,EAAOC,EACV,OAAO,EAGJE,MAAMC,SAASP,KAClBA,EAAUA,EAAQQ,MAAMC,eAGzB,IAAIC,EAAQC,GAAGC,cAAgBZ,EAAU,IAOzC,OANAH,EAAQK,GAAOE,EAAMJ,GAChBa,EAAEC,eAAiBJ,GAEtBd,EAAamB,IAAI,UAAWlB,GAE9BI,GAAYA,KACL,IAkBR,OAfAe,MAAMC,KAAO,WAGZ,IAAIC,EACJ,KACCA,EAAQtB,EAAauB,QAAQN,EAAEO,cAAgB,cAClCd,MAAMC,SAASW,KAC3BrB,EAAUS,MAAMe,MAAMH,IAEtB,MAAOI,MAMHxB","file":"../../utils/blocks.js","sourcesContent":["define([\r\n\t\"./localStorage\"\r\n],function(localStorage){\r\n\tvar blocked = {},\r\n\t\tblocking = {};\r\n\r\n   /**\r\n   * Lock some code for a specific time. \r\n   * This method will paths info about blocking in localStorage if the expiration is longer than 10 seconds.\r\n   * @param  {String} name   \r\n   * @param  {Number} timeout \r\n   * @param  {Function} callback  \r\n   */\r\n\tblocking.blocked = function (name, timeout, callback) { //W.BLOCKED = \r\n\t\tvar key = name;\r\n\t\tvar item = blocked[key];\r\n\t\tvar now = Date.now();\r\n\r\n\t\tif (item > now) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tif (langx.isString(timeout)) {\r\n\t\t\ttimeout = timeout.env().parseExpire();\r\n\t\t}\r\n\r\n\t\tvar local = MD.localstorage && timeout > 10000;\r\n\t\tblocked[key] = now + timeout;\r\n\t\tif (!M.isPRIVATEMODE && local) { // W.isPRIVATEMODE\r\n\t\t  //localStorage.setItem(M.$localstorage + '.blocked', JSON.stringify(blocked));\r\n\t\t  localStorage.set('blocked', blocked);\r\n\t\t}\r\n\t\tcallback && callback();\r\n\t\treturn false;\r\n\t};\r\n\r\n\tblock.load = function() {\r\n\t\t//clearTimeout($ready);\r\n\t\t//if (MD.localstorage) {\r\n\t\tvar cache;\r\n\t\ttry {\r\n\t\t\tcache = localStorage.getItem(M.$localstorage + '.blocked');\r\n\t\t\tif (cache && langx.isString(cache)) {\r\n\t\t\t\tblocked = langx.parse(cache);  // PARSE\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t\t//}\r\n\r\n\t\t//M.loaded = true;  //TODO\r\n\t}\r\n\r\n\treturn blocking;\r\n\r\n});"]}