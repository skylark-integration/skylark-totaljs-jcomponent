{"version":3,"sources":["langx/ArrayEx.js"],"names":["define","slangx","regexp","AP","Array","prototype","next_wait","self","onItem","callback","thread","tmp","pending","wait","waitFor","this","init","isFunction","index","item","shift","undefined","cancel","call","setTimeout","i","limit","max","fn","current","length","push","async","context","arr","c","take","count","skip","takeskip","trim","empty","output","isString","findIndex","cb","value","isFN","isV","findAll","findItem","remove","last","def","quicksort","name","asc","type","field","isJSONDate","Date","sort","a","b","va","vb","LCOMPARER","getTime","at","bt","attr","arguments","toString","env","replace","scalar","key","isDate","isAvg","isDistinct","val","parseFloat","indexOf","Math","min","half","floor","isNumber"],"mappings":"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","file":"../../langx/ArrayEx.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"./regexp\"\r\n],function(slangx,regexp){\r\n\r\n\tvar AP = Array.prototype;\r\n\tAP.wait = AP.waitFor = function(onItem, callback, thread, tmp) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar init = false;\r\n\r\n\t\t// INIT\r\n\t\tif (!tmp) {\r\n\r\n\t\t\tif (!slangx.isFunction(callback)) {\r\n\t\t\t\tthread = callback;\r\n\t\t\t\tcallback = null;\r\n\t\t\t}\r\n\r\n\t\t\ttmp = {};\r\n\t\t\ttmp.pending = 0;\r\n\t\t\ttmp.index = 0;\r\n\t\t\ttmp.thread = thread;\r\n\r\n\t\t\t// thread === Boolean then array has to be removed item by item\r\n\t\t\tinit = true;\r\n\t\t}\r\n\r\n\t\tvar item = thread === true ? self.shift() : self[tmp.index++];\r\n\r\n\t\tif (item === undefined) {\r\n\t\t\tif (!tmp.pending) {\r\n\t\t\t\tcallback && callback();\r\n\t\t\t\ttmp.cancel = true;\r\n\t\t\t}\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\ttmp.pending++;\r\n\t\tonItem.call(self, item, function() {\r\n\t\t\tsetTimeout(next_wait, 1, self, onItem, callback, thread, tmp);\r\n\t\t}, tmp.index);\r\n\r\n\t\tif (!init || tmp.thread === 1){\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\tfor (var i = 1; i < tmp.thread; i++) {\r\n\t\t\tself.wait(onItem, callback, 1, tmp);\r\n\t\t}\r\n\r\n\t\treturn self;\r\n\t};\r\n\r\n\tfunction next_wait(self, onItem, callback, thread, tmp) {\r\n\t\ttmp.pending--;\r\n\t\tself.wait(onItem, callback, thread, tmp);\r\n\t}\r\n\r\n\tAP.limit = function(max, fn, callback, index) {\r\n\r\n\t\tif (index === undefined)\r\n\t\t\tindex = 0;\r\n\r\n\t\tvar current = [];\r\n\t\tvar self = this;\r\n\t\tvar length = index + max;\r\n\r\n\t\tfor (var i = index; i < length; i++) {\r\n\t\t\tvar item = self[i];\r\n\r\n\t\t\tif (item !== undefined) {\r\n\t\t\t\tcurrent.push(item);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!current.length) {\r\n\t\t\t\tcallback && callback();\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\tfn(current, function() { callback && callback(); }, index, index + max);\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\tif (!current.length) {\r\n\t\t\tcallback && callback();\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\tfn(current, function() {\r\n\t\t\tif (length < self.length)\r\n\t\t\t\tself.limit(max, fn, callback, length);\r\n\t\t\telse\r\n\t\t\t\tcallback && callback();\r\n\t\t}, index, index + max);\r\n\r\n\t\treturn self;\r\n\t};\r\n\r\n\tAP.async = function(context, callback) {\r\n\r\n\t\tif (slangx.isFunction(context)) {\r\n\t\t\tvar tmp = callback;\r\n\t\t\tcallback = context;\r\n\t\t\tcontext = tmp;\r\n\t\t}\r\n\r\n\t\tif (!context) {\r\n\t\t\tcontext = {};\r\n\t\t}\r\n\r\n\t\tvar arr = this;\r\n\t\tvar index = 0;\r\n\r\n\t\tvar c = function() {\r\n\t\t\tvar fn = arr[index++];\r\n\t\t\tif (fn) {\r\n\t\t\t\tfn.call(context, c, index - 1);\r\n\t\t\t} else {\r\n\t\t\t\treturn callback && callback.call(context);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tc();\r\n\t\treturn this;\r\n\t};\r\n\r\n\tAP.take = function(count) {\r\n\t\tvar arr = [];\r\n\t\tvar self = this;\r\n\t\tvar length = self.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tarr.push(self[i]);\r\n\t\t\tif (arr.length >= count) {\r\n\t\t\t\treturn arr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t};\r\n\r\n\tAP.skip = function(count) {\r\n\t\tvar arr = [];\r\n\t\tvar self = this;\r\n\t\tvar length = self.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\ti >= count && arr.push(self[i]);\r\n\t\t}\r\n\t\treturn arr;\r\n\t};\r\n\r\n\tAP.takeskip = function(take, skip) {\r\n\t\tvar arr = [];\r\n\t\tvar self = this;\r\n\t\tvar length = self.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tif (i < skip)\r\n\t\t\t\tcontinue;\r\n\t\t\tif (arr.length >= take)\r\n\t\t\t\treturn arr;\r\n\t\t\tarr.push(self[i]);\r\n\t\t}\r\n\t\treturn arr;\r\n\t};\r\n\r\n\tAP.trim = function(empty) {\r\n\t\tvar self = this;\r\n\t\tvar output = [];\r\n\t\tfor (var i = 0, length = self.length; i < length; i++) {\r\n\t\t\tif (slangx.isString(self[i]))\r\n\t\t\t\tself[i] = self[i].trim();\r\n\t\t\tif (empty || self[i])\r\n\t\t\t\toutput.push(self[i]);\r\n\t\t}\r\n\t\treturn output;\r\n\t};\r\n\r\n\tAP.findIndex = function(cb, value) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar isFN = slangx.isFunction(cb);\r\n\t\tvar isV = value !== undefined;\r\n\r\n\t\tfor (var i = 0, length = self.length; i < length; i++) {\r\n\t\t\tif (isFN) {\r\n\t\t\t\tif (cb.call(self, self[i], i)) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t} else if (isV) {\r\n\t\t\t\tif (self[i][cb] === value) {\r\n\t\t\t\t\treturn i;\r\n\t\t\t\t}\r\n\t\t\t} else if (self[i] === cb) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n\r\n\tAP.findAll = function(cb, value) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar isFN = slangx.isFunction(cb);\r\n\t\tvar isV = value !== undefined;\r\n\t\tvar arr = [];\r\n\r\n\t\tfor (var i = 0, length = self.length; i < length; i++) {\r\n\t\t\tif (isFN) {\r\n\t\t\t\tcb.call(self, self[i], i) && arr.push(self[i]);\r\n\t\t\t} else if (isV) {\r\n\t\t\t\tself[i][cb] === value && arr.push(self[i]);\r\n\t\t\t} else {\r\n\t\t\t\tself[i] === cb && arr.push(self[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t};\r\n\r\n\tAP.findItem = function(cb, value) {\r\n\t\tvar index = this.findIndex(cb, value);\r\n\t\tif (index !== -1)\r\n\t\t\treturn this[index];\r\n\t};\r\n\r\n\r\n\tAP.remove = function(cb, value) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar arr = [];\r\n\t\tvar isFN = slangx.isFunction(cb);\r\n\t\tvar isV = value !== undefined;\r\n\r\n\t\tfor (var i = 0, length = self.length; i < length; i++) {\r\n\t\t\tif (isFN) {\r\n\t\t\t\t!cb.call(self, self[i], i) && arr.push(self[i]);\r\n\t\t\t} else if (isV) {\r\n\t\t\t\tself[i][cb] !== value && arr.push(self[i]);\r\n\t\t\t} else {\r\n\t\t\t\tself[i] !== cb && arr.push(self[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn arr;\r\n\t};\r\n\r\n\tAP.last = function(def) {\r\n\t\tvar item = this[this.length - 1];\r\n\t\treturn item === undefined ? def : item;\r\n\t};\r\n\r\n\tAP.quicksort = function(name, asc, type) {\r\n\r\n\t\tvar self = this;\r\n\t\tvar length = self.length;\r\n\t\tif (!length || length === 1) {\r\n\t\t\treturn self;\r\n\t\t}\r\n\r\n\t\tif (typeof(name) === 'boolean') {\r\n\t\t\tasc = name;\r\n\t\t\tname = undefined;\r\n\t\t}\r\n\r\n\t\tif (asc == null || asc === 'asc')\r\n\t\t\tasc = true;\r\n\t\telse if (asc === 'desc')\r\n\t\t\tasc = false;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase 'date':\r\n\t\t\t\ttype = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\ttype = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'number':\r\n\t\t\t\ttype = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'bool':\r\n\t\t\tcase 'boolean':\r\n\t\t\t\ttype = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\ttype = 0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (!type) {\r\n\t\t\tvar index = 0;\r\n\t\t\twhile (!type) {\r\n\t\t\t\tvar field = self[index++];\r\n\t\t\t\tif (field === undefined)\r\n\t\t\t\t\treturn self;\r\n\t\t\t\tif (name)\r\n\t\t\t\t\tfield = field[name];\r\n\t\t\t\tswitch (typeof(field)) {\r\n\t\t\t\t\tcase 'string':\r\n\t\t\t\t\t\ttype = field.isJSONDate() ? 4 : 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'number':\r\n\t\t\t\t\t\ttype = 2;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'boolean':\r\n\t\t\t\t\t\ttype = 3;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (field instanceof Date)\r\n\t\t\t\t\t\t\ttype = 4;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tself.sort(function(a, b) {\r\n\r\n\t\t\tvar va = name ? a[name] : a;\r\n\t\t\tvar vb = name ? b[name] : b;\r\n\r\n\t\t\tif (va == null)\r\n\t\t\t\treturn asc ? -1 : 1;\r\n\r\n\t\t\tif (vb == null)\r\n\t\t\t\treturn asc ? 1 : -1;\r\n\r\n\t\t\t// String\r\n\t\t\tif (type === 1) {\r\n\t\t\t\treturn va && vb ? (asc ? LCOMPARER(va, vb) : LCOMPARER(vb, va)) : 0;\r\n\t\t\t} else if (type === 2) {\r\n\t\t\t\treturn va > vb ? (asc ? 1 : -1) : va < vb ? (asc ? -1 : 1) : 0;\r\n\t\t\t} else if (type === 3) {\r\n\t\t\t\treturn va === true && vb === false ? (asc ? 1 : -1) : va === false && vb === true ? (asc ? -1 : 1) : 0;\r\n\t\t\t} else if (type === 4) {\r\n\t\t\t\tif (!va || !vb)\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\tif (!va.getTime) {\r\n\t\t\t\t\tva = new Date(va);\r\n\t\t\t\t}\r\n\t\t\t\tif (!vb.getTime) {\r\n\t\t\t\t\tvb = new Date(vb);\r\n\t\t\t\t}\r\n\t\t\t\tvar at = va.getTime();\r\n\t\t\t\tvar bt = vb.getTime();\r\n\t\t\t\treturn at > bt ? (asc ? 1 : -1) : at < bt ? (asc ? -1 : 1) : 0;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\r\n\t\treturn self;\r\n\t};\r\n\r\n\tAP.attr = function(name, value) {\r\n\r\n\t\tvar self = this;\r\n\r\n\t\tif (arguments.length === 2) {\r\n\t\t\tif (value == null)\r\n\t\t\t\treturn self;\r\n\t\t} else if (value === undefined)\r\n\t\t\tvalue = name.toString();\r\n\r\n\t\tself.push(name + '=\"' + value.toString().env().toString().replace(/[<>&\"]/g, function(c) {\r\n\t\t\tswitch (c) {\r\n\t\t\t\tcase '&': return '&amp;';\r\n\t\t\t\tcase '<': return '&lt;';\r\n\t\t\t\tcase '>': return '&gt;';\r\n\t\t\t\tcase '\"': return '&quot;';\r\n\t\t\t}\r\n\t\t\treturn c;\r\n\t\t}) + '\"');\r\n\r\n\t\treturn self;\r\n\t};\r\n\r\n\tAP.scalar = function(type, key, def) {\r\n\r\n\t\tvar output = def;\r\n\t\tvar isDate = false;\r\n\t\tvar isAvg = type === 'avg' || type === 'average';\r\n\t\tvar isDistinct = type === 'distinct';\r\n\t\tvar self = this;\r\n\r\n\t\tfor (var i = 0, length = self.length; i < length; i++) {\r\n\t\t\tvar val = key ? self[i][key] : self[i];\r\n\r\n\t\t\tif (slangx.isString(val))\r\n\t\t\t\tval = val.parseFloat();\r\n\r\n\t\t\tif (val instanceof Date) {\r\n\t\t\t\tisDate = true;\r\n\t\t\t\tval = val.getTime();\r\n\t\t\t}\r\n\r\n\t\t\tif (isDistinct) {\r\n\t\t\t\tif (!output)\r\n\t\t\t\t\toutput = [];\r\n\t\t\t\toutput.indexOf(val) === -1 && output.push(val);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (type === 'median') {\r\n\t\t\t\tif (!output)\r\n\t\t\t\t\toutput = [];\r\n\t\t\t\toutput.push(val);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (type === 'sum' || isAvg) {\r\n\t\t\t\tif (output)\r\n\t\t\t\t\toutput += val;\r\n\t\t\t\telse\r\n\t\t\t\t\toutput = val;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (type !== 'range') {\r\n\t\t\t\tif (!output)\r\n\t\t\t\t\toutput = val;\r\n\t\t\t} else {\r\n\t\t\t\tif (!output) {\r\n\t\t\t\t\toutput = new Array(2);\r\n\t\t\t\t\toutput[0] = val;\r\n\t\t\t\t\toutput[1] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'range':\r\n\t\t\t\t\toutput[0] = Math.min(output[0], val);\r\n\t\t\t\t\toutput[1] = Math.max(output[1], val);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'min':\r\n\t\t\t\t\toutput = Math.min(output, val);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'max':\r\n\t\t\t\t\toutput = Math.max(output, val);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isDistinct)\r\n\t\t\treturn output;\r\n\r\n\t\tif (isAvg) {\r\n\t\t\toutput = output / self.length;\r\n\t\t\treturn isDate ? new Date(output) : output;\r\n\t\t}\r\n\r\n\t\tif (type === 'median') {\r\n\t\t\tif (!output)\r\n\t\t\t\toutput = [0];\r\n\t\t\toutput.sort(function(a, b) {\r\n\t\t\t\treturn a - b;\r\n\t\t\t});\r\n\t\t\tvar half = Math.floor(output.length / 2);\r\n\t\t\toutput = output.length % 2 ? output[half] : (output[half - 1] + output[half]) / 2.0;\r\n\t\t}\r\n\r\n\t\tif (isDate) {\r\n\t\t\tif (slangx.isNumber(output))\r\n\t\t\t\treturn new Date(output);\r\n\t\t\toutput[0] = new Date(output[0]);\r\n\t\t\toutput[1] = new Date(output[1]);\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t};\r\n\r\n\t\r\n});"]}