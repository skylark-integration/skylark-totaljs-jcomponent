{"version":3,"sources":["others/schedulers.js"],"names":["define","langx","schedulers","schedulercounter","setInterval","length","now","i","item","type","dt","add","expire","arr","FIND","selector","j","a","usage","compare","name","callback","clear","id","remove","this","clearAll","ownerId","schedule","substring","split","toLowerCase","guid","push","owner","current_owner"],"mappings":";;;;;;;AAAAA,QACC,YACC,SAASC,GACV,IAAIC,KACAC,EAAmB,EA6DvB,OApDAA,EAAmB,EACnBC,YAAY,WAEX,GAAKF,EAAWG,OAAhB,CAGAF,IAIA,IADA,IAAIG,EAAML,EAAMK,KAAI,GACXC,EAAI,EAAGF,EAASH,EAAWG,OAAQE,EAAIF,EAAQE,IAAK,CAC5D,IAAIC,EAAON,EAAWK,GACtB,GAAkB,MAAdC,EAAKC,MACR,GAAIN,EAAmB,IAAO,EAC7B,cACK,GAAkB,MAAdK,EAAKC,MAGXN,EAAmB,KAAQ,EAC9B,SAKF,IAFA,IAAIO,EAAKJ,EAAIK,IAAIH,EAAKI,QAClBC,EAAMC,KAAKN,EAAKO,UAAU,GACrBC,EAAI,EAAGA,EAAIH,EAAIR,OAAQW,IAAK,CACpC,IAAIC,EAAIJ,EAAIG,GACZC,GAAKA,EAAEC,MAAMC,QAAQX,EAAKY,KAAMV,IAAOF,EAAKa,SAASJ,OAGrD,OAwBFK,MAPD,SAAeC,GAEd,OADArB,EAAaA,EAAWsB,OAAO,KAAMD,GAC9BE,MAMPC,SA5DD,SAAkBC,GAEjB,OADAzB,EAAWsB,OAAO,QAASG,GACpBF,MA2DPG,SAvBD,SAAkBb,EAAUK,EAAMR,EAAQS,GACV,MAA3BT,EAAOiB,UAAU,EAAG,KACvBjB,EAAS,IAAMA,GAChB,IACIH,EADMG,EAAOkB,MAAM,KACR,GAAGC,cAAcF,UAAU,EAAG,GACzCN,EAAKtB,EAAM+B,KAAK,IAMpB,OALA9B,EAAW+B,MACVV,GAAIA,EACJH,KAAMA,EACNR,OAAQA,EACRG,SAAUA,EAAUM,SAAUA,EAAUZ,KAAe,MAATA,GAAyB,MAATA,EAAe,IAAMA,EAAMyB,MAAOC,gBAC1FZ","file":"../../others/schedulers.js","sourcesContent":["define([\r\n\t\"../langx\"\r\n],function(langx){\r\n\tvar schedulers = [];\r\n\tvar schedulercounter = 0;\r\n\r\n\r\n\tfunction clearAll(ownerId) {\r\n\t\tschedulers.remove('owner', ownerId);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t// scheduler\r\n\tschedulercounter = 0;\r\n\tsetInterval(function() {\r\n\r\n\t\tif (!schedulers.length)\r\n\t\t\treturn;\r\n\r\n\t\tschedulercounter++;\r\n\t\t//var now = new Date();\r\n\t\t//W.DATETIME = W.NOW = now;\r\n\t\tvar now = langx.now(true);\r\n\t\tfor (var i = 0, length = schedulers.length; i < length; i++) {\r\n\t\t\tvar item = schedulers[i];\r\n\t\t\tif (item.type === 'm') {\r\n\t\t\t\tif (schedulercounter % 30 !== 0)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t} else if (item.type === 'h') {\r\n\t\t\t\t// 1800 seconds --> 30 minutes\r\n\t\t\t\t// 1800 / 2 (seconds) --> 900\r\n\t\t\t\tif (schedulercounter % 900 !== 0)\r\n\t\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar dt = now.add(item.expire);\r\n\t\t\tvar arr = FIND(item.selector, true);\r\n\t\t\tfor (var j = 0; j < arr.length; j++) {\r\n\t\t\t\tvar a = arr[j];\r\n\t\t\t\ta && a.usage.compare(item.name, dt) && item.callback(a);\r\n\t\t\t}\r\n\t\t}\r\n\t}, 3500);\r\n\r\n\r\n\tfunction schedule(selector, name, expire, callback) { //W.SCHEDULE = \r\n\t\tif (expire.substring(0, 1) !== '-')\r\n\t\t\texpire = '-' + expire;\r\n\t\tvar arr = expire.split(' ');\r\n\t\tvar type = arr[1].toLowerCase().substring(0, 1);\r\n\t\tvar id = langx.guid(10); //GUID\r\n\t\tschedulers.push({ \r\n\t\t\tid: id, \r\n\t\t\tname: name, \r\n\t\t\texpire: expire, \r\n\t\t\tselector: selector, callback: callback, type: type === 'y' || type === 'd' ? 'h' : type, owner: current_owner });\r\n\t\treturn id;\r\n\t};\r\n\r\n\tfunction clear(id) {  //W.CLEARSCHEDULE\r\n\t\tschedulers = schedulers.remove('id', id);\r\n\t\treturn this;\r\n\t};\r\n\r\n\r\n\treturn  {\r\n\t\tclear,\r\n\t\tclearAll,\r\n\t\tschedule\r\n\t}\r\n});"]}