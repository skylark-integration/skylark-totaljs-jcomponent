{"version":3,"sources":["topic.js"],"names":["define","jc","langx","caches","events","topic","on","name","path","fn","init","context","indexOf","MULTIPLE","arr","split","trim","i","length","this","push","substring","owner","index","TYPE_FN","replace","obj","current_owner","current_com","undefined","tmp","findFormat","format","charCodeAt","env","p","s","j","b","lastIndexOf","c","join","$path","watches","unshift","call","M","get","C","ready","off","W","OFF","type","cleararr","key","remove","item","Object","keys","forEach","emit","e","args","arguments","$removed","apply","window"],"mappings":"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","file":"../topic.js","sourcesContent":["define([\r\n\t\"./jc\",\r\n\t\"./langx\",\r\n\t\"./caches\"\r\n],function(jc, langx,caches){\r\n\tvar events = {};\r\n\r\n\t// ===============================================================\r\n\t// Eventer\r\n\t// ===============================================================\r\n\r\n\r\n\tfunction on(name, path, fn, init, context) {\r\n\r\n\t\tif (name.indexOf(MULTIPLE) !== -1) {\r\n\t\t\tvar arr = name.split(MULTIPLE).trim();\r\n\t\t\tfor (var i = 0; i < arr.length; i++)\r\n\t\t\t\ton(arr[i], path, fn, init, context);\r\n\t\t\treturn this; //W;\r\n\t\t}\r\n\r\n\t\tvar push = true;\r\n\r\n\t\tif (name.substring(0, 1) === '^') {\r\n\t\t\tpush = false;\r\n\t\t\tname = name.substring(1);\r\n\t\t}\r\n\r\n\t\tvar owner = null;\r\n\t\tvar index = name.indexOf('#');\r\n\r\n\t\tif (index) {\r\n\t\t\towner = name.substring(0, index).trim();\r\n\t\t\tname = name.substring(index + 1).trim();\r\n\t\t}\r\n\r\n\t\tif (typeof(path) === TYPE_FN) {\r\n\t\t\tfn = path;\r\n\t\t\tpath = name === 'watch' ? '*' : '';\r\n\t\t} else\r\n\t\t\tpath = path.replace('.*', '');\r\n\r\n\t\tvar obj = { name: name, fn: fn, owner: owner || current_owner, context: context || (current_com == null ? undefined : current_com) };\r\n\r\n\t\tif (name === 'watch') {\r\n\t\t\tvar arr = [];\r\n\r\n\t\t\tvar tmp = findFormat(path);\r\n\t\t\tif (tmp) {\r\n\t\t\t\tpath = tmp.path;\r\n\t\t\t\tobj.format = tmp.fn;\r\n\t\t\t}\r\n\r\n\t\t\tif (path.substring(path.length - 1) === '.')\r\n\t\t\t\tpath = path.substring(0, path.length - 1);\r\n\r\n\t\t\t// Temporary\r\n\t\t\tif (path.charCodeAt(0) === 37)\r\n\t\t\t\tpath = 'jctmp.' + path.substring(1);\r\n\r\n\t\t\tpath = path.env();\r\n\r\n\t\t\t// !path = fixed path\r\n\t\t\tif (path.charCodeAt(0) === 33) {\r\n\t\t\t\tpath = path.substring(1);\r\n\t\t\t\tarr.push(path);\r\n\t\t\t} else {\r\n\t\t\t\tvar p = path.split('.');\r\n\t\t\t\tvar s = [];\r\n\t\t\t\tfor (var j = 0; j < p.length; j++) {\r\n\t\t\t\t\tvar b = p[j].lastIndexOf('[');\r\n\t\t\t\t\tif (b !== -1) {\r\n\t\t\t\t\t\tvar c = s.join('.');\r\n\t\t\t\t\t\tarr.push(c + (c ? '.' : '') + p[j].substring(0, b));\r\n\t\t\t\t\t}\r\n\t\t\t\t\ts.push(p[j]);\r\n\t\t\t\t\tarr.push(s.join('.'));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tobj.path = path;\r\n\t\t\tobj.$path = arr;\r\n\r\n\t\t\tif (push)\r\n\t\t\t\twatches.push(obj);\r\n\t\t\telse\r\n\t\t\t\twatches.unshift(obj);\r\n\r\n\t\t\tinit && fn.call(context || M, path, obj.format ? obj.format(get(path), path, 0) : get(path), 0);\r\n\t\t} else {\r\n\t\t\tif (events[name]) {\r\n\t\t\t\tif (push)\r\n\t\t\t\t\tevents[name].push(obj);\r\n\t\t\t\telse\r\n\t\t\t\t\tevents[name].unshift(obj);\r\n\t\t\t} else\r\n\t\t\t\tevents[name] = [obj];\r\n\t\t\t(!C.ready && (name === 'ready' || name === 'init')) && fn();\r\n\t\t}\r\n\t\treturn this; //W;\r\n\t}\r\n\r\n\tfunction off(name, path, fn) {\r\n\r\n\t\tif (name.indexOf('+') !== -1) {\r\n\t\t\tvar arr = name.split('+').trim();\r\n\t\t\tfor (var i = 0; i < arr.length; i++)\r\n\t\t\t\tW.OFF(arr[i], path, fn);\r\n\t\t\treturn this; //W;\r\n\t\t}\r\n\r\n\t\tif (typeof(path) === TYPE_FN) {\r\n\t\t\tfn = path;\r\n\t\t\tpath = '';\r\n\t\t}\r\n\r\n\t\tif (path === undefined)\r\n\t\t\tpath = '';\r\n\r\n\t\tvar owner = null;\r\n\t\tvar index = name.indexOf('#');\r\n\t\tif (index) {\r\n\t\t\towner = name.substring(0, index).trim();\r\n\t\t\tname = name.substring(index + 1).trim();\r\n\t\t}\r\n\r\n\t\tif (path) {\r\n\t\t\tpath = path.replace('.*', '').trim();\r\n\t\t\tvar tmp = findFormat(path);\r\n\t\t\tif (tmp)\r\n\t\t\t\tpath = tmp.path;\r\n\t\t\tif (path.substring(path.length - 1) === '.')\r\n\t\t\t\tpath = path.substring(0, path.length - 1);\r\n\t\t}\r\n\r\n\t\tvar type = 0;\r\n\r\n\t\tif (owner && !path && !fn && !name)\r\n\t\t\ttype = 1;\r\n\t\telse if (owner && name && !fn && !path)\r\n\t\t\ttype = 2;\r\n\t\telse if (owner && name && path)\r\n\t\t\ttype = 3;\r\n\t\telse if (owner && name && path && fn)\r\n\t\t\ttype = 4;\r\n\t\telse if (name && path && fn)\r\n\t\t\ttype = 5;\r\n\t\telse if (name && path)\r\n\t\t\ttype = 7;\r\n\t\telse if (fn)\r\n\t\t\ttype = 6;\r\n\r\n\t\tvar cleararr = function(arr, key) {\r\n\t\t\treturn arr.remove(function(item) {\r\n\t\t\t\tif (type > 2 && type < 5) {\r\n\t\t\t\t\tif (item.path !== path)\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tvar v = false;\r\n\t\t\t\tif (type === 1)\r\n\t\t\t\t\tv = item.owner === owner;\r\n\t\t\t\telse if (type === 2)\r\n\t\t\t\t\tv = key === name && item.owner === owner;\r\n\t\t\t\telse if (type === 3)\r\n\t\t\t\t\tv = key === name && item.owner === owner;\r\n\t\t\t\telse if (type === 4)\r\n\t\t\t\t\tv = key === name && item.owner === owner && item.fn === fn;\r\n\t\t\t\telse if (type === 5 || type === 6)\r\n\t\t\t\t\tv = key === name && item.fn === fn;\r\n\t\t\t\telse if (type === 6)\r\n\t\t\t\t\tv = item.fn === fn;\r\n\t\t\t\telse if (type === 7)\r\n\t\t\t\t\tv = key === name && item.path === path;\r\n\t\t\t\telse\r\n\t\t\t\t\tv = key === name;\r\n\t\t\t\treturn v;\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tObject.keys(events).forEach(function(p) {\r\n\t\t\tevents[p] = cleararr(events[p], p);\r\n\t\t\tif (!events[p].length)\r\n\t\t\t\tdelete events[p];\r\n\t\t});\r\n\r\n\t\twatches = cleararr(watches, 'watch');\r\n\t\treturn this; //W;\r\n\t}\r\n\r\n\tfunction emit(name) {\r\n\r\n\t\tvar e = events[name];\r\n\t\tif (!e)\r\n\t\t\treturn false;\r\n\r\n\t\tvar args = [];\r\n\r\n\t\tfor (var i = 1, length = arguments.length; i < length; i++)\r\n\t\t\targs.push(arguments[i]);\r\n\r\n\t\tfor (var i = 0, length = e.length; i < length; i++) {\r\n\t\t\tvar context = e[i].context;\r\n\t\t\tif (context !== undefined && (context === null || context.$removed))\r\n\t\t\t\tcontinue;\r\n\t\t\te[i].fn.apply(context || window, args);\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn jc.topic = {\r\n\t\ton,\r\n\t\toff,\r\n\t\temit\r\n\t}\r\n});"]}