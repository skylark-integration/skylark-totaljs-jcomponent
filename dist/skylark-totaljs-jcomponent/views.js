/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["./jc","./langx","./Usage","./caches","./Component"],function(t,e,n,r,a){var i=t,o=a.components=[],l={},f=r.clear;$.fn.FIND=function(t,e,n,r){typeof e===TYPE_FN&&(r=n,n=e,e=void 0);var a=this,i=d(a,t);return typeof n===TYPE_FN?i.length?(n.call(i,i),a):(WAIT(function(){var n=a.FIND(t,e);return n instanceof Array?n.length>0:!!n},function(r){if(!r){var i=a.FIND(t,e);n.call(i||W,i)}},500,r),a):e?i:i[0]},$.fn.SETTER=function(t,e){for(var n=this,r=[],a=!0===t?3:2,i=a;i<arguments.length;i++)r.push(arguments[i]);if(3===a){if(t=e,e=arguments[2],lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){$.fn.SETTER.apply(n,t)},555,arguments),n;n.FIND(t,!0,function(t){for(var n=0,a=t.length;n<a;n++){var i=t[n];typeof i[e]===TYPE_FN?i[e].apply(i,r):i[e]=r[0]}})}else{if(lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){$.fn.SETTER.apply(n,t)},555,arguments),n;for(var o=n.FIND(t,!0),l=(i=0,o.length);i<l;i++){var f=o[i];typeof f[e]===TYPE_FN?f[e].apply(f,r):f[e]=r[0]}}return n},$.fn.RECONFIGURE=function(t,e){return this.SETTER(t,"reconfigure",e)},i.$formatter=[],W.FORMATTER=i.formatter=function(t,n,r){if(e.isFunction(t))return!i.$formatter&&(i.$formatter=[]),!0===n?i.$formatter.unshift(t):i.$formatter.push(t),i;var a=i.$formatter;if(a&&a.length)for(var o=0,l=a.length;o<l;o++){var f=a[o].call(i,n,t,r);void 0!==f&&(t=f)}return t},W.RECONFIGURE=function(t,e){return SETTER(!0,t,"reconfigure",e),RECONFIGURE};function u(t,e,n){setTimeout(function(){EXEC.call(t,!0,e,n[0],n[1],n[2],n[3],n[4],n[5],n[6])},200)}function s(t,e,n,r){var a=e instanceof Array,i="dirty"+t+(a?">"+e.join("|"):""),l=null;if(a&&(l=e,e=void 0),"boolean"!=typeof e&&void 0!==p[i])return p[i];var u=!0,s=void 0!==e?[]:null,c=null;if(a){var d=!1;c={},l=l.remove(function(t){return"@"===t.substring(0,1)&&(c[t.substring(1)]=!0,d=!0,!0)}),!d&&(c=null),a=l.length>0}var v=t.lastIndexOf(".*"),h=-1!==v;-1!==v&&(t=t.substring(0,v)),t=pathmaker(t);for(var m=o,$=0,y=m.length;$<y;$++){var g=m[$];!(g&&!g.$removed&&g.$loaded&&g.path&&g.$compare(t))||a&&g.$except(l)||(c&&(c.visible&&!g.visible()||c.hidden&&!g.hidden()||c.enabled&&g.find(SELINPUT).is(":disabled")||c.disabled&&g.find(SELINPUT).is(":enabled"))||(g.disabled||g.$dirty_disabled?s&&g.state&&s.push(g):void 0!==e?(g.state&&s.push(g),n?n._id===g._id&&(g.$dirty=e,g.$interaction(101)):(h||g.path===t)&&(g.$dirty=e,g.$interaction(101)),!1===g.$dirty&&(u=!1)):!1===g.$dirty&&(u=!1)))}return f("dirty"),p[i]=u,!r&&state(s,1,2),u}function c(t,e){if(!t.length)return null;for(var n=0;n<t.length;n++)if(t[n][e])return t[n][e];for(var r=t[0].parentElement;null!==r;){if(r[e])return r[e];r=r.parentElement}return null}function d(t,e,n){for(var r,a=e?e.split(" "):EMPTYARRAY,i="",l="",f="",u="",s=0,c=a.length;s<c;s++)switch(a[s].substring(0,1)){case"*":break;case".":i=a[s].substring(1);break;case"#":-1!==(r=(f=a[s].substring(1)).indexOf("["))&&(i=f.substring(r+1,f.length-1).trim(),f=f.substring(0,r));break;default:-1!==(r=(l=a[s]).indexOf("["))&&(i=l.substring(r+1,l.length-1).trim(),l=l.substring(0,r)),-1!==(r=l.lastIndexOf("@"))&&(u=l.substring(r+1),l=l.substring(0,r))}var d=n?void 0:[];if(t){var v=!1;t.find("[data-jc]").each(function(){var t=this.$com;v||!t||!t.$loaded||t.$removed||f&&t.id!==f||l&&t.$name!==l||u&&t.$version!==u||i&&(t.$pp||t.path!==i&&(!t.pathscope||t.pathscope+"."+i!==t.path))||(n?!1===n(t)&&(v=!0):d.push(t))})}else for(s=0,c=o.length;s<c;s++){var p=o[s];if(!(!p||!p.$loaded||p.$removed||f&&p.id!==f||l&&p.$name!==l||u&&p.$version!==u||i&&(p.$pp||p.path!==i&&(!p.pathscope||p.pathscope+"."+i!==p.path))))if(n){if(!1===n(p))break}else d.push(p)}return d}function v(t,e){t.$inputcontrol&&t.$inputcontrol%2!=0?t.$inputcontrol++:function t(e,n,r){var a=e.childNodes;var i=[];ACTRLS[e.tagName]&&n(e);null==r?r=0:r++;for(var o=0,l=a.length;o<l;o++){var f=a[o];if(f&&f.tagName&&(f.childNodes.length&&"SCRIPT"!==f.tagName&&null==f.getAttribute("data-jc")&&i.push(f),ACTRLS[f.tagName]&&null!=f.getAttribute("data-jc-bind")&&!1===n(f)))return}for(var o=0,l=i.length;o<l;o++)if((f=i[o])&&!1===t(f,n,r))return}((e||t.element)[0],function(e){e.$com&&e.$com===t||(e.$com=t,t.$inputcontrol=1)})}$.fn.vbind=function(){return c(this,"$vbind")},$.fn.vbindarray=function(){return c(this,"$vbindarray")},$.fn.component=function(){return c(this,"$com")},$.fn.components=function(t){var e=this.find("[data-jc]"),n=null;return e.each(function(e){var r=this.$com;if(r)if(r instanceof Array)r.forEach(function(r){if(r&&r.$ready&&!r.$removed){if(t)return t.call(r,e);n||(n=[]),n.push(r)}});else if(r&&r.$ready&&!r.$removed){if(t)return t.call(r,e);n||(n=[]),n.push(r)}}),t?e:n},e.mixin(o,{add:function(t,e){if((e instanceof COM||e instanceof Scope||e instanceof Plugin)&&(e=e.element),t instanceof Array)for(var n=0;n<t.length;n++)ADD(t[n],e);else $(e||document.body).append('<div data-jc="{0}"></div>'.format(t)),setTimeout2("ADD",COMPILE,10)},attrcom:attrcom,exec:function(t){var n,r=[],a=1,i=!1,o=this;!0===t&&(i=!0,t=arguments[1],a=2),t=t.env();for(var l=a;l<arguments.length;l++)r.push(arguments[l]);var f=t.charCodeAt(0);if(35===f)return n=t.substring(1),i?!events[n]&&u(o,t,r):EMIT.call(o,n,r[0],r[1],r[2],r[3],r[4]),EXEC;var s=0;if(64===f){var c=t.indexOf(".");if(n=t.substring(1,c),v=plugins.find(n)){var d=v[t.substring(c+1)];e.isFunction(d)&&(d.apply(o===Window?v:o,r),s=1)}return i&&!s&&u(o,t,r),EXEC}if(-1!==(c=t.indexOf("/"))){n=t.substring(0,c);var v=plugins.find(n);return d=t.substring(c+1),v&&typeof v[d]===TYPE_FN&&(v[d].apply(o===W?v:o,r),s=1),i&&!s&&u(o,t,r),EXEC}return d=paths.get(t),e.isFunction(d)&&(d.apply(o,r),s=1),i&&!s&&u(o,t,r),EXEC},exec2:function(t,e){var n=!0===t;return function(r,a,i,o){n?EXEC(e,t,r,a,i,o):EXEC(t,r,a,i,o)}}});var p={};function h(t,e){var n=!!e&&-1!==e.lastIndexOf("*");n&&(e=e.replace(".*",""));for(var r=o,a=0,i=0,l=r.length;i<l;i++){var f=r[i];if(f&&f.$loaded&&!f.$removed&&(!e||f.path&&f.$compare(e)))if(!0===t(f,a++,n))return this}return this}return t.views={components:o,changed:function(t){return!s(t)},change:function(t,e){return null==e&&(e=!0),!s(t,!e)},cleaner:cleaner,cleaner2:cleaner2,default2:function t(n,a,i,l){if(a>0)return setTimeout(function(){t(n,0,i,l)},a),this;"boolean"==typeof i&&(l=i,i=null),void 0===l&&(l=!0);var f,u=(n=pathmakerw(n)).replace(/\.\*$/,""),s=defaults["#"+HASH(u)];s&&(f=s(),set(u,f));for(var c=[],d=o,p=0,h=d.length;p<h;p++){var m=d[p];if(m&&!m.$removed&&!m.disabled&&m.$loaded&&m.path&&m.$compare(n)&&(m.state&&c.push(m),!i||i._id===m._id)){if(m.$default&&m.set(m.$default(),3),!l)return;v(m),m.$dirty_disabled||(m.$dirty=!0),m.$valid_disabled||(m.$valid=!0,m.$validate=!1,m.validate&&(m.$valid=m.validate(m.get()),m.$interaction(102)))}}return l&&(r.clear("valid","dirty"),e.state(c,3,3)),this},each:h,find:function(t,n,r,a){var i=!1;if(e.isFunction(n))i=!0,a=n,n=void 0;else if(e.isFunction(r)){var o=a;i=!0,a=r,r=o}if(!i){if("object"==typeof t){t instanceof jQuery||(t=$(t));var l=d(t,"");return n?l:l[0]}var f;if(!r&&(l=p[f="find."+t+"."+(n?0:1)]))return l;var u=d(null,t);return n||(u=u[0]),l=u,r||(p[f]=l),l}e.isWaiting(function(){var e=FIND(t,n,r);return lazycom[t]&&1===lazycom[t].state&&(lazycom[t].state=2,topic.emit("lazy",t,!0),warn("Lazy load: "+t),compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var r=FIND(t,n);a.call(r||W,r)}},500,r)},refresh:refresh,reset:function t(e,n,r){if(n>0)return setTimeout(function(){t(e)},n),this;e=parsers.pathmaker(e).replace(REGWILDCARD,"");for(var a=[],i=o,l=0,u=i.length;l<u;l++){var s=i[l];s&&!s.$removed&&!s.disabled&&s.$loaded&&s.path&&s.$compare(e)&&(s.state&&a.push(s),r&&r._id!==s._id||(v(s),s.$dirty_disabled||(s.$dirty=!0,s.$interaction(101)),s.$valid_disabled||(s.$valid=!0,s.$validate=!1,s.validate&&(s.$valid=s.validate(s.get()),s.$interaction(102)))))}return f("valid","dirty"),state(a,1,3),this},setter:function(t,e){for(var n=[],r=!0===t?3:2,a=r;a<arguments.length;a++)n.push(arguments[a]);if(3===r){if(t=e,lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){t[0]=!0,W.SETTER.apply(W,t)},555,arguments),SETTER;e=arguments[2],FIND(t,!0,function(t){for(var r=0,a=t.length;r<a;r++){var i=t[r];typeof i[e]===TYPE_FN?i[e].apply(i,n):i[e]=n[0]}})}else{if(lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){W.SETTER.apply(W,t)},555,arguments),SETTER;for(var i=FIND(t,!0),o=(a=0,i.length);a<o;a++){var l=i[a];typeof l[e]===TYPE_FN?l[e].apply(l,n):l[e]=n[0]}}return SETTER},usage:function(t,n,r,a){var l=typeof n;l===TYPE_S?n=e.now(!0).add("-"+n.env()).getTime():l===TYPE_N&&(n=Date.now()-n),typeof r===TYPE_FN&&(a=r,r=void 0);var f=[],u=null;u=r?FIND("."+r,!0):o;for(var s=0;s<u.length;s++){var c=u[s];c.usage[t]>=n&&(a?a(c):f.push(c))}return a?i:f},version:function(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t].split(","),n=0;n<e.length;n++){var r=e[n].trim(),a=r.indexOf("@");if(-1!==a){var i=r.substring(a+1);r=r.substring(0,a),i&&r&&(l[r]=i)}}}}});
//# sourceMappingURL=sourcemaps/views.js.map
