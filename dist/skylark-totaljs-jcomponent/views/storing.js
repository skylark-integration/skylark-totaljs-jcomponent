/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/pathmaker"],function(t,e){var r="input,textarea,select",n={sort:1,reverse:1,splice:1,slice:1,pop:1,unshift:1,shift:1,push:1},i=" + ",a=0;$.components=M,setInterval(function(){t.now(!0);for(var e=M.components,r=0,n=e.length;r<n;r++)e[r].knockknock&&e[r].knockknock(a);EMIT("knockknock",a++)},6e4),setInterval(function(){temp={},paths={}},3e5);return function(a,s){var o={};function l(t,e,r){for(var n=0,i=u.length;n<i;n++){var a=u[n];if("*"===a.path)a.fn.call(a.context,t,a.format?a.format(e,t,r):e,r);else if(t.length>a.path.length){var o=t.lastIndexOf(".",a.path.length);if(-1!==o&&a.path===t.substring(0,o)){var l=s.get(a.path);a.fn.call(a.context,t,a.format?a.format(l,t,r):l,r)}}else for(var d=0,f=a.$path.length;d<f;d++)if(a.$path[d]===t){l=s.get(a.path),a.fn.call(a.context,t,a.format?a.format(l,t,r):l,r);break}}}function d(t){for(var e=Object.keys(o),r=e.length,n=0;n<r;n++){var i=e[n];arr=o[i],t(i,arr),arr.length||delete o[i]}}var u=[];function f(t){for(var e=t.split("."),r=[],n=[],i=0;i<e.length;i++){var a=e[i],s=a.indexOf("[");if(-1===s)if(-1===a.indexOf("-"))n.push(a),r.push(n.join("."));else{var o=n.splice(n.length-1);n.push(o+"['"+a+"']"),r.push(n.join("."))}else-1===a.indexOf("-")?(n.push(a.substring(0,s)),r.push(n.join(".")),n.splice(n.length-1),n.push(a),r.push(n.join("."))):(n.push("['"+a.substring(0,s)+"']"),r.push(n.join("")),n.push(a.substring(s)),r.push(n.join("")))}return r}a.data;var c={},v={},h={},p=[],g={};function b(t,e,r){for(var n=c[t],i=0;i<n.length;i++){var a=n[i];a.ticks!==r&&(a.ticks=r,a.exec(getx(a.path),e))}}function d(t,e){var r=!!e&&-1!==e.lastIndexOf("*");r&&(e=e.replace(".*",""));for(var n=components,i=0,a=0,s=n.length;a<s;a++){var o=n[a];if(o&&o.$loaded&&!o.$removed&&(!e||o.path&&o.$compare(e))&&!0===t(o,i++,r))return this}return this}function $(t,n,i,a){var o=n instanceof Array,l="dirty"+t+(o?">"+n.join("|"):""),d=null;if(o&&(d=n,n=void 0),"boolean"!=typeof n&&void 0!==m[l])return m[l];var u=!0,f=void 0!==n?[]:null,c=null;if(o){var v=!1;c={},d=d.remove(function(t){return"@"===t.substring(0,1)&&(c[t.substring(1)]=!0,v=!0,!0)}),!v&&(c=null),o=d.length>0}var h=t.lastIndexOf(".*"),p=-1!==h;-1!==h&&(t=t.substring(0,h)),t=e(t);for(var g=s.components,b=0,$=g.length;b<$;b++){var y=g[b];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(t))||o&&y.$except(d)||c&&(c.visible&&!y.visible()||c.hidden&&!y.hidden()||c.enabled&&y.find(r).is(":disabled")||c.disabled&&y.find(r).is(":enabled"))||(y.disabled||y.$dirty_disabled?f&&y.state&&f.push(y):void 0!==n?(y.state&&f.push(y),i?i._id===y._id&&(y.$dirty=n,y.$interaction(101)):(p||y.path===t)&&(y.$dirty=n,y.$interaction(101)),!1===y.$dirty&&(u=!1)):!1===y.$dirty&&(u=!1))}return m.clearPageData("dirty"),m.setPageData(l,u),!a&&state(f,1,2),u}function y(n,i,a){var o=i instanceof Array,l="valid"+n+(o?">"+i.join("|"):""),d=null;if(o&&(d=i,i=void 0),"boolean"!=typeof i&&void 0!==m[l])return m[l];var u=null;if(o){var f=!1;u={},d=d.remove(function(t){return"@"===t.substring(0,1)&&(u[t.substring(1)]=!0,f=!0,!0)}),!f&&(u=null),o=d.length>0}var c=!0,v=void 0!==i?[]:null,h=n.lastIndexOf(".*"),p=-1!==h;-1!==h&&(n=n.substring(0,h)),n=e(n);for(var g=s.components,b=0,$=g.length;b<$;b++){var y=g[b];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(n))||o&&y.$except(d)||u&&(u.visible&&!y.visible()||u.hidden&&!y.hidden()||u.enabled&&y.find(r).is(":disabled")||u.disabled&&y.find(r).is(":enabled"))||(y.disabled||y.$valid_disabled?v&&y.state&&v.push(y):void 0!==i?(y.state&&v.push(y),a?a._id===y._id&&(y.$valid=i,y.$interaction(102)):(p||y.path===n)&&(y.$valid=i,y.$interaction(102)),!1===y.$valid&&(c=!1)):!1===y.$valid&&(c=!1))}return m.clearPageData("valid"),m.setPageData(l,c),t.state(v,1,1),c}function m(t,e,r){var n="$jcpath";if(WATCH(t,function(r,i){var a=storages.get(n);a?a[t]=i:(a={})[t]=i,storages.put(n,a,e)}),void 0===r||r){var i=storages.get(n);i&&void 0!==i[t]&&i[t]!==x(t)&&w(t,i[t],!0)}return this}function x(t,e){if(null!=t){37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1));var r="="+t;if(v[r])return v[r](e||stores.root);if(-1===t.indexOf("?")){for(var n=f(t),i=[],a=0,s=n.length-1;a<s;a++){var o=n[a];"["!==o.substring(0,1)&&(o="."+o),i.push("if(!w"+o+")return")}var l=n[n.length-1];"["!==l.substring(0,1)&&(l="."+l);var d=new Function("w",i.join(";")+";return w"+l);return v[r]=d,d(e||MD.scope)}}}function k(t,e,r){if(null!=t){var n="+"+t;if(v[n])return v[n](a.data,e,t,c,b,r);if(-1===t.indexOf("?")){for(var i=f(t),s=[],o=[],l=0;l<i.length-1;l++){var d=i[l],u=i[l+1]&&REGISARR.test(i[l+1])?"[]":"{}",h="w"+("["===d.substring(0,1)?"":".")+d;s.push("if(typeof("+h+")!=='object'||"+h+"==null)"+h+"="+u)}for(l=0;l<i.length-1;l++)d=i[l],o.push("binders['"+d+"']&&binderbind('"+d+"','"+t+"',$ticks)");var p=i[i.length-1];o.push("binders['"+p+"']&&binderbind('"+p+"','"+t+"',$ticks)"),o.push("binders['!"+p+"']&&binderbind('!"+p+"','"+t+"',$ticks)"),"["!==p.substring(0,1)&&(p="."+p);var g=new Function("w","a","b","binders","binderbind","nobind","var $ticks=Math.random().toString().substring(2,8);if(!nobind){"+s.join(";")+";var v=typeof(a)=='function'?a(MAIN.compiler.get(b)):a;w"+p+"=v}"+o.join(";")+";return a");return v[n]=g,g(a.data,e,t,c,b,r),this}t=""}}function w(t,r,n){if(t instanceof Array){for(var i=0;i<t.length;i++)w(t[i],r,n);return M}if(!(t=e(t)))return M;if(33===t.charCodeAt(0)&&(t=t.substring(1)),43===t.charCodeAt(0))return j(t=t.substring(1),r,n);if(!t)return M;var a="object"==typeof r&&!(r instanceof Array)&&null!=r,o=!0===n;if(o&&(n=1),M.skipproxy=t,k(t,r),a)return _(t,o,n,!0);var d=x(t),u=[];void 0===n&&(n=1);for(var f=s.components,c=(i=0,f.length);i<c;i++){var v=f[i];v&&!v.disabled&&!v.$removed&&v.$loaded&&v.path&&v.$compare(t)&&(v.setter&&(v.path===t?v.setter&&(v.setterX(d,t,n),v.$interaction(n)):v.setter&&(v.setterX(x(v.path),t,n),v.$interaction(n))),v.$ready||(v.$ready=!0),3!==n&&v.state&&u.push(v),o?(v.$dirty_disabled||(v.$dirty=!0),v.$valid_disabled||(v.$valid=!0,v.$validate=!1,v.validate&&(v.$valid=v.validate(d),v.$interaction(102))),findcontrol2(v)):v.validate&&!v.$valid_disabled&&v.valid(v.validate(d),!0))}for(o&&caches.clear("dirty","valid"),i=0,c=u.length;i<c;i++)u[i].stateX(n,5);return l(t,d,n),M}function _(t,r,n,i){if(t instanceof Array){for(var o=0;o<t.length;o++)_(a,t[o],r,n);return this}if(!(t=e(t)))return this;if(33===t.charCodeAt(0)&&(t=t.substring(1)),!(t=t.replaceWildcard()))return this;i||x(t,x(t));var d=[];void 0===n&&(n=1),M.skipproxy=t;for(var u=s.components,f=(o=0,u.length);o<f;o++){var c=u[o];if(c&&!c.disabled&&!c.$removed&&c.$loaded&&c.path&&c.$compare(t)){var v=c.get();c.setter&&(c.$skip=!1,c.setterX(v,t,n),c.$interaction(n)),c.$ready||(c.$ready=!0),!0===r?(c.$dirty_disabled||(c.$dirty=!0,c.$interaction(101)),c.$valid_disabled||(c.$valid=!0,c.$validate=!1,c.validate&&(c.$valid=c.validate(v),c.$interaction(102))),findcontrol2(c)):c.validate&&!c.$valid_disabled&&c.valid(c.validate(v),!0),c.state&&d.push(c)}}for(r&&clear("dirty","valid"),o=0,f=d.length;o<f;o++)d[o].stateX(1,4);return l(t,x(t),n),this}function j(t,e,r){if(t instanceof Array){for(var n=0;n<t.length;n++)j(t[n],e,r);return this}var i=x(t),a=!1;i instanceof Array||(i=[],a=!0);var s=!0;return M.skipproxy=t,e instanceof Array?e.length?i.push.apply(i,e):s=!1:i.push(e),a?w(t,i,r):s&&_(t,void 0,r),this}function A(t,e){return null==e&&(e=!0),!$(t,!e)}function O(e){var r,n=[],i=1,a=!1,s=this;!0===e&&(a=!0,e=arguments[1],i=2),e=e.env();for(var l=i;l<arguments.length;l++)n.push(arguments[l]);var d=e.charCodeAt(0);if(35===d)return r=e.substring(1),a?!o[r]&&exechelper(s,e,n):EMIT.call(s,r,n[0],n[1],n[2],n[3],n[4]),EXEC;var u=0;if(64===d){var f=e.indexOf(".");if(r=e.substring(1,f),h=plugins.find(r)){var c=h[e.substring(f+1)];t.isFunction(c)&&(c.apply(s===Window?h:s,n),u=1)}return a&&!u&&exechelper(s,e,n),EXEC}if(-1!==(f=e.indexOf("/"))){r=e.substring(0,f);var h=plugins.find(r);return c=e.substring(f+1),h&&typeof h[c]===TYPE_FN&&(h[c].apply(s===W?h:s,n),u=1),a&&!u&&exechelper(s,e,n),EXEC}return c=v.get(e),t.isFunction(c)&&(c.apply(s,n),u=1),a&&!u&&exechelper(s,e,n),O}function F(t,r,n){if(r>0)return setTimeout(function(){F(t)},r),this;t=e(t).replaceWildcard();for(var i=[],a=s.components,o=0,l=a.length;o<l;o++){var d=a[o];d&&!d.$removed&&!d.disabled&&d.$loaded&&d.path&&d.$compare(t)&&(d.state&&i.push(d),n&&n._id!==d._id||(findcontrol2(d),d.$dirty_disabled||(d.$dirty=!0,d.$interaction(101)),d.$valid_disabled||(d.$valid=!0,d.$validate=!1,d.validate&&(d.$valid=d.validate(d.get()),d.$interaction(102)))))}return clear("valid","dirty"),state(i,1,3),this}return $parser=[],nmCache={},temp={},{on:function e(r,n,a,s,l){if(-1!==r.indexOf(i)){for(var d=r.split(i).trim(),f=0;f<d.length;f++)e(d[f],n,a,s,l);return this}var c=!0;"^"===r.substring(0,1)&&(c=!1,r=r.substring(1));var v=null,h=r.indexOf("#");h&&(v=r.substring(0,h).trim(),r=r.substring(h+1).trim()),t.isFunction(n)?(a=n,n="watch"===r?"*":""):n=n.replace(".*","");var p={name:r,fn:a,owner:v||current_owner,context:l||(null==current_com?void 0:current_com)};if("watch"===r){d=[];var g=findFormat(n);if(g&&(n=g.path,p.format=g.fn),"."===n.substring(n.length-1)&&(n=n.substring(0,n.length-1)),37===n.charCodeAt(0)&&(n="jctmp."+n.substring(1)),33===(n=n.env()).charCodeAt(0))n=n.substring(1),d.push(n);else for(var b=n.split("."),$=[],y=0;y<b.length;y++){var m=b[y].lastIndexOf("[");if(-1!==m){var k=$.join(".");d.push(k+(k?".":"")+b[y].substring(0,m))}$.push(b[y]),d.push($.join("."))}p.path=n,p.$path=d,c?u.push(p):u.unshift(p),s&&a.call(l||M,n,p.format?p.format(x(n),n,0):x(n),0)}else o[r]?c?o[r].push(p):o[r].unshift(p):o[r]=[p],!C.ready&&("ready"===r||"init"===r)&&a();return this},off:function t(e,r,n){if(-1!==e.indexOf("+")){for(var i=e.split("+").trim(),a=0;a<i.length;a++)t(i[a],r,n);return this}lang.isFunction(r)&&(n=r,r=""),void 0===r&&(r="");var s=null,l=e.indexOf("#");if(l&&(s=e.substring(0,l).trim(),e=e.substring(l+1).trim()),r){r=r.replace(".*","").trim();var d=findFormat(r);d&&(r=d.path),"."===r.substring(r.length-1)&&(r=r.substring(0,r.length-1))}var f=0;!s||r||n||e?s&&e&&!n&&!r?f=2:s&&e&&r?f=3:s&&e&&r&&n?f=4:e&&r&&n?f=5:e&&r?f=7:n&&(f=6):f=1;var c=function(t,i){return t.remove(function(t){return!(f>2&&f<5&&t.path!==r)&&(1===f?t.owner===s:2===f?i===e&&t.owner===s:3===f?i===e&&t.owner===s:4===f?i===e&&t.owner===s&&t.fn===n:5===f||6===f?i===e&&t.fn===n:6===f?t.fn===n:7===f?i===e&&t.path===r:i===e)})};return Object.keys(o).forEach(function(t){o[t]=c(o[t],t),o[t].length||delete o[t]}),u=c(u,"watch"),this},emit:function(t){var e=o[t];if(!e)return!1;for(var r=[],n=1,i=arguments.length;n<i;n++)r.push(arguments[n]);for(n=0,i=e.length;n<i;n++){var a=e[n].context;(void 0===a||null!==a&&!a.$removed)&&e[n].fn.apply(a||window,r)}return!0},watch:function r(n,a,s){if(-1!==n.indexOf(i)){for(var o=n.split(i).trim(),l=0;l<o.length;l++)r(o[l],a,s);return this}t.isFunction(n)&&(s=a,a=n,n="*");var d="";return"^"===n.substring(0,1)&&(n=n.substring(1),d="^"),n=e(n,!0),topic.on(d+"watch",n,a,s),this},unwatch:function t(e,r){if(-1!==e.indexOf(i)){for(var n=e.split(i).trim(),a=0;a<n.length;a++)t(n[a],r);return this}return topic.off("watch",e,r)},emitwatch:l,cache:m,can:function(t,r){return!$(t=e(t),r)&&y(t,r)},change:A,changed:function(t){return!$(t)},create:function(e){var r,i=!1;if(t.isString(e)){if(proxy[e])return proxy[e];i=!0,r=function(t){var r=e+(t?"."+t:"");M.skipproxy!==r?setTimeout(function(){M.skipproxy===r?M.skipproxy="":(function(){for(var t=arguments,e=s.components,r=Math.random().toString().substring(2,8),n=0;n<t.length;n++){var i=t[n];c[i]&&b(i,i,r)}for(var a=0,o=e.length;a<o;a++){var d=e[a];if(d&&!d.$removed&&!d.disabled&&d.$loaded&&d.path){for(var u=0,n=0;n<t.length;n++)if(d.path===t[n]){u=1;break}if(u){var f=d.get();d.setter&&d.setterX(f,d.path,1),d.state&&d.stateX(1,6),d.$interaction(1)}}}for(var n=0;n<t.length;n++)l(t[n],getx(t[n]),1)}(r),F(r))},MD.delaybinder):M.skipproxy=""}}else r=e;var a=!1,o=e&&get2(e)||{},d={get:function(t,e,r){try{return new Proxy(t[e],d)}catch(n){return Reflect.get(t,e,r)}},defineProperty:function(t,e,n){return!a&&r(e,n),Reflect.defineProperty(t,e,n)},deleteProperty:function(t,e){return!a&&r(e),Reflect.deleteProperty(t,e)},apply:function(t,e,i){if(n[t.name]){a=!0;var s=Reflect.apply(t,e,i);return r("",i[0]),a=!1,s}return Reflect.apply(t,e,i)}},u=new Proxy(o,d);return i?(M.skipproxy=e,null==getx(e)&&w(e,o,!0),proxy[e]=u):u},default:function r(n,i,a,o){if(i>0)return setTimeout(function(){r(n,0,a,o)},i),this;"boolean"==typeof a&&(o=a,a=null),void 0===o&&(o=!0);var l=(n=e(n.replaceWildcard())).replace(/\.\*$/,""),d=h["#"+HASH(l)];d&&k(l,d());for(var u=[],f=s.components,c=0,v=f.length;c<v;c++){var p=f[c];if(p&&!p.$removed&&!p.disabled&&p.$loaded&&p.path&&p.$compare(n)&&(p.state&&u.push(p),!a||a._id===p._id)){if(p.$default&&p.set(p.$default(),3),!o)return;findcontrol2(p),p.$dirty_disabled||(p.$dirty=!0),p.$valid_disabled||(p.$valid=!0,p.$validate=!1,p.validate&&(p.$valid=p.validate(p.get()),p.$interaction(102)))}}return o&&(m.clearPageData("valid","dirty"),t.state(u,3,3)),this},disabled:function(t,r){return $(t=e(t),r)||!y(t,r)},errors:function(r,n,i){r instanceof Array&&(n=r,r=void 0),!0===n&&(n=i instanceof Array?i:null,i=!0);var a=[];return d(function(t){t.disabled||n&&t.$except(n)||!1!==t.$valid||t.$valid_disabled||a.push(t)},e(r)),i&&t.state(a,1,1),a},evaluate:function(t,e,r){var n="eval"+e,i=temp[n],a=null;return a=r?t:x(t),i?i.call(a,a,t):(-1===e.indexOf("return")&&(e="return "+e),i=new Function("value","path",e),temp[n]=i,i.call(a,a,t))},exec:O,exec2:function(t,e){var r=!0===t;return function(n,i,a,s){r?O(e,t,n,i,a,s):O(t,n,i,a,s)}},extend:function(r,n,i){if(r=e(r)){var a=x(r);null==a&&(a={}),w(r,t.extend(a,n),i)}return this},format:function(e,r,n){if(t.isFunction(e))return!0===r?p.unshift(e):p.push(e),M;var i=p;if(i&&i.length)for(var a=0,s=i.length;a<s;a++){var o=i[a].call(M,r,e,n);void 0!==o&&(e=o)}return e},get:x,inc:function e(r,n,i){if(r instanceof Array){for(var a=0;a<r.length;a++)e(r[a],n,i);return this}if(!r)return this;var s=x(r);return s?t.isNumber(s)||(s=parseFloat(s),isNaN(s)&&(s=0)):s=0,w(r,s+=n,i),this},invalid:function(t,r){return(t=e(t))&&($(t,!1,r,!0),y(t,!1,r)),W},make:function(t,e,r){switch(typeof t){case"function":e=t,t={};break;case"string":var n=t,i=!0;return null==(t=x(n))&&(i=!1,t={}),e.call(t,t,n,function(e,r){w(t,e,r)}),!i||void 0!==r&&!0!==r?C.ready?k(n,t):w(n,t,!0):r(n,!0),t}return e.call(t,t,""),t},modify:function e(r,n,i){return r&&"object"==typeof r?Object.keys(r).forEach(function(t){e(t,r[t],n)}):(t.isFunction(n)&&(n=n(x(r))),w(r,n,i),i?t.setTimeout(A,i+5,r):A(r)),this},modified:function(t){var r=[];return d(function(t){t.disabled||t.$dirty_disabled||!1===t.$dirty&&r.push(t.path)},e(t)),r},parser:function(e,r,n){if(t.isFunction(e))return!0===r?$parser.unshift(e):$parser.push(e),this;var i=$parser;if(i&&i.length)for(var a=0,s=i.length;a<s;a++)e=i[a].call(this,r,e,n);return e},push:j,reset:F,rewrite:function(t,r,n){return(t=e(t))&&(M.skipproxy=t,k(t,r),l(t,r,n)),this},set:k,set2:function(t,e,r){if(null!=e){var n="++"+e;if(v[n])return v[n](t,r,e);for(var i=f(e),a=[],s=0;s<i.length-1;s++){var o=i[s],l=i[s+1]&&REGISARR.test(i[s+1])?"[]":"{}",d="w"+("["===o.substring(0,1)?"":".")+o;a.push("if(typeof("+d+")!=='object'||"+d+"==null)"+d+"="+l)}var u=i[i.length-1];"["!==u.substring(0,1)&&(u="."+u);var c=new Function("w","a","b",a.join(";")+";w"+u+"=a;return a");return v[n]=c,c(t,r,e),t}},setx:w,skip:function(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t].split(","),r=0,n=e.length;r<n;r++){var i=e[r].trim();g[i]?g[i]++:g[i]=1}},update:_,used:function(t){return d(function(t){!t.disabled&&t.used()},t),this},validate:function(t,n){var i=[],a=!0;t=e(t.replaceWildcard());var s=null;if(n){var o=!1;s={},n=n.remove(function(t){return"@"===t.substring(0,1)&&(s[t.substring(1)]=!0,o=!0,!0)}),!o&&(s=null),!n.length&&(n=null)}for(var l=M.components.all,d=0,u=l.length;d<u;d++){var f=l[d];f&&!f.$removed&&!f.disabled&&f.$loaded&&f.path&&f.$compare(t)&&(s&&(s.visible&&!f.visible()||s.hidden&&!f.hidden()||s.enabled&&f.find(r).is(":disabled")||s.disabled&&f.find(r).is(":enabled"))||(f.state&&i.push(f),f.$valid_disabled||(f.$validate=!0,f.validate&&(f.$valid=f.validate(x(f.path)),f.$interaction(102),f.$valid||(a=!1)))))}return clear("valid"),state(i,1,1),a}}}});
//# sourceMappingURL=../sourcemaps/views/storing.js.map
