/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/pathmaker"],function(t,e){var r="input,textarea,select",n={sort:1,reverse:1,splice:1,slice:1,pop:1,unshift:1,shift:1,push:1},i=0;$.components=M,setInterval(function(){t.now(!0);for(var e=M.components,r=0,n=e.length;r<n;r++)e[r].knockknock&&e[r].knockknock(i);EMIT("knockknock",i++)},6e4),setInterval(function(){temp={},paths={}},3e5);return function(i,a){function s(t){for(var e=t.split("."),r=[],n=[],i=0;i<e.length;i++){var a=e[i],s=a.indexOf("[");if(-1===s)if(-1===a.indexOf("-"))n.push(a),r.push(n.join("."));else{var d=n.splice(n.length-1);n.push(d+"['"+a+"']"),r.push(n.join("."))}else-1===a.indexOf("-")?(n.push(a.substring(0,s)),r.push(n.join(".")),n.splice(n.length-1),n.push(a),r.push(n.join("."))):(n.push("['"+a.substring(0,s)+"']"),r.push(n.join("")),n.push(a.substring(s)),r.push(n.join("")))}return r}i.data;var d={},o={},l={},u=[],c={};function f(t,e,r){for(var n=d[t],i=0;i<n.length;i++){var a=n[i];a.ticks!==r&&(a.ticks=r,a.exec(getx(a.path),e))}}function v(t,e){var r=!!e&&-1!==e.lastIndexOf("*");r&&(e=e.replace(".*",""));for(var n=components,i=0,a=0,s=n.length;a<s;a++){var d=n[a];if(d&&d.$loaded&&!d.$removed&&(!e||d.path&&d.$compare(e))&&!0===t(d,i++,r))return this}return this}function p(t,n,i,s){var d=n instanceof Array,o="dirty"+t+(d?">"+n.join("|"):""),l=null;if(d&&(l=n,n=void 0),"boolean"!=typeof n&&void 0!==$[o])return $[o];var u=!0,c=void 0!==n?[]:null,f=null;if(d){var v=!1;f={},l=l.remove(function(t){return"@"===t.substring(0,1)&&(f[t.substring(1)]=!0,v=!0,!0)}),!v&&(f=null),d=l.length>0}var p=t.lastIndexOf(".*"),h=-1!==p;-1!==p&&(t=t.substring(0,p)),t=e(t);for(var b=a.components,g=0,y=b.length;g<y;g++){var m=b[g];!(m&&!m.$removed&&m.$loaded&&m.path&&m.$compare(t))||d&&m.$except(l)||f&&(f.visible&&!m.visible()||f.hidden&&!m.hidden()||f.enabled&&m.find(r).is(":disabled")||f.disabled&&m.find(r).is(":enabled"))||(m.disabled||m.$dirty_disabled?c&&m.state&&c.push(m):void 0!==n?(m.state&&c.push(m),i?i._id===m._id&&(m.$dirty=n,m.$interaction(101)):(h||m.path===t)&&(m.$dirty=n,m.$interaction(101)),!1===m.$dirty&&(u=!1)):!1===m.$dirty&&(u=!1))}return $.clearPageData("dirty"),$.setPageData(o,u),!s&&state(c,1,2),u}function h(n,i,s){var d=i instanceof Array,o="valid"+n+(d?">"+i.join("|"):""),l=null;if(d&&(l=i,i=void 0),"boolean"!=typeof i&&void 0!==$[o])return $[o];var u=null;if(d){var c=!1;u={},l=l.remove(function(t){return"@"===t.substring(0,1)&&(u[t.substring(1)]=!0,c=!0,!0)}),!c&&(u=null),d=l.length>0}var f=!0,v=void 0!==i?[]:null,p=n.lastIndexOf(".*"),h=-1!==p;-1!==p&&(n=n.substring(0,p)),n=e(n);for(var b=a.components,g=0,y=b.length;g<y;g++){var m=b[g];!(m&&!m.$removed&&m.$loaded&&m.path&&m.$compare(n))||d&&m.$except(l)||u&&(u.visible&&!m.visible()||u.hidden&&!m.hidden()||u.enabled&&m.find(r).is(":disabled")||u.disabled&&m.find(r).is(":enabled"))||(m.disabled||m.$valid_disabled?v&&m.state&&v.push(m):void 0!==i?(m.state&&v.push(m),s?s._id===m._id&&(m.$valid=i,m.$interaction(102)):(h||m.path===n)&&(m.$valid=i,m.$interaction(102)),!1===m.$valid&&(f=!1)):!1===m.$valid&&(f=!1))}return $.clearPageData("valid"),$.setPageData(o,f),t.state(v,1,1),f}function $(t,e,r){var n="$jcpath";if(WATCH(t,function(r,i){var a=storages.get(n);a?a[t]=i:(a={})[t]=i,storages.put(n,a,e)}),void 0===r||r){var i=storages.get(n);i&&void 0!==i[t]&&i[t]!==b(t)&&y(t,i[t],!0)}return this}function b(t,e){if(null!=t){37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1));var r="="+t;if(o[r])return o[r](e||stores.root);if(-1===t.indexOf("?")){for(var n=s(t),i=[],a=0,d=n.length-1;a<d;a++){var l=n[a];"["!==l.substring(0,1)&&(l="."+l),i.push("if(!w"+l+")return")}var u=n[n.length-1];"["!==u.substring(0,1)&&(u="."+u);var c=new Function("w",i.join(";")+";return w"+u);return o[r]=c,c(e||MD.scope)}}}function g(t,e,r){if(null!=t){var n="+"+t;if(o[n])return o[n](i.data,e,t,d,f,r);if(-1===t.indexOf("?")){for(var a=s(t),l=[],u=[],c=0;c<a.length-1;c++){var v=a[c],p=a[c+1]&&REGISARR.test(a[c+1])?"[]":"{}",h="w"+("["===v.substring(0,1)?"":".")+v;l.push("if(typeof("+h+")!=='object'||"+h+"==null)"+h+"="+p)}for(c=0;c<a.length-1;c++)v=a[c],u.push("binders['"+v+"']&&binderbind('"+v+"','"+t+"',$ticks)");var $=a[a.length-1];u.push("binders['"+$+"']&&binderbind('"+$+"','"+t+"',$ticks)"),u.push("binders['!"+$+"']&&binderbind('!"+$+"','"+t+"',$ticks)"),"["!==$.substring(0,1)&&($="."+$);var b=new Function("w","a","b","binders","binderbind","nobind","var $ticks=Math.random().toString().substring(2,8);if(!nobind){"+l.join(";")+";var v=typeof(a)=='function'?a(MAIN.compiler.get(b)):a;w"+$+"=v}"+u.join(";")+";return a");return o[n]=b,b(i.data,e,t,d,f,r),this}t=""}}function y(t,r,n){if(t instanceof Array){for(var i=0;i<t.length;i++)y(t[i],r,n);return M}if(!(t=e(t)))return M;if(33===t.charCodeAt(0)&&(t=t.substring(1)),43===t.charCodeAt(0))return x(t=t.substring(1),r,n);if(!t)return M;var s="object"==typeof r&&!(r instanceof Array)&&null!=r,d=!0===n;if(d&&(n=1),M.skipproxy=t,g(t,r),s)return m(t,d,n,!0);var o=b(t),l=[];void 0===n&&(n=1);for(var u=a.components,c=(i=0,u.length);i<c;i++){var f=u[i];f&&!f.disabled&&!f.$removed&&f.$loaded&&f.path&&f.$compare(t)&&(f.setter&&(f.path===t?f.setter&&(f.setterX(o,t,n),f.$interaction(n)):f.setter&&(f.setterX(b(f.path),t,n),f.$interaction(n))),f.$ready||(f.$ready=!0),3!==n&&f.state&&l.push(f),d?(f.$dirty_disabled||(f.$dirty=!0),f.$valid_disabled||(f.$valid=!0,f.$validate=!1,f.validate&&(f.$valid=f.validate(o),f.$interaction(102))),findcontrol2(f)):f.validate&&!f.$valid_disabled&&f.valid(f.validate(o),!0))}for(d&&caches.clear("dirty","valid"),i=0,c=l.length;i<c;i++)l[i].stateX(n,5);return emitwatch(t,o,n),M}function m(t,r,n,s){if(t instanceof Array){for(var d=0;d<t.length;d++)m(i,t[d],r,n);return this}if(!(t=e(t)))return this;if(33===t.charCodeAt(0)&&(t=t.substring(1)),!(t=t.replaceWildcard()))return this;s||b(t,b(t));var o=[];void 0===n&&(n=1),M.skipproxy=t;for(var l=a.components,u=(d=0,l.length);d<u;d++){var c=l[d];if(c&&!c.disabled&&!c.$removed&&c.$loaded&&c.path&&c.$compare(t)){var f=c.get();c.setter&&(c.$skip=!1,c.setterX(f,t,n),c.$interaction(n)),c.$ready||(c.$ready=!0),!0===r?(c.$dirty_disabled||(c.$dirty=!0,c.$interaction(101)),c.$valid_disabled||(c.$valid=!0,c.$validate=!1,c.validate&&(c.$valid=c.validate(f),c.$interaction(102))),findcontrol2(c)):c.validate&&!c.$valid_disabled&&c.valid(c.validate(f),!0),c.state&&o.push(c)}}for(r&&clear("dirty","valid"),d=0,u=o.length;d<u;d++)o[d].stateX(1,4);return emitwatch(t,b(t),n),this}function x(t,e,r){if(t instanceof Array){for(var n=0;n<t.length;n++)x(t[n],e,r);return this}var i=b(t),a=!1;i instanceof Array||(i=[],a=!0);var s=!0;return M.skipproxy=t,e instanceof Array?e.length?i.push.apply(i,e):s=!1:i.push(e),a?y(t,i,r):s&&m(t,void 0,r),this}function k(t,e){return null==e&&(e=!0),!p(t,!e)}function _(e){var r,n=[],i=1,a=!1,s=this;!0===e&&(a=!0,e=arguments[1],i=2),e=e.env();for(var d=i;d<arguments.length;d++)n.push(arguments[d]);var l=e.charCodeAt(0);if(35===l)return r=e.substring(1),a?!events[r]&&exechelper(s,e,n):EMIT.call(s,r,n[0],n[1],n[2],n[3],n[4]),EXEC;var u=0;if(64===l){var c=e.indexOf(".");if(r=e.substring(1,c),v=plugins.find(r)){var f=v[e.substring(c+1)];t.isFunction(f)&&(f.apply(s===Window?v:s,n),u=1)}return a&&!u&&exechelper(s,e,n),EXEC}if(-1!==(c=e.indexOf("/"))){r=e.substring(0,c);var v=plugins.find(r);return f=e.substring(c+1),v&&typeof v[f]===TYPE_FN&&(v[f].apply(s===W?v:s,n),u=1),a&&!u&&exechelper(s,e,n),EXEC}return f=o.get(e),t.isFunction(f)&&(f.apply(s,n),u=1),a&&!u&&exechelper(s,e,n),_}function w(t,r,n){if(r>0)return setTimeout(function(){w(t)},r),this;t=e(t).replaceWildcard();for(var i=[],s=a.components,d=0,o=s.length;d<o;d++){var l=s[d];l&&!l.$removed&&!l.disabled&&l.$loaded&&l.path&&l.$compare(t)&&(l.state&&i.push(l),n&&n._id!==l._id||(findcontrol2(l),l.$dirty_disabled||(l.$dirty=!0,l.$interaction(101)),l.$valid_disabled||(l.$valid=!0,l.$validate=!1,l.validate&&(l.$valid=l.validate(l.get()),l.$interaction(102)))))}return clear("valid","dirty"),state(i,1,3),this}return $parser=[],nmCache={},temp={},{cache:$,can:function(t,r){return!p(t=e(t),r)&&h(t,r)},change:k,changed:function(t){return!p(t)},create:function(e){var r,i=!1;if(t.isString(e)){if(proxy[e])return proxy[e];i=!0,r=function(t){var r=e+(t?"."+t:"");M.skipproxy!==r?setTimeout(function(){M.skipproxy===r?M.skipproxy="":(function(){for(var t=arguments,e=a.components,r=Math.random().toString().substring(2,8),n=0;n<t.length;n++){var i=t[n];d[i]&&f(i,i,r)}for(var s=0,o=e.length;s<o;s++){var l=e[s];if(l&&!l.$removed&&!l.disabled&&l.$loaded&&l.path){for(var u=0,n=0;n<t.length;n++)if(l.path===t[n]){u=1;break}if(u){var c=l.get();l.setter&&l.setterX(c,l.path,1),l.state&&l.stateX(1,6),l.$interaction(1)}}}for(var n=0;n<t.length;n++)emitwatch(t[n],getx(t[n]),1)}(r),w(r))},MD.delaybinder):M.skipproxy=""}}else r=e;var s=!1,o=e&&get2(e)||{},l={get:function(t,e,r){try{return new Proxy(t[e],l)}catch(n){return Reflect.get(t,e,r)}},defineProperty:function(t,e,n){return!s&&r(e,n),Reflect.defineProperty(t,e,n)},deleteProperty:function(t,e){return!s&&r(e),Reflect.deleteProperty(t,e)},apply:function(t,e,i){if(n[t.name]){s=!0;var a=Reflect.apply(t,e,i);return r("",i[0]),s=!1,a}return Reflect.apply(t,e,i)}},u=new Proxy(o,l);return i?(M.skipproxy=e,null==getx(e)&&y(e,o,!0),proxy[e]=u):u},default:function r(n,i,s,d){if(i>0)return setTimeout(function(){r(n,0,s,d)},i),this;"boolean"==typeof s&&(d=s,s=null),void 0===d&&(d=!0);var o=(n=e(n.replaceWildcard())).replace(/\.\*$/,""),u=l["#"+HASH(o)];u&&g(o,u());for(var c=[],f=a.components,v=0,p=f.length;v<p;v++){var h=f[v];if(h&&!h.$removed&&!h.disabled&&h.$loaded&&h.path&&h.$compare(n)&&(h.state&&c.push(h),!s||s._id===h._id)){if(h.$default&&h.set(h.$default(),3),!d)return;findcontrol2(h),h.$dirty_disabled||(h.$dirty=!0),h.$valid_disabled||(h.$valid=!0,h.$validate=!1,h.validate&&(h.$valid=h.validate(h.get()),h.$interaction(102)))}}return d&&($.clearPageData("valid","dirty"),t.state(c,3,3)),this},disabled:function(t,r){return p(t=e(t),r)||!h(t,r)},errors:function(r,n,i){r instanceof Array&&(n=r,r=void 0),!0===n&&(n=i instanceof Array?i:null,i=!0);var a=[];return v(function(t){t.disabled||n&&t.$except(n)||!1!==t.$valid||t.$valid_disabled||a.push(t)},e(r)),i&&t.state(a,1,1),a},evaluate:function(t,e,r){var n="eval"+e,i=temp[n],a=null;return a=r?t:b(t),i?i.call(a,a,t):(-1===e.indexOf("return")&&(e="return "+e),i=new Function("value","path",e),temp[n]=i,i.call(a,a,t))},exec:_,exec2:function(t,e){var r=!0===t;return function(n,i,a,s){r?_(e,t,n,i,a,s):_(t,n,i,a,s)}},extend:function(r,n,i){if(r=e(r)){var a=b(r);null==a&&(a={}),y(r,t.extend(a,n),i)}return this},format:function(e,r,n){if(t.isFunction(e))return!0===r?u.unshift(e):u.push(e),M;var i=u;if(i&&i.length)for(var a=0,s=i.length;a<s;a++){var d=i[a].call(M,r,e,n);void 0!==d&&(e=d)}return e},get:b,inc:function e(r,n,i){if(r instanceof Array){for(var a=0;a<r.length;a++)e(r[a],n,i);return this}if(!r)return this;var s=b(r);return s?t.isNumber(s)||(s=parseFloat(s),isNaN(s)&&(s=0)):s=0,y(r,s+=n,i),this},invalid:function(t,r){return(t=e(t))&&(p(t,!1,r,!0),h(t,!1,r)),W},make:function(t,e,r){switch(typeof t){case"function":e=t,t={};break;case"string":var n=t,i=!0;return null==(t=b(n))&&(i=!1,t={}),e.call(t,t,n,function(e,r){y(t,e,r)}),!i||void 0!==r&&!0!==r?C.ready?g(n,t):y(n,t,!0):r(n,!0),t}return e.call(t,t,""),t},modify:function e(r,n,i){return r&&"object"==typeof r?Object.keys(r).forEach(function(t){e(t,r[t],n)}):(t.isFunction(n)&&(n=n(b(r))),y(r,n,i),i?t.setTimeout(k,i+5,r):k(r)),this},modified:function(t){var r=[];return v(function(t){t.disabled||t.$dirty_disabled||!1===t.$dirty&&r.push(t.path)},e(t)),r},parser:function(e,r,n){if(t.isFunction(e))return!0===r?$parser.unshift(e):$parser.push(e),this;var i=$parser;if(i&&i.length)for(var a=0,s=i.length;a<s;a++)e=i[a].call(this,r,e,n);return e},push:x,reset:w,rewrite:function(t,r,n){return(t=e(t))&&(M.skipproxy=t,g(t,r),emitwatch(t,r,n)),this},set:g,set2:function(t,e,r){if(null!=e){var n="++"+e;if(o[n])return o[n](t,r,e);for(var i=s(e),a=[],d=0;d<i.length-1;d++){var l=i[d],u=i[d+1]&&REGISARR.test(i[d+1])?"[]":"{}",c="w"+("["===l.substring(0,1)?"":".")+l;a.push("if(typeof("+c+")!=='object'||"+c+"==null)"+c+"="+u)}var f=i[i.length-1];"["!==f.substring(0,1)&&(f="."+f);var v=new Function("w","a","b",a.join(";")+";w"+f+"=a;return a");return o[n]=v,v(t,r,e),t}},setx:y,skip:function(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t].split(","),r=0,n=e.length;r<n;r++){var i=e[r].trim();c[i]?c[i]++:c[i]=1}},update:m,used:function(t){return v(function(t){!t.disabled&&t.used()},t),this},validate:function(t,n){var i=[],a=!0;t=e(t.replaceWildcard());var s=null;if(n){var d=!1;s={},n=n.remove(function(t){return"@"===t.substring(0,1)&&(s[t.substring(1)]=!0,d=!0,!0)}),!d&&(s=null),!n.length&&(n=null)}for(var o=M.components.all,l=0,u=o.length;l<u;l++){var c=o[l];c&&!c.$removed&&!c.disabled&&c.$loaded&&c.path&&c.$compare(t)&&(s&&(s.visible&&!c.visible()||s.hidden&&!c.hidden()||s.enabled&&c.find(r).is(":disabled")||s.disabled&&c.find(r).is(":enabled"))||(c.state&&i.push(c),c.$valid_disabled||(c.$validate=!0,c.validate&&(c.$valid=c.validate(b(c.path)),c.$interaction(102),c.$valid||(a=!1)))))}return clear("valid"),state(i,1,1),a}}}});
//# sourceMappingURL=../sourcemaps/views/storing.js.map
