/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","../utils/domx","../utils/http","../components/registry","../components/versions","../plugins"],function(e,t,n,i,r,o,a){var c=e.statics,l={fallback:"https://cdn.componentator.com/j-{0}.html",fallbackcache:"",importcache:"session",version:""},s={$:0};function m(){clear("find")}return setInterval(function(){temp={},paths={}},3e5),setInterval(function(){m()},3e5),function(a){var m=a.helper,p=(a.eventer,a.storing),u=a.scoper,f=a.binding,h=(a.componentater,!1);recompile=!1,importing=0,pending=[],initing=[],imports={},toggles=[],ready=[],caches={current:{}};var g=!1,d=[];function v(){importing?setTimeout(v,1e3):e.setTimeout2("$fallback",function(){d.splice(0).wait(function(e,t){r[e]?t():(warn("Downloading: "+e),i.importCache(l.fallback.format(e),l.fallbackcache,t))},3)},100)}function $(){var e=pending.shift();if(e)e();else if(ready&&(h=!1),l.fallback&&s.$&&!importing){for(var t=Object.keys(s),n=0;n<t.length;n++)"$"!==t[n]&&1===s[t[n]]&&(d.push(t[n].toLowerCase()),s[t[n]]=2);s.$=0,d.length&&v()}}function b(t,n,r,o){t.importing?e.wait(function(){return!0!==t.importing},function(){n(r,o)}):t.dependencies&&t.dependencies.length?(t.importing=!0,t.dependencies.wait(function(t,n){e.isFunction(t)?t(n):i.import2((-1===t.indexOf("<")?"once ":"")+t,n)},function(){t.importing=!1,n(r,o)},3)):setTimeout(function(e,t,n){e(t,n)},5,n,r,o)}function k(e,t){var i,r=e[0].tagName;n.inputable(r)?(t.$input=!0,i=t.element):i=e,m.findControl2(t,i),t.released&&t.released(t.$released),componenter.components.push(t),initing.push(t),"BODY"!==r&&m.canCompile(e[0])&&N(e),O()}function y(p,h,g,d){var v=t(h),$=p.split(/_{2,}/);if($.length?p=($=$.trim(!0))[0]:$=null,has=!0,c["$ST_"+p])n.remove(v);else{for(var y=[],N=p.split(","),O=0;O<N.length;O++){var C=!1;if(-1!==(p=N[O].trim()).indexOf("|")){for(var w=p.split("|"),T=0;T<w.length;T++){var x=w[T].trim();if(x&&r[x]){p=x,C=!0;break}}C||(p=w[0].trim())}var j=!1;if("lazy "===p.substring(0,5).toLowerCase()&&(p=p.substring(5),j=!0),!C&&-1===p.lastIndexOf("@")){var _=o.get(p);_?p+="@"+_:l.version&&(p+="@"+l.version)}var E=r[p],P=null;if(!j||!p||1!==(P=componenter.checkLazy(p)).state)if(E){1===s[p]&&(s.$--,delete s[p]);for(var S=new m.Component(E.name,a),I=h.parentNode;;){if(I.$com){var L=I.$com;S.owner=L,L.$children?L.$children++:L.$children=1;break}if("BODY"===I.nodeName)break;if(null==(I=I.parentNode))break}S.global=E.shared,S.element=v,S.dom=h;var q=m.attrcom(v,"path")||($?"null"===$[1]?"":$[1]:"")||S._id;"%"===q.substring(0,1)&&(S.$noscope=!0),S.setPath(f.pathmaker(q,!0),1),S.config={},E.config&&S.reconfigure(E.config,NOOP);var z=m.attrcom(v,"config")||($?"null"===$[2]?"":$[2]:"");for(z&&S.reconfigure(z,NOOP),S.$init||(S.$init=m.attrcom(v,"init")||null),S.type||(S.type=m.attrcom(v,"type")||""),S.id||(S.id=m.attrcom(v,"id")||S._id),S.siblings=N.length>1,S.$lazy=P,T=0;T<configs.length;T++){var D=configs[T];D.fn(S)&&S.reconfigure(D.config,NOOP)}caches.current.com=S,E.declaration.call(S,S,S.config),caches.current.com=null,$[3]&&v.attrd("jc-value",$[3]),S.init&&!c[p]&&(c[p]=!0,S.init()),h.$com=S,S.$noscope||(S.$noscope="true"===m.attrcom(v,"noscope"));var F=S.path?S.path.charCodeAt(0):0;if(!S.$noscope&&d.length&&!S.$pp){var Y=u.initscopes(d);S.path&&33!==F&&35!==F?S.setPath("?"===S.path?Y.path:-1===S.path.indexOf("?")?Y.path+"."+S.path:S.path.replace(/\?/g,Y.path),2):(S.$$path=[],S.path=""),S.scope=Y,S.pathscope=Y.path}y.push(S);var A=m.attrcom(v,"template")||S.template;if(A&&(S.template=A),"true"===m.attrcom(v,"released")&&(S.$released=!0),m.attrcom(v,"url"))warn('Components: You have to use "data-jc-template" attribute instead of "data-jc-url" for the component: {0}[{1}].'.format(S.name,S.path));else if(e.isString(A)){var B=function(t){S.prerender&&(t=S.prerender(t)),b(E,function(n,i){if(e.isFunction(n.make)){var r=caches.current.com;caches.current.com=n,n.make(t),caches.current.com=r}k(i,n)},S,v)},H=A.substring(0,1);if("."===H||"#"===H||"["===H){B(t(A).html());continue}var G="TE"+HASH(A),R=c[G];if(R){B(R);continue}t.get(m.makeurl(A),function(e){c[G]=e,B(e)})}else if(e.isString(S.make)){if(-1!==S.make.indexOf("<")){b(E,function(e,t){e.prerender&&(e.make=e.prerender(e.make)),t.html(e.make),k(t,e)},S,v);continue}t.get(makeurl(S.make),function(e){b(E,function(t,n){t.prerender&&(e=t.prerender(e)),n.html(e),k(n,t)},S,v)})}else E.dependencies?b(E,function(e,t){if(e.make){var n=caches.current.com;caches.current.com=e,e.make(),caches.current.com=n}k(t,e)},S,v):setTimeout(function(e,t,n){if(n.make){var i=caches.current.com;caches.current.com=n,n.make(),caches.current.com=i}e(t,n)},5,k,v,S)}else{s[p]||(s[p]=1,s.$++);var U=m.attrcom(v,"import");if(!U){!c["$NE_"+p]&&(c["$NE_"+p]=!0);continue}if(1===imports[U])continue;if(2===imports[U]){!c["$NE_"+p]&&(c["$NE_"+p]=!0);continue}imports[U]=1,importing++,i.import(U,function(){importing--,imports[U]=2})}}y.length>0&&(v.$com=y.length>1?y:y[0])}}function N(r,o){var s=this;if(h)recompile=!0;else{var u=[];if(u.length)for(;;){var g=u.shift();if(!g)break;g()}if(h=!0,function(){var r=[],o=0;if(m.findUrl(a.elm()).each(function(){var e=this,n=t(e);if(!e.$downloaded){e.$downloaded=1;var i=m.attrcom(n,"url"),o="once "===i.substring(0,5).toLowerCase();if("!"===i.substring(0,1)||o){if(i=o?i.substring(5):i.substring(1),c[i])return;c[i]=2}var a={};a.url=i,a.element=n,a.callback=m.attrcom(n,"init"),a.path=m.attrcom(n,"path"),a.toggle=(m.attrcom(n,"class")||"").split(" "),a.expire=m.attrcom(n,"cache")||l.importcache,r.push(a)}}),r.length){var s=!1;importing++,e.async(r,function(t,r){var a=m.makeurl(t.url);i.ajaxCache("GET "+t.url,null,function(i){if(a="$import"+a,caches.current.element=t.element[0],(i=c[a]?n.removescripts(i):n.importscripts(importstyles(i)))&&m.canCompile(i)&&(s=!0),t.element.html(i),c[a]=!0,t.toggle.length&&t.toggle[0]&&toggles.push(t),t.callback&&!m.attrcom(t.element)){var l=p.get(t.callback);e.isFunction(l)&&l(t.element)}caches.current.element=null,o++,r()},t.expire)},function(){importing--,componenter.clean(),o&&s&&N()})}}(),pending.length)pending.push(function(){N(s)});else{if(function e(n,i,r,o){if((n=n?t(n)[0]:a.elm())&&!m.nocompile(n)){if((null==r||0===r)&&(o=[],n!==a.elm())){var c=m.scope(n);c&&scopes.push(c)}var l=null,s=!!n&&m.released(n),p=null;m.scope(n)&&o.push(n),n.$jcbind||(l=m.attrbind(n))&&(p||(p=[]),p.push({el:n,b:l}));var u=m.attrcom(n);n.$com||null==u||i(u,n,0,o);var f=n.childNodes,h=[];void 0===r?r=0:r++;for(var g=0,d=f.length;g<d;g++){var v=f[g];if(v){if(!v.tagName)continue;if(m.nocompile(v))continue;void 0===v.$com&&null!=(u=m.attrcom(v))&&(s&&m.released(v,"true"),i(u||"",v,r,o)),v.$jcbind||(l=m.attrbind(v))&&(v.$jcbind=1,!p&&(p=[]),p.push({el:v,b:l})),m.nocompile(v)||v.childNodes.length&&"SCRIPT"!==v.tagName&&m.canCompile(v)&&-1===h.indexOf(v)&&h.push(v)}}for(g=0,d=h.length;g<d;g++)(v=h[g])&&e(v,i,r,o&&o.length?o:[]);if(p)for(g=0;g<p.length;g++){var $=p[g];$.el.$jcbind=parsebinder($.el,$.b,o)}}}(r,y),f.rebindbinder(),h=!1,void 0!==r||!toggles.length)return $();e.async(toggles,function(e,t){for(var n=0,i=e.toggle.length;n<i;n++)e.element.tclass(e.toggle[n]);t()},$)}}}function O(){e.setTimeout2("$ready",function(){mediaquery(),a.refresh(),function e(){var t=initing.pop();void 0===t?!ready&&N():(!t.$removed&&prepare(t),e())}();var n=componenter.components.length;if(t(document).trigger("components",[n]),g||(g=!0,caches.clear("valid","dirty","find"),topic.emit("init"),topic.emit("ready")),e.setTimeout2("$initcleaner",function(){components.cleaner();for(var e=autofill.splice(0),n=0;n<e.length;n++){var i=e[n];!i.$default&&m.findControl(i.element[0],function(e){var n=t(e).val();if(n){var r=i.parser(n);r&&i.get()!==r&&(i.dirty(!1,!0),i.set(r,0))}return!0})}},1e3),h=!1,recompile&&(recompile=!1,N()),ready){for(var i=ready,r=0,o=i.length;r<o;r++)i[r](n);ready=void 0,N(),setTimeout(N,3e3),setTimeout(N,6e3),setTimeout(N,9e3)}},100)}return{compile:N,request:O}}});
//# sourceMappingURL=../sourcemaps/views/compiler.js.map
