/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","../utils/domx","../utils/http","../components/registry","../plugins"],function(e,t,n,i,r,o){var a=e.statics,c={fallback:"https://cdn.componentator.com/j-{0}.html",fallbackcache:"",version:"v16"},l={$:0};function s(){clear("find")}return setInterval(function(){temp={},paths={}},3e5),setInterval(function(){s()},3e5),function(o){var s=o.helper,m=(o.eventer,o.storing),u=o.scoper,p=(o.componentater,!1);recompile=!1,importing=0,pending=[],initing=[],imports={},toggles=[],ready=[],lazycom={},caches={current:{}};var f=!1;function d(t,n,r,o){t.importing?e.wait(function(){return!0!==t.importing},function(){n(r,o)}):t.dependencies&&t.dependencies.length?(t.importing=!0,t.dependencies.wait(function(t,n){e.isFunction(t)?t(n):i.import2((-1===t.indexOf("<")?"once ":"")+t,n)},function(){t.importing=!1,n(r,o)},3)):setTimeout(function(e,t,n){e(t,n)},5,n,r,o)}function h(e,t){var i,r=e[0].tagName;n.inputable(r)?(t.$input=!0,i=t.element):i=e,s.findControl2(t,i),t.released&&t.released(t.$released),componenter.components.push(t),initing.push(t),"BODY"!==r&&s.canCompile(e[0])&&v(e),$()}function g(m,p,f,g){var v=t(p),$=m.split(/_{2,}/);if($.length?m=($=$.trim(!0))[0]:$=null,has=!0,a["$ST_"+m])n.remove(v);else{for(var b=[],k=m.split(","),y=0;y<k.length;y++){var N=!1;if(-1!==(m=k[y].trim()).indexOf("|")){for(var O=m.split("|"),x=0;x<O.length;x++){var C=O[x].trim();if(C&&r[C]){m=C,N=!0;break}}N||(m=O[0].trim())}var T=!1;"lazy "===m.substring(0,5).toLowerCase()&&(m=m.substring(5),T=!0),N||-1!==m.lastIndexOf("@")||(versions[m]?m+="@"+versions[m]:c.version&&(m+="@"+c.version));var j=r[m],w=null;if(T&&m){var _=m.substring(0,m.indexOf("@"));if(!(w=lazycom[m])){lazycom[m]=_&&m!==_?lazycom[_]={state:1}:{state:1};continue}if(1===w.state)continue}if(j){1===l[m]&&(l.$--,delete l[m]);for(var z=new s.Component(j.name,o),E=p.parentNode;;){if(E.$com){var P=E.$com;z.owner=P,P.$children?P.$children++:P.$children=1;break}if("BODY"===E.nodeName)break;if(null==(E=E.parentNode))break}z.global=j.shared,z.element=v,z.dom=p;var S=s.attrcom(v,"path")||($?"null"===$[1]?"":$[1]:"")||z._id;"%"===S.substring(0,1)&&(z.$noscope=!0),z.setPath(pathmaker(S,!0),1),z.config={},j.config&&z.reconfigure(j.config,NOOP);var I=s.attrcom(v,"config")||($?"null"===$[2]?"":$[2]:"");for(I&&z.reconfigure(I,NOOP),z.$init||(z.$init=s.attrcom(v,"init")||null),z.type||(z.type=s.attrcom(v,"type")||""),z.id||(z.id=s.attrcom(v,"id")||z._id),z.siblings=k.length>1,z.$lazy=w,x=0;x<configs.length;x++){var q=configs[x];q.fn(z)&&z.reconfigure(q.config,NOOP)}caches.current.com=z,j.declaration.call(z,z,z.config),caches.current.com=null,$[3]&&v.attrd("jc-value",$[3]),z.init&&!a[m]&&(a[m]=!0,z.init()),p.$com=z,z.$noscope||(z.$noscope="true"===s.attrcom(v,"noscope"));var F=z.path?z.path.charCodeAt(0):0;if(!z.$noscope&&g.length&&!z.$pp){var Y=u.initscopes(g);z.path&&33!==F&&35!==F?z.setPath("?"===z.path?Y.path:-1===z.path.indexOf("?")?Y.path+"."+z.path:z.path.replace(/\?/g,Y.path),2):(z.$$path=[],z.path=""),z.scope=Y,z.pathscope=Y.path}b.push(z);var A=s.attrcom(v,"template")||z.template;if(A&&(z.template=A),"true"===s.attrcom(v,"released")&&(z.$released=!0),s.attrcom(v,"url"))warn('Components: You have to use "data-jc-template" attribute instead of "data-jc-url" for the component: {0}[{1}].'.format(z.name,z.path));else if(e.isString(A)){var B=function(t){z.prerender&&(t=z.prerender(t)),d(j,function(n,i){if(e.isFunction(n.make)){var r=caches.current.com;caches.current.com=n,n.make(t),caches.current.com=r}h(i,n)},z,v)},D=A.substring(0,1);if("."===D||"#"===D||"["===D){B(t(A).html());continue}var H="TE"+HASH(A),L=a[H];if(L){B(L);continue}t.get(s.makeurl(A),function(e){a[H]=e,B(e)})}else if(e.isString(z.make)){if(-1!==z.make.indexOf("<")){d(j,function(e,t){e.prerender&&(e.make=e.prerender(e.make)),t.html(e.make),h(t,e)},z,v);continue}t.get(makeurl(z.make),function(e){d(j,function(t,n){t.prerender&&(e=t.prerender(e)),n.html(e),h(n,t)},z,v)})}else j.dependencies?d(j,function(e,t){if(e.make){var n=caches.current.com;caches.current.com=e,e.make(),caches.current.com=n}h(t,e)},z,v):setTimeout(function(e,t,n){if(n.make){var i=caches.current.com;caches.current.com=n,n.make(),caches.current.com=i}e(t,n)},5,h,v,z)}else{l[m]||(l[m]=1,l.$++);var G=s.attrcom(v,"import");if(!G){!a["$NE_"+m]&&(a["$NE_"+m]=!0);continue}if(1===imports[G])continue;if(2===imports[G]){!a["$NE_"+m]&&(a["$NE_"+m]=!0);continue}imports[G]=1,importing++,i.import2(G,function(){importing--,imports[G]=2})}}b.length>0&&(v.$com=b.length>1?b:b[0])}}function v(r,l){var u=this;if(p)recompile=!0;else{var f=[];if(f.length)for(;;){var d=f.shift();if(!d)break;d()}if(p=!0,function(r){var o=[],l=0;if(s.findUrl(r._elm).each(function(){var e=this,n=t(e);if(!e.$downloaded){e.$downloaded=1;var i=s.attrcom(n,"url"),r="once "===i.substring(0,5).toLowerCase();if("!"===i.substring(0,1)||r){if(i=r?i.substring(5):i.substring(1),a[i])return;a[i]=2}var l={};l.url=i,l.element=n,l.callback=s.attrcom(n,"init"),l.path=s.attrcom(n,"path"),l.toggle=(s.attrcom(n,"class")||"").split(" "),l.expire=s.attrcom(n,"cache")||c.importcache,o.push(l)}}),o.length){var u=!1;importing++,e.async(o,function(t,r){var o=s.makeurl(t.url);i.ajaxCache("GET "+t.url,null,function(i){if(o="$import"+o,caches.current.element=t.element[0],(i=a[o]?n.removescripts(i):n.importscripts(importstyles(i)))&&s.canCompile(i)&&(u=!0),t.element.html(i),a[o]=!0,t.toggle.length&&t.toggle[0]&&toggles.push(t),t.callback&&!s.attrcom(t.element)){var c=m.get(t.callback);e.isFunction(c)&&c(t.element)}caches.current.element=null,l++,r()},t.expire)},function(){importing--,componenter.clean(),l&&u&&r.compile()})}}(u),pending.length)pending.push(function(){v(u)});else{if(function e(n,i,r,a){var c=o.helper;if(o.binding,(n=n?t(n)[0]:document.body)&&!c.nocompile(n)){if((null==r||0===r)&&(a=[],n!==document.body)){var l=c.scope(n);l&&scopes.push(l)}var s=null,m=!!n&&c.released(n),u=null;c.scope(n)&&a.push(n),n.$jcbind||(s=c.attrbind(n))&&(u||(u=[]),u.push({el:n,b:s}));var p=c.attrcom(n);n.$com||null==p||i(p,n,0,a);var f=n.childNodes,d=[];void 0===r?r=0:r++;for(var h=0,g=f.length;h<g;h++){var v=f[h];if(v){if(!v.tagName)continue;if(c.nocompile(v))continue;void 0===v.$com&&null!=(p=c.attrcom(v))&&(m&&c.released(v,"true"),i(p||"",v,r,a)),v.$jcbind||(s=c.attrbind(v))&&(v.$jcbind=1,!u&&(u=[]),u.push({el:v,b:s})),c.nocompile(v)||v.childNodes.length&&"SCRIPT"!==v.tagName&&c.canCompile(v)&&-1===d.indexOf(v)&&d.push(v)}}for(h=0,g=d.length;h<g;h++)(v=d[h])&&e(v,i,r,a&&a.length?a:[]);if(u)for(h=0;h<u.length;h++){var $=u[h];$.el.$jcbind=parsebinder($.el,$.b,a)}}}(r,g),rebindbinder(),p=!1,void 0!==r||!toggles.length)return nextpending();e.async(toggles,function(e,t){for(var n=0,i=e.toggle.length;n<i;n++)e.element.tclass(e.toggle[n]);t()},nextpending)}}}function $(){e.setTimeout2("$ready",function(){mediaquery(),o.refresh(),function e(){var t=initing.pop();void 0===t?!ready&&v():(!t.$removed&&prepare(t),e())}();var n=components.length;if(t(document).trigger("components",[n]),f||(f=!0,caches.clear("valid","dirty","find"),topic.emit("init"),topic.emit("ready")),e.setTimeout2("$initcleaner",function(){components.cleaner();for(var e=autofill.splice(0),n=0;n<e.length;n++){var i=e[n];!i.$default&&findcontrol(i.element[0],function(e){var n=t(e).val();if(n){var r=i.parser(n);r&&i.get()!==r&&(i.dirty(!1,!0),i.set(r,0))}return!0})}},1e3),p=!1,recompile&&(recompile=!1,v()),ready){for(var i=ready,r=0,a=i.length;r<a;r++)i[r](n);ready=void 0,v(),setTimeout(v,3e3),setTimeout(v,6e3),setTimeout(v,9e3)}},100)}return{compile:v,request:$}}});
//# sourceMappingURL=../sourcemaps/views/compiler.js.map
