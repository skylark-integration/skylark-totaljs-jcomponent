/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","../utils/domx","../utils/http","../utils/logs","../utils/cache","../components/registry","../components/configs","../components/versions","../plugins"],function(e,t,n,i,r,o,a,c,l,s){var u=e.statics,m=r.warn,f={fallback:"https://cdn.componentator.com/j-{0}.html",fallbackcache:"",importcache:"session",version:""},p={$:0};function h(){o.clear("find")}return setInterval(function(){temp={}},3e5),setInterval(function(){h()},3e5),function(r){var o=r.helper,s=r.eventer,h=r.storing,d=r.scoper,g=r.binding,v=r.componenter,$=0,b=[],k=[],y={},N=[],O=[],C={current:{}},T={is:!1,recompile:!1},w=!1,x=[];function j(){$?setTimeout(j,1e3):e.setTimeout2("$fallback",function(){x.splice(0).wait(function(e,t){a[e]?t():(m("Downloading: "+e),i.importCache(f.fallback.format(e),f.fallbackcache,t))},3)},100)}function _(){var e=b.shift();if(e)e();else if(O&&(T.is=!1),f.fallback&&p.$&&!$){for(var t=Object.keys(p),n=0;n<t.length;n++)"$"!==t[n]&&1===p[t[n]]&&(x.push(t[n].toLowerCase()),p[t[n]]=2);p.$=0,x.length&&j()}}function E(t,n,r,o){t.importing?e.wait(function(){return!0!==t.importing},function(){n(r,o)}):t.dependencies&&t.dependencies.length?(t.importing=!0,t.dependencies.wait(function(t,n){e.isFunction(t)?t(n):i.import2((-1===t.indexOf("<")?"once ":"")+t,n)},function(){t.importing=!1,n(r,o)},3)):setTimeout(function(e,t,n){e(t,n)},5,n,r,o)}function P(e,t){var i,r=e[0].tagName;n.inputable(r)?(t.$input=!0,i=t.element):i=e,o.findControl2(t,i),t.released&&t.released(t.$released),v.components.push(t),k.push(t),"BODY"!==r&&o.canCompile(e[0])&&I(e),L()}function S(s,h,b,k){var N=t(h),O=s.split(/_{2,}/);if(O.length?s=(O=O.trim(!0))[0]:O=null,has=!0,u["$ST_"+s])n.remove(N);else{for(var T=[],w=s.split(","),x=0;x<w.length;x++){var j=!1;if(-1!==(s=w[x].trim()).indexOf("|")){for(var _=s.split("|"),S=0;S<_.length;S++){var I=_[S].trim();if(I&&a[I]){s=I,j=!0;break}}j||(s=_[0].trim())}var L=!1;if("lazy "===s.substring(0,5).toLowerCase()&&(s=s.substring(5),L=!0),!j&&-1===s.lastIndexOf("@")){var z=l.get(s);z?s+="@"+z:f.version&&(s+="@"+f.version)}var D=a[s],F=null;if(!L||!s||1!==(F=v.checkLazy(s)).state)if(D){1===p[s]&&(p.$--,delete p[s]);for(var Y=new o.Component(D.name,r),q=h.parentNode;;){if(q.$com){var A=q.$com;Y.owner=A,A.$children?A.$children++:A.$children=1;break}if("BODY"===q.nodeName)break;if(null==(q=q.parentNode))break}Y.global=D.shared,Y.element=N,Y.dom=h;var B=o.attrcom(N,"path")||(O?"null"===O[1]?"":O[1]:"")||Y._id;"%"===B.substring(0,1)&&(Y.$noscope=!0),Y.setPath(g.pathmaker(B,!0),1),Y.config={},D.config&&Y.reconfigure(D.config,NOOP);var H=o.attrcom(N,"config")||(O?"null"===O[2]?"":O[2]:"");for(H&&Y.reconfigure(H,NOOP),Y.$init||(Y.$init=o.attrcom(N,"init")||null),Y.type||(Y.type=o.attrcom(N,"type")||""),Y.id||(Y.id=o.attrcom(N,"id")||Y._id),Y.siblings=w.length>1,Y.$lazy=F,S=0;S<c.length;S++){var G=c[S];G.fn(Y)&&Y.reconfigure(G.config,NOOP)}C.current.com=Y,D.declaration.call(Y,Y,Y.config),C.current.com=null,O[3]&&N.attrd("jc-value",O[3]),Y.init&&!u[s]&&(u[s]=!0,Y.init()),h.$com=Y,Y.$noscope||(Y.$noscope="true"===o.attrcom(N,"noscope"));var R=Y.path?Y.path.charCodeAt(0):0;if(!Y.$noscope&&k.length&&!Y.$pp){var U=d.initscopes(k);Y.path&&33!==R&&35!==R?Y.setPath("?"===Y.path?U.path:-1===Y.path.indexOf("?")?U.path+"."+Y.path:Y.path.replace(/\?/g,U.path),2):(Y.$$path=[],Y.path=""),Y.scope=U,Y.pathscope=U.path}T.push(Y);var J=o.attrcom(N,"template")||Y.template;if(J&&(Y.template=J),"true"===o.attrcom(N,"released")&&(Y.$released=!0),o.attrcom(N,"url"))m('Components: You have to use "data-jc-template" attribute instead of "data-jc-url" for the component: {0}[{1}].'.format(Y.name,Y.path));else if(e.isString(J)){var K=function(t){Y.prerender&&(t=Y.prerender(t)),E(D,function(n,i){if(e.isFunction(n.make)){var r=C.current.com;C.current.com=n,n.make(t),C.current.com=r}P(i,n)},Y,N)},M=J.substring(0,1);if("."===M||"#"===M||"["===M){K(t(J).html());continue}var Q="TE"+HASH(J),V=u[Q];if(V){K(V);continue}t.get(o.makeurl(J),function(e){u[Q]=e,K(e)})}else if(e.isString(Y.make)){if(-1!==Y.make.indexOf("<")){E(D,function(e,t){e.prerender&&(e.make=e.prerender(e.make)),t.html(e.make),P(t,e)},Y,N);continue}t.get(makeurl(Y.make),function(e){E(D,function(t,n){t.prerender&&(e=t.prerender(e)),n.html(e),P(n,t)},Y,N)})}else D.dependencies?E(D,function(e,t){if(e.make){var n=C.current.com;C.current.com=e,e.make(),C.current.com=n}P(t,e)},Y,N):setTimeout(function(e,t,n){if(n.make){var i=C.current.com;C.current.com=n,n.make(),C.current.com=i}e(t,n)},5,P,N,Y)}else{p[s]||(p[s]=1,p.$++);var W=o.attrcom(N,"import");if(!W){!u["$NE_"+s]&&(u["$NE_"+s]=!0);continue}if(1===y[W])continue;if(2===y[W]){!u["$NE_"+s]&&(u["$NE_"+s]=!0);continue}y[W]=1,$++,i.import(W,function(){$--,y[W]=2})}}T.length>0&&(N.$com=T.length>1?T:T[0])}}function I(a,c){var l=this;if(T.is)T.recompile=!0;else{var s=[];if(s.length)for(;;){var m=s.shift();if(!m)break;m()}if(T.is=!0,function(){var a=[],c=0;if(o.findUrl(r.elm()).each(function(){var e=this,n=t(e);if(!e.$downloaded){e.$downloaded=1;var i=o.attrcom(n,"url"),r="once "===i.substring(0,5).toLowerCase();if("!"===i.substring(0,1)||r){if(i=r?i.substring(5):i.substring(1),u[i])return;u[i]=2}var c={};c.url=i,c.element=n,c.callback=o.attrcom(n,"init"),c.path=o.attrcom(n,"path"),c.toggle=(o.attrcom(n,"class")||"").split(" "),c.expire=o.attrcom(n,"cache")||f.importcache,a.push(c)}}),a.length){var l=!1;$++,e.async(a,function(t,r){var a=o.makeurl(t.url);i.ajaxCache("GET "+t.url,null,function(i){if(a="$import"+a,C.current.element=t.element[0],(i=u[a]?n.removescripts(i):n.importscripts(importstyles(i)))&&o.canCompile(i)&&(l=!0),t.element.html(i),u[a]=!0,t.toggle.length&&t.toggle[0]&&N.push(t),t.callback&&!o.attrcom(t.element)){var s=h.get(t.callback);e.isFunction(s)&&s(t.element)}C.current.element=null,c++,r()},t.expire)},function(){$--,v.clean(),c&&l&&I()})}}(),b.length)b.push(function(){I(l)});else{if(function e(n,i,a,c){if((n=n?t(n)[0]:r.elm())&&!o.nocompile(n)){if((null==a||0===a)&&(c=[],n!==r.elm())){var l=o.scope(n);l&&scopes.push(l)}var s=null,u=!!n&&o.released(n),m=null;o.scope(n)&&c.push(n),n.$jcbind||(s=o.attrbind(n))&&(m||(m=[]),m.push({el:n,b:s}));var f=o.attrcom(n);n.$com||null==f||i(f,n,0,c);var p=n.childNodes,h=[];void 0===a?a=0:a++;for(var d=0,v=p.length;d<v;d++){var $=p[d];if($){if(!$.tagName)continue;if(o.nocompile($))continue;void 0===$.$com&&null!=(f=o.attrcom($))&&(u&&o.released($,"true"),i(f||"",$,a,c)),$.$jcbind||(s=o.attrbind($))&&($.$jcbind=1,!m&&(m=[]),m.push({el:$,b:s})),o.nocompile($)||$.childNodes.length&&"SCRIPT"!==$.tagName&&o.canCompile($)&&-1===h.indexOf($)&&h.push($)}}for(d=0,v=h.length;d<v;d++)($=h[d])&&e($,i,a,c&&c.length?c:[]);if(m)for(d=0;d<m.length;d++){var b=m[d];b.el.$jcbind=g.parse(b.el,b.b,c)}}}(a,S),g.rebindbinder(),T.is=!1,void 0!==a||!N.length)return _();e.async(N,function(e,t){for(var n=0,i=e.toggle.length;n<i;n++)e.element.tclass(e.toggle[n]);t()},_)}}}function L(){e.setTimeout2("$ready",function(){r.refresh(),function e(){var t=k.pop();void 0===t?!O&&I():(t.$removed||v.prepare(t),e())}();var n=v.components.length;if(t(document).trigger("components",[n]),w||(w=!0,v.clean(),s.emit("init"),s.emit("ready")),e.setTimeout2("$initcleaner",function(){v.clean();for(var e=v.autofill.splice(0),n=0;n<e.length;n++){var i=e[n];!i.$default&&o.findControl(i.element[0],function(e){var n=t(e).val();if(n){var r=i.parser(n);r&&i.get()!==r&&(i.dirty(!1,!0),i.set(r,0))}return!0})}},1e3),T.is=!1,T.recompile&&(T.recompile=!1,I()),O){for(var i=O,a=0,c=i.length;a<c;a++)i[a](n);O=void 0,I(),setTimeout(I,3e3),setTimeout(I,6e3),setTimeout(I,9e3)}},100)}return e.mixin(T,{compile:I,request:L})}});
//# sourceMappingURL=../sourcemaps/views/compiler.js.map
