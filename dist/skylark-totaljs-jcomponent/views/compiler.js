/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/query","../utils/domx","../utils/http","../components/registry","../plugins"],function(e,t,n,i,r,o){var c=e.statics,a={fallback:"https://cdn.componentator.com/j-{0}.html",fallbackcache:"",version:"v16"},l={$:0};function s(){clear("find")}return setInterval(function(){temp={},paths={}},3e5),setInterval(function(){s()},3e5),function(o){var s=o.helper,m=(o.eventer,o.storing),u=o.scoper,p=(o.componentater,!1);function f(t,n,r,o){t.importing?e.wait(function(){return!0!==t.importing},function(){n(r,o)}):t.dependencies&&t.dependencies.length?(t.importing=!0,t.dependencies.wait(function(t,n){e.isFunction(t)?t(n):i.import2((-1===t.indexOf("<")?"once ":"")+t,n)},function(){t.importing=!1,n(r,o)},3)):setTimeout(function(e,t,n){e(t,n)},5,n,r,o)}function h(e,t){var i,r=e[0].tagName;n.inputable(r)?(t.$input=!0,i=t.element):i=e,s.findControl2(t,i),t.released&&t.released(t.$released),componenter.components.push(t),initing.push(t),"BODY"!==r&&s.canCompile(e[0])&&d(e),request()}function g(m,p,g,d){var v=t(p),b=m.split(/_{2,}/);if(b.length?m=(b=b.trim(!0))[0]:b=null,has=!0,c["$ST_"+m])n.remove(v);else{for(var $=[],k=m.split(","),y=0;y<k.length;y++){var N=!1;if(-1!==(m=k[y].trim()).indexOf("|")){for(var O=m.split("|"),x=0;x<O.length;x++){var C=O[x].trim();if(C&&r[C]){m=C,N=!0;break}}N||(m=O[0].trim())}var j=!1;"lazy "===m.substring(0,5).toLowerCase()&&(m=m.substring(5),j=!0),N||-1!==m.lastIndexOf("@")||(versions[m]?m+="@"+versions[m]:a.version&&(m+="@"+a.version));var w=r[m],_=null;if(j&&m){var z=m.substring(0,m.indexOf("@"));if(!(_=lazycom[m])){lazycom[m]=z&&m!==z?lazycom[z]={state:1}:{state:1};continue}if(1===_.state)continue}if(w){1===l[m]&&(l.$--,delete l[m]);for(var E=new s.Component(w.name,o),P=p.parentNode;;){if(P.$com){var T=P.$com;E.owner=T,T.$children?T.$children++:T.$children=1;break}if("BODY"===P.nodeName)break;if(null==(P=P.parentNode))break}E.global=w.shared,E.element=v,E.dom=p;var S=s.attrcom(v,"path")||(b?"null"===b[1]?"":b[1]:"")||E._id;"%"===S.substring(0,1)&&(E.$noscope=!0),E.setPath(pathmaker(S,!0),1),E.config={},w.config&&E.reconfigure(w.config,NOOP);var q=s.attrcom(v,"config")||(b?"null"===b[2]?"":b[2]:"");for(q&&E.reconfigure(q,NOOP),E.$init||(E.$init=s.attrcom(v,"init")||null),E.type||(E.type=s.attrcom(v,"type")||""),E.id||(E.id=s.attrcom(v,"id")||E._id),E.siblings=k.length>1,E.$lazy=_,x=0;x<configs.length;x++){var I=configs[x];I.fn(E)&&E.reconfigure(I.config,NOOP)}caches.current.com=E,w.declaration.call(E,E,E.config),caches.current.com=null,b[3]&&v.attrd("jc-value",b[3]),E.init&&!c[m]&&(c[m]=!0,E.init()),p.$com=E,E.$noscope||(E.$noscope="true"===s.attrcom(v,"noscope"));var F=E.path?E.path.charCodeAt(0):0;if(!E.$noscope&&d.length&&!E.$pp){var Y=u.initscopes(d);E.path&&33!==F&&35!==F?E.setPath("?"===E.path?Y.path:-1===E.path.indexOf("?")?Y.path+"."+E.path:E.path.replace(/\?/g,Y.path),2):(E.$$path=[],E.path=""),E.scope=Y,E.pathscope=Y.path}$.push(E);var A=s.attrcom(v,"template")||E.template;if(A&&(E.template=A),"true"===s.attrcom(v,"released")&&(E.$released=!0),s.attrcom(v,"url"))warn('Components: You have to use "data-jc-template" attribute instead of "data-jc-url" for the component: {0}[{1}].'.format(E.name,E.path));else if(e.isString(A)){var B=function(t){E.prerender&&(t=E.prerender(t)),f(w,function(n,i){if(e.isFunction(n.make)){var r=caches.current.com;caches.current.com=n,n.make(t),caches.current.com=r}h(i,n)},E,v)},D=A.substring(0,1);if("."===D||"#"===D||"["===D){B(t(A).html());continue}var H="TE"+HASH(A),L=c[H];if(L){B(L);continue}t.get(s.makeurl(A),function(e){c[H]=e,B(e)})}else if(e.isString(E.make)){if(-1!==E.make.indexOf("<")){f(w,function(e,t){e.prerender&&(e.make=e.prerender(e.make)),t.html(e.make),h(t,e)},E,v);continue}t.get(makeurl(E.make),function(e){f(w,function(t,n){t.prerender&&(e=t.prerender(e)),n.html(e),h(n,t)},E,v)})}else w.dependencies?f(w,function(e,t){if(e.make){var n=caches.current.com;caches.current.com=e,e.make(),caches.current.com=n}h(t,e)},E,v):setTimeout(function(e,t,n){if(n.make){var i=caches.current.com;caches.current.com=n,n.make(),caches.current.com=i}e(t,n)},5,h,v,E)}else{l[m]||(l[m]=1,l.$++);var G=s.attrcom(v,"import");if(!G){!c["$NE_"+m]&&(c["$NE_"+m]=!0);continue}if(1===imports[G])continue;if(2===imports[G]){!c["$NE_"+m]&&(c["$NE_"+m]=!0);continue}imports[G]=1,importing++,i.import2(G,function(){importing--,imports[G]=2})}}$.length>0&&(v.$com=$.length>1?$:$[0])}}function d(r,l){var u=this;if(p)recompile=!0;else{var f=[];if(f.length)for(;;){var h=f.shift();if(!h)break;h()}if(p=!0,function(r){var o=[],l=0;if(s.findUrl(r._elm).each(function(){var e=this,n=t(e);if(!e.$downloaded){e.$downloaded=1;var i=s.attrcom(n,"url"),r="once "===i.substring(0,5).toLowerCase();if("!"===i.substring(0,1)||r){if(i=r?i.substring(5):i.substring(1),c[i])return;c[i]=2}var l={};l.url=i,l.element=n,l.callback=s.attrcom(n,"init"),l.path=s.attrcom(n,"path"),l.toggle=(s.attrcom(n,"class")||"").split(" "),l.expire=s.attrcom(n,"cache")||a.importcache,o.push(l)}}),o.length){var u=!1;importing++,e.async(o,function(t,r){var o=s.makeurl(t.url);i.ajaxCache("GET "+t.url,null,function(i){if(o="$import"+o,caches.current.element=t.element[0],(i=c[o]?n.removescripts(i):n.importscripts(importstyles(i)))&&s.canCompile(i)&&(u=!0),t.element.html(i),c[o]=!0,t.toggle.length&&t.toggle[0]&&toggles.push(t),t.callback&&!s.attrcom(t.element)){var a=m.get(t.callback);e.isFunction(a)&&a(t.element)}caches.current.element=null,l++,r()},t.expire)},function(){importing--,componenter.clean(),l&&u&&r.compile()})}}(u),pending.length)pending.push(function(){d(u)});else{if(function e(n,i,r,c){var a=o.helper;if(o.binding,(n=n?t(n)[0]:document.body)&&!a.nocompile(n)){if((null==r||0===r)&&(c=[],n!==document.body)){var l=a.scope(n);l&&scopes.push(l)}var s=null,m=!!n&&a.released(n),u=null;a.scope(n)&&c.push(n),n.$jcbind||(s=a.attrbind(n))&&(u||(u=[]),u.push({el:n,b:s}));var p=a.attrcom(n);n.$com||null==p||i(p,n,0,c);var f=n.childNodes,h=[];void 0===r?r=0:r++;for(var g=0,d=f.length;g<d;g++){var v=f[g];if(v){if(!v.tagName)continue;if(a.nocompile(v))continue;void 0===v.$com&&null!=(p=a.attrcom(v))&&(m&&a.released(v,"true"),i(p||"",v,r,c)),v.$jcbind||(s=a.attrbind(v))&&(v.$jcbind=1,!u&&(u=[]),u.push({el:v,b:s})),a.nocompile(v)||v.childNodes.length&&"SCRIPT"!==v.tagName&&a.canCompile(v)&&-1===h.indexOf(v)&&h.push(v)}}for(g=0,d=h.length;g<d;g++)(v=h[g])&&e(v,i,r,c&&c.length?c:[]);if(u)for(g=0;g<u.length;g++){var b=u[g];b.el.$jcbind=parsebinder(b.el,b.b,c)}}}(r,g),rebindbinder(),p=!1,void 0!==r||!toggles.length)return nextpending();e.async(toggles,function(e,t){for(var n=0,i=e.toggle.length;n<i;n++)e.element.tclass(e.toggle[n]);t()},nextpending)}}}return recompile=!1,importing=0,pending=[],initing=[],imports={},toggles=[],ready=[],lazycom={},caches={current:{}},{compile:d,request:request}}});
//# sourceMappingURL=../sourcemaps/views/compiler.js.map
