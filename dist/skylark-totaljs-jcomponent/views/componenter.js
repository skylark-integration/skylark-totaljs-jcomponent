/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../components/extensions","../components/registry"],function(e,t,n){return function(n){var i=n.helper,a=n.storing,r=n.eventer,l=n.compiler,d=[],o={},s={dirty:{},valid:{},find:{},clear:function(e,t,n){for(var i=1;i<arguments.length;i++)this[arguments[i]]={}},get:function(e,t){this[e][t]},set:function(e,t,n){this[e][t]=n}},v={},f=0;function u(t,n,a,d){s.find;var v=!1;if(e.isFunction(n))v=!0,d=n,n=void 0;else if(e.isFunction(a)){var f=d;v=!0,d=a,a=f}if(!v){if("object"==typeof t){t instanceof jQuery||(t=$(t));var c=i.findComponent(t,"");return n?c:c[0]}var h;if(!a&&(h=t+"."+(n?0:1),c=s.get("find",h)))return c;var m=i.findComponent(null,t);return n||(m=m[0]),c=m,a||s.set("find",h,c),c}e.wait(function(){var e=u(t,n,a);return o[t]&&1===o[t].state&&(o[t].state=2,r.emit("lazy",t,!0),warn("Lazy load: "+t),l.compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var i=u(t,n);d.call(i||window,i)}},500,a)}function c(e,t){for(var n=[],r=!0===e?3:2,d=r;d<arguments.length;d++)n.push(arguments[d]);if(3===r){if(o[e=t]&&3!==o[e].state)return 1===o[e].state&&(o[e].state=2,a.emit("lazy",e,!0),warn("Lazy load: "+e),l.compile()),setTimeout(function(e){e[0]=!0,c.apply(window,e)},555,arguments),SETTER;t=arguments[2],u(e,!0,function(e){for(var i=0,a=e.length;i<a;i++){var r=e[i];typeof r[t]===TYPE_FN?r[t].apply(r,n):r[t]=n[0]}})}else{if(o[e]&&3!==o[e].state)return 1===o[e].state&&(o[e].state=2,a.emit("lazy",e,!0),warn("Lazy load: "+e),l.compile()),setTimeout(function(e){c.apply(window,e)},555,arguments),SETTER;for(var s=i.find(e,!0),v=(d=0,s.length);d<v;d++){var f=s[d];typeof f[t]===TYPE_FN?f[t].apply(f,n):f[t]=n[0]}}return this}return setInterval(function(){e.now(!0);for(var t=d,n=0,i=t.length;n<i;n++)t[n].knockknock&&t[n].knockknock(f);r.emit("knockknock",f++)},6e4),{checkLazy:function(e){var t=o[e];if(!t){var n=e.substring(0,e.indexOf("@"));t=o[e]=n&&e!==n?o[n]={state:1}:{state:1}}return t},clean:function(){var e=d,t=0;for(length=e.length;t<length;){var n=e[t++];if(n){var i=n.element;n.$removed||!i||!inDOM(i[0])||n.attr(ATTRDEL)?(r.emit("destroy",n.name,n),r.emit("component.destroy",n.name,n),delete statics["$ST_"+n.name],n.destroy&&n.destroy(),$("#css"+n.ID).remove(),"BODY"!==i[0].nodeName&&(i.off(),i.find("*").off(),i.remove()),n.$main=void 0,n.$data=null,n.dom=null,n.$removed=2,n.path=null,n.setter=null,n.setter2=null,n.getter=null,n.getter2=null,n.make=null,t--,e.splice(t,1),length=e.length,is=!0):(n.$parser&&!n.$parser.length&&(n.$parser=void 0),n.$formatter&&!n.$formatter.length&&(n.$formatter=void 0))}else t--,e.splice(t,1),length=e.length}s={dirty:{},valid:{},find:{}}},com_valid:function(t,n,i){var a=n instanceof Array,r=t+(a?">"+n.join("|"):""),l=null;a&&(l=n,n=void 0);var o=s.get("valid",r);if("boolean"!=typeof n&&void 0!==o)return o;var v=null;if(a){var f=!1;v={},l=l.remove(function(e){return"@"===e.substring(0,1)&&(v[e.substring(1)]=!0,f=!0,!0)}),!f&&(v=null),a=l.length>0}o=!0;var u=void 0!==n?[]:null,c=t.lastIndexOf(".*"),$=-1!==c;-1!==c&&(t=t.substring(0,c)),t=pathmaker(t);for(var h=d,m=0,p=h.length;m<p;m++){var g=h[m];!(g&&!g.$removed&&g.$loaded&&g.path&&g.$compare(t))||a&&g.$except(l)||v&&(v.visible&&!g.visible()||v.hidden&&!g.hidden()||v.enabled&&g.find(SELINPUT).is(":disabled")||v.disabled&&g.find(SELINPUT).is(":enabled"))||(g.disabled||g.$valid_disabled?u&&g.state&&u.push(g):void 0!==n?(g.state&&u.push(g),i?i._id===g._id&&(g.$valid=n,g.$interaction(102)):($||g.path===t)&&(g.$valid=n,g.$interaction(102)),!1===g.$valid&&(o=!1)):!1===g.$valid&&(o=!1))}return s.clear("valid"),s.set("valid",r,o),e.state(u,1,1),o},com_validate2:function(t){var n=!0;if(t.disabled)return n;if(t.$valid_disabled)return n;var i=[];return t.state&&i.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate(get(t.path)),t.$interaction(102),t.$valid||(n=!1)),s.clear("valid"),e.state(i,1,1),n},com_dirty:function(e,t,n,i){var a=s.dirty,r=t instanceof Array,l=e+(r?">"+t.join("|"):""),o=null;if(r&&(o=t,t=void 0),"boolean"!=typeof t&&void 0!==a[l])return a[l];var v=!0,f=void 0!==t?[]:null,u=null;if(r){var c=!1;u={},o=o.remove(function(e){return"@"===e.substring(0,1)&&(u[e.substring(1)]=!0,c=!0,!0)}),!c&&(u=null),r=o.length>0}var $=e.lastIndexOf(".*"),h=-1!==$;-1!==$&&(e=e.substring(0,$)),e=pathmaker(e);for(var m=d,p=0,g=m.length;p<g;p++){var b=m[p];!(b&&!b.$removed&&b.$loaded&&b.path&&b.$compare(e))||r&&b.$except(o)||u&&(u.visible&&!b.visible()||u.hidden&&!b.hidden()||u.enabled&&b.find(SELINPUT).is(":disabled")||u.disabled&&b.find(SELINPUT).is(":enabled"))||(b.disabled||b.$dirty_disabled?f&&b.state&&f.push(b):void 0!==t?(b.state&&f.push(b),n?n._id===b._id&&(b.$dirty=t,b.$interaction(101)):(h||b.path===e)&&(b.$dirty=t,b.$interaction(101)),!1===b.$dirty&&(v=!1)):!1===b.$dirty&&(v=!1))}return s.clear("dirty"),s.set("dirty",l,v),!i&&state(f,1,2),v},each:function(e,t){var n=!!t&&-1!==t.lastIndexOf("*");n&&(t=t.replace(".*",""));for(var i=d,a=0,r=0,l=i.length;r<l;r++){var o=i[r];if(o&&o.$loaded&&!o.$removed&&(!t||o.path&&o.$compare(t))&&!0===e(o,a++,n))return this}return this},find:u,notify:function(){for(var e=arguments,t=n.components,i=Math.random().toString().substring(2,8),a=0;a<e.length;a++){var r=e[a];binders[r]&&binderbind(r,r,i)}for(var l=0,d=t.length;l<d;l++){var o=t[l];if(o&&!o.$removed&&!o.disabled&&o.$loaded&&o.path){var s=0;for(a=0;a<e.length;a++)if(o.path===e[a]){s=1;break}if(s){var v=o.get();o.setter&&o.setterX(v,o.path,1),o.state&&o.stateX(1,6),o.$interaction(1)}}}for(a=0;a<e.length;a++)emitwatch(e[a],getx(e[a]),1);return this},prepare:function(n){if(n){var r=n.element;t[n.name]&&t[n.name].forEach(function(t){t.config&&n.reconfigure(t.config,e.empties.fn),t.fn.call(n,n,n.config)});var l,d=n.get();n.configure&&n.reconfigure(n.config,void 0,!0),n.$loaded=!0,n.setter?n.$prepared||(n.$prepared=!0,n.$ready=!0,(l=i.attrcom(n,"value"))&&(v[l]||(v[l]=new Function("return "+l)),n.$default=v[l],void 0===d&&(d=n.$default(),a.set(n.path,d),a.emitwatch(n.path,d,0))),n.$binded?n.$interaction(0):(n.$binded=!0,n.setterX(d,n.path,0),n.$interaction(0))):n.$binded=!0,n.validate&&!n.$valid_disabled&&(n.$valid=n.validate(n.get(),!0)),n.done&&setTimeout(n.done,20),n.state&&n.stateX(0,3),n.$init&&setTimeout(function(){var t=get(n.$init);e.isFunction(t)&&t.call(n,n),n.$init=void 0},5);var o="component";r.trigger(o),r.off(o);var f=i.attrcom(r,"class");f&&function(e){setTimeout(function(){e=e.split(" ");for(var t=r[0].$jclass||{},n=0,i=e.length;n<i;n++)t[e[n]]||(r.tclass(e[n]),t[e[n]]=!0);r[0].$jclass=t},5)}(f),n.id&&a.emit("#"+n.id,n),a.emit("@"+n.name,n),a.emit(o,n),s.clear("find"),n.$lazy&&(n.$lazy.state=3,delete n.$lazy,a.emit("lazy",n.$name,!1))}},reconfigure:function(e,t){return c(!0,e,"reconfigure",t),this},setter:c,usage:function(t,n,i,a){e.isString(n)?n=e.now(!0).add("-"+n.env()).getTime():e.isNumber(n)&&(n=Date.now()-n),e.isFunction(i)&&(a=i,i=void 0);var r=[],l=null;l=i?u("."+i,!0):d;for(var o=0;o<l.length;o++){var s=l[o];s.usage[t]>=n&&(a?a(s):r.push(s))}return a?M:r},validate:function(e,t){var n=[],i=!0;e=pathmaker(e.replaceWildcard());var a=null;if(t){var r=!1;a={},t=t.remove(function(e){return"@"===e.substring(0,1)&&(a[e.substring(1)]=!0,r=!0,!0)}),!r&&(a=null),!t.length&&(t=null)}for(var l=M.components.all,d=0,o=l.length;d<o;d++){var v=l[d];v&&!v.$removed&&!v.disabled&&v.$loaded&&v.path&&v.$compare(e)&&(a&&(a.visible&&!v.visible()||a.hidden&&!v.hidden()||a.enabled&&v.find(SELINPUT).is(":disabled")||a.disabled&&v.find(SELINPUT).is(":enabled"))||(v.state&&n.push(v),v.$valid_disabled||(v.$validate=!0,v.validate&&(v.$valid=v.validate(get(v.path)),v.$interaction(102),v.$valid||(i=!1)))))}return s.clear("valid"),state(n,1,1),i}}}});
//# sourceMappingURL=../sourcemaps/views/componenter.js.map
