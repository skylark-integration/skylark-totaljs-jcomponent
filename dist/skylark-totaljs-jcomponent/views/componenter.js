/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../components/extensions","../components/registry"],function(e,t,n){return function(n){var i=n.helper,a=n.storing,r=n.eventer,o=n.compiler,l=[],d={dirty:{},valid:{},find:{}},s={},f=0;function v(t,n,a,l){var s=d.find,f=!1;if(e.isFunction(n))f=!0,l=n,n=void 0;else if(e.isFunction(a)){var c=l;f=!0,l=a,a=c}if(!f){if("object"==typeof t){t instanceof jQuery||(t=$(t));var u=i.findComponent(t,"");return n?u:u[0]}var m;if(!a&&(u=s[m=t+"."+(n?0:1)]))return u;var p=i.findComponent(null,t);return n||(p=p[0]),u=p,a||(s[m]=u),u}e.wait(function(){var e=v(t,n,a);return lazycom[t]&&1===lazycom[t].state&&(lazycom[t].state=2,r.emit("lazy",t,!0),warn("Lazy load: "+t),o.compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var i=v(t,n);l.call(i||window,i)}},500,a)}function c(e,t){for(var n=[],r=!0===e?3:2,l=r;l<arguments.length;l++)n.push(arguments[l]);if(3===r){if(e=t,lazycom[e]&&3!==lazycom[e].state)return 1===lazycom[e].state&&(lazycom[e].state=2,a.emit("lazy",e,!0),warn("Lazy load: "+e),o.compile()),setTimeout(function(e){e[0]=!0,c.apply(window,e)},555,arguments),SETTER;t=arguments[2],v(e,!0,function(e){for(var i=0,a=e.length;i<a;i++){var r=e[i];typeof r[t]===TYPE_FN?r[t].apply(r,n):r[t]=n[0]}})}else{if(lazycom[e]&&3!==lazycom[e].state)return 1===lazycom[e].state&&(lazycom[e].state=2,a.emit("lazy",e,!0),warn("Lazy load: "+e),o.compile()),setTimeout(function(e){c.apply(window,e)},555,arguments),SETTER;for(var d=i.find(e,!0),s=(l=0,d.length);l<s;l++){var f=d[l];typeof f[t]===TYPE_FN?f[t].apply(f,n):f[t]=n[0]}}return this}return setInterval(function(){e.now(!0);for(var t=l,n=0,i=t.length;n<i;n++)t[n].knockknock&&t[n].knockknock(f);r.emit("knockknock",f++)},6e4),{clean:function(){var e=l,t=0;for(length=e.length;t<length;){var n=e[t++];if(n){var i=n.element;n.$removed||!i||!inDOM(i[0])||n.attr(ATTRDEL)?(r.emit("destroy",n.name,n),r.emit("component.destroy",n.name,n),delete statics["$ST_"+n.name],n.destroy&&n.destroy(),$("#css"+n.ID).remove(),"BODY"!==i[0].nodeName&&(i.off(),i.find("*").off(),i.remove()),n.$main=void 0,n.$data=null,n.dom=null,n.$removed=2,n.path=null,n.setter=null,n.setter2=null,n.getter=null,n.getter2=null,n.make=null,t--,e.splice(t,1),length=e.length,is=!0):(n.$parser&&!n.$parser.length&&(n.$parser=void 0),n.$formatter&&!n.$formatter.length&&(n.$formatter=void 0))}else t--,e.splice(t,1),length=e.length}d={dirty:{},valid:{},find:{}}},com_valid:function(t,n,i){var a=d.valid,r=n instanceof Array,o=t+(r?">"+n.join("|"):""),s=null;if(r&&(s=n,n=void 0),"boolean"!=typeof n&&void 0!==a[o])return a[o];var f=null;if(r){var v=!1;f={},s=s.remove(function(e){return"@"===e.substring(0,1)&&(f[e.substring(1)]=!0,v=!0,!0)}),!v&&(f=null),r=s.length>0}var c=!0,u=void 0!==n?[]:null,m=t.lastIndexOf(".*"),p=-1!==m;-1!==m&&(t=t.substring(0,m)),t=pathmaker(t);for(var $=l,h=0,g=$.length;h<g;h++){var y=$[h];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(t))||r&&y.$except(s)||f&&(f.visible&&!y.visible()||f.hidden&&!y.hidden()||f.enabled&&y.find(SELINPUT).is(":disabled")||f.disabled&&y.find(SELINPUT).is(":enabled"))||(y.disabled||y.$valid_disabled?u&&y.state&&u.push(y):void 0!==n?(y.state&&u.push(y),i?i._id===y._id&&(y.$valid=n,y.$interaction(102)):(p||y.path===t)&&(y.$valid=n,y.$interaction(102)),!1===y.$valid&&(c=!1)):!1===y.$valid&&(c=!1))}return(a=d.valid={})[o]=c,e.state(u,1,1),c},com_dirty:function(e,t,n,i){var a=d.dirty,r=t instanceof Array,o=e+(r?">"+t.join("|"):""),s=null;if(r&&(s=t,t=void 0),"boolean"!=typeof t&&void 0!==a[o])return a[o];var f=!0,v=void 0!==t?[]:null,c=null;if(r){var u=!1;c={},s=s.remove(function(e){return"@"===e.substring(0,1)&&(c[e.substring(1)]=!0,u=!0,!0)}),!u&&(c=null),r=s.length>0}var m=e.lastIndexOf(".*"),p=-1!==m;-1!==m&&(e=e.substring(0,m)),e=pathmaker(e);for(var $=l,h=0,g=$.length;h<g;h++){var y=$[h];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(e))||r&&y.$except(s)||c&&(c.visible&&!y.visible()||c.hidden&&!y.hidden()||c.enabled&&y.find(SELINPUT).is(":disabled")||c.disabled&&y.find(SELINPUT).is(":enabled"))||(y.disabled||y.$dirty_disabled?v&&y.state&&v.push(y):void 0!==t?(y.state&&v.push(y),n?n._id===y._id&&(y.$dirty=t,y.$interaction(101)):(p||y.path===e)&&(y.$dirty=t,y.$interaction(101)),!1===y.$dirty&&(f=!1)):!1===y.$dirty&&(f=!1))}return(a=d.dirty={})[o]=f,!i&&state(v,1,2),f},each:function(e,t){var n=!!t&&-1!==t.lastIndexOf("*");n&&(t=t.replace(".*",""));for(var i=l,a=0,r=0,o=i.length;r<o;r++){var d=i[r];if(d&&d.$loaded&&!d.$removed&&(!t||d.path&&d.$compare(t))&&!0===e(d,a++,n))return this}return this},find:v,notify:function(){for(var e=arguments,t=n.components,i=Math.random().toString().substring(2,8),a=0;a<e.length;a++){var r=e[a];binders[r]&&binderbind(r,r,i)}for(var o=0,l=t.length;o<l;o++){var d=t[o];if(d&&!d.$removed&&!d.disabled&&d.$loaded&&d.path){var s=0;for(a=0;a<e.length;a++)if(d.path===e[a]){s=1;break}if(s){var f=d.get();d.setter&&d.setterX(f,d.path,1),d.state&&d.stateX(1,6),d.$interaction(1)}}}for(a=0;a<e.length;a++)emitwatch(e[a],getx(e[a]),1);return this},prepare:function(n){if(n){var r=n.element;t[n.name]&&t[n.name].forEach(function(t){t.config&&n.reconfigure(t.config,e.empties.fn),t.fn.call(n,n,n.config)});var o,l=n.get();n.configure&&n.reconfigure(n.config,void 0,!0),n.$loaded=!0,n.setter?n.$prepared||(n.$prepared=!0,n.$ready=!0,(o=i.attrcom(n,"value"))&&(s[o]||(s[o]=new Function("return "+o)),n.$default=s[o],void 0===l&&(l=n.$default(),a.set(n.path,l),a.emitwatch(n.path,l,0))),n.$binded?n.$interaction(0):(n.$binded=!0,n.setterX(l,n.path,0),n.$interaction(0))):n.$binded=!0,n.validate&&!n.$valid_disabled&&(n.$valid=n.validate(n.get(),!0)),n.done&&setTimeout(n.done,20),n.state&&n.stateX(0,3),n.$init&&setTimeout(function(){var t=get(n.$init);e.isFunction(t)&&t.call(n,n),n.$init=void 0},5);var d="component";r.trigger(d),r.off(d);var f=i.attrcom(r,"class");f&&function(e){setTimeout(function(){e=e.split(" ");for(var t=r[0].$jclass||{},n=0,i=e.length;n<i;n++)t[e[n]]||(r.tclass(e[n]),t[e[n]]=!0);r[0].$jclass=t},5)}(f),n.id&&a.emit("#"+n.id,n),a.emit("@"+n.name,n),a.emit(d,n),clear("find."),n.$lazy&&(n.$lazy.state=3,delete n.$lazy,a.emit("lazy",n.$name,!1))}},reconfigure:function(e,t){return c(!0,e,"reconfigure",t),this},setter:c,usage:function(t,n,i,a){e.isString(n)?n=e.now(!0).add("-"+n.env()).getTime():e.isNumber(n)&&(n=Date.now()-n),e.isFunction(i)&&(a=i,i=void 0);var r=[],o=null;o=i?v("."+i,!0):l;for(var d=0;d<o.length;d++){var s=o[d];s.usage[t]>=n&&(a?a(s):r.push(s))}return a?M:r},validate:function(e,t){var n=[],i=!0;e=pathmaker(e.replaceWildcard());var a=null;if(t){var r=!1;a={},t=t.remove(function(e){return"@"===e.substring(0,1)&&(a[e.substring(1)]=!0,r=!0,!0)}),!r&&(a=null),!t.length&&(t=null)}for(var o=M.components.all,l=0,d=o.length;l<d;l++){var s=o[l];s&&!s.$removed&&!s.disabled&&s.$loaded&&s.path&&s.$compare(e)&&(a&&(a.visible&&!s.visible()||a.hidden&&!s.hidden()||a.enabled&&s.find(SELINPUT).is(":disabled")||a.disabled&&s.find(SELINPUT).is(":enabled"))||(s.state&&n.push(s),s.$valid_disabled||(s.$validate=!0,s.validate&&(s.$valid=s.validate(get(s.path)),s.$interaction(102),s.$valid||(i=!1)))))}return clear("valid"),state(n,1,1),i}}}});
//# sourceMappingURL=../sourcemaps/views/componenter.js.map
