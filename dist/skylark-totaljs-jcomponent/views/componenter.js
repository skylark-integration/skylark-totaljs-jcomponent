/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/domx","../utils/logs","../components/extensions","../components/registry"],function(e,t,n,i,a){var r=n.warn;return function(n){var a=n.helper,l=n.eventer,o=(n.storing,[]),d={},s={dirty:{},valid:{},find:{},clear:function(e,t,n){for(var i=1;i<arguments.length;i++)this[arguments[i]]={}},get:function(e,t){this[e][t]},set:function(e,t,n){this[e][t]=n}},v={},u=0;function f(e,t,n){e&&e.length&&setTimeout(function(){for(var i=0,a=e.length;i<a;i++)e[i].stateX(t,n)},2,e)}function c(t,i,o,v){var u=!1;if(e.isFunction(i))u=!0,v=i,i=void 0;else if(e.isFunction(o)){var f=v;u=!0,v=o,o=f}if(!u){if("object"==typeof t){t instanceof jQuery||(t=$(t));var g=a.findComponent(t,"");return i?g:g[0]}var h;if(!o&&(h=t+"."+(i?0:1),g=s.get("find",h)))return g;var m=a.findComponent(null,t);return i||(m=m[0]),g=m,o||s.set("find",h,g),g}n.storing.wait(function(){var e=c(t,i,o);return d[t]&&1===d[t].state&&(d[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),n.compiler.compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var n=c(t,i);v.call(n||window,n)}},500,o)}function g(t,i){for(var a=[],o=!0===t?3:2,s=o;s<arguments.length;s++)a.push(arguments[s]);if(3===o){if(d[t=i]&&3!==d[t].state)return 1===d[t].state&&(d[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),n.compiler.compile()),setTimeout(function(e){e[0]=!0,g.apply(window,e)},555,arguments),SETTER;i=arguments[2],c(t,!0,function(t){for(var n=0,r=t.length;n<r;n++){var l=t[n];e.isFunction(l[i])?l[i].apply(l,a):l[i]=a[0]}})}else{if(d[t]&&3!==d[t].state)return 1===d[t].state&&(d[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),n.compiler.compile()),setTimeout(function(e){g.apply(window,e)},555,arguments),SETTER;for(var v=c(t,!0),u=(s=0,v.length);s<u;s++){var f=v[s];e.isFunction(f[i])?f[i].apply(f,a):f[i]=a[0]}}return this}return setInterval(function(){e.now(!0);for(var t=o,n=0,i=t.length;n<i;n++)t[n].knockknock&&t[n].knockknock(u);l.emit("knockknock",u++)},6e4),{autofill:[],cache:s,checkLazy:function(e){var t=d[e];if(!t){var n=e.substring(0,e.indexOf("@"));t=d[e]=n&&e!==n?d[n]={state:1}:{state:1}}return t},clean:function(){var n=o,i=0;for(length=n.length;i<length;){var a=n[i++];if(a){var r=a.element;!a.$removed&&r&&t.inDOM(r[0])?(a.$parser&&!a.$parser.length&&(a.$parser=void 0),a.$formatter&&!a.$formatter.length&&(a.$formatter=void 0)):(l.emit("destroy",a.name,a),l.emit("component.destroy",a.name,a),delete e.statics["$ST_"+a.name],a.destroy&&a.destroy(),$("#css"+a.ID).remove(),"BODY"!==r[0].nodeName&&(r.off(),r.find("*").off(),r.remove()),a.$main=void 0,a.$data=null,a.dom=null,a.$removed=2,a.path=null,a.setter=null,a.setter2=null,a.getter=null,a.getter2=null,a.make=null,i--,n.splice(i,1),length=n.length,is=!0)}else i--,n.splice(i,1),length=n.length}s.clear("dirty","valid","find")},components:o,com_valid:function(e,t,i){var a=t instanceof Array,r=e+(a?">"+t.join("|"):""),l=null;a&&(l=t,t=void 0);var d=s.get("valid",r);if("boolean"!=typeof t&&void 0!==d)return d;var v=null;if(a){var u=!1;v={},l=l.remove(function(e){return"@"===e.substring(0,1)&&(v[e.substring(1)]=!0,u=!0,!0)}),!u&&(v=null),a=l.length>0}d=!0;var c=void 0!==t?[]:null,g=e.lastIndexOf(".*"),h=-1!==g;-1!==g&&(e=e.substring(0,g)),e=n.binding.pathmaker(e);for(var m=o,$=0,p=m.length;$<p;$++){var b=m[$];!(b&&!b.$removed&&b.$loaded&&b.path&&b.$compare(e))||a&&b.$except(l)||v&&(v.visible&&!b.visible()||v.hidden&&!b.hidden()||v.enabled&&b.find(SELINPUT).is(":disabled")||v.disabled&&b.find(SELINPUT).is(":enabled"))||(b.disabled||b.$valid_disabled?c&&b.state&&c.push(b):void 0!==t?(b.state&&c.push(b),i?i._id===b._id&&(b.$valid=t,b.$interaction(102)):(h||b.path===e)&&(b.$valid=t,b.$interaction(102)),!1===b.$valid&&(d=!1)):!1===b.$valid&&(d=!1))}return s.clear("valid"),s.set("valid",r,d),f(c,1,1),d},com_validate2:function(e){var t=!0;if(e.disabled)return t;if(e.$valid_disabled)return t;var n=[];return e.state&&n.push(e),e.$validate=!0,e.validate&&(e.$valid=e.validate(get(e.path)),e.$interaction(102),e.$valid||(t=!1)),s.clear("valid"),f(n,1,1),t},com_dirty:function(e,t,i,a){var r=t instanceof Array,l=e+(r?">"+t.join("|"):""),d=null;r&&(d=t,t=void 0);var v=s.get("dirty",l);if("boolean"!=typeof t&&void 0!==v)return v;v=!0;var u=void 0!==t?[]:null,c=null;if(r){var g=!1;c={},d=d.remove(function(e){return"@"===e.substring(0,1)&&(c[e.substring(1)]=!0,g=!0,!0)}),!g&&(c=null),r=d.length>0}var h=e.lastIndexOf(".*"),m=-1!==h;-1!==h&&(e=e.substring(0,h)),e=n.binding.pathmaker(e);for(var $=o,p=0,b=$.length;p<b;p++){var y=$[p];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(e))||r&&y.$except(d)||c&&(c.visible&&!y.visible()||c.hidden&&!y.hidden()||c.enabled&&y.find(SELINPUT).is(":disabled")||c.disabled&&y.find(SELINPUT).is(":enabled"))||(y.disabled||y.$dirty_disabled?u&&y.state&&u.push(y):void 0!==t?(y.state&&u.push(y),i?i._id===y._id&&(y.$dirty=t,y.$interaction(101)):(m||y.path===e)&&(y.$dirty=t,y.$interaction(101)),!1===y.$dirty&&(v=!1)):!1===y.$dirty&&(v=!1))}return s.clear("dirty"),s.set("dirty",l,v),!a&&f(u,1,2),v},each:function(e,t){var n=!!t&&-1!==t.lastIndexOf("*");n&&(t=t.replace(".*",""));for(var i=o,a=0,r=0,l=i.length;r<l;r++){var d=i[r];if(d&&d.$loaded&&!d.$removed&&(!t||d.path&&d.$compare(t))&&!0===e(d,a++,n))return this}return this},find:c,notify:function(){for(var e=arguments,t=o,n=Math.random().toString().substring(2,8),i=0;i<e.length;i++){var a=e[i];binders[a]&&binderbind(a,a,n)}for(var r=0,d=t.length;r<d;r++){var s=t[r];if(s&&!s.$removed&&!s.disabled&&s.$loaded&&s.path){var v=0;for(i=0;i<e.length;i++)if(s.path===e[i]){v=1;break}if(v){var u=s.get();s.setter&&s.setterX(u,s.path,1),s.state&&s.stateX(1,6),s.$interaction(1)}}}for(i=0;i<e.length;i++)l.emitwatch(e[i],getx(e[i]),1);return this},prepare:function(t){if(t){var r=t.element;i[t.name]&&i[t.name].forEach(function(n){n.config&&t.reconfigure(n.config,e.empties.fn),n.fn.call(t,t,t.config)});var o,d=t.get();t.configure&&t.reconfigure(t.config,void 0,!0),t.$loaded=!0,t.setter?t.$prepared||(t.$prepared=!0,t.$ready=!0,(o=a.attrcom(t,"value"))&&(v[o]||(v[o]=new Function("return "+o)),t.$default=v[o],void 0===d&&(d=t.$default(),n.storing.set(t.path,d),l.emitwatch(t.path,d,0))),t.$binded?t.$interaction(0):(t.$binded=!0,t.setterX(d,t.path,0),t.$interaction(0))):t.$binded=!0,t.validate&&!t.$valid_disabled&&(t.$valid=t.validate(t.get(),!0)),t.done&&setTimeout(t.done,20),t.state&&t.stateX(0,3),t.$init&&setTimeout(function(){var n=get(t.$init);e.isFunction(n)&&n.call(t,t),t.$init=void 0},5);var u="component";r.trigger(u),r.off(u);var f=a.attrcom(r,"class");f&&function(e){setTimeout(function(){e=e.split(" ");for(var t=r[0].$jclass||{},n=0,i=e.length;n<i;n++)t[e[n]]||(r.tclass(e[n]),t[e[n]]=!0);r[0].$jclass=t},5)}(f),t.id&&l.emit("#"+t.id,t),l.emit("@"+t.name,t),l.emit(u,t),s.clear("find"),t.$lazy&&(t.$lazy.state=3,delete t.$lazy,l.emit("lazy",t.$name,!1))}},reconfigure:function(e,t){return g(!0,e,"reconfigure",t),this},setter:g,state:f,usage:function(t,n,i,a){e.isString(n)?n=e.now(!0).add("-"+n.env()).getTime():e.isNumber(n)&&(n=Date.now()-n),e.isFunction(i)&&(a=i,i=void 0);var r=[],l=null;l=i?c("."+i,!0):o;for(var d=0;d<l.length;d++){var s=l[d];s.usage[t]>=n&&(a?a(s):r.push(s))}return a?M:r},validate:function(e,t){var i=[],a=!0;e=n.binding.pathmaker(e.replaceWildcard());var r=null;if(t){var l=!1;r={},t=t.remove(function(e){return"@"===e.substring(0,1)&&(r[e.substring(1)]=!0,l=!0,!0)}),!l&&(r=null),!t.length&&(t=null)}for(var d=o,v=0,u=d.length;v<u;v++){var c=d[v];c&&!c.$removed&&!c.disabled&&c.$loaded&&c.path&&c.$compare(e)&&(r&&(r.visible&&!c.visible()||r.hidden&&!c.hidden()||r.enabled&&c.find(SELINPUT).is(":disabled")||r.disabled&&c.find(SELINPUT).is(":enabled"))||(c.state&&i.push(c),c.$valid_disabled||(c.$validate=!0,c.validate&&(c.$valid=c.validate(get(c.path)),c.$interaction(102),c.$valid||(a=!1)))))}return s.clear("valid"),f(i,1,1),a}}}});
//# sourceMappingURL=../sourcemaps/views/componenter.js.map
