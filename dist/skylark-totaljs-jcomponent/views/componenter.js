/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/domx","../utils/logs","../components/extensions","../components/registry"],function(e,t,i,n,a){var r=i.warn;return function(i){var a=i.helper,l=i.eventer,o=(i.storing,i.compiler),d=[],s={},v={dirty:{},valid:{},find:{},clear:function(e,t,i){for(var n=1;n<arguments.length;n++)this[arguments[n]]={}},get:function(e,t){this[e][t]},set:function(e,t,i){this[e][t]=i}},u={},f=0;function c(t,i,n,d){var u=!1;if(e.isFunction(i))u=!0,d=i,i=void 0;else if(e.isFunction(n)){var f=d;u=!0,d=n,n=f}if(!u){if("object"==typeof t){t instanceof jQuery||(t=$(t));var h=a.findComponent(t,"");return i?h:h[0]}var m;if(!n&&(m=t+"."+(i?0:1),h=v.get("find",m)))return h;var g=a.findComponent(null,t);return i||(g=g[0]),h=g,n||v.set("find",m,h),h}e.wait(function(){var e=c(t,i,n);return s[t]&&1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var n=c(t,i);d.call(n||window,n)}},500,n)}function h(t,i){for(var n=[],a=!0===t?3:2,d=a;d<arguments.length;d++)n.push(arguments[d]);if(3===a){if(s[t=i]&&3!==s[t].state)return 1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),setTimeout(function(e){e[0]=!0,h.apply(window,e)},555,arguments),SETTER;i=arguments[2],c(t,!0,function(t){for(var a=0,r=t.length;a<r;a++){var l=t[a];e.isFunction(l[i])?l[i].apply(l,n):l[i]=n[0]}})}else{if(s[t]&&3!==s[t].state)return 1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),setTimeout(function(e){h.apply(window,e)},555,arguments),SETTER;for(var v=c(t,!0),u=(d=0,v.length);d<u;d++){var f=v[d];e.isFunction(f[i])?f[i].apply(f,n):f[i]=n[0]}}return this}return setInterval(function(){e.now(!0);for(var t=d,i=0,n=t.length;i<n;i++)t[i].knockknock&&t[i].knockknock(f);l.emit("knockknock",f++)},6e4),{autofill:[],cache:v,checkLazy:function(e){var t=s[e];if(!t){var i=e.substring(0,e.indexOf("@"));t=s[e]=i&&e!==i?s[i]={state:1}:{state:1}}return t},clean:function(){var e=d,i=0;for(length=e.length;i<length;){var n=e[i++];if(n){var a=n.element;!n.$removed&&a&&t.inDOM(a[0])?(n.$parser&&!n.$parser.length&&(n.$parser=void 0),n.$formatter&&!n.$formatter.length&&(n.$formatter=void 0)):(l.emit("destroy",n.name,n),l.emit("component.destroy",n.name,n),delete statics["$ST_"+n.name],n.destroy&&n.destroy(),$("#css"+n.ID).remove(),"BODY"!==a[0].nodeName&&(a.off(),a.find("*").off(),a.remove()),n.$main=void 0,n.$data=null,n.dom=null,n.$removed=2,n.path=null,n.setter=null,n.setter2=null,n.getter=null,n.getter2=null,n.make=null,i--,e.splice(i,1),length=e.length,is=!0)}else i--,e.splice(i,1),length=e.length}v.clear("dirty","valid","find")},components:d,com_valid:function(t,i,n){var a=i instanceof Array,r=t+(a?">"+i.join("|"):""),l=null;a&&(l=i,i=void 0);var o=v.get("valid",r);if("boolean"!=typeof i&&void 0!==o)return o;var s=null;if(a){var u=!1;s={},l=l.remove(function(e){return"@"===e.substring(0,1)&&(s[e.substring(1)]=!0,u=!0,!0)}),!u&&(s=null),a=l.length>0}o=!0;var f=void 0!==i?[]:null,c=t.lastIndexOf(".*"),h=-1!==c;-1!==c&&(t=t.substring(0,c)),t=pathmaker(t);for(var $=d,m=0,g=$.length;m<g;m++){var p=$[m];!(p&&!p.$removed&&p.$loaded&&p.path&&p.$compare(t))||a&&p.$except(l)||s&&(s.visible&&!p.visible()||s.hidden&&!p.hidden()||s.enabled&&p.find(SELINPUT).is(":disabled")||s.disabled&&p.find(SELINPUT).is(":enabled"))||(p.disabled||p.$valid_disabled?f&&p.state&&f.push(p):void 0!==i?(p.state&&f.push(p),n?n._id===p._id&&(p.$valid=i,p.$interaction(102)):(h||p.path===t)&&(p.$valid=i,p.$interaction(102)),!1===p.$valid&&(o=!1)):!1===p.$valid&&(o=!1))}return v.clear("valid"),v.set("valid",r,o),e.state(f,1,1),o},com_validate2:function(t){var i=!0;if(t.disabled)return i;if(t.$valid_disabled)return i;var n=[];return t.state&&n.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate(get(t.path)),t.$interaction(102),t.$valid||(i=!1)),v.clear("valid"),e.state(n,1,1),i},com_dirty:function(e,t,i,n){var a=t instanceof Array,r=e+(a?">"+t.join("|"):""),l=null;a&&(l=t,t=void 0);var o=v.get("dirty",r);if("boolean"!=typeof t&&void 0!==o)return o;o=!0;var s=void 0!==t?[]:null,u=null;if(a){var f=!1;u={},l=l.remove(function(e){return"@"===e.substring(0,1)&&(u[e.substring(1)]=!0,f=!0,!0)}),!f&&(u=null),a=l.length>0}var c=e.lastIndexOf(".*"),h=-1!==c;-1!==c&&(e=e.substring(0,c)),e=pathmaker(e);for(var $=d,m=0,g=$.length;m<g;m++){var p=$[m];!(p&&!p.$removed&&p.$loaded&&p.path&&p.$compare(e))||a&&p.$except(l)||u&&(u.visible&&!p.visible()||u.hidden&&!p.hidden()||u.enabled&&p.find(SELINPUT).is(":disabled")||u.disabled&&p.find(SELINPUT).is(":enabled"))||(p.disabled||p.$dirty_disabled?s&&p.state&&s.push(p):void 0!==t?(p.state&&s.push(p),i?i._id===p._id&&(p.$dirty=t,p.$interaction(101)):(h||p.path===e)&&(p.$dirty=t,p.$interaction(101)),!1===p.$dirty&&(o=!1)):!1===p.$dirty&&(o=!1))}return v.clear("dirty"),v.set("dirty",r,o),!n&&state(s,1,2),o},each:function(e,t){var i=!!t&&-1!==t.lastIndexOf("*");i&&(t=t.replace(".*",""));for(var n=d,a=0,r=0,l=n.length;r<l;r++){var o=n[r];if(o&&o.$loaded&&!o.$removed&&(!t||o.path&&o.$compare(t))&&!0===e(o,a++,i))return this}return this},find:c,notify:function(){for(var e=arguments,t=d,i=Math.random().toString().substring(2,8),n=0;n<e.length;n++){var a=e[n];binders[a]&&binderbind(a,a,i)}for(var r=0,o=t.length;r<o;r++){var s=t[r];if(s&&!s.$removed&&!s.disabled&&s.$loaded&&s.path){var v=0;for(n=0;n<e.length;n++)if(s.path===e[n]){v=1;break}if(v){var u=s.get();s.setter&&s.setterX(u,s.path,1),s.state&&s.stateX(1,6),s.$interaction(1)}}}for(n=0;n<e.length;n++)l.emitwatch(e[n],getx(e[n]),1);return this},prepare:function(t){if(t){var r=t.element;n[t.name]&&n[t.name].forEach(function(i){i.config&&t.reconfigure(i.config,e.empties.fn),i.fn.call(t,t,t.config)});var o,d=t.get();t.configure&&t.reconfigure(t.config,void 0,!0),t.$loaded=!0,t.setter?t.$prepared||(t.$prepared=!0,t.$ready=!0,(o=a.attrcom(t,"value"))&&(u[o]||(u[o]=new Function("return "+o)),t.$default=u[o],void 0===d&&(d=t.$default(),i.storing.set(t.path,d),l.emitwatch(t.path,d,0))),t.$binded?t.$interaction(0):(t.$binded=!0,t.setterX(d,t.path,0),t.$interaction(0))):t.$binded=!0,t.validate&&!t.$valid_disabled&&(t.$valid=t.validate(t.get(),!0)),t.done&&setTimeout(t.done,20),t.state&&t.stateX(0,3),t.$init&&setTimeout(function(){var i=get(t.$init);e.isFunction(i)&&i.call(t,t),t.$init=void 0},5);var s="component";r.trigger(s),r.off(s);var f=a.attrcom(r,"class");f&&function(e){setTimeout(function(){e=e.split(" ");for(var t=r[0].$jclass||{},i=0,n=e.length;i<n;i++)t[e[i]]||(r.tclass(e[i]),t[e[i]]=!0);r[0].$jclass=t},5)}(f),t.id&&l.emit("#"+t.id,t),l.emit("@"+t.name,t),l.emit(s,t),v.clear("find"),t.$lazy&&(t.$lazy.state=3,delete t.$lazy,l.emit("lazy",t.$name,!1))}},reconfigure:function(e,t){return h(!0,e,"reconfigure",t),this},setter:h,usage:function(t,i,n,a){e.isString(i)?i=e.now(!0).add("-"+i.env()).getTime():e.isNumber(i)&&(i=Date.now()-i),e.isFunction(n)&&(a=n,n=void 0);var r=[],l=null;l=n?c("."+n,!0):d;for(var o=0;o<l.length;o++){var s=l[o];s.usage[t]>=i&&(a?a(s):r.push(s))}return a?M:r},validate:function(e,t){var i=[],n=!0;e=pathmaker(e.replaceWildcard());var a=null;if(t){var r=!1;a={},t=t.remove(function(e){return"@"===e.substring(0,1)&&(a[e.substring(1)]=!0,r=!0,!0)}),!r&&(a=null),!t.length&&(t=null)}for(var l=d,o=0,s=l.length;o<s;o++){var u=l[o];u&&!u.$removed&&!u.disabled&&u.$loaded&&u.path&&u.$compare(e)&&(a&&(a.visible&&!u.visible()||a.hidden&&!u.hidden()||a.enabled&&u.find(SELINPUT).is(":disabled")||a.disabled&&u.find(SELINPUT).is(":enabled"))||(u.state&&i.push(u),u.$valid_disabled||(u.$validate=!0,u.validate&&(u.$valid=u.validate(get(u.path)),u.$interaction(102),u.$valid||(n=!1)))))}return v.clear("valid"),state(i,1,1),n}}}});
//# sourceMappingURL=../sourcemaps/views/componenter.js.map
