/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../utils/domx","../utils/logs","../components/extensions","../components/registry"],function(e,t,n,i,a){var r=n.warn;return function(n){var a=n.helper,l=n.eventer,o=(n.storing,n.compiler),d=[],s={},v={dirty:{},valid:{},find:{},clear:function(e,t,n){for(var i=1;i<arguments.length;i++)this[arguments[i]]={}},get:function(e,t){this[e][t]},set:function(e,t,n){this[e][t]=n}},u={},f=0;function c(e,t,n){e&&e.length&&setTimeout(function(){for(var i=0,a=e.length;i<a;i++)e[i].stateX(t,n)},2,e)}function h(t,n,i,d){var u=!1;if(e.isFunction(n))u=!0,d=n,n=void 0;else if(e.isFunction(i)){var f=d;u=!0,d=i,i=f}if(!u){if("object"==typeof t){t instanceof jQuery||(t=$(t));var c=a.findComponent(t,"");return n?c:c[0]}var g;if(!i&&(g=t+"."+(n?0:1),c=v.get("find",g)))return c;var m=a.findComponent(null,t);return n||(m=m[0]),c=m,i||v.set("find",g,c),c}e.wait(function(){var e=h(t,n,i);return s[t]&&1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),e instanceof Array?e.length>0:!!e},function(e){if(!e){var i=h(t,n);d.call(i||window,i)}},500,i)}function g(t,n){for(var i=[],a=!0===t?3:2,d=a;d<arguments.length;d++)i.push(arguments[d]);if(3===a){if(s[t=n]&&3!==s[t].state)return 1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),setTimeout(function(e){e[0]=!0,g.apply(window,e)},555,arguments),SETTER;n=arguments[2],h(t,!0,function(t){for(var a=0,r=t.length;a<r;a++){var l=t[a];e.isFunction(l[n])?l[n].apply(l,i):l[n]=i[0]}})}else{if(s[t]&&3!==s[t].state)return 1===s[t].state&&(s[t].state=2,l.emit("lazy",t,!0),r("Lazy load: "+t),o.compile()),setTimeout(function(e){g.apply(window,e)},555,arguments),SETTER;for(var v=h(t,!0),u=(d=0,v.length);d<u;d++){var f=v[d];e.isFunction(f[n])?f[n].apply(f,i):f[n]=i[0]}}return this}return setInterval(function(){e.now(!0);for(var t=d,n=0,i=t.length;n<i;n++)t[n].knockknock&&t[n].knockknock(f);l.emit("knockknock",f++)},6e4),{autofill:[],cache:v,checkLazy:function(e){var t=s[e];if(!t){var n=e.substring(0,e.indexOf("@"));t=s[e]=n&&e!==n?s[n]={state:1}:{state:1}}return t},clean:function(){var e=d,n=0;for(length=e.length;n<length;){var i=e[n++];if(i){var a=i.element;!i.$removed&&a&&t.inDOM(a[0])?(i.$parser&&!i.$parser.length&&(i.$parser=void 0),i.$formatter&&!i.$formatter.length&&(i.$formatter=void 0)):(l.emit("destroy",i.name,i),l.emit("component.destroy",i.name,i),delete statics["$ST_"+i.name],i.destroy&&i.destroy(),$("#css"+i.ID).remove(),"BODY"!==a[0].nodeName&&(a.off(),a.find("*").off(),a.remove()),i.$main=void 0,i.$data=null,i.dom=null,i.$removed=2,i.path=null,i.setter=null,i.setter2=null,i.getter=null,i.getter2=null,i.make=null,n--,e.splice(n,1),length=e.length,is=!0)}else n--,e.splice(n,1),length=e.length}v.clear("dirty","valid","find")},components:d,com_valid:function(t,i,a){var r=i instanceof Array,l=t+(r?">"+i.join("|"):""),o=null;r&&(o=i,i=void 0);var s=v.get("valid",l);if("boolean"!=typeof i&&void 0!==s)return s;var u=null;if(r){var f=!1;u={},o=o.remove(function(e){return"@"===e.substring(0,1)&&(u[e.substring(1)]=!0,f=!0,!0)}),!f&&(u=null),r=o.length>0}s=!0;var c=void 0!==i?[]:null,h=t.lastIndexOf(".*"),g=-1!==h;-1!==h&&(t=t.substring(0,h)),t=n.binding.pathmaker(t);for(var $=d,m=0,p=$.length;m<p;m++){var b=$[m];!(b&&!b.$removed&&b.$loaded&&b.path&&b.$compare(t))||r&&b.$except(o)||u&&(u.visible&&!b.visible()||u.hidden&&!b.hidden()||u.enabled&&b.find(SELINPUT).is(":disabled")||u.disabled&&b.find(SELINPUT).is(":enabled"))||(b.disabled||b.$valid_disabled?c&&b.state&&c.push(b):void 0!==i?(b.state&&c.push(b),a?a._id===b._id&&(b.$valid=i,b.$interaction(102)):(g||b.path===t)&&(b.$valid=i,b.$interaction(102)),!1===b.$valid&&(s=!1)):!1===b.$valid&&(s=!1))}return v.clear("valid"),v.set("valid",l,s),e.state(c,1,1),s},com_validate2:function(t){var n=!0;if(t.disabled)return n;if(t.$valid_disabled)return n;var i=[];return t.state&&i.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate(get(t.path)),t.$interaction(102),t.$valid||(n=!1)),v.clear("valid"),e.state(i,1,1),n},com_dirty:function(e,t,i,a){var r=t instanceof Array,l=e+(r?">"+t.join("|"):""),o=null;r&&(o=t,t=void 0);var s=v.get("dirty",l);if("boolean"!=typeof t&&void 0!==s)return s;s=!0;var u=void 0!==t?[]:null,f=null;if(r){var h=!1;f={},o=o.remove(function(e){return"@"===e.substring(0,1)&&(f[e.substring(1)]=!0,h=!0,!0)}),!h&&(f=null),r=o.length>0}var g=e.lastIndexOf(".*"),$=-1!==g;-1!==g&&(e=e.substring(0,g)),e=n.binding.pathmaker(e);for(var m=d,p=0,b=m.length;p<b;p++){var y=m[p];!(y&&!y.$removed&&y.$loaded&&y.path&&y.$compare(e))||r&&y.$except(o)||f&&(f.visible&&!y.visible()||f.hidden&&!y.hidden()||f.enabled&&y.find(SELINPUT).is(":disabled")||f.disabled&&y.find(SELINPUT).is(":enabled"))||(y.disabled||y.$dirty_disabled?u&&y.state&&u.push(y):void 0!==t?(y.state&&u.push(y),i?i._id===y._id&&(y.$dirty=t,y.$interaction(101)):($||y.path===e)&&(y.$dirty=t,y.$interaction(101)),!1===y.$dirty&&(s=!1)):!1===y.$dirty&&(s=!1))}return v.clear("dirty"),v.set("dirty",l,s),!a&&c(u,1,2),s},each:function(e,t){var n=!!t&&-1!==t.lastIndexOf("*");n&&(t=t.replace(".*",""));for(var i=d,a=0,r=0,l=i.length;r<l;r++){var o=i[r];if(o&&o.$loaded&&!o.$removed&&(!t||o.path&&o.$compare(t))&&!0===e(o,a++,n))return this}return this},find:h,notify:function(){for(var e=arguments,t=d,n=Math.random().toString().substring(2,8),i=0;i<e.length;i++){var a=e[i];binders[a]&&binderbind(a,a,n)}for(var r=0,o=t.length;r<o;r++){var s=t[r];if(s&&!s.$removed&&!s.disabled&&s.$loaded&&s.path){var v=0;for(i=0;i<e.length;i++)if(s.path===e[i]){v=1;break}if(v){var u=s.get();s.setter&&s.setterX(u,s.path,1),s.state&&s.stateX(1,6),s.$interaction(1)}}}for(i=0;i<e.length;i++)l.emitwatch(e[i],getx(e[i]),1);return this},prepare:function(t){if(t){var r=t.element;i[t.name]&&i[t.name].forEach(function(n){n.config&&t.reconfigure(n.config,e.empties.fn),n.fn.call(t,t,t.config)});var o,d=t.get();t.configure&&t.reconfigure(t.config,void 0,!0),t.$loaded=!0,t.setter?t.$prepared||(t.$prepared=!0,t.$ready=!0,(o=a.attrcom(t,"value"))&&(u[o]||(u[o]=new Function("return "+o)),t.$default=u[o],void 0===d&&(d=t.$default(),n.storing.set(t.path,d),l.emitwatch(t.path,d,0))),t.$binded?t.$interaction(0):(t.$binded=!0,t.setterX(d,t.path,0),t.$interaction(0))):t.$binded=!0,t.validate&&!t.$valid_disabled&&(t.$valid=t.validate(t.get(),!0)),t.done&&setTimeout(t.done,20),t.state&&t.stateX(0,3),t.$init&&setTimeout(function(){var n=get(t.$init);e.isFunction(n)&&n.call(t,t),t.$init=void 0},5);var s="component";r.trigger(s),r.off(s);var f=a.attrcom(r,"class");f&&function(e){setTimeout(function(){e=e.split(" ");for(var t=r[0].$jclass||{},n=0,i=e.length;n<i;n++)t[e[n]]||(r.tclass(e[n]),t[e[n]]=!0);r[0].$jclass=t},5)}(f),t.id&&l.emit("#"+t.id,t),l.emit("@"+t.name,t),l.emit(s,t),v.clear("find"),t.$lazy&&(t.$lazy.state=3,delete t.$lazy,l.emit("lazy",t.$name,!1))}},reconfigure:function(e,t){return g(!0,e,"reconfigure",t),this},setter:g,state:c,usage:function(t,n,i,a){e.isString(n)?n=e.now(!0).add("-"+n.env()).getTime():e.isNumber(n)&&(n=Date.now()-n),e.isFunction(i)&&(a=i,i=void 0);var r=[],l=null;l=i?h("."+i,!0):d;for(var o=0;o<l.length;o++){var s=l[o];s.usage[t]>=n&&(a?a(s):r.push(s))}return a?M:r},validate:function(e,t){var i=[],a=!0;e=n.binding.pathmaker(e.replaceWildcard());var r=null;if(t){var l=!1;r={},t=t.remove(function(e){return"@"===e.substring(0,1)&&(r[e.substring(1)]=!0,l=!0,!0)}),!l&&(r=null),!t.length&&(t=null)}for(var o=d,s=0,u=o.length;s<u;s++){var f=o[s];f&&!f.$removed&&!f.disabled&&f.$loaded&&f.path&&f.$compare(e)&&(r&&(r.visible&&!f.visible()||r.hidden&&!f.hidden()||r.enabled&&f.find(SELINPUT).is(":disabled")||r.disabled&&f.find(SELINPUT).is(":enabled"))||(f.state&&i.push(f),f.$valid_disabled||(f.$validate=!0,f.validate&&(f.$valid=f.validate(get(f.path)),f.$interaction(102),f.$valid||(a=!1)))))}return v.clear("valid"),c(i,1,1),a}}}});
//# sourceMappingURL=../sourcemaps/views/componenter.js.map
