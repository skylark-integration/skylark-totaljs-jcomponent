/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/findFormat"],function(t,n){var e=" + ";return function(r){var i={};function o(r,a,l,s,u){if(-1!==r.indexOf(e)){for(var c=r.split(e).trim(),h=0;h<c.length;h++)o(c[h],a,l,s,u);return this}var g=!0;"^"===r.substring(0,1)&&(g=!1,r=r.substring(1));var v=null,m=r.indexOf("#");m&&(v=r.substring(0,m).trim(),r=r.substring(m+1).trim()),t.isFunction(a)?(l=a,a="watch"===r?"*":""):a=a.replace(".*","");var x={name:r,fn:l,owner:v||current_owner,context:u||(null==current_com?void 0:current_com)};if("watch"===r){c=[];var p=n(a);if(p&&(a=p.path,x.format=p.fn),"."===a.substring(a.length-1)&&(a=a.substring(0,a.length-1)),37===a.charCodeAt(0)&&(a="jctmp."+a.substring(1)),33===(a=a.env()).charCodeAt(0))a=a.substring(1),c.push(a);else for(var d=a.split("."),b=[],w=0;w<d.length;w++){var O=d[w].lastIndexOf("[");if(-1!==O){var $=b.join(".");c.push($+($?".":"")+d[w].substring(0,O))}b.push(d[w]),c.push(b.join("."))}x.path=a,x.$path=c,g?f.push(x):f.unshift(x),s&&l.call(u||M,a,x.format?x.format(get(a),a,0):get(a),0)}else i[r]?g?i[r].push(x):i[r].unshift(x):i[r]=[x];return this}function a(t,e,r){if(-1!==t.indexOf("+")){for(var o=t.split("+").trim(),l=0;l<o.length;l++)a(o[l],e,r);return this}lang.isFunction(e)&&(r=e,e=""),void 0===e&&(e="");var s=null,u=t.indexOf("#");if(u&&(s=t.substring(0,u).trim(),t=t.substring(u+1).trim()),e){e=e.replace(".*","").trim();var c=n(e);c&&(e=c.path),"."===e.substring(e.length-1)&&(e=e.substring(0,e.length-1))}var h=0;!s||e||r||t?s&&t&&!r&&!e?h=2:s&&t&&e?h=3:s&&t&&e&&r?h=4:t&&e&&r?h=5:t&&e?h=7:r&&(h=6):h=1;var g=function(n,i){return n.remove(function(n){return!(h>2&&h<5&&n.path!==e)&&(1===h?n.owner===s:2===h?i===t&&n.owner===s:3===h?i===t&&n.owner===s:4===h?i===t&&n.owner===s&&n.fn===r:5===h||6===h?i===t&&n.fn===r:6===h?n.fn===r:7===h?i===t&&n.path===e:i===t)})};return Object.keys(i).forEach(function(t){i[t]=g(i[t],t),i[t].length||delete i[t]}),f=g(f,"watch"),this}var f=[];return{clean:function(){for(topic.each(function(t,n){for(index=0;;){var e=n[index++];if(void 0===e)break;null==e.context||e.context.element&&inDOM(e.context.element[0])||(e.context&&e.context.element&&e.context.element.remove(),e.context.$removed=!0,e.context=null,n.splice(index-1,1),n.length||delete i[t],index-=2,is=!0)}}),index=0;;){var t=f[index++];if(void 0===t)break;null==t.context||t.context.element&&inDOM(t.context.element[0])||(t.context&&t.context.element&&t.context.element.remove(),t.context.$removed=!0,t.context=null,f.splice(index-1,1),index-=2,is=!0)}},on:o,off:a,emit:function(t){var n=i[t];if(!n)return!1;for(var e=[],r=1,o=arguments.length;r<o;r++)e.push(arguments[r]);for(r=0,o=n.length;r<o;r++){var a=n[r].context;(void 0===a||null!==a&&!a.$removed)&&n[r].fn.apply(a||window,e)}return!0},watch:function n(r,i,a){if(-1!==r.indexOf(e)){for(var f=r.split(e).trim(),l=0;l<f.length;l++)n(f[l],i,a);return this}t.isFunction(r)&&(a=i,i=r,r="*");var s="";return"^"===r.substring(0,1)&&(r=r.substring(1),s="^"),o(s+"watch",r=pathmaker(r,!0),i,a),this},unwatch:function t(n,r){if(-1!==n.indexOf(e)){for(var i=n.split(e).trim(),o=0;o<i.length;o++)t(i[o],r);return this}return a("watch",n,r)},emitwatch:function(t,n,e){for(var i=0,o=f.length;i<o;i++){var a=f[i];if("*"===a.path)a.fn.call(a.context,t,a.format?a.format(n,t,e):n,e);else if(t.length>a.path.length){var l=t.lastIndexOf(".",a.path.length);if(-1!==l&&a.path===t.substring(0,l)){var s=get(a.path);a.fn.call(a.context,t,a.format?a.format(s,t,e):s,e)}}else for(var u=0,c=a.$path.length;u<c;u++)if(a.$path[u]===t){s=r.storing.get(a.path),a.fn.call(a.context,t,a.format?a.format(s,t,e):s,e);break}}}}}});
//# sourceMappingURL=../sourcemaps/views/eventer.js.map
