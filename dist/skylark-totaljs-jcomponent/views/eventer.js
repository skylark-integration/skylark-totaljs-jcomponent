/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/findFormat"],function(t,n){var e=" + ";return function(r){var i={};function a(r,o,l,s,u){if(-1!==r.indexOf(e)){for(var c=r.split(e).trim(),h=0;h<c.length;h++)a(c[h],o,l,s,u);return this}var g=!0;"^"===r.substring(0,1)&&(g=!1,r=r.substring(1));var v=null,m=r.indexOf("#");m&&(v=r.substring(0,m).trim(),r=r.substring(m+1).trim()),t.isFunction(o)?(l=o,o="watch"===r?"*":""):o=o.replace(".*","");var x={name:r,fn:l,owner:v,context:u};if("watch"===r){c=[];var p=n(o);if(p&&(o=p.path,x.format=p.fn),"."===o.substring(o.length-1)&&(o=o.substring(0,o.length-1)),37===o.charCodeAt(0)&&(o="jctmp."+o.substring(1)),33===(o=o.env()).charCodeAt(0))o=o.substring(1),c.push(o);else for(var d=o.split("."),b=[],w=0;w<d.length;w++){var O=d[w].lastIndexOf("[");if(-1!==O){var $=b.join(".");c.push($+($?".":"")+d[w].substring(0,O))}b.push(d[w]),c.push(b.join("."))}x.path=o,x.$path=c,g?f.push(x):f.unshift(x),s&&l.call(u||M,o,x.format?x.format(get(o),o,0):get(o),0)}else i[r]?g?i[r].push(x):i[r].unshift(x):i[r]=[x];return this}function o(t,e,r){if(-1!==t.indexOf("+")){for(var a=t.split("+").trim(),l=0;l<a.length;l++)o(a[l],e,r);return this}lang.isFunction(e)&&(r=e,e=""),void 0===e&&(e="");var s=null,u=t.indexOf("#");if(u&&(s=t.substring(0,u).trim(),t=t.substring(u+1).trim()),e){e=e.replace(".*","").trim();var c=n(e);c&&(e=c.path),"."===e.substring(e.length-1)&&(e=e.substring(0,e.length-1))}var h=0;!s||e||r||t?s&&t&&!r&&!e?h=2:s&&t&&e?h=3:s&&t&&e&&r?h=4:t&&e&&r?h=5:t&&e?h=7:r&&(h=6):h=1;var g=function(n,i){return n.remove(function(n){return!(h>2&&h<5&&n.path!==e)&&(1===h?n.owner===s:2===h?i===t&&n.owner===s:3===h?i===t&&n.owner===s:4===h?i===t&&n.owner===s&&n.fn===r:5===h||6===h?i===t&&n.fn===r:6===h?n.fn===r:7===h?i===t&&n.path===e:i===t)})};return Object.keys(i).forEach(function(t){i[t]=g(i[t],t),i[t].length||delete i[t]}),f=g(f,"watch"),this}var f=[];return{clean:function(){for(topic.each(function(t,n){for(index=0;;){var e=n[index++];if(void 0===e)break;null==e.context||e.context.element&&inDOM(e.context.element[0])||(e.context&&e.context.element&&e.context.element.remove(),e.context.$removed=!0,e.context=null,n.splice(index-1,1),n.length||delete i[t],index-=2,is=!0)}}),index=0;;){var t=f[index++];if(void 0===t)break;null==t.context||t.context.element&&inDOM(t.context.element[0])||(t.context&&t.context.element&&t.context.element.remove(),t.context.$removed=!0,t.context=null,f.splice(index-1,1),index-=2,is=!0)}},on:a,off:o,emit:function(t){var n=i[t];if(!n)return!1;for(var e=[],r=1,a=arguments.length;r<a;r++)e.push(arguments[r]);for(r=0,a=n.length;r<a;r++){var o=n[r].context;(void 0===o||null!==o&&!o.$removed)&&n[r].fn.apply(o||window,e)}return!0},watch:function n(r,i,o){if(-1!==r.indexOf(e)){for(var f=r.split(e).trim(),l=0;l<f.length;l++)n(f[l],i,o);return this}t.isFunction(r)&&(o=i,i=r,r="*");var s="";return"^"===r.substring(0,1)&&(r=r.substring(1),s="^"),a(s+"watch",r=pathmaker(r,!0),i,o),this},unwatch:function t(n,r){if(-1!==n.indexOf(e)){for(var i=n.split(e).trim(),a=0;a<i.length;a++)t(i[a],r);return this}return o("watch",n,r)},emitwatch:function(t,n,e){for(var i=0,a=f.length;i<a;i++){var o=f[i];if("*"===o.path)o.fn.call(o.context,t,o.format?o.format(n,t,e):n,e);else if(t.length>o.path.length){var l=t.lastIndexOf(".",o.path.length);if(-1!==l&&o.path===t.substring(0,l)){var s=get(o.path);o.fn.call(o.context,t,o.format?o.format(s,t,e):s,e)}}else for(var u=0,c=o.$path.length;u<c;u++)if(o.$path[u]===t){s=r.storing.get(o.path),o.fn.call(o.context,t,o.format?o.format(s,t,e):s,e);break}}}}}});
//# sourceMappingURL=../sourcemaps/views/eventer.js.map
