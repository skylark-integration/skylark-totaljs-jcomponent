/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["./langx","../utils/domx","../utils/query","./jc","./components/Usage","./utils/cache","./components/Component"],function(t,e,n,a,r,i,o){var l=a,s=o.components=[],u={},c="input,textarea,select";function f(t,e,n){setTimeout(function(){EXEC.call(t,!0,e,n[0],n[1],n[2],n[3],n[4],n[5],n[6])},200)}function d(t,e,n,a){var r=e instanceof Array,o="dirty"+t+(r?">"+e.join("|"):""),l=null;if(r&&(l=e,e=void 0),"boolean"!=typeof e&&void 0!==i[o])return i[o];var u=!0,f=void 0!==e?[]:null,d=null;if(r){var p=!1;d={},l=l.remove(function(t){return"@"===t.substring(0,1)&&(d[t.substring(1)]=!0,p=!0,!0)}),!p&&(d=null),r=l.length>0}var v=t.lastIndexOf(".*"),h=-1!==v;-1!==v&&(t=t.substring(0,v)),t=pathmaker(t);for(var m=s,y=0,g=m.length;y<g;y++){var $=m[y];!($&&!$.$removed&&$.$loaded&&$.path&&$.$compare(t))||r&&$.$except(l)||(d&&(d.visible&&!$.visible()||d.hidden&&!$.hidden()||d.enabled&&$.find(c).is(":disabled")||d.disabled&&$.find(c).is(":enabled"))||($.disabled||$.$dirty_disabled?f&&$.state&&f.push($):void 0!==e?($.state&&f.push($),n?n._id===$._id&&($.$dirty=e,$.$interaction(101)):(h||$.path===t)&&($.$dirty=e,$.$interaction(101)),!1===$.$dirty&&(u=!1)):!1===$.$dirty&&(u=!1)))}return i.clearPageData("dirty"),i.setPageData(o,u),!a&&state(f,1,2),u}function p(t,e,n){for(var a,r=e?e.split(" "):EMPTYARRAY,i="",o="",l="",u="",c=0,f=r.length;c<f;c++)switch(r[c].substring(0,1)){case"*":break;case".":i=r[c].substring(1);break;case"#":-1!==(a=(l=r[c].substring(1)).indexOf("["))&&(i=l.substring(a+1,l.length-1).trim(),l=l.substring(0,a));break;default:-1!==(a=(o=r[c]).indexOf("["))&&(i=o.substring(a+1,o.length-1).trim(),o=o.substring(0,a)),-1!==(a=o.lastIndexOf("@"))&&(u=o.substring(a+1),o=o.substring(0,a))}var d=n?void 0:[];if(t){var p=!1;t.find("[data-jc]").each(function(){var t=this.$com;p||!t||!t.$loaded||t.$removed||l&&t.id!==l||o&&t.$name!==o||u&&t.$version!==u||i&&(t.$pp||t.path!==i&&(!t.pathscope||t.pathscope+"."+i!==t.path))||(n?!1===n(t)&&(p=!0):d.push(t))})}else for(c=0,f=s.length;c<f;c++){var v=s[c];if(!(!v||!v.$loaded||v.$removed||l&&v.id!==l||o&&v.$name!==o||u&&v.$version!==u||i&&(v.$pp||v.path!==i&&(!v.pathscope||v.pathscope+"."+i!==v.path))))if(n){if(!1===n(v))break}else d.push(v)}return d}function v(t,n){t.$inputcontrol&&t.$inputcontrol%2!=0?t.$inputcontrol++:function t(n,a,r){var i=n.childNodes;var o=[];e.inputable(n)&&a(n);null==r?r=0:r++;for(var l=0,s=i.length;l<s;l++){var u=i[l];if(u&&u.tagName&&(u.childNodes.length&&"SCRIPT"!==u.tagName&&null==u.getAttribute("data-jc")&&o.push(u),e.inputable(u)&&null!=u.getAttribute("data-jc-bind")&&!1===a(u)))return}for(var l=0,s=o.length;l<s;l++)if((u=o[l])&&!1===t(u,a,r))return}((n||t.element)[0],function(e){e.$com&&e.$com===t||(e.$com=t,t.$inputcontrol=1)})}function h(t,e){for(var n=[],a=!0===t?3:2,r=a;r<arguments.length;r++)n.push(arguments[r]);if(3===a){if(t=e,lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){t[0]=!0,W.SETTER.apply(W,t)},555,arguments),SETTER;e=arguments[2],FIND(t,!0,function(t){for(var a=0,r=t.length;a<r;a++){var i=t[a];typeof i[e]===TYPE_FN?i[e].apply(i,n):i[e]=n[0]}})}else{if(lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){W.SETTER.apply(W,t)},555,arguments),SETTER;for(var i=FIND(t,!0),o=(r=0,i.length);r<o;r++){var l=i[r];typeof l[e]===TYPE_FN?l[e].apply(l,n):l[e]=n[0]}}return SETTER}function m(e){var n,a=[],r=1,i=!1,o=this;!0===e&&(i=!0,e=arguments[1],r=2),e=e.env();for(var l=r;l<arguments.length;l++)a.push(arguments[l]);var s=e.charCodeAt(0);if(35===s)return n=e.substring(1),i?!events[n]&&f(o,e,a):EMIT.call(o,n,a[0],a[1],a[2],a[3],a[4]),EXEC;var u=0;if(64===s){var c=e.indexOf(".");if(n=e.substring(1,c),p=plugins.find(n)){var d=p[e.substring(c+1)];t.isFunction(d)&&(d.apply(o===Window?p:o,a),u=1)}return i&&!u&&f(o,e,a),EXEC}if(-1!==(c=e.indexOf("/"))){n=e.substring(0,c);var p=plugins.find(n);d=e.substring(c+1);return p&&typeof p[d]===TYPE_FN&&(p[d].apply(o===W?p:o,a),u=1),i&&!u&&f(o,e,a),EXEC}d=paths.get(e);return t.isFunction(d)&&(d.apply(o,a),u=1),i&&!u&&f(o,e,a),m}n.fn.FIND=function(e,n,a,r){t.isFunction(n)&&(r=a,a=n,n=void 0);var i=this,o=p(i,e);return t.isFunction(a)?o.length?(a.call(o,o),i):(WAIT(function(){var t=i.FIND(e,n);return t instanceof Array?t.length>0:!!t},function(t){if(!t){var r=i.FIND(e,n);a.call(r||W,r)}},500,r),i):n?o:o[0]},n.fn.SETTER=function(t,e){for(var a=this,r=[],i=!0===t?3:2,o=i;o<arguments.length;o++)r.push(arguments[o]);if(3===i){if(t=e,e=arguments[2],lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){n.fn.SETTER.apply(a,t)},555,arguments),a;a.FIND(t,!0,function(t){for(var n=0,a=t.length;n<a;n++){var i=t[n];typeof i[e]===TYPE_FN?i[e].apply(i,r):i[e]=r[0]}})}else{if(lazycom[t]&&3!==lazycom[t].state)return 1===lazycom[t].state&&(lazycom[t].state=2,EMIT("lazy",t,!0),warn("Lazy load: "+t),compile()),setTimeout(function(t){n.fn.SETTER.apply(a,t)},555,arguments),a;for(var l=a.FIND(t,!0),s=(o=0,l.length);o<s;o++){var u=l[o];typeof u[e]===TYPE_FN?u[e].apply(u,r):u[e]=r[0]}}return a},n.fn.RECONFIGURE=function(t,e){return this.SETTER(t,"reconfigure",e)},l.$formatter=[],W.FORMATTER=l.formatter=function(e,n,a){if(t.isFunction(e))return!l.$formatter&&(l.$formatter=[]),!0===n?l.$formatter.unshift(e):l.$formatter.push(e),l;var r=l.$formatter;if(r&&r.length)for(var i=0,o=r.length;i<o;i++){var s=r[i].call(l,n,e,a);void 0!==s&&(e=s)}return e},n.fn.component=function(){return e.findInstance(this,"$com")},n.fn.components=function(t){var e=helper.nested(this),n=null;return e.forEach(function(e){if(e instanceof Array)e.forEach(function(e){if(e&&e.$ready&&!e.$removed){if(t)return t.call(e,index);n||(n=[]),n.push(e)}});else if(e&&e.$ready&&!e.$removed){if(t)return t.call(e,index);n||(n=[]),n.push(e)}}),t?e:n},t.mixin(s,{add:function(t,e){if((e instanceof COM||e instanceof Scope||e instanceof Plugin)&&(e=e.element),t instanceof Array)for(var a=0;a<t.length;a++)ADD(t[a],e);else n(e||document.body).append('<div data-jc="{0}"></div>'.format(t)),setTimeout2("ADD",COMPILE,10)},attrcom:attrcom,exec:m,exec2:function(t,e){var n=!0===t;return function(a,r,i,o){n?m(e,t,a,r,i,o):m(t,a,r,i,o)}}});i={};return a.views={components:s,changed:function(t){return!d(t)},change:function(t,e){return null==e&&(e=!0),!d(t,!e)},cleaner:cleaner,cleaner2:cleaner2,default2:function e(n,a,r,o){if(a>0)return setTimeout(function(){e(n,0,r,o)},a),this;"boolean"==typeof r&&(o=r,r=null),void 0===o&&(o=!0);var l,u=(n=paths.pathmaker(n.replaceWildcard())).replace(/\.\*$/,""),c=defaults["#"+HASH(u)];c&&(l=c(),set(u,l));for(var f=[],d=s,p=0,h=d.length;p<h;p++){var m=d[p];if(m&&!m.$removed&&!m.disabled&&m.$loaded&&m.path&&m.$compare(n)&&(m.state&&f.push(m),!r||r._id===m._id)){if(m.$default&&m.set(m.$default(),3),!o)return;v(m),m.$dirty_disabled||(m.$dirty=!0),m.$valid_disabled||(m.$valid=!0,m.$validate=!1,m.validate&&(m.$valid=m.validate(m.get()),m.$interaction(102)))}}return o&&(i.clearPageData("valid","dirty"),t.state(f,3,3)),this},each:each,find:function(e,a,r,o){var l=!1;if(t.isFunction(a))l=!0,o=a,a=void 0;else if(t.isFunction(r)){var s=o;l=!0,o=r,r=s}if(!l){if("object"==typeof e){e instanceof jQuery||(e=n(e));var u=p(e,"");return a?u:u[0]}var c;if(!r&&(u=i[c="find."+e+"."+(a?0:1)]))return u;var f=p(null,e);return a||(f=f[0]),u=f,r||(i[c]=u),u}t.isWaiting(function(){var t=FIND(e,a,r);return lazycom[e]&&1===lazycom[e].state&&(lazycom[e].state=2,topic.emit("lazy",e,!0),warn("Lazy load: "+e),compile()),t instanceof Array?t.length>0:!!t},function(t){if(!t){var n=FIND(e,a);o.call(n||W,n)}},500,r)},refresh:refresh,reset:reset,setter:h,usage:function(e,n,a,r){var i=typeof n;i===TYPE_S?n=t.now(!0).add("-"+n.env()).getTime():i===TYPE_N&&(n=Date.now()-n),typeof a===TYPE_FN&&(r=a,a=void 0);var o=[],u=null;u=a?FIND("."+a,!0):s;for(var c=0;c<u.length;c++){var f=u[c];f.usage[e]>=n&&(r?r(f):o.push(f))}return r?l:o},version:function(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t].split(","),n=0;n<e.length;n++){var a=e[n].trim(),r=a.indexOf("@");if(-1!==r){var i=a.substring(r+1);a=a.substring(0,r),i&&(u[a]=i)}}},extend:extend,extend2:extend2,inc:inc,inc2:inc2,push:push,push2:push2,update:update,update2:update2}});
//# sourceMappingURL=sourcemaps/components.js.map
