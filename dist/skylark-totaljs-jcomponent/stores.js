/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["skylark-langx/langx","./jc","./utils/cache"],function(t,e,r){var n={},i={};function a(t,e){if(null!=t){37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1));var r="="+t;if(i[r])return i[r](e||n.root);if(-1===t.indexOf("?")){for(var a=c(t),s=[],o=0,u=a.length-1;o<u;o++){var l=a[o];"["!==l.substring(0,1)&&(l="."+l),s.push("if(!w"+l+")return")}var d=a[a.length-1];"["!==d.substring(0,1)&&(d="."+d);var f=new Function("w",s.join(";")+";return w"+d);return i[r]=f,f(e||MD.scope)}}}var s=/\{{1,2}[a-z0-9_.-\s]+\}{1,2}/gi,o={},u=/\[\d+\]$/,l=(i={},{});function d(t,e,r){for(var n=l[t],i=0;i<n.length;i++){var a=n[i];a.ticks!==r&&(a.ticks=r,a.exec(getx(a.path),e))}}function f(t,e,r){if(null!=t){var a="+"+t;if(i[a])return i[a](MD.scope,e,t,l,d,r);if(-1===t.indexOf("?")){for(var s=c(t),o=[],f=[],p=0;p<s.length-1;p++){var v=s[p],h=s[p+1]&&u.test(s[p+1])?"[]":"{}",g="w"+("["===v.substring(0,1)?"":".")+v;o.push("if(typeof("+g+")!=='object'||"+g+"==null)"+g+"="+h)}for(p=0;p<s.length-1;p++){v=s[p];f.push("binders['"+v+"']&&binderbind('"+v+"','"+t+"',$ticks)")}var m=s[s.length-1];f.push("binders['"+m+"']&&binderbind('"+m+"','"+t+"',$ticks)"),f.push("binders['!"+m+"']&&binderbind('!"+m+"','"+t+"',$ticks)"),"["!==m.substring(0,1)&&(m="."+m);var b=new Function("w","a","b","binders","binderbind","nobind","var $ticks=Math.random().toString().substring(2,8);if(!nobind){"+o.join(";")+";var v=typeof(a)=='function'?a(MAIN.compiler.get(b)):a;w"+m+"=v}"+f.join(";")+";return a");return i[a]=b,b(n.root,e,t,l,d,r),this}t=""}}function c(t){for(var e=t.split("."),r=[],n=[],i=0;i<e.length;i++){var a=e[i],s=a.indexOf("[");if(-1===s)if(-1===a.indexOf("-"))n.push(a),r.push(n.join("."));else{var o=n.splice(n.length-1);n.push(o+"['"+a+"']"),r.push(n.join("."))}else-1===a.indexOf("-")?(n.push(a.substring(0,s)),r.push(n.join(".")),n.splice(n.length-1),n.push(a),r.push(n.join("."))):(n.push("['"+a.substring(0,s)+"']"),r.push(n.join("")),n.push(a.substring(s)),r.push(n.join("")))}return r}function p(t,e,r){switch(typeof t){case"function":e=t,t={};break;case"string":var n=t,i=!0;return null==(t=a(n))&&(i=!1,t={}),e.call(t,t,n,function(e,r){setx(t,e,r)}),!i||void 0!==r&&!0!==r?C.ready?$set(n,t):immSetx(n,t,!0):v(n,!0),t}return e.call(t,t,""),t}Array.prototype.findValue=function(e,n,i,s,o){t.isFunction(e)&&(s=i,i=n,n=void 0,o=!1);var u,l=s;if(o&&(u="fv_"+e+"="+n,r.temp[u]))return r.temp[u];var d=this.findIndex(e,n);if(-1!==d){var f=this[d];f=-1===i.indexOf(".")?f[i]:a(i,f),o&&(r.temp[u]=l),l=null==f?s:f}return l},String.prototype.params=String.prototype.arg=function(t){return this.replace(s,function(e){var r=123===e.charCodeAt(1)?2:1,n=a(e.substring(r,e.length-r).trim(),t);return null==n?e:n})};function v(t,e,r,n){if(t instanceof Array){for(var i=0;i<t.length;i++)v(t[i],e,r);return M}if(!(t=pathmaker(t)))return M;if(33===t.charCodeAt(0)&&(t=t.substring(1)),!(t=t.replaceWildcard()))return M;!n&&$set(t,$get(t),!0);var s=[];void 0===r&&(r=1),M.skipproxy=t;for(var o=M.components.all,u=(i=0,o.length);i<u;i++){var l=o[i];if(l&&!l.disabled&&!l.$removed&&l.$loaded&&l.path&&l.$compare(t)){var d=l.get();l.setter&&(l.$skip=!1,l.setterX(d,t,r),l.$interaction(r)),l.$ready||(l.$ready=!0),!0===e?(l.$dirty_disabled||(l.$dirty=!0,l.$interaction(101)),l.$valid_disabled||(l.$valid=!0,l.$validate=!1,l.validate&&(l.$valid=l.validate(d),l.$interaction(102))),findcontrol2(l)):l.validate&&!l.$valid_disabled&&l.valid(l.validate(d),!0),l.state&&s.push(l)}}e&&clear("dirty","valid");for(i=0,u=s.length;i<u;i++)s[i].stateX(1,4);return emitwatch(t,a(t),r),M}return setInterval(function(){i={}},3e5),e.stores=n={root:Window,unwatch:unwatch,watch:watch,get:a,getx:getx,getr:getr,set:f,set2:function(t,e,r){if(null!=e){var n="++"+e;if(i[n])return i[n](t,r,e);for(var a=c(e),s=[],o=0;o<a.length-1;o++){var l=a[o],d=a[o+1]&&u.test(a[o+1])?"[]":"{}",f="w"+("["===l.substring(0,1)?"":".")+l;s.push("if(typeof("+f+")!=='object'||"+f+"==null)"+f+"="+d)}var p=a[a.length-1];"["!==p.substring(0,1)&&(p="."+p);var v=new Function("w","a","b",s.join(";")+";w"+p+"=a;return a");return i[n]=v,v(t,r,e),t}},immSetx:immSetx,setx:setx,setx2:setx2,setr:setr,toggle:toggle,toogle2:toogle2,cache:function(t,e,r){var n="$jcpath";if(WATCH(t,function(r,i){var a=storages.get(n);a?a[t]=i:(a={})[t]=i,storages.put(n,a,e)}),void 0===r||r){var i=storages.get(n);i&&void 0!==i[t]&&i[t]!==a(t)&&immSetx(t,i[t],!0)}return this},immInc:function e(r,n,i){if(r instanceof Array){for(var s=0;s<r.length;s++)e(r[s],n,i);return this}if(!r)return this;var o=a(r);return o?t.isNumber(o)||(o=parseFloat(o),isNaN(o)&&(o=0)):o=0,o+=n,immSetx(r,o,i),this},immExtend:function(t,e,r){if(t=pathmaker(t)){var n=a(t);null==n&&(n={}),immSetx(t,$.extend(n,e),r)}return this},immPush:function t(e,r,n){if(e instanceof Array){for(var i=0;i<e.length;i++)t(e[i],r,n);return this}var s=a(e),o=!1;s instanceof Array||(s=[],o=!0);var u=!0;return M.skipproxy=e,r instanceof Array?r.length?s.push.apply(s,r):u=!1:s.push(r),o?immSetx(e,s,n):u&&v(e,void 0,n),this},immUpdate:v,bind:bind,create:function(e){var r,n=!1;if(t.isString(e)){if(o[e])return o[e];n=!0,r=function(t){var r=e+(t?"."+t:"");M.skipproxy!==r?setTimeout(function(){M.skipproxy===r?M.skipproxy="":(function(){for(var t=arguments,e=M.components.all,r=Math.random().toString().substring(2,8),n=0;n<t.length;n++){var i=t[n];l[i]&&d(i,i,r)}for(var a=0,s=e.length;a<s;a++){var o=e[a];if(o&&!o.$removed&&!o.disabled&&o.$loaded&&o.path){for(var u=0,n=0;n<t.length;n++)if(o.path===t[n]){u=1;break}if(u){var f=o.get();o.setter&&o.setterX(f,o.path,1),o.state&&o.stateX(1,6),o.$interaction(1)}}}for(var n=0;n<t.length;n++)emitwatch(t[n],getx(t[n]),1)}(r),reset(r))},MD.delaybinder):M.skipproxy=""}}else r=e;var i=!1,a=e&&get2(e)||{},s={get:function(t,e,r){try{return new Proxy(t[e],s)}catch(n){return Reflect.get(t,e,r)}},defineProperty:function(t,e,n){return!i&&r(e,n),Reflect.defineProperty(t,e,n)},deleteProperty:function(t,e){return!i&&r(e),Reflect.deleteProperty(t,e)},apply:function(t,e,n){if(BLACKLIST[t.name]){i=!0;var a=Reflect.apply(t,e,n);return r("",n[0]),i=!1,a}return Reflect.apply(t,e,n)}},u=new Proxy(a,s);return n?(M.skipproxy=e,null==getx(e)&&setx(e,a,!0),o[e]=u):u},defaultValue:function(t,e,r){var n=t.split(REGMETA);if(n.length>1){var i=n[1],a=(t=n[0]).indexOf(".*");-1!==a&&(t=t.substring(0,a)),SET(t,new Function("return "+i)(),e>10?e:3,e>10?3:null)}return M.default(n[0],e,null,r)},errors:errors,make:p,evaluate:function(t,e,n){var i="eval"+e,s=r.temp[i],o=null;return o=n?t:a(t),s?s.call(o,o,t):(-1===e.indexOf("return")&&(e="return "+e),s=new Function("value","path",e),r.temp[i]=s,s.call(o,o,t))},make:p,modified:modified,pathmaker:pathmaker,rewrite:function(t,e,r){return(t=pathmaker(t))&&(M.skipproxy=t,f(t,e),emitwatch(t,e,r)),this},validate:function(t,e){var r=[],n=!0;t=pathmaker(t.replaceWildcard());var i=null;if(e){var s=!1;i={},e=e.remove(function(t){return"@"===t.substring(0,1)&&(i[t.substring(1)]=!0,s=!0,!0)}),!s&&(i=null),!e.length&&(e=null)}for(var o=M.components.all,u=0,l=o.length;u<l;u++){var d=o[u];d&&!d.$removed&&!d.disabled&&d.$loaded&&d.path&&d.$compare(t)&&(i&&(i.visible&&!d.visible()||i.hidden&&!d.hidden()||i.enabled&&d.find(SELINPUT).is(":disabled")||i.disabled&&d.find(SELINPUT).is(":enabled"))||(d.state&&r.push(d),d.$valid_disabled||(d.$validate=!0,d.validate&&(d.$valid=d.validate(a(d.path)),d.$interaction(102),d.$valid||(n=!1)))))}return clear("valid"),state(r,1,1),n}}});
//# sourceMappingURL=sourcemaps/stores.js.map
