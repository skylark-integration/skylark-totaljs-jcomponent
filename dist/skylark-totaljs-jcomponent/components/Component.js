/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/findFormat","./Usage"],function(t,e,i){var n={},r=0,s=555,a=200,h=t.klass({_construct(e,n){var s=this;s._id=s.ID="jc"+r++,s.usage=new i,s.$dirty=!0,s.$valid=!0,s.$validate=!1,s.$parser=[],s.$formatter=[],s.$skip=!1,s.$ready=!1,s.$path,s.trim=!0,s.$released=!1,s.$bindreleased=!0,s.$data={};var a=e.lastIndexOf("@");s.view=n,s.storing=n.storing,s.name=e,s.$name=-1===a?e:e.substring(0,a),s.version=-1===a?"":e.substring(a+1),s.path,s.type,s.id,s.disabled=!1,s.removed=!1,s.make,s.done,s.prerender,s.destroy,s.state,s.validate,s.released,s.getter=function(t,e,i){t=this.parser(t),this.getter2&&this.getter2(t,e),e&&(this.$skip=!0),i?this.view.componenter.com_validate2(this):t!==this.get()?this.set(t,2):3===e&&this.view.componenter.com_validate2(this)},s.stateX=function(t,e){var i=t+"x"+e;s.$bindchanges&&s.$state===i||(s.$state=i,s.config.$state&&EXEC.call(s,s.config.$state,t,e),s.state(t,e))},s.setterX=function(e,i,n){if(!(!s.setter||s.$bindexact&&s.path!==i&&-1===s.path.indexOf(i+".")&&n)){var r=s.$bindcache;if(arguments.length){if(0==s.view.storing.skipDec(s.path))return;if(s.$format&&(e=s.$format(e,i,n)),s.$bindreleased){if(s.$bindchanges){var a=t.hashCode(e);if(a===s.$valuehash)return;s.$valuehash=a}s.config.$setter&&EXEC.call(s,s.config.$setter,e,i,n),s.data("",e),s.setter(e,i,n),s.setter2&&s.setter2(e,i,n)}else s.$released?(r.is=!0,r.value=e,r.path=i,r.type=n):(r.value=e,r.path=i,r.type=n,r.bt||(r.is=!0,s.setterX()))}else!s.$released&&r&&r.is&&(r.is=!1,r.bt&&clearTimeout(r.bt),r.bt=setTimeout(function(i){var n=i.$bindcache;if(n.bt=0,i.$bindchanges){var r=t.hashCode(e);if(r===i.$valuehash)return;i.$valuehash=r}i.config.$setter&&EXEC.call(i,i.config.$setter,n.value,n.path,n.type),i.data("",n.value),i.setter(n.value,n.path,n.type),i.setter2&&i.setter2(n.value,n.path,n.type)},s.$bindtimeout,s))}},s.setter=function(t,e,i){var n=this;if(2===i&&n.$skip)n.$skip=!1;else{var r="select-one";t=n.formatter(t),n.view.helper.findControl(n.element[0],function(e){e.$com!==n&&(e.$com=n);var s=e.$com.path;if(!s||!s.length||s===n.path)if("checkbox"!==e.type)if(null==t&&(t=""),i||e.type===r||"range"===e.type||n.$default||t||n.view.componenter.autofill.push(e.$com),e.type===r||"select"===e.type){var a=$(e);a.val()!==t&&a.val(t)}else e.value!==t&&(e.value=t);else{var h=null!=t?t.toString().toLowerCase():"";(h="true"===h||"1"===h||"on"===h)!==e.checked&&(e.checked=h)}})}}}}),o=h.prototype;o.data=function(t,e){t||(t="@");var i=this.$data[t];if(1===arguments.length)return i?i.value:null;if(i){i.value=e;for(var n=0;n<i.items.length;n++){var r=i.items[n];r.el[0].parentNode&&r.exec(e,t)}}else this.$data[t]={value:e,items:[]};if(this.$ppc){var s=this.view.components.all;for(n=0;n<s.length;n++){var a=s[n];a.owner===this&&a.$pp&&t===a.path&&a.setterX(e,e,2)}}return e},o.$except=function(t){for(var e=self.$path,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(t[i]===e[n])return!0;return!1},o.$compare=function(t,e){if(e)return this.path===t;if(t.length>this.path.length){var i=t.lastIndexOf(".",this.path.length);return-1!==i&&this.path===t.substring(0,i)}for(var n=0,r=this.$path.length;n<r;n++)if(this.$path[n]===t)return!0},o.notmodified=function(e){return t.isString(e)&&(e=[e]),NOTMODIFIED(this._id,this.get(),e)},o.$waiter=function(t,e){var i=this;if(!0!==t){if(!1!==t){if(!i.$W&&(i.$W={}),i.$W[t]){for(n=0;n<i.$W[t].length;n++)if(i.$W[t][n]===e)return i;return i.$W[t].callback.push(e),i}return i.$W[t]={callback:[e]},i.$released||(i.$W[t].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},s,i,t)),i}if(i.$W){a=Object.keys(i.$W);for(var n=0;n<a.length;n++){var r=i.$W[a[n]];r&&clearInterval(r.id)}}}else if(i.$W)for(var a=Object.keys(i.$W),n=0;n<a.length;n++){var h=a[n];i.$W[h].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},s,i,h)}},o.hidden=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null===i,t&&(i?t.call(e):e.$waiter("hidden",t)),i},o.visible=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null!==i,t&&(i?t.call(e):e.$waiter("visible",t)),i},o.width=function(t){var e=this,i=e.element?e.element[0].offsetWidth:0;return t&&(i?t.call(e,i):e.$waiter("width",t)),i},o.height=function(t){var e=this,i=e.element?e.element[0].offsetHeight:0;return t&&(i?t.call(e,i):e.$waiter("height",t)),i},o.import=function(t,e,i,n){return this.view.import(t,this.element,e,i,n),this},o.release=function(t,e){var i=this;return void 0===t||i.$removed?i.$released:(i.attrd("jc-released",t),i.view.helper.nested(e||i.element).forEach(function(){var e=$(this);e.attrd("jc-released",t?"true":"false");var n=e[0].$com;if(n instanceof Object)if(n instanceof Array)for(var r=0,s=n.length;r<s;r++){var a=n[r];a.$removed||a.$released===t||(a.$released=t,a.released&&a.released(t,i),a.$waiter(!t),!t&&a.setterX())}else n.$removed||n.$released===t||(n.$released=t,n.released&&n.released(t,i),n.$waiter(!t),!t&&n.setterX())}),e||i.$released===t||(i.$released=t,i.released&&i.released(t,i),i.$waiter(!t),!t&&i.setterX()),t)},o.validate2=function(){return com_validate2(this)},o.exec=function(t,e,i,n,r,s){return this},o.replace=function(t,e){C.is&&(C.recompile=!0);var i="jc-scope",n=this.element,r=n.attrd(i);return this.element.rattrd("jc"),this.element[0].$com=null,r&&this.element.rattrd(i),e?n.off().remove():this.attrd("jc-replaced","true"),this.element=$(t),this.dom=this.element[0],this.dom.$com=this,this.attrd("jc",this.name),r&&this.attrd(i,r),this.siblings=!1,this},o.nested=function(){return self.view.helper.nested(this.element)},o.$interaction=function(t){var e=Date.now(),i=this;switch(t){case 0:i.usage.init=e,i.$binded=!0;break;case 1:i.usage.manually=e,i.$binded=!0;break;case 2:i.usage.input=e,i.$binded=!0;break;case 3:i.usage.default=e,i.$binded=!0;break;case 100:i.usage.custom=e;break;case 101:i.usage.dirty=e;break;case 102:i.usage.valid=e}return i},o.notify=function(){return NOTIFY(this.path),this},o.update=o.refresh=function(e,i){return this.$binded&&(t.isString(e)&&(i=e,e=!0),e?this.set(this.get(),i):(this.setter&&this.setterX(this.get(),this.path,1),this.$interaction(1))),this},o.tclass=function(t,e){return this.element.tclass(t,e),this},o.aclass=function(t,e){var i=this;return e?setTimeout(function(){i.element.aclass(t)},e):i.element.aclass(t),i},o.hclass=function(t){return this.element.hclass(t)},o.rclass=function(t,e){var i=this.element;return e?setTimeout(function(){i.rclass(t)},e):t?i.rclass(t):i.rclass(),this},o.rclass2=function(t){return this.element.rclass2(t),this},o.classes=function(t){var e="cls."+t,i=n[e],r=this,s=r.element;if(i)return i.add&&s.aclass(i.add),i.rem&&s.rclass(i.rem),r;for(var a=t instanceof Array?t:t.split(" "),h="",o="",l=0,c=a.length;l<c;l++){var u=a[l].substring(0,1);"-"===u?o+=(o?" ":"")+a[l].substring(1):h+=(h?" ":"")+("+"===u?a[l].substring(1):a[l])}return h&&s.aclass(h),o&&s.rclass(o),t instanceof Array?r:(n[e]={add:h,rem:o},r)},o.toggle=function(e,i,n){var r=!1;t.isString(e)||(n=i,i=e,e="hidden",r=!0),t.isNumber(i)?(n=i,i=void 0):r&&void 0!==i&&(i=!i);var s=this.element;return n?(setTimeout(function(){s.tclass(e,i)},n),this):(s.tclass(e,i),this)},o.noscope=o.noScope=function(t){return this.$noscope=void 0===t||!0===t,this},o.nocompile=function(){return this.element.attrd("jc-compile","0"),this},o.singleton=function(){return statics["$ST_"+this.name]=!0,this},o.blind=function(){return this.path=null,this.$path=null,this.$$path=null,this},o.bindchanges=o.bindChanges=function(t){return this.$bindchanges=null==t||!0===t,this},o.bindexact=o.bindExact=function(t){return this.$bindexact=null==t||!0===t,this},o.bindvisible=o.bindVisible=function(t){return this.$bindreleased=!1,this.$bindtimeout=t||a,this.$bindcache={},this},o.readonly=function(){return this.noDirty(),this.noValid(),this.getter=null,this.setter=null,this.$parser=null,this.$formatter=null,this},o.novalidate=o.noValid=o.noValidate=function(t){void 0===t&&(t=!0);return this.$valid_disabled=t,this.$valid=t,this},o.nodirty=o.noDirty=function(t){void 0===t&&(t=!0);return this.$dirty_disabled=t,this.$dirty=!t,this},o.datasource=function(t,e,i){var n=this.$datasource;return n&&this.unwatch(n.path,n.fn),t?(this.$datasource={path:t,fn:e},this.watch(t,e,!1!==i)):this.$datasource=null,this},o.setPath=function(t,i){var n=e(t);n?(t=n.path,this.$format=n.fn):i||(this.$format=null);var r=[];if("@"===t.substring(0,1)?(t=t.substring(1),this.$pp=!0,this.owner.$ppc=!0):this.$pp=!1,37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1)),33===(t=t.env()).charCodeAt(0))t=t.substring(1),r.push(t);else for(var s=t.split("."),a=[],h=0;h<s.length;h++){var o=s[h].lastIndexOf("[");if(-1!==o){var l=a.join(".");r.push(l+(l?".":"")+s[h].substring(0,o))}a.push(s[h]),r.push(a.join("."))}return this.path=t,this.$path=r,1!==i&&C.ready&&refresh(),this},o.attr=function(t,e){var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},o.attrd=function(t,e){t="data-"+t;var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},o.css=function(t,e){var i=this.element;return void 0===e?i.css(t):(i.css(t,e),this)},o.main=function(){if(void 0===this.$main){var t=this.parent().closest("[data-jc]")[0];this.$main=t?t.$com:null}return this.$main},o.rcwatch=function(t,e){return e?this.reconfigure(e):this},o.reconfigure=function(e,i,n){var r=this;t.isPlainObject(e)?Object.keys(e).forEach(function(t){var s=r.config[t];n||r.config[t]===e[t]||(r.config[t]=e[t]),i?i(t,e[t],n,n?void 0:s):r.configure&&r.configure(t,e[t],n,n?void 0:s),r.data("config."+t,e[t])}):"="===e.substring(0,1)?(e=e.substring(1),r.watch&&(r.$rcwatch&&r.unwatch(r.$rcwatch,r.rcwatch),r.watch(e,r.rcwatch),r.$rcwatch=e),r.reconfigure(get(e),i,n)):e.$config(function(t,e){var s=r.config[t];n||r.config[t]===e||(r.config[t]=e),r.data("config."+t,e),i?i(t,e,n,n?void 0:s):r.configure&&r.configure(t,e,n,n?void 0:s)});var s=r.config;return r.data("config",s),s.$type&&(r.type=s.$type),s.$id&&(r.id=s.$id),0==s.$compile&&r.nocompile(),s.$init&&(r.$init=s.$init),s.$class&&r.tclass(s.$class),s.$released&&r.release(1==s.$released),s.$reconfigure&&EXEC.call(s.$reconfigure,s),r},o.closest=function(t){return this.element.closest(t)},o.parent=function(t){return this.element.parent(t)};var l={number:1,boolean:1};return o.html=function(t){var e=this.element;return void 0===t?e.html():(t instanceof Array&&(t=t.join("")),t||l[typeof t]?e.empty().append(t):e.empty())},o.text=function(t){var e=this.element;return void 0===t?e.text():(t instanceof Array&&(t=t.join("")),t||l[typeof t]?e.empty().text(t):e.empty())},o.empty=function(){if(this.$children){for(var t=0,e=all.length;t<e;t++){var i=all[t];!i.$removed&&i.owner===this&&i.remove()}this.$children=0}var n=this.element;return n.empty(),n},o.append=function(t){var e=this.element;return t instanceof Array&&(t=t.join("")),t?e.append(t):e},o.event=function(){var t=this;return t.element?t.element.on.apply(t.element,arguments):setTimeout(function(e){t.event(t,e)},500,arguments),t},o.find=function(t){return this.element.find(t)},o.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},o.unwatch=function(t,e){return this.view.eventer.off("com"+this._id+"#watch",t,e),this},o.watch=function(e,i,n){return t.isFunction(e)?(n=i,i=e,e=this.path):e=pathmaker(e),this.on("watch",e,i,n),this},o.invalid=function(){return this.storing.invalid(this.path,this)},o.valid=function(t,e){return void 0===t?this.$valid:this.$valid_disabled?this:(this.$valid=t,this.$validate=!1,this.$interaction(102),this.view.componenter.cache.clear("valid"),!e&&this.state&&this.stateX(1,1),this)},o.style=function(t){return domx.style(t,this._id),this},o.change=function(t){return this.$dirty_disabled=!1,this.$dirty=!0,this.storing.change(this.path,void 0===t||t,this),this},o.used=function(){return this.$interaction(100)},o.dirty=function(t,e){return void 0===t?this.$dirty:this.$dirty_disabled?this:(this.$dirty=t,this.$interaction(101),this.view.componenter.cache.clear("dirty"),!e&&this.state&&this.stateX(2,2),this)},o.reset=function(){return this.storing.reset(this.path,0,this),this},o.setDefault=function(t){return this.$default=function(){return t},this},o.default=function(t){return this.storing.default(this.path,0,this,t),this},o.remove=o.kill=function(e){var i=this.element;return function(t){if(t.$W)for(var e=Object.keys(t.$W),i=0,n=e.length;i<n;i++){var r=t.$W[e[i]];r.id&&clearInterval(r.id)}}(this),this.view.helper.kill(i),this.$removed=1,this.removed=!0,this.view.eventer.off("com"+this._id+"#"),e||t.setTimeout2("$cleaner",cleaner2,100),!0},o.isRemoved=function(){},o.on=function(e,i,n,r){t.isFunction(i)?(r=n,n=i,i=""):i=i.replace(".*","");var s="";return"^"===e.substring(0,1)&&(s="^",e=e.substring(1)),this.view.eventer.on(s+"com"+this._id+"#"+e,i,n,r,this),this},o.formatter=function(e,i){if(t.isFunction(e))return!this.$formatter&&(this.$formatter=[]),!0===i?this.$formatter.unshift(e):this.$formatter.push(e),this;var n=this.$formatter;if(n&&n.length)for(var r=0,s=n.length;r<s;r++)e=n[r].call(this,this.path,e,this.type);return e=this.storing.format(e,this.path,this.type)},o.parser=function(t,e){var i=typeof t;if("function"===i)return!this.$parser&&(this.$parser=[]),!0===e?this.$parser.unshift(t):this.$parser.push(t),this;this.trim&&"string"===i&&(t=t.trim());var n=this.$parser;if(n&&n.length)for(var r=0,s=n.length;r<s;r++)t=n[r].call(this,this.path,t,this.type);return t=this.storing.parser(t,this.path,this.type)},o.emit=function(){return self.view.eventer.emit.apply(self.view.eventer,arguments),this},o.evaluate=function(t,e,i){return e||(e=t,t=this.path),self.storing.evaluate(t,e,i)},o.get=function(t){return t||(t=this.path),this.$pp?this.owner.data(this.path):t?this.storing.get(t):void 0},o.skip=function(t){return this.storing.skip(t||this.path),this},o.set=function(t,e){var i=arguments;return this.$pp?(this.owner.set(this.path,t),this):(3===i.length?this.storing.setx(i[0],i[1],i[2]):this.storing.setx(this.path,t,e),this)},o.inc=function(t,e){return this.storing.inc(this.path,t,e),this},o.extend=function(t,e){return this.storing.extend(this.path,t,e),this},o.rewrite=function(t){return this.storing.rewrite(this.path,t),this},o.push=function(t,e){return this.storing.push(this.path,t,e),this},o.compile=function(t){return!t&&this.attrd("jc-compile")&&this.attrd("jc-compile","1"),this.view.compile(t||this.element),this},h});
//# sourceMappingURL=../sourcemaps/components/Component.js.map
