/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/findFormat","./Usage"],function(t,e,i){var n={},r=0;function s(e){var i=!0;if(e.disabled)return i;if(e.$valid_disabled)return i;var n=[];return e.state&&n.push(e),e.$validate=!0,e.validate&&(e.$valid=e.validate(get(e.path)),e.$interaction(102),e.$valid||(i=!1)),clear("valid"),t.state(n,1,1),i}var a=t.klass({_construct(t,e){var n=this;n._id=n.ID="jc"+r++,n.usage=new i,n.$dirty=!0,n.$valid=!0,n.$validate=!1,n.$parser=[],n.$formatter=[],n.$skip=!1,n.$ready=!1,n.$path,n.trim=!0,n.$released=!1,n.$bindreleased=!0,n.$data={};var a=t.lastIndexOf("@");n.view=e,n.name=t,n.$name=-1===a?t:t.substring(0,a),n.version=-1===a?"":t.substring(a+1),n.path,n.type,n.id,n.disabled=!1,n.removed=!1,n.make,n.done,n.prerender,n.destroy,n.state,n.validate,n.released,n.getter=function(t,e,i){t=this.parser(t),this.getter2&&this.getter2(t,e),e&&(this.$skip=!0),i?s(this):t!==this.get()?this.set(t,2):3===e&&s(this)},n.stateX=function(t,e){var i=t+"x"+e;n.$bindchanges&&n.$state===i||(n.$state=i,n.config.$state&&EXEC.call(n,n.config.$state,t,e),n.state(t,e))},n.setterX=function(t,e,i){if(!(!n.setter||n.$bindexact&&n.path!==e&&-1===n.path.indexOf(e+".")&&i)){var r=n.$bindcache;if(arguments.length){if(skips[n.path])if(--skips[n.path]<=0)return void delete skips[n.path];if(n.$format&&(t=n.$format(t,e,i)),n.$bindreleased){if(n.$bindchanges){var s=HASH(t);if(s===n.$valuehash)return;n.$valuehash=s}n.config.$setter&&EXEC.call(n,n.config.$setter,t,e,i),n.data("",t),n.setter(t,e,i),n.setter2&&n.setter2(t,e,i)}else n.$released?(r.is=!0,r.value=t,r.path=e,r.type=i):(r.value=t,r.path=e,r.type=i,r.bt||(r.is=!0,n.setterX()))}else!n.$released&&r&&r.is&&(r.is=!1,r.bt&&clearTimeout(r.bt),r.bt=setTimeout(function(e){var i=e.$bindcache;if(i.bt=0,e.$bindchanges){var n=HASH(t);if(n===e.$valuehash)return;e.$valuehash=n}e.config.$setter&&EXEC.call(e,e.config.$setter,i.value,i.path,i.type),e.data("",i.value),e.setter(i.value,i.path,i.type),e.setter2&&e.setter2(i.value,i.path,i.type)},n.$bindtimeout,n))}},n.setter=function(t,e,i){var n=this;if(2===i&&n.$skip)n.$skip=!1;else{var r="select-one";t=n.formatter(t),findcontrol(n.element[0],function(e){e.$com!==n&&(e.$com=n);var s=e.$com.path;if(!s||!s.length||s===n.path)if("checkbox"!==e.type)if(null==t&&(t=""),i||e.type===r||"range"===e.type||n.$default||t||autofill.push(e.$com),e.type===r||"select"===e.type){var a=$(e);a.val()!==t&&a.val(t)}else e.value!==t&&(e.value=t);else{var h=null!=t?t.toString().toLowerCase():"";(h="true"===h||"1"===h||"on"===h)!==e.checked&&(e.checked=h)}})}}}}),h=a.prototype;h.data=function(t,e){t||(t="@");var i=this.$data[t];if(1===arguments.length)return i?i.value:null;if(i){i.value=e;for(var n=0;n<i.items.length;n++){var r=i.items[n];r.el[0].parentNode&&r.exec(e,t)}}else this.$data[t]={value:e,items:[]};if(this.$ppc){var s=this.view.components.all;for(n=0;n<s.length;n++){var a=s[n];a.owner===this&&a.$pp&&t===a.path&&a.setterX(e,e,2)}}return e},h.$except=function(t){for(var e=self.$path,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(t[i]===e[n])return!0;return!1},h.$compare=function(t,e){if(e)return this.path===t;if(t.length>this.path.length){var i=t.lastIndexOf(".",this.path.length);return-1!==i&&this.path===t.substring(0,i)}for(var n=0,r=this.$path.length;n<r;n++)if(this.$path[n]===t)return!0},h.notmodified=function(e){return t.isString(e)&&(e=[e]),NOTMODIFIED(this._id,this.get(),e)},h.$waiter=function(t,e){var i=this;if(!0!==t){if(!1!==t){if(!i.$W&&(i.$W={}),i.$W[t]){for(n=0;n<i.$W[t].length;n++)if(i.$W[t][n]===e)return i;return i.$W[t].callback.push(e),i}return i.$W[t]={callback:[e]},i.$released||(i.$W[t].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,t)),i}if(i.$W){s=Object.keys(i.$W);for(var n=0;n<s.length;n++){var r=i.$W[s[n]];r&&clearInterval(r.id)}}}else if(i.$W)for(var s=Object.keys(i.$W),n=0;n<s.length;n++){var a=s[n];i.$W[a].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,a)}},h.hidden=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null===i,t&&(i?t.call(e):e.$waiter("hidden",t)),i},h.visible=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null!==i,t&&(i?t.call(e):e.$waiter("visible",t)),i},h.width=function(t){var e=this,i=e.element?e.element[0].offsetWidth:0;return t&&(i?t.call(e,i):e.$waiter("width",t)),i},h.height=function(t){var e=this,i=e.element?e.element[0].offsetHeight:0;return t&&(i?t.call(e,i):e.$waiter("height",t)),i},h.import=function(t,e,i,n){return this.view.import(t,this.element,e,i,n),this},h.release=function(t,e){var i=this;return void 0===t||i.$removed?i.$released:(i.attrd("jc-released",t),helper.nested(e||i.element).forEach(function(){var e=$(this);e.attrd("jc-released",t?"true":"false");var n=e[0].$com;if(n instanceof Object)if(n instanceof Array)for(var r=0,s=n.length;r<s;r++){var a=n[r];a.$removed||a.$released===t||(a.$released=t,a.released&&a.released(t,i),a.$waiter(!t),!t&&a.setterX())}else n.$removed||n.$released===t||(n.$released=t,n.released&&n.released(t,i),n.$waiter(!t),!t&&n.setterX())}),e||i.$released===t||(i.$released=t,i.released&&i.released(t,i),i.$waiter(!t),!t&&i.setterX()),t)},h.validate2=function(){return s(this)},h.exec=function(t,e,i,n,r,s){return this},h.replace=function(t,e){C.is&&(C.recompile=!0);var i="jc-scope",n=this.element,r=n.attrd(i);return this.element.rattrd("jc"),this.element[0].$com=null,r&&this.element.rattrd(i),e?n.off().remove():this.attrd("jc-replaced","true"),this.element=$(t),this.dom=this.element[0],this.dom.$com=this,this.attrd("jc",this.name),r&&this.attrd(i,r),this.siblings=!1,this},h.nested=function(){return helper.nested(this.element)},h.$interaction=function(t){var e=Date.now(),i=this;switch(t){case 0:i.usage.init=e,i.$binded=!0;break;case 1:i.usage.manually=e,i.$binded=!0;break;case 2:i.usage.input=e,i.$binded=!0;break;case 3:i.usage.default=e,i.$binded=!0;break;case 100:i.usage.custom=e;break;case 101:i.usage.dirty=e;break;case 102:i.usage.valid=e}return i},h.notify=function(){return NOTIFY(this.path),this},h.update=h.refresh=function(e,i){return this.$binded&&(t.isString(e)&&(i=e,e=!0),e?this.set(this.get(),i):(this.setter&&this.setterX(this.get(),this.path,1),this.$interaction(1))),this},h.tclass=function(t,e){return this.element.tclass(t,e),this},h.aclass=function(t,e){var i=this;return e?setTimeout(function(){i.element.aclass(t)},e):i.element.aclass(t),i},h.hclass=function(t){return this.element.hclass(t)},h.rclass=function(t,e){var i=this.element;return e?setTimeout(function(){i.rclass(t)},e):t?i.rclass(t):i.rclass(),this},h.rclass2=function(t){return this.element.rclass2(t),this},h.classes=function(t){var e="cls."+t,i=n[e],r=this,s=r.element;if(i)return i.add&&s.aclass(i.add),i.rem&&s.rclass(i.rem),r;for(var a=t instanceof Array?t:t.split(" "),h="",l="",c=0,o=a.length;c<o;c++){var u=a[c].substring(0,1);"-"===u?l+=(l?" ":"")+a[c].substring(1):h+=(h?" ":"")+("+"===u?a[c].substring(1):a[c])}return h&&s.aclass(h),l&&s.rclass(l),t instanceof Array?r:(n[e]={add:h,rem:l},r)},h.toggle=function(e,i,n){var r=!1;t.isString(e)||(n=i,i=e,e="hidden",r=!0),t.isNumber(i)?(n=i,i=void 0):r&&void 0!==i&&(i=!i);var s=this.element;return n?(setTimeout(function(){s.tclass(e,i)},n),this):(s.tclass(e,i),this)},h.noscope=h.noScope=function(t){return this.$noscope=void 0===t||!0===t,this},h.nocompile=function(){return this.element.attrd("jc-compile","0"),this},h.singleton=function(){return statics["$ST_"+this.name]=!0,this},h.blind=function(){return this.path=null,this.$path=null,this.$$path=null,this},h.bindchanges=h.bindChanges=function(t){return this.$bindchanges=null==t||!0===t,this},h.bindexact=h.bindExact=function(t){return this.$bindexact=null==t||!0===t,this},h.bindvisible=h.bindVisible=function(t){return this.$bindreleased=!1,this.$bindtimeout=t||MD.delaybinder,this.$bindcache={},this},h.readonly=function(){return this.noDirty(),this.noValid(),this.getter=null,this.setter=null,this.$parser=null,this.$formatter=null,this},h.novalidate=h.noValid=h.noValidate=function(t){void 0===t&&(t=!0);return this.$valid_disabled=t,this.$valid=t,this},h.nodirty=h.noDirty=function(t){void 0===t&&(t=!0);return this.$dirty_disabled=t,this.$dirty=!t,this},h.datasource=function(t,e,i){var n=this.$datasource;return n&&this.unwatch(n.path,n.fn),t?(this.$datasource={path:t,fn:e},this.watch(t,e,!1!==i)):this.$datasource=null,this},h.setPath=function(t,i){var n=e(t);n?(t=n.path,this.$format=n.fn):i||(this.$format=null);var r=[];if("@"===t.substring(0,1)?(t=t.substring(1),this.$pp=!0,this.owner.$ppc=!0):this.$pp=!1,37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1)),33===(t=t.env()).charCodeAt(0))t=t.substring(1),r.push(t);else for(var s=t.split("."),a=[],h=0;h<s.length;h++){var l=s[h].lastIndexOf("[");if(-1!==l){var c=a.join(".");r.push(c+(c?".":"")+s[h].substring(0,l))}a.push(s[h]),r.push(a.join("."))}return this.path=t,this.$path=r,1!==i&&C.ready&&refresh(),this},h.attr=function(t,e){var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},h.attrd=function(t,e){t="data-"+t;var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},h.css=function(t,e){var i=this.element;return void 0===e?i.css(t):(i.css(t,e),this)},h.main=function(){if(void 0===this.$main){var t=this.parent().closest("[data-jc]")[0];this.$main=t?t.$com:null}return this.$main},h.rcwatch=function(t,e){return e?this.reconfigure(e):this},h.reconfigure=function(e,i,n){var r=this;t.isPlainObject(e)?Object.keys(e).forEach(function(t){var s=r.config[t];n||r.config[t]===e[t]||(r.config[t]=e[t]),i?i(t,e[t],n,n?void 0:s):r.configure&&r.configure(t,e[t],n,n?void 0:s),r.data("config."+t,e[t])}):"="===e.substring(0,1)?(e=e.substring(1),r.watch&&(r.$rcwatch&&r.unwatch(r.$rcwatch,r.rcwatch),r.watch(e,r.rcwatch),r.$rcwatch=e),r.reconfigure(get(e),i,n)):e.$config(function(t,e){var s=r.config[t];n||r.config[t]===e||(r.config[t]=e),r.data("config."+t,e),i?i(t,e,n,n?void 0:s):r.configure&&r.configure(t,e,n,n?void 0:s)});var s=r.config;return r.data("config",s),s.$type&&(r.type=s.$type),s.$id&&(r.id=s.$id),0==s.$compile&&r.nocompile(),s.$init&&(r.$init=s.$init),s.$class&&r.tclass(s.$class),s.$released&&r.release(1==s.$released),s.$reconfigure&&EXEC.call(s.$reconfigure,s),r},h.closest=function(t){return this.element.closest(t)},h.parent=function(t){return this.element.parent(t)};var l={number:1,boolean:1};return h.html=function(t){var e=this.element;return void 0===t?e.html():(t instanceof Array&&(t=t.join("")),t||l[typeof t]?e.empty().append(t):e.empty())},h.text=function(t){var e=this.element;return void 0===t?e.text():(t instanceof Array&&(t=t.join("")),t||l[typeof t]?e.empty().text(t):e.empty())},h.empty=function(){if(this.$children){for(var t=0,e=all.length;t<e;t++){var i=all[t];!i.$removed&&i.owner===this&&i.remove()}this.$children=0}var n=this.element;return n.empty(),n},h.append=function(t){var e=this.element;return t instanceof Array&&(t=t.join("")),t?e.append(t):e},h.event=function(){var t=this;return t.element?t.element.on.apply(t.element,arguments):setTimeout(function(e){t.event(t,e)},500,arguments),t},h.find=function(t){return this.element.find(t)},h.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},h.unwatch=function(t,e){return this.pathing.off("com"+this._id+"#watch",t,e),this},h.watch=function(e,i,n){return t.isFunction(e)?(n=i,i=e,e=this.path):e=pathmaker(e),this.on("watch",e,i,n),this},h.invalid=function(){return this.view.invalid(this.path,this)},h.valid=function(t,e){return void 0===t?this.$valid:this.$valid_disabled?this:(this.$valid=t,this.$validate=!1,this.$interaction(102),this.view.clear("valid"),!e&&this.state&&this.stateX(1,1),this)},h.style=function(t){return domx.style(t,this._id),this},h.change=function(t){return this.$dirty_disabled=!1,this.$dirty=!0,this.view.change(this.path,void 0===t||t,this),this},h.used=function(){return this.$interaction(100)},h.dirty=function(t,e){return void 0===t?this.$dirty:this.$dirty_disabled?this:(this.$dirty=t,this.$interaction(101),this.view.clear("dirty"),!e&&this.state&&this.stateX(2,2),this)},h.reset=function(){return this.view.reset(this.path,0,this),this},h.setDefault=function(t){return this.$default=function(){return t},this},h.default=function(t){return this.view.default(this.path,0,this,t),this},h.remove=h.kill=function(e){var i=this.element;return function(t){if(t.$W)for(var e=Object.keys(t.$W),i=0,n=e.length;i<n;i++){var r=t.$W[e[i]];r.id&&clearInterval(r.id)}}(this),helper.kill(i),this.$removed=1,this.removed=!0,this.pathing.off("com"+this._id+"#"),e||t.setTimeout2("$cleaner",cleaner2,100),!0},h.on=function(e,i,n,r){t.isFunction(i)?(r=n,n=i,i=""):i=i.replace(".*","");var s="";return"^"===e.substring(0,1)&&(s="^",e=e.substring(1)),this.pathing.on(s+"com"+this._id+"#"+e,i,n,r,this),this},h.formatter=function(e,i){if(t.isFunction(e))return!this.$formatter&&(this.$formatter=[]),!0===i?this.$formatter.unshift(e):this.$formatter.push(e),this;var n=this.$formatter;if(n&&n.length)for(var r=0,s=n.length;r<s;r++)e=n[r].call(this,this.path,e,this.type);return e=this.view.format(this.path,e,this.type)},h.parser=function(t,e){var i=typeof t;if("function"===i)return!this.$parser&&(this.$parser=[]),!0===e?this.$parser.unshift(t):this.$parser.push(t),this;this.trim&&"string"===i&&(t=t.trim());var n=this.$parser;if(n&&n.length)for(var r=0,s=n.length;r<s;r++)t=n[r].call(this,this.path,t,this.type);return t=this.view.parser(this.path,t,this.type)},h.emit=function(){return self.pathing.emit.apply(self.pathing,arguments),this},h.evaluate=function(t,e,i){return e||(e=t,t=this.path),self.view.evaluate(t,e,i)},h.get=function(t){return t||(t=this.path),this.$pp?this.owner.data(this.path):t?this.view.get(t):void 0},h.skip=function(t){return this.view.skip(t||this.path),this},h.set=function(t,e){var i=arguments;return this.$pp?(this.owner.set(this.path,t),this):(3===i.length?this.view.setx(i[0],i[1],i[2]):this.view.setx(this.path,t,e),this)},h.inc=function(t,e){return this.view.inc(this.path,t,e),this},h.extend=function(t,e){return this.view.extend(this.path,t,e),this},h.rewrite=function(t){return this.view.rewrite(this.path,t),this},h.push=function(t,e){return this.view.push(this.path,t,e),this},a});
//# sourceMappingURL=../sourcemaps/components/Component.js.map
