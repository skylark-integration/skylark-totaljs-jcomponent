/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["../langx","../binding/findFormat","./Usage"],function(t,e,i){var n={},s=0,r=t.klass({_construct(e,n){var r=this;r._id=r.ID="jc"+s++,r.usage=new i,r.$dirty=!0,r.$valid=!0,r.$validate=!1,r.$parser=[],r.$formatter=[],r.$skip=!1,r.$ready=!1,r.$path,r.trim=!0,r.$released=!1,r.$bindreleased=!0,r.$data={};var a=e.lastIndexOf("@");r.view=n,r.storing=n.storing,r.name=e,r.$name=-1===a?e:e.substring(0,a),r.version=-1===a?"":e.substring(a+1),r.path,r.type,r.id,r.disabled=!1,r.removed=!1,r.make,r.done,r.prerender,r.destroy,r.state,r.validate,r.released,r.getter=function(t,e,i){t=this.parser(t),this.getter2&&this.getter2(t,e),e&&(this.$skip=!0),i?this.view.componenter.com_validate2(this):t!==this.get()?this.set(t,2):3===e&&this.view.componenter.com_validate2(this)},r.stateX=function(t,e){var i=t+"x"+e;r.$bindchanges&&r.$state===i||(r.$state=i,r.config.$state&&EXEC.call(r,r.config.$state,t,e),r.state(t,e))},r.setterX=function(e,i,n){if(!(!r.setter||r.$bindexact&&r.path!==i&&-1===r.path.indexOf(i+".")&&n)){var s=r.$bindcache;if(arguments.length){if(skips[r.path])if(--skips[r.path]<=0)return void delete skips[r.path];if(r.$format&&(e=r.$format(e,i,n)),r.$bindreleased){if(r.$bindchanges){var a=t.hashCode(e);if(a===r.$valuehash)return;r.$valuehash=a}r.config.$setter&&EXEC.call(r,r.config.$setter,e,i,n),r.data("",e),r.setter(e,i,n),r.setter2&&r.setter2(e,i,n)}else r.$released?(s.is=!0,s.value=e,s.path=i,s.type=n):(s.value=e,s.path=i,s.type=n,s.bt||(s.is=!0,r.setterX()))}else!r.$released&&s&&s.is&&(s.is=!1,s.bt&&clearTimeout(s.bt),s.bt=setTimeout(function(i){var n=i.$bindcache;if(n.bt=0,i.$bindchanges){var s=t.hashCode(e);if(s===i.$valuehash)return;i.$valuehash=s}i.config.$setter&&EXEC.call(i,i.config.$setter,n.value,n.path,n.type),i.data("",n.value),i.setter(n.value,n.path,n.type),i.setter2&&i.setter2(n.value,n.path,n.type)},r.$bindtimeout,r))}},r.setter=function(t,e,i){var n=this;if(2===i&&n.$skip)n.$skip=!1;else{var s="select-one";t=n.formatter(t),findControl(n.element[0],function(e){e.$com!==n&&(e.$com=n);var r=e.$com.path;if(!r||!r.length||r===n.path)if("checkbox"!==e.type)if(null==t&&(t=""),i||e.type===s||"range"===e.type||n.$default||t||autofill.push(e.$com),e.type===s||"select"===e.type){var a=$(e);a.val()!==t&&a.val(t)}else e.value!==t&&(e.value=t);else{var h=null!=t?t.toString().toLowerCase():"";(h="true"===h||"1"===h||"on"===h)!==e.checked&&(e.checked=h)}})}}}}),a=r.prototype;a.data=function(t,e){t||(t="@");var i=this.$data[t];if(1===arguments.length)return i?i.value:null;if(i){i.value=e;for(var n=0;n<i.items.length;n++){var s=i.items[n];s.el[0].parentNode&&s.exec(e,t)}}else this.$data[t]={value:e,items:[]};if(this.$ppc){var r=this.view.components.all;for(n=0;n<r.length;n++){var a=r[n];a.owner===this&&a.$pp&&t===a.path&&a.setterX(e,e,2)}}return e},a.$except=function(t){for(var e=self.$path,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(t[i]===e[n])return!0;return!1},a.$compare=function(t,e){if(e)return this.path===t;if(t.length>this.path.length){var i=t.lastIndexOf(".",this.path.length);return-1!==i&&this.path===t.substring(0,i)}for(var n=0,s=this.$path.length;n<s;n++)if(this.$path[n]===t)return!0},a.notmodified=function(e){return t.isString(e)&&(e=[e]),NOTMODIFIED(this._id,this.get(),e)},a.$waiter=function(t,e){var i=this;if(!0!==t){if(!1!==t){if(!i.$W&&(i.$W={}),i.$W[t]){for(n=0;n<i.$W[t].length;n++)if(i.$W[t][n]===e)return i;return i.$W[t].callback.push(e),i}return i.$W[t]={callback:[e]},i.$released||(i.$W[t].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var s=0;s<i.callback.length;s++)i.callback[s].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,t)),i}if(i.$W){r=Object.keys(i.$W);for(var n=0;n<r.length;n++){var s=i.$W[r[n]];s&&clearInterval(s.id)}}}else if(i.$W)for(var r=Object.keys(i.$W),n=0;n<r.length;n++){var a=r[n];i.$W[a].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var s=0;s<i.callback.length;s++)i.callback[s].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,a)}},a.hidden=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null===i,t&&(i?t.call(e):e.$waiter("hidden",t)),i},a.visible=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null!==i,t&&(i?t.call(e):e.$waiter("visible",t)),i},a.width=function(t){var e=this,i=e.element?e.element[0].offsetWidth:0;return t&&(i?t.call(e,i):e.$waiter("width",t)),i},a.height=function(t){var e=this,i=e.element?e.element[0].offsetHeight:0;return t&&(i?t.call(e,i):e.$waiter("height",t)),i},a.import=function(t,e,i,n){return this.view.import(t,this.element,e,i,n),this},a.release=function(t,e){var i=this;return void 0===t||i.$removed?i.$released:(i.attrd("jc-released",t),i.view.helper.nested(e||i.element).forEach(function(){var e=$(this);e.attrd("jc-released",t?"true":"false");var n=e[0].$com;if(n instanceof Object)if(n instanceof Array)for(var s=0,r=n.length;s<r;s++){var a=n[s];a.$removed||a.$released===t||(a.$released=t,a.released&&a.released(t,i),a.$waiter(!t),!t&&a.setterX())}else n.$removed||n.$released===t||(n.$released=t,n.released&&n.released(t,i),n.$waiter(!t),!t&&n.setterX())}),e||i.$released===t||(i.$released=t,i.released&&i.released(t,i),i.$waiter(!t),!t&&i.setterX()),t)},a.validate2=function(){return com_validate2(this)},a.exec=function(t,e,i,n,s,r){return this},a.replace=function(t,e){C.is&&(C.recompile=!0);var i="jc-scope",n=this.element,s=n.attrd(i);return this.element.rattrd("jc"),this.element[0].$com=null,s&&this.element.rattrd(i),e?n.off().remove():this.attrd("jc-replaced","true"),this.element=$(t),this.dom=this.element[0],this.dom.$com=this,this.attrd("jc",this.name),s&&this.attrd(i,s),this.siblings=!1,this},a.nested=function(){return self.view.helper.nested(this.element)},a.$interaction=function(t){var e=Date.now(),i=this;switch(t){case 0:i.usage.init=e,i.$binded=!0;break;case 1:i.usage.manually=e,i.$binded=!0;break;case 2:i.usage.input=e,i.$binded=!0;break;case 3:i.usage.default=e,i.$binded=!0;break;case 100:i.usage.custom=e;break;case 101:i.usage.dirty=e;break;case 102:i.usage.valid=e}return i},a.notify=function(){return NOTIFY(this.path),this},a.update=a.refresh=function(e,i){return this.$binded&&(t.isString(e)&&(i=e,e=!0),e?this.set(this.get(),i):(this.setter&&this.setterX(this.get(),this.path,1),this.$interaction(1))),this},a.tclass=function(t,e){return this.element.tclass(t,e),this},a.aclass=function(t,e){var i=this;return e?setTimeout(function(){i.element.aclass(t)},e):i.element.aclass(t),i},a.hclass=function(t){return this.element.hclass(t)},a.rclass=function(t,e){var i=this.element;return e?setTimeout(function(){i.rclass(t)},e):t?i.rclass(t):i.rclass(),this},a.rclass2=function(t){return this.element.rclass2(t),this},a.classes=function(t){var e="cls."+t,i=n[e],s=this,r=s.element;if(i)return i.add&&r.aclass(i.add),i.rem&&r.rclass(i.rem),s;for(var a=t instanceof Array?t:t.split(" "),h="",l="",o=0,c=a.length;o<c;o++){var u=a[o].substring(0,1);"-"===u?l+=(l?" ":"")+a[o].substring(1):h+=(h?" ":"")+("+"===u?a[o].substring(1):a[o])}return h&&r.aclass(h),l&&r.rclass(l),t instanceof Array?s:(n[e]={add:h,rem:l},s)},a.toggle=function(e,i,n){var s=!1;t.isString(e)||(n=i,i=e,e="hidden",s=!0),t.isNumber(i)?(n=i,i=void 0):s&&void 0!==i&&(i=!i);var r=this.element;return n?(setTimeout(function(){r.tclass(e,i)},n),this):(r.tclass(e,i),this)},a.noscope=a.noScope=function(t){return this.$noscope=void 0===t||!0===t,this},a.nocompile=function(){return this.element.attrd("jc-compile","0"),this},a.singleton=function(){return statics["$ST_"+this.name]=!0,this},a.blind=function(){return this.path=null,this.$path=null,this.$$path=null,this},a.bindchanges=a.bindChanges=function(t){return this.$bindchanges=null==t||!0===t,this},a.bindexact=a.bindExact=function(t){return this.$bindexact=null==t||!0===t,this},a.bindvisible=a.bindVisible=function(t){return this.$bindreleased=!1,this.$bindtimeout=t||MD.delaybinder,this.$bindcache={},this},a.readonly=function(){return this.noDirty(),this.noValid(),this.getter=null,this.setter=null,this.$parser=null,this.$formatter=null,this},a.novalidate=a.noValid=a.noValidate=function(t){void 0===t&&(t=!0);return this.$valid_disabled=t,this.$valid=t,this},a.nodirty=a.noDirty=function(t){void 0===t&&(t=!0);return this.$dirty_disabled=t,this.$dirty=!t,this},a.datasource=function(t,e,i){var n=this.$datasource;return n&&this.unwatch(n.path,n.fn),t?(this.$datasource={path:t,fn:e},this.watch(t,e,!1!==i)):this.$datasource=null,this},a.setPath=function(t,i){var n=e(t);n?(t=n.path,this.$format=n.fn):i||(this.$format=null);var s=[];if("@"===t.substring(0,1)?(t=t.substring(1),this.$pp=!0,this.owner.$ppc=!0):this.$pp=!1,37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1)),33===(t=t.env()).charCodeAt(0))t=t.substring(1),s.push(t);else for(var r=t.split("."),a=[],h=0;h<r.length;h++){var l=r[h].lastIndexOf("[");if(-1!==l){var o=a.join(".");s.push(o+(o?".":"")+r[h].substring(0,l))}a.push(r[h]),s.push(a.join("."))}return this.path=t,this.$path=s,1!==i&&C.ready&&refresh(),this},a.attr=function(t,e){var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},a.attrd=function(t,e){t="data-"+t;var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},a.css=function(t,e){var i=this.element;return void 0===e?i.css(t):(i.css(t,e),this)},a.main=function(){if(void 0===this.$main){var t=this.parent().closest("[data-jc]")[0];this.$main=t?t.$com:null}return this.$main},a.rcwatch=function(t,e){return e?this.reconfigure(e):this},a.reconfigure=function(e,i,n){var s=this;t.isPlainObject(e)?Object.keys(e).forEach(function(t){var r=s.config[t];n||s.config[t]===e[t]||(s.config[t]=e[t]),i?i(t,e[t],n,n?void 0:r):s.configure&&s.configure(t,e[t],n,n?void 0:r),s.data("config."+t,e[t])}):"="===e.substring(0,1)?(e=e.substring(1),s.watch&&(s.$rcwatch&&s.unwatch(s.$rcwatch,s.rcwatch),s.watch(e,s.rcwatch),s.$rcwatch=e),s.reconfigure(get(e),i,n)):e.$config(function(t,e){var r=s.config[t];n||s.config[t]===e||(s.config[t]=e),s.data("config."+t,e),i?i(t,e,n,n?void 0:r):s.configure&&s.configure(t,e,n,n?void 0:r)});var r=s.config;return s.data("config",r),r.$type&&(s.type=r.$type),r.$id&&(s.id=r.$id),0==r.$compile&&s.nocompile(),r.$init&&(s.$init=r.$init),r.$class&&s.tclass(r.$class),r.$released&&s.release(1==r.$released),r.$reconfigure&&EXEC.call(r.$reconfigure,r),s},a.closest=function(t){return this.element.closest(t)},a.parent=function(t){return this.element.parent(t)};var h={number:1,boolean:1};return a.html=function(t){var e=this.element;return void 0===t?e.html():(t instanceof Array&&(t=t.join("")),t||h[typeof t]?e.empty().append(t):e.empty())},a.text=function(t){var e=this.element;return void 0===t?e.text():(t instanceof Array&&(t=t.join("")),t||h[typeof t]?e.empty().text(t):e.empty())},a.empty=function(){if(this.$children){for(var t=0,e=all.length;t<e;t++){var i=all[t];!i.$removed&&i.owner===this&&i.remove()}this.$children=0}var n=this.element;return n.empty(),n},a.append=function(t){var e=this.element;return t instanceof Array&&(t=t.join("")),t?e.append(t):e},a.event=function(){var t=this;return t.element?t.element.on.apply(t.element,arguments):setTimeout(function(e){t.event(t,e)},500,arguments),t},a.find=function(t){return this.element.find(t)},a.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},a.unwatch=function(t,e){return this.pathing.off("com"+this._id+"#watch",t,e),this},a.watch=function(e,i,n){return t.isFunction(e)?(n=i,i=e,e=this.path):e=pathmaker(e),this.on("watch",e,i,n),this},a.invalid=function(){return this.storing.invalid(this.path,this)},a.valid=function(t,e){return void 0===t?this.$valid:this.$valid_disabled?this:(this.$valid=t,this.$validate=!1,this.$interaction(102),this.storing.clear("valid"),!e&&this.state&&this.stateX(1,1),this)},a.style=function(t){return domx.style(t,this._id),this},a.change=function(t){return this.$dirty_disabled=!1,this.$dirty=!0,this.storing.change(this.path,void 0===t||t,this),this},a.used=function(){return this.$interaction(100)},a.dirty=function(t,e){return void 0===t?this.$dirty:this.$dirty_disabled?this:(this.$dirty=t,this.$interaction(101),this.storing.clear("dirty"),!e&&this.state&&this.stateX(2,2),this)},a.reset=function(){return this.storing.reset(this.path,0,this),this},a.setDefault=function(t){return this.$default=function(){return t},this},a.default=function(t){return this.storing.default(this.path,0,this,t),this},a.remove=a.kill=function(e){var i=this.element;return function(t){if(t.$W)for(var e=Object.keys(t.$W),i=0,n=e.length;i<n;i++){var s=t.$W[e[i]];s.id&&clearInterval(s.id)}}(this),this.view.helper.kill(i),this.$removed=1,this.removed=!0,this.pathing.off("com"+this._id+"#"),e||t.setTimeout2("$cleaner",cleaner2,100),!0},a.on=function(e,i,n,s){t.isFunction(i)?(s=n,n=i,i=""):i=i.replace(".*","");var r="";return"^"===e.substring(0,1)&&(r="^",e=e.substring(1)),this.pathing.on(r+"com"+this._id+"#"+e,i,n,s,this),this},a.formatter=function(e,i){if(t.isFunction(e))return!this.$formatter&&(this.$formatter=[]),!0===i?this.$formatter.unshift(e):this.$formatter.push(e),this;var n=this.$formatter;if(n&&n.length)for(var s=0,r=n.length;s<r;s++)e=n[s].call(this,this.path,e,this.type);return e=this.storing.format(this.path,e,this.type)},a.parser=function(t,e){var i=typeof t;if("function"===i)return!this.$parser&&(this.$parser=[]),!0===e?this.$parser.unshift(t):this.$parser.push(t),this;this.trim&&"string"===i&&(t=t.trim());var n=this.$parser;if(n&&n.length)for(var s=0,r=n.length;s<r;s++)t=n[s].call(this,this.path,t,this.type);return t=this.storing.parser(this.path,t,this.type)},a.emit=function(){return self.pathing.emit.apply(self.pathing,arguments),this},a.evaluate=function(t,e,i){return e||(e=t,t=this.path),self.storing.evaluate(t,e,i)},a.get=function(t){return t||(t=this.path),this.$pp?this.owner.data(this.path):t?this.storing.get(t):void 0},a.skip=function(t){return this.storing.skip(t||this.path),this},a.set=function(t,e){var i=arguments;return this.$pp?(this.owner.set(this.path,t),this):(3===i.length?this.storing.setx(i[0],i[1],i[2]):this.storing.setx(this.path,t,e),this)},a.inc=function(t,e){return this.storing.inc(this.path,t,e),this},a.extend=function(t,e){return this.storing.extend(this.path,t,e),this},a.rewrite=function(t){return this.storing.rewrite(this.path,t),this},a.push=function(t,e){return this.storing.push(this.path,t,e),this},a.compile=function(t){return!t&&this.attrd("jc-compile")&&this.attrd("jc-compile","1"),this.view.compile(t||this.element),this},r});
//# sourceMappingURL=../sourcemaps/components/Component.js.map
