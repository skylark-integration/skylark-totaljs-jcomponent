/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["skylark-utils-dom/query","./jc","./langx","./plugins"],function(e,l,n,t){var r="[data-bind],[bind],[data-vbind]",i=/,/g,a=/\s/g;function s(){}function c(e,t,r){if(n.isFunction(e))return!l.$parser&&(l.$parser=[]),!0===t?l.$parser.unshift(e):l.$parser.push(e),this;var i=l.$parser;if(i&&i.length)for(var a=0,s=i.length;a<s;a++)e=i[a].call(M,t,e,r);return e}e.fn.scope=function(){if(!this.length)return null;var e=this[0].$scopedata;if(e)return e;var l=this.closest("["+ATTRSCOPE+"]");return l.length&&(e=l[0].$scopedata)?e:null},s.prototype.exec=function(e,l,n,t,r){var i=this,a=i.el;if(null!=n){if(null==i.child)return;if(null==(i=i.child[n]))return}if((!i.notnull||null!=e)&&(i.selector&&(i.cache?a=i.cache:(a=a.find(i.selector)).length&&(i.cache=a)),a.length)){if(!t&&i.delay)return i.$delay&&clearTimeout(i.$delay),void(i.$delay=setTimeout(function(e,l,n,t,r){e.$delay=null,e.exec(l,n,t,!0,r)},i.delay,i,e,l,n,r));if(i.init){if(i.strict&&i.path!==l)return;if(i.track&&i.path!==l){r=!1;for(var s=0;s<i.track.length;s++)if(i.track[s]===l){r=!0;break}if(!r)return}}else i.init=1;i.def&&null==e&&(e=i.def),i.format&&(e=i.format(e,l));var c=null;if(r=!1!==r,!i.show||null==e&&i.show.$nn||(c=i.show.call(i.el,e,l,i.el),a.tclass("hidden",!c),c||(r=!1)),!i.hide||null==e&&i.hide.$nn||(c=i.hide.call(a,e,l,a),a.tclass("hidden",c),c&&(r=!1)),!i.invisible||null==e&&i.invisible.$nn||(c=i.invisible.call(i.el,e,l,i.el),a.tclass("invisible",c),c||(r=!1)),!i.visible||null==e&&i.visible.$nn||(c=i.visible.call(i.el,e,l,i.el),a.tclass("invisible",!c),c||(r=!1)),i.classes)for(s=0;s<i.classes.length;s++){var u=i.classes[s];u.fn.$nn&&null==e||a.tclass(u.name,!!u.fn.call(a,e,l,a))}if(r&&i.import&&(typeof i.import===TYPE_FN?e&&(!i.$ic&&(i.$ic={}),!i.$ic[e]&&IMPORT("ONCE "+e,a),i.$ic[e]=1):(IMPORT(i.import,a),delete i.import)),i.config&&(r||i.config.$nv)&&(null!=e||!i.config.$nn)&&(c=i.config.call(a,e,l,a)))for(s=0;s<a.length;s++){var h=a[s].$com;h&&h.$ready&&h.reconfigure(c)}if(i.html&&(r||i.html.$nv)&&(null==e&&i.html.$nn?a.html(i.htmlbk||""):(c=i.html.call(a,e,l,a),a.html(null==c?i.htmlbk||"":c))),i.text&&(r||i.text.$nv)&&(null==e&&i.text.$nn?a.html(i.htmlbk||""):(c=i.text.call(a,e,l,a),a.text(null==c?i.htmlbk||"":c))),i.val&&(r||i.val.$nv)&&(null==e&&i.val.$nn?a.val(i.valbk||""):(c=i.val.call(a,e,l,a),a.val(null==c?i.valbk||"":c))),!i.template||!r&&!i.template.$nv||null==e&&i.template.$nn||(DEFMODEL.value=e,DEFMODEL.path=l,a.html(i.template(DEFMODEL))),i.disabled&&(r||i.disabled.$nv)&&(null==e&&i.disabled.$nn?a.prop("disabled",1==i.disabledbk):(c=i.disabled.call(a,e,l,a),a.prop("disabled",1==c))),i.enabled&&(r||i.enabled.$nv)&&(null==e&&i.enabled.$nn?a.prop("disabled",0==i.enabledbk):(c=i.enabled.call(a,e,l,a),a.prop("disabled",!c))),i.checked&&(r||i.checked.$nv)&&(null==e&&i.checked.$nn?a.prop("checked",1==i.checkedbk):(c=i.checked.call(a,e,l,a),a.prop("checked",1==c))),i.title&&(r||i.title.$nv)&&(null==e&&i.title.$nn?a.attr("title",i.titlebk||""):(c=i.title.call(a,e,l,a),a.attr("title",null==c?i.titlebk||"":c))),i.href&&(r||i.href.$nv)&&(null==e&&i.href.$nn?a.attr(i.hrefbk||""):(c=i.href.call(a,e,l,a),a.attr("href",null==c?i.hrefbk||"":c))),i.src&&(r||i.src.$nv)&&(null==e&&i.src.$nn?a.attr("src",i.srcbk||""):(c=i.src.call(a,e,l,a),a.attr("src",null==c?i.srcbk||"":c))),!i.setter||!r&&!i.setter.$nv||null==e&&i.setter.$nn||i.setter.call(a,e,l,a),!i.change||null==e&&i.change.$nn||i.change.call(a,e,l,a),r&&null==n&&i.child)for(s=0;s<i.child.length;s++)i.exec(e,l,s,void 0,r);i.tclass&&(a.tclass(i.tclass),delete i.tclass)}},l.$parser.push(function(e,l,t){switch(t){case"number":case"currency":case"float":var r=+(n.isString(l)?l.replace(a,"").replace(i,"."):l);return isNaN(r)?null:r;case"date":case"datetime":return l?l instanceof Date?l:(l=l.parseDate())&&l.getTime()?l:null:null}return l});function u(l){var t=this,i=t.element=e(l);t.binders=[];var a=function(){var l=e(this),r=l.attrd("bind")||l.attr("bind")||l.attrd("vbind");this.$jcbind=c.parsebinder(this,r,n.empties.array),this.$jcbind&&t.binders.push(this.$jcbind)};i.filter(r).each(a),i.find(r).each(a)}var h=u.prototype;function d(e){return new u(e)}return h.on=function(){var e=this;return e.element.on.apply(e.element,arguments),e},h.remove=function(){var e=this,l=e.element;return l.find("*").off(),l.off().remove(),e.element=null,e.binders=null,e=null},h.set=function(e,l){var n=this;null==l&&(l=e,e="");for(var t=0;t<n.binders.length;t++){var r=n.binders[t];if(!e||e===r.path){var i=e||!r.path?l:$get(r.path,l);n.binders[t].exec(i,r.path)}}return n},l.binders={parser:c,jBinder:s,VBinder:u,vbind:d,vbindArray:function(l,n){var t={};t.html=l,t.items=[],t.element=n instanceof COM?n.element:e(n),t.element[0].$vbindarray=t,t.remove=function(){for(var e=0;e<t.items.length;e++)t.items[e].remove();t.checksum=null,t.items=null,t.html=null,t.element=null};var r=function(e){switch(typeof e){case TYPE_N:return e+"";case"boolean":return e?"1":"0";case TYPE_S:return e;default:return null==e?"":e instanceof Date?e.getTime():JSON.stringify(e)}},i=function(e){var l=0,n=t.items[0];if(n)for(var i=0;i<n.binders.length;i++){var a=n.binders[i],s=a.path;if(a.track)for(var c=0;c<a.track.length;c++)l+=r($get((s?s+".":"")+a.track[c].substring(1),e));else l+=r(s?$get(s,e):e)}return HASH(l)};return t.set=function(e,l){var n=null;if(!(e instanceof Array))return(s=t.items[e])&&(n=i(l),(u=s.element[0]).$bchecksum!==n&&(u.$bchecksum=n,s.set(l))),t;if(l=e,t.items.length>l.length)for(var r=t.items.splice(l.length),a=0;a<r.length;a++)r[a].remove();for(a=0;a<l.length;a++){var s,c=l[a];(s=t.items[a])||(s=d(t.html),t.items.push(s),s.element.attrd("index",a),s.element[0].$vbind=s,s.index=a,t.element.append(s.element));var u=s.element[0];n=i(c),u.$bchecksum!==n&&(u.$bchecksum=n,s.set(c))}},t}}});
//# sourceMappingURL=sourcemaps/binders.js.map
