/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["./jc","./langx","./caches","./topic","./Usage"],function(t,e,i,n,r){var s=[],a={},h=0;function l(t){var i=!0;if(t.disabled)return i;if(t.$valid_disabled)return i;var n=[];return t.state&&n.push(t),t.$validate=!0,t.validate&&(t.$valid=t.validate(get(t.path)),t.$interaction(102),t.$valid||(i=!1)),clear("valid"),e.state(n,1,1),i}var c=e.Evented.inherit({_construct(t){var e=this;e._id=e.ID="jc"+h++,e.usage=new r,e.$dirty=!0,e.$valid=!0,e.$validate=!1,e.$parser=[],e.$formatter=[],e.$skip=!1,e.$ready=!1,e.$path,e.trim=!0,e.$released=!1,e.$bindreleased=!0,e.$data={};var i=t.lastIndexOf("@");e.name=t,e.$name=-1===i?t:t.substring(0,i),e.version=-1===i?"":t.substring(i+1),e.path,e.type,e.id,e.disabled=!1,e.removed=!1,e.make,e.done,e.prerender,e.destroy,e.state,e.validate,e.released,e.getter=function(t,e,i){t=this.parser(t),this.getter2&&this.getter2(t,e),e&&(this.$skip=!0),i?l(this):t!==this.get()?this.set(t,2):3===e&&l(this)},e.stateX=function(t,i){var n=t+"x"+i;e.$bindchanges&&e.$state===n||(e.$state=n,e.config.$state&&EXEC.call(e,e.config.$state,t,i),e.state(t,i))},e.setterX=function(t,i,n){if(!(!e.setter||e.$bindexact&&e.path!==i&&-1===e.path.indexOf(i+".")&&n)){var r=e.$bindcache;if(arguments.length){if(d[e.path])if(--d[e.path]<=0)return void delete d[e.path];if(e.$format&&(t=e.$format(t,i,n)),e.$bindreleased){if(e.$bindchanges){var s=HASH(t);if(s===e.$valuehash)return;e.$valuehash=s}e.config.$setter&&EXEC.call(e,e.config.$setter,t,i,n),e.data("",t),e.setter(t,i,n),e.setter2&&e.setter2(t,i,n)}else e.$released?(r.is=!0,r.value=t,r.path=i,r.type=n):(r.value=t,r.path=i,r.type=n,r.bt||(r.is=!0,e.setterX()))}else!e.$released&&r&&r.is&&(r.is=!1,r.bt&&clearTimeout(r.bt),r.bt=setTimeout(function(e){var i=e.$bindcache;if(i.bt=0,e.$bindchanges){var n=HASH(t);if(n===e.$valuehash)return;e.$valuehash=n}e.config.$setter&&EXEC.call(e,e.config.$setter,i.value,i.path,i.type),e.data("",i.value),e.setter(i.value,i.path,i.type),e.setter2&&e.setter2(i.value,i.path,i.type)},e.$bindtimeout,e))}},e.setter=function(t,e,i){var n=this;if(2===i&&n.$skip)n.$skip=!1;else{var r="select-one";t=n.formatter(t),findcontrol(n.element[0],function(e){e.$com!==n&&(e.$com=n);var s=e.$com.path;if(!s||!s.length||s===n.path)if("checkbox"!==e.type)if(null==t&&(t=""),i||e.type===r||"range"===e.type||n.$default||t||autofill.push(e.$com),e.type===r||"select"===e.type){var a=$(e);a.val()!==t&&a.val(t)}else e.value!==t&&(e.value=t);else{var h=null!=t?t.toString().toLowerCase():"";(h="true"===h||"1"===h||"on"===h)!==e.checked&&(e.checked=h)}})}}}}),o=c.prototype;o.data=function(t,e){t||(t="@");var i=this.$data[t];if(1===arguments.length)return i?i.value:null;if(i){i.value=e;for(var n=0;n<i.items.length;n++){var r=i.items[n];r.el[0].parentNode&&r.exec(e,t)}}else this.$data[t]={value:e,items:[]};if(this.$ppc){var s=c.components.all;for(n=0;n<s.length;n++){var a=s[n];a.owner===this&&a.$pp&&t===a.path&&a.setterX(e,e,2)}}return e},o.$except=function(t){for(var e=self.$path,i=0;i<t.length;i++)for(var n=0;n<e.length;n++)if(t[i]===e[n])return!0;return!1},o.$compare=function(t,e){if(e)return this.path===t;if(t.length>this.path.length){var i=t.lastIndexOf(".",this.path.length);return-1!==i&&this.path===t.substring(0,i)}for(var n=0,r=this.$path.length;n<r;n++)if(this.$path[n]===t)return!0},o.notmodified=function(t){return e.isString(t)&&(t=[t]),NOTMODIFIED(this._id,this.get(),t)},o.$waiter=function(t,e){var i=this;if(!0!==t){if(!1!==t){if(!i.$W&&(i.$W={}),i.$W[t]){for(n=0;n<i.$W[t].length;n++)if(i.$W[t][n]===e)return i;return i.$W[t].callback.push(e),i}return i.$W[t]={callback:[e]},i.$released||(i.$W[t].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,t)),i}if(i.$W){s=Object.keys(i.$W);for(var n=0;n<s.length;n++){var r=i.$W[s[n]];r&&clearInterval(r.id)}}}else if(i.$W)for(var s=Object.keys(i.$W),n=0;n<s.length;n++){var a=s[n];i.$W[a].id=setInterval(function(t,e){var i=t.$W[e],n=t[e]();if(n){clearInterval(i.id);for(var r=0;r<i.callback.length;r++)i.callback[r].call(t,n);delete t.$W[e]}},MD.delaywatcher,i,a)}},o.hidden=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null===i,t&&(i?t.call(e):e.$waiter("hidden",t)),i},o.visible=function(t){var e=this,i=e.element?e.element[0].offsetParent:null;return i=null!==i,t&&(i?t.call(e):e.$waiter("visible",t)),i},o.width=function(t){var e=this,i=e.element?e.element[0].offsetWidth:0;return t&&(i?t.call(e,i):e.$waiter("width",t)),i},o.height=function(t){var e=this,i=e.element?e.element[0].offsetHeight:0;return t&&(i?t.call(e,i):e.$waiter("height",t)),i},o.import=function(t,e,i,n){return M.import(t,this.element,e,i,n),this},o.release=function(t,e){var i=this;return void 0===t||i.$removed?i.$released:(i.attrd("jc-released",t),(e||i.element).find(consts.ATTRCOM).each(function(){var e=$(this);e.attrd("jc-released",t?"true":"false");var n=e[0].$com;if(n instanceof Object)if(n instanceof Array)for(var r=0,s=n.length;r<s;r++){var a=n[r];a.$removed||a.$released===t||(a.$released=t,a.released&&a.released(t,i),a.$waiter(!t),!t&&a.setterX())}else n.$removed||n.$released===t||(n.$released=t,n.released&&n.released(t,i),n.$waiter(!t),!t&&n.setterX())}),e||i.$released===t||(i.$released=t,i.released&&i.released(t,i),i.$waiter(!t),!t&&i.setterX()),t)},o.validate2=function(){return l(this)},o.exec=function(t,e,i,n,r,s){var a=this;return a.find(consts.ATTRCOM).each(function(){var h=this;h.$com&&(h.$com.caller=a,h.$com[t]&&this.$com[t](e,i,n,r,s))}),a},o.replace=function(t,e){C.is&&(C.recompile=!0);var i="jc-scope",n=this.element,r=n.attrd(i);return this.element.rattrd("jc"),this.element[0].$com=null,r&&this.element.rattrd(i),e?n.off().remove():this.attrd("jc-replaced","true"),this.element=$(t),this.dom=this.element[0],this.dom.$com=this,this.attrd("jc",this.name),r&&this.attrd(i,r),this.siblings=!1,this},o.nested=function(){var t=[];return this.find(ATTRCOM).each(function(){var e=$(this),i=e[0].$com;i&&!e.attr(ATTRDEL)&&(i instanceof Array?t.push.apply(t,i):t.push(i))}),t},o.$interaction=function(t){var e=Date.now(),i=this;switch(t){case 0:i.usage.init=e,i.$binded=!0;break;case 1:i.usage.manually=e,i.$binded=!0;break;case 2:i.usage.input=e,i.$binded=!0;break;case 3:i.usage.default=e,i.$binded=!0;break;case 100:i.usage.custom=e;break;case 101:i.usage.dirty=e;break;case 102:i.usage.valid=e}return i},o.notify=function(){return NOTIFY(this.path),this},o.update=o.refresh=function(t,e){return this.$binded&&(typeof t===TYPE_S&&(e=t,t=!0),t?this.set(this.get(),e):(this.setter&&this.setterX(this.get(),this.path,1),this.$interaction(1))),this},o.tclass=function(t,e){return this.element.tclass(t,e),this},o.aclass=function(t,e){var i=this;return e?setTimeout(function(){i.element.aclass(t)},e):i.element.aclass(t),i},o.hclass=function(t){return this.element.hclass(t)},o.rclass=function(t,e){var i=this.element;return e?setTimeout(function(){i.rclass(t)},e):t?i.rclass(t):i.rclass(),this},o.rclass2=function(t){return this.element.rclass2(t),this},o.classes=function(t){var e="cls."+t,n=i.temp[e],r=this,s=r.element;if(n)return n.add&&s.aclass(n.add),n.rem&&s.rclass(n.rem),r;for(var a=t instanceof Array?t:t.split(" "),h="",l="",c=0,o=a.length;c<o;c++){var u=a[c].substring(0,1);"-"===u?l+=(l?" ":"")+a[c].substring(1):h+=(h?" ":"")+("+"===u?a[c].substring(1):a[c])}return h&&s.aclass(h),l&&s.rclass(l),t instanceof Array?r:(i.temp[e]={add:h,rem:l},r)},o.toggle=function(t,i,n){var r=!1;e.isString(t)||(n=i,i=t,t="hidden",r=!0),e.isNumber(i)?(n=i,i=void 0):r&&void 0!==i&&(i=!i);var s=this.element;return n?(setTimeout(function(){s.tclass(t,i)},n),this):(s.tclass(t,i),this)},o.noscope=o.noScope=function(t){return this.$noscope=void 0===t||!0===t,this},o.nocompile=function(){return this.element.attrd("jc-compile","0"),this},o.singleton=function(){return statics["$ST_"+this.name]=!0,this},o.blind=function(){return this.path=null,this.$path=null,this.$$path=null,this},o.bindchanges=o.bindChanges=function(t){return this.$bindchanges=null==t||!0===t,this},o.bindexact=o.bindExact=function(t){return this.$bindexact=null==t||!0===t,this},o.bindvisible=o.bindVisible=function(t){return this.$bindreleased=!1,this.$bindtimeout=t||MD.delaybinder,this.$bindcache={},this},o.readonly=function(){return this.noDirty(),this.noValid(),this.getter=null,this.setter=null,this.$parser=null,this.$formatter=null,this},o.novalidate=o.noValid=o.noValidate=function(t){void 0===t&&(t=!0);return this.$valid_disabled=t,this.$valid=t,this},o.nodirty=o.noDirty=function(t){void 0===t&&(t=!0);return this.$dirty_disabled=t,this.$dirty=!t,this},o.datasource=function(t,e,i){var n=this.$datasource;return n&&this.unwatch(n.path,n.fn),t?(this.$datasource={path:t,fn:e},this.watch(t,e,!1!==i)):this.$datasource=null,this},o.setPath=function(t,e){var i=findFormat(t);i?(t=i.path,this.$format=i.fn):e||(this.$format=null);var n=[];if("@"===t.substring(0,1)?(t=t.substring(1),this.$pp=!0,this.owner.$ppc=!0):this.$pp=!1,37===t.charCodeAt(0)&&(t="jctmp."+t.substring(1)),33===(t=t.env()).charCodeAt(0))t=t.substring(1),n.push(t);else for(var r=t.split("."),s=[],a=0;a<r.length;a++){var h=r[a].lastIndexOf("[");if(-1!==h){var l=s.join(".");n.push(l+(l?".":"")+r[a].substring(0,h))}s.push(r[a]),n.push(s.join("."))}return this.path=t,this.$path=n,1!==e&&C.ready&&refresh(),this},o.attr=function(t,e){var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},o.attrd=function(t,e){t="data-"+t;var i=this.element;return void 0===e?i.attr(t):(i.attr(t,e),this)},o.css=function(t,e){var i=this.element;return void 0===e?i.css(t):(i.css(t,e),this)},o.main=function(){if(void 0===this.$main){var t=this.parent().closest("[data-jc]")[0];this.$main=t?t.$com:null}return this.$main},o.rcwatch=function(t,e){return e?this.reconfigure(e):this},o.reconfigure=function(t,e,i){var n=this;typeof t===TYPE_O?Object.keys(t).forEach(function(r){var s=n.config[r];i||n.config[r]===t[r]||(n.config[r]=t[r]),e?e(r,t[r],i,i?void 0:s):n.configure&&n.configure(r,t[r],i,i?void 0:s),n.data("config."+r,t[r])}):"="===t.substring(0,1)?(t=t.substring(1),n.watch&&(n.$rcwatch&&n.unwatch(n.$rcwatch,n.rcwatch),n.watch(t,n.rcwatch),n.$rcwatch=t),n.reconfigure(get(t),e,i)):t.$config(function(t,r){var s=n.config[t];i||n.config[t]===r||(n.config[t]=r),n.data("config."+t,r),e?e(t,r,i,i?void 0:s):n.configure&&n.configure(t,r,i,i?void 0:s)});var r=n.config;return n.data("config",r),r.$type&&(n.type=r.$type),r.$id&&(n.id=r.$id),0==r.$compile&&n.nocompile(),r.$init&&(n.$init=r.$init),r.$class&&n.tclass(r.$class),r.$released&&n.release(1==r.$released),r.$reconfigure&&EXEC.call(r.$reconfigure,r),n},o.closest=function(t){return this.element.closest(t)},o.parent=function(t){return this.element.parent(t)};var u={number:1,boolean:1};o.html=function(t){var e=this.element;if(void 0===t)return e.html();t instanceof Array&&(t=t.join(""));var n=typeof t;i.current.element=e[0];var r=t||u[n]?e.empty().append(t):e.empty();return i.current.element=null,r},o.text=function(t){var e=this.element;return void 0===t?e.text():(t instanceof Array&&(t=t.join("")),t||u[typeof t]?e.empty().text(t):e.empty())},o.empty=function(){if(this.$children){for(var t=0,e=all.length;t<e;t++){var i=all[t];!i.$removed&&i.owner===this&&i.remove()}this.$children=0}var n=this.element;return n.empty(),n},o.append=function(t){var e=this.element;t instanceof Array&&(t=t.join("")),i.current.element=e[0];var n=t?e.append(t):e;return i.current.element=null,n},o.event=function(){var t=this;return t.element?t.element.on.apply(t.element,arguments):setTimeout(function(e){t.event(t,e)},500,arguments),t},o.find=function(t){return this.element.find(t)},o.isInvalid=function(){var t=!this.$valid;return t&&!this.$validate&&(t=!this.$dirty),t},o.unwatch=function(t,e){return OFF("com"+this._id+"#watch",t,e),this},o.watch=function(t,i,n){return e.isFunction(t)?(n=i,i=t,t=this.path):t=pathmaker(t),this.on("watch",t,i,n),this},o.invalid=function(){return INVALID(this.path,this)},o.valid=function(t,e){return void 0===t?this.$valid:this.$valid_disabled?this:(this.$valid=t,this.$validate=!1,this.$interaction(102),clear("valid"),!e&&this.state&&this.stateX(1,1),this)},o.style=function(t){return STYLE(t,this._id),this},o.change=function(t){return this.$dirty_disabled=!1,this.$dirty=!0,CHANGE(this.path,void 0===t||t,this),this},o.used=function(){return this.$interaction(100)},o.dirty=function(t,e){return void 0===t?this.$dirty:this.$dirty_disabled?this:(this.$dirty=t,this.$interaction(101),clear("dirty"),!e&&this.state&&this.stateX(2,2),this)},o.reset=function(){return M.reset(this.path,0,this),this},o.setDefault=function(t){return this.$default=function(){return t},this},o.default=function(t){return M.default(this.path,0,this,t),this},o.remove=o.kill=function(t){var e=this.element;return function(t){if(t.$W)for(var e=Object.keys(t.$W),i=0,n=e.length;i<n;i++){var r=t.$W[e[i]];r.id&&clearInterval(r.id)}}(this),e.removeData(ATTRDATA),e.attr(ATTRDEL,"true").find(ATTRCOM).attr(ATTRDEL,"true"),this.$removed=1,this.removed=!0,OFF("com"+this._id+"#"),!t&&setTimeout2("$cleaner",cleaner2,100),!0},o.on=function(t,i,r,s){e.isFunction(i)?(s=r,r=i,i=""):i=i.replace(".*","");var a="";return"^"===t.substring(0,1)&&(a="^",t=t.substring(1)),n.on(a+"com"+this._id+"#"+t,i,r,s,this),this},o.formatter=function(t,i){if(e.isFunction(t))return!this.$formatter&&(this.$formatter=[]),!0===i?this.$formatter.unshift(t):this.$formatter.push(t),this;var n=this.$formatter;if(n&&n.length)for(var r=0,s=n.length;r<s;r++)t=n[r].call(this,this.path,t,this.type);if((n=M.$formatter)&&n.length)for(r=0,s=n.length;r<s;r++)t=n[r].call(this,this.path,t,this.type);return t},o.parser=function(e,i){var n=typeof e;if("function"===n)return!this.$parser&&(this.$parser=[]),!0===i?this.$parser.unshift(e):this.$parser.push(e),this;this.trim&&"string"===n&&(e=e.trim());var r=this.$parser;if(r&&r.length)for(var s=0,a=r.length;s<a;s++)e=r[s].call(this,this.path,e,this.type);if((r=t.$parser)&&r.length)for(s=0,a=r.length;s<a;s++)e=r[s].call(this,this.path,e,this.type);return e},o.emit=function(){return n.emit.apply(M,arguments),this},o.evaluate=function(t,e,i){return e||(e=t,t=this.path),EVALUATE(t,e,i)},o.get=function(t){return t||(t=this.path),this.$pp?this.owner.data(this.path):t?paths.get(t):void 0},o.skip=function(t){return v(t||this.path),this},o.set=function(t,e){var i=arguments;return this.$pp?(this.owner.set(this.path,t),this):(3===i.length?paths.immSetx(i[0],i[1],i[2]):paths.immSetx(this.path,t,e),this)},o.inc=function(t,e){return paths.immInc(this.path,t,e),this},o.extend=function(t,e){return paths.immExtend(this.path,t,e),this},o.rewrite=function(t){return REWRITE(this.path,t),this},o.push=function(t,e){return paths.immPush(this.path,t,e),this};var f=registry={};var d={};function v(){for(var t=0;t<arguments.length;t++)for(var e=arguments[t].split(","),i=0,n=e.length;i<n;i++){var r=e[i].trim();d[r]?d[r]++:d[r]=1}}return e.mixin(c,{extend:function(t,e,i){if(typeof e===TYPE_FN){var n=i;i=e,e=n}a[t]?a[t].push({config:e,fn:i}):a[t]=[{config:e,fn:i}];for(var r=0,s=all.length;r<s;r++){var h=all[r];h.$removed&&t!==h.name||(e&&h.reconfigure(e,void 0,!0),i.call(h,h,h.config))}RECOMPILE()},configure:function(t,i){if(e.isString(t)){var n=[];t.split(" ").forEach(function(t){var e="";switch(t.trim().substring(0,1)){case"*":return void n.push("com.path.indexOf('{0}')!==-1".format(t.substring(1)));case".":e="path";break;case"#":e="id";break;default:e="$name"}n.push("com.{0}=='{1}'".format(e,"$name"===e?t:t.substring(1)))}),t=FN("com=>"+n.join("&&"))}s.push({fn:t,config:i})},registry:registry,register:function t(i,r,s,a){if(e.isFunction(r)&&(a=s,s=r,r=null),-1===i.indexOf(",")){f[i]&&warn("Components: Overwriting component:",i);var h=f[i]={name:i,config:r,declaration:s,shared:{},dependencies:a instanceof Array?a:null};n.emit("component.compile",i,h)}else i.split(",").forEach(function(e,i){(e=e.trim())&&t(e,r,s,i?null:a)})},extensions:a,skip:v}),t.Component=c});
//# sourceMappingURL=sourcemaps/Component.js.map
