/**
 * skylark-totaljs-jcomponent - A version of totaljs jcomponent that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-totaljs-jcomponent/
 * @license MIT
 */
define(["./jc","./defaults","./langx","./caches","./http","./plugins","./Component","./paths","./views"],function(e,t,n,i,r,o,a,c,s){var l=e,m=t;extensions=a.extensions,components=s.components,C=e.compiler={};var u=[];C.is=!1,C.recompile=!1,C.importing=0,C.pending=[],C.init=[],C.imports={},C.ready=[],C.get=get;var d={},f={$:0},p=[],h=setTimeout(load,2),g=!1;function v(){C.importing?setTimeout(v,1e3):n.setTimeout2("$fallback",function(){p.splice(0).wait(function(e,t){a.registry[e]?t():(warn("Downloading: "+e),r.importCache(m.fallback.format(e),m.fallbackcache,t))},3)},100)}function y(){var e=C.init.pop();void 0===e?!C.ready&&T():(!e.$removed&&function(e){if(!e)return;var i=e.element;extensions[e.name]&&extensions[e.name].forEach(function(t){t.config&&e.reconfigure(t.config,NOOP),t.fn.call(e,e,e.config)});var r,o=e.get();e.configure&&e.reconfigure(e.config,void 0,!0),e.$loaded=!0,e.setter?e.$prepared||(e.$prepared=!0,e.$ready=!0,(r=attrcom(e,"value"))&&(t[r]||(t[r]=new Function("return "+r)),e.$default=t[r],void 0===o&&(o=e.$default(),set(e.path,o),emitwatch(e.path,o,0))),e.$binded?e.$interaction(0):(e.$binded=!0,e.setterX(o,e.path,0),e.$interaction(0))):e.$binded=!0;e.validate&&!e.$valid_disabled&&(e.$valid=e.validate(e.get(),!0));e.done&&setTimeout(e.done,20),e.state&&e.stateX(0,3),e.$init&&setTimeout(function(){var t=get(e.$init);n.isFunction(t)&&t.call(e,e),e.$init=void 0},5);var a="component";i.trigger(a),i.off(a);var c=attrcom(i,"class");c&&function(e){setTimeout(function(){e=e.split(" ");for(var t=i[0].$jclass||{},n=0,r=e.length;n<r;n++)t[e[n]]||(i.tclass(e[n]),t[e[n]]=!0);i[0].$jclass=t},5)}(c),e.id&&EMIT("#"+e.id,e),EMIT("@"+e.name,e),EMIT(a,e),clear("find."),e.$lazy&&(e.$lazy.state=3,delete e.$lazy,EMIT("lazy",e.$name,!1))}(e),y())}function b(){var e=C.pending.shift();if(e)e();else if($domready&&(C.ready&&(C.is=!1),m.fallback&&f.$&&!C.importing)){for(var t=Object.keys(f),n=0;n<t.length;n++){if("$"!==t[n])1===f[t[n]]&&(p.push(t[n].toLowerCase()),f[t[n]]=2)}f.$=0,p.length&&v()}}var k={};function j(e,t,i,r){e.importing?WAIT(function(){return!0!==e.importing},function(){t(i,r)}):e.dependencies&&e.dependencies.length?(e.importing=!0,e.dependencies.wait(function(e,t){n.isFunction(e)?e(t):IMPORT((-1===e.indexOf("<")?"once ":"")+e,t)},function(){e.importing=!1,t(i,r)},3)):setTimeout(function(e,t,n){e(t,n)},5,t,i,r)}function T(e,t){if(C.is)C.recompile=!0;else{var r=[];if(W.READY instanceof Array&&r.push.apply(r,W.READY),W.jComponent instanceof Array&&r.push.apply(r,W.jComponent),W.components instanceof Array&&r.push.apply(r,W.components),r.length)for(;;){var o=r.shift();if(!o)break;o()}if(C.is=!0,function(){var e=[],t=0;if($(ATTRURL).each(function(){var t=this,n=$(t);if(!t.$downloaded){t.$downloaded=1;var i=attrcom(n,"url"),r="once "===i.substring(0,5).toLowerCase();if("!"===i.substring(0,1)||r){if(i=r?i.substring(5):i.substring(1),statics[i])return;statics[i]=2}var o={};o.url=i,o.element=n,o.callback=attrcom(n,"init"),o.path=attrcom(n,"path"),o.toggle=(attrcom(n,"class")||"").split(" "),o.expire=attrcom(n,"cache")||m.importcache,e.push(o)}}),e.length){var n=!1;C.importing++,async(e,function(e,r){var o=makeurl(e.url);AJAXCACHE("GET "+e.url,null,function(a){if(o="$import"+o,i.current.element=e.element[0],(a=statics[o]?removescripts(a):importscripts(importstyles(a)))&&REGCOM.test(a)&&(n=!0),e.element.html(a),statics[o]=!0,e.toggle.length&&e.toggle[0]&&u.push(e),e.callback&&!attrcom(e.element)){var c=get(e.callback);typeof c===TYPE_FN&&c(e.element)}i.current.element=null,t++,r()},e.expire)},function(){C.importing--,clear("valid","dirty","find"),t&&n&&T()})}}(),C.pending.length)!function(e){C.pending.push(function(){T(e)})}(e);else{var a=!1;if(function e(t,n,i,r){t=t?$(t)[0]:document.body;if(!t)return;var o=t?attrcom(t,"compile"):"1";if("0"===o||"false"===o)return;if((null==i||0===i)&&(r=[],t!==document.body)){var a=$(t).closest("["+ATTRSCOPE+"]");a&&a.length&&r.push(a[0])}var c=null;var s=!!t&&"true"===attrcom(t,"released");var l=attrcom(t,"scope");var m=null;l&&r.push(t);t.$jcbind||(c=t.getAttribute("data-bind")||t.getAttribute("bind"))&&(!m&&(m=[]),m.push({el:t,b:c}));var u=attrcom(t);!t.$com&&null!=u&&n(u,t,0,r);var d=t.childNodes;var f=[];void 0===i?i=0:i++;for(var p=0,h=d.length;p<h;p++){var g=d[p];if(g){if(!g.tagName)continue;if("0"===(o=g.getAttribute("data-jc-compile"))||"false"===o)continue;void 0===g.$com&&null!=(u=attrcom(g))&&(s&&g.setAttribute(ATTRREL,"true"),n(u||"",g,i,r)),g.$jcbind||(c=g.getAttribute("data-bind")||g.getAttribute("bind"))&&(g.$jcbind=1,!m&&(m=[]),m.push({el:g,b:c})),"0"!==(o=g.getAttribute("data-jc-compile"))&&"false"!==o&&g.childNodes.length&&"SCRIPT"!==g.tagName&&REGCOM.test(g.innerHTML)&&-1===f.indexOf(g)&&f.push(g)}}for(var p=0,h=f.length;p<h;p++)(g=f[p])&&e(g,n,i,r&&r.length?r:[]);if(m)for(var p=0;p<m.length;p++){var v=m[p];v.el.$jcbind=parsebinder(v.el,v.b,r)}}(e,function(e,t,r,o){var c=$(t),s=e.split(REGMETA);if(s.length?e=(s=s.trim(!0))[0]:s=null,a=!0,statics["$ST_"+e])remove(c);else{for(var u=[],d=e.split(","),p=0;p<d.length;p++){var h=!1;if(-1!==(e=d[p].trim()).indexOf("|")){for(var g=e.split("|"),v=0;v<g.length;v++){var y=g[v].trim();if(y&&l.$components[y]){e=y,h=!0;break}}h||(e=g[0].trim())}var b=!1;"lazy "===e.substring(0,5).toLowerCase()&&(e=e.substring(5),b=!0),h||-1!==e.lastIndexOf("@")||(versions[e]?e+="@"+versions[e]:m.version&&(e+="@"+m.version));var T=l.$components[e],x=null;if(b&&e){var E=e.substring(0,e.indexOf("@"));if(!(x=k[e])){k[e]=E&&e!==E?k[E]={state:1}:{state:1};continue}if(1===x.state)continue}if(T){1===f[e]&&(f.$--,delete f[e]);for(var A=new COM(T.name),N=t.parentNode;;){if(N.$com){var M=N.$com;A.owner=M,M.$children?M.$children++:M.$children=1;break}if("BODY"===N.nodeName)break;if(null==(N=N.parentNode))break}A.global=T.shared,A.element=c,A.dom=t;var w=attrcom(c,"path")||(s?"null"===s[1]?"":s[1]:"")||A._id;"%"===w.substring(0,1)&&(A.$noscope=!0),A.setPath(pathmaker(w,!0),1),A.config={},T.config&&A.reconfigure(T.config,NOOP);var R=attrcom(c,"config")||(s?"null"===s[2]?"":s[2]:"");R&&A.reconfigure(R,NOOP),A.$init||(A.$init=attrcom(c,"init")||null),A.type||(A.type=attrcom(c,"type")||""),A.id||(A.id=attrcom(c,"id")||A._id),A.siblings=d.length>1,A.$lazy=x;for(v=0;v<configs.length;v++){var D=configs[v];D.fn(A)&&A.reconfigure(D.config,NOOP)}i.current.com=A,T.declaration.call(A,A,A.config),i.current.com=null,s[3]&&c.attrd("jc-value",s[3]),A.init&&!statics[e]&&(statics[e]=!0,A.init()),t.$com=A,A.$noscope||(A.$noscope="true"===attrcom(c,"noscope"));var I=A.path?A.path.charCodeAt(0):0;if(!A.$noscope&&o.length&&!A.$pp){var P=initscopes(o);A.path&&33!==I&&35!==I?A.setPath("?"===A.path?P.path:-1===A.path.indexOf("?")?P.path+"."+A.path:A.path.replace(/\?/g,P.path),2):(A.$$path=EMPTYARRAY,A.path=""),A.scope=P,A.pathscope=P.path}u.push(A);var S=attrcom(c,"template")||A.template;if(S&&(A.template=S),"true"===attrcom(c,"released")&&(A.$released=!0),attrcom(c,"url"))warn('Components: You have to use "data-jc-template" attribute instead of "data-jc-url" for the component: {0}[{1}].'.format(A.name,A.path));else if(n.isString(S)){var W=function(e){A.prerender&&(e=A.prerender(e)),j(T,function(t,r){if(n.isFunction(t.make)){var o=i.current.com;i.current.com=t,t.make(e),i.current.com=o}O(r,t)},A,c)},L=S.substring(0,1);if("."===L||"#"===L||"["===L){W($(S).html());continue}var _="TE"+HASH(S),Y=statics[_];if(Y){W(Y);continue}$.get(makeurl(S),function(e){statics[_]=e,W(e)})}else if(n.isString(A.make)){if(-1!==A.make.indexOf("<")){j(T,function(e,t){e.prerender&&(e.make=e.prerender(e.make)),t.html(e.make),O(t,e)},A,c);continue}$.get(makeurl(A.make),function(e){j(T,function(t,n){t.prerender&&(e=t.prerender(e)),n.html(e),O(n,t)},A,c)})}else T.dependencies?j(T,function(e,t){if(e.make){var n=i.current.com;i.current.com=e,e.make(),i.current.com=n}O(t,e)},A,c):setTimeout(function(e,t,n){if(n.make){var r=i.current.com;i.current.com=n,n.make(),i.current.com=r}e(t,n)},5,O,c,A)}else{f[e]||(f[e]=1,f.$++);var z=attrcom(c,"import");if(!z){!statics["$NE_"+e]&&(statics["$NE_"+e]=!0);continue}if(1===C.imports[z])continue;if(2===C.imports[z]){!statics["$NE_"+e]&&(statics["$NE_"+e]=!0);continue}C.imports[z]=1,C.importing++,l.import(z,function(){C.importing--,C.imports[z]=2})}}u.length>0&&(c.$com=u.length>1?u:u[0])}},void 0),rebindbinder(),a&&C.pending.length||(C.is=!1),void 0!==e||!u.length)return b();async(u,function(e,t){for(var n=0,i=e.toggle.length;n<i;n++)e.element.tclass(e.toggle[n]);t()},b)}}}function O(e,t){var r,o=e[0].tagName;ACTRLS[o]?(t.$input=!0,r=t.element):r=e,findcontrol2(t,r),t.released&&t.released(t.$released),components.push(t),C.init.push(t),"BODY"!==o&&REGCOM.test(e[0].innerHTML)&&T(e),n.setTimeout2("$ready",function(){mediaquery(),components.refresh(),y();var e=components.length;if($(document).trigger("components",[e]),g||(g=!0,i.clear("valid","dirty","find"),topic.emit("init"),topic("ready")),n.setTimeout2("$initcleaner",function(){components.cleaner();for(var e=autofill.splice(0),t=0;t<e.length;t++){var n=e[t];!n.$default&&findcontrol(n.element[0],function(e){var t=$(e).val();if(t){var i=n.parser(t);i&&n.get()!==i&&(n.dirty(!1,!0),n.set(i,0))}return!0})}},1e3),C.is=!1,C.recompile&&(C.recompile=!1,T()),C.ready){for(var t=C.ready,r=0,o=t.length;r<o;r++)t[r](e);C.ready=void 0,T(),setTimeout(T,3e3),setTimeout(T,6e3),setTimeout(T,9e3)}},100)}function x(){for(var e,t,n=Object.keys(events),i=!1,r=n.length,a=0;a<r;a++){var c=n[a];for(e=0,t=events[c];;){if(void 0===(k=t[e++]))break;null==k.context||k.context.element&&inDOM(k.context.element[0])||(k.context&&k.context.element&&k.context.element.remove(),k.context.$removed=!0,k.context=null,t.splice(e-1,1),t.length||delete events[c],e-=2,i=!0)}}for(e=0;;){if(void 0===(k=watches[e++]))break;null==k.context||k.context.element&&inDOM(k.context.element[0])||(k.context&&k.context.element&&k.context.element.remove(),k.context.$removed=!0,k.context=null,watches.splice(e-1,1),e-=2,i=!0)}for(e=0,r=all.length;e<r;){var s=all[e++];if(s){var u=s.element;s.$removed||!u||!inDOM(u[0])||s.attr(ATTRDEL)?(topic.emit("destroy",s.name,s),topic.emit("component.destroy",s.name,s),delete statics["$ST_"+s.name],s.destroy&&s.destroy(),$("#css"+s.ID).remove(),"BODY"!==u[0].nodeName&&(u.off(),u.find("*").off(),u.remove()),s.$main=void 0,s.$data=null,s.dom=null,s.$removed=2,s.path=null,s.setter=null,s.setter2=null,s.getter=null,s.getter2=null,s.make=null,e--,all.splice(e,1),r=all.length,i=!0):(s.$parser&&!s.$parser.length&&(s.$parser=void 0),s.$formatter&&!s.$formatter.length&&(s.$formatter=void 0))}else e--,all.splice(e,1),r=all.length}n=Object.keys(binders);for(a=0;a<n.length;a++){t=binders[n[a]];for(var f=0;;){var p=t[f++];if(!p)break;if(!inDOM(p.el[0])){var h=p.el;h[0].$br||(h.off(),h.find("*").off(),h[0].$br=1),f--,t.splice(f,1)}}t.length||delete binders[n[a]]}clear("find");var g=o.registry;Object.keys(g).forEach(function(e){var t=g[e];inDOM(t.element[0])&&t.element[0].innerHTML||(t.$remove(),delete g[e])}),W.DATETIME=W.NOW=new Date;var v=W.NOW.getTime(),y=!1,b=!1;for(var c in d)d[c]<=v&&(delete d[c],y=!0);for(var c in m.localstorage&&y&&!l.isPRIVATEMODE&&localStorage.setItem(l.$localstorage+".blocked",JSON.stringify(d)),storage){var k;(!(k=storage[c]).expire||k.expire<=v)&&(delete storage[c],b=!0)}b&&save(),i&&(setTimeout2("$refresh",function(){all.sort(function(e,t){if(e.$removed||!e.path)return 1;if(t.$removed||!t.path)return-1;var n=e.path.length,i=t.path.length;return n>i?-1:n===i?LCOMPARER(e.path,t.path):1})},200),setTimeout(T,2e3))}return $(document).ready(function(){h&&(clearTimeout(h),load()),$(Window).on("orientationchange",mediaquery),$(document).on("input","input[data-jc-bind],textarea[data-jc-bind]",function(){var e=this.$com;if(e&&!e.$removed&&e.getter&&!1!==this.$jckeypress){if(this.$jcevent=2,void 0===this.$jckeypress){var t=attrcom(this,"keypress");if(t?this.$jckeypress="true"===t:null!=e.config.$realtime?this.$jckeypress=!0===e.config.$realtime:e.config.$binding?this.$jckeypress=1===e.config.$binding:this.$jckeypress=m.keypress,!1===this.$jckeypress)return}void 0===this.$jcdelay&&(this.$jcdelay=+(attrcom(this,"keypress-delay")||e.config.$delay||m.delay)),void 0===this.$jconly&&(this.$jconly="true"===attrcom(this,"keypress-only")||!0===e.config.$keypress||2===e.config.$binding),this.$jctimeout&&clearTimeout(this.$jctimeout),this.$jctimeout=setTimeout(keypressdelay,this.$jcdelay,this)}}),$(document).on("focus blur","input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]",function(e){var t=this.$com;if(t&&!t.$removed&&t.getter)if("focusin"===e.type)this.$jcevent=1;else if(1===this.$jcevent)t.dirty(!1,!0),t.getter(this.value,3);else if(this.$jcskip)this.$jcskip=!1;else{var n=t.$skip;n&&(t.$skip=!1),t.setter(t.get(),t.path,2),n&&(t.$skip=n)}}),$(document).on("change","input[data-jc-bind],textarea[data-jc-bind],select[data-jc-bind]",function(){var e=this.$com;if(!this.$jconly&&e&&!e.$removed&&e.getter){if(!1===this.$jckeypress)return this.$jcskip=!0,void e.getter(this.value,!1);switch(this.tagName){case"SELECT":var t=this[this.selectedIndex];return this.$jcevent=2,e.dirty(!1,!0),void e.getter(t.value,!1);case"INPUT":if("checkbox"===this.type||"radio"===this.type)return this.$jcevent=2,e.dirty(!1,!0),void e.getter(this.checked,!1)}this.$jctimeout?(e.dirty(!1,!0),e.getter(this.value,!0),clearTimeout(this.$jctimeout),this.$jctimeout=0):(this.$jcskip=!0,e.setter&&e.setterX(e.get(),this.path,2))}}),setTimeout(T,2),$domready=!0}),a.prototype.compile=function(e){return!e&&this.attrd("jc-compile")&&this.attrd("jc-compile","1"),T(e||this.element),this},setInterval(function(){x()},3e5),e.compiler={block:function(e,t,i){var r=e,o=d[r],a=Date.now();if(o>a)return!0;n.isString(t)&&(t=t.env().parseExpire());var c=m.localstorage&&t>1e4;return d[r]=a+t,!l.isPRIVATEMODE&&c&&localStorage.setItem(l.$localstorage+".blocked",JSON.stringify(d)),i&&i(),!1},compile:T}});
//# sourceMappingURL=sourcemaps/compiler.js.map
